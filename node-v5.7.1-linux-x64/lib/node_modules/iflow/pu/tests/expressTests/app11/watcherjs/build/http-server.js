/*
watcher.js 2.5.3- app watcher
Built on 2015-10-20
*/
"use strict";var express=require("express"),http=require("http"),path=require("path"),favicon=require("serve-favicon"),morgan=require("morgan"),cookieParser=require("cookie-parser"),bodyParser=require("body-parser"),_=require("underscore"),stampit=require("stampit"),logger=require("./logger"),httpServer=stampit().methods({setup:function(a){var b=this._app=express();b.set("env",a.env),logger.debug("Setting up watcher http internal server "+b.get("env")+" environment."),b.set("port",a.port),b.set("host",a.host),b.set("views",path.join(__dirname,a.views)),b.set("view engine","ejs"),b.use(favicon(path.join(__dirname,"public","img","favicon.ico"))),b.use(morgan("dev")),b.use(bodyParser.urlencoded({extended:!0})),b.use(bodyParser.json()),b.use(cookieParser()),b.use(express["static"](path.join(__dirname,a["static"]))),b.use("/views",express["static"](path.join(__dirname,a.views))),a.routesCallback(b),b.use(function(a,b,c){var d=new Error("Not Found");d.status=404,c(d)}),b.locals.pretty=!0,b.use(function(a,b,c,d){a=a||{error:"Unknown Error!"},c.status(a.status||500).json(a)})},start:function(a){var b=this._app;this._server=http.Server(b);var c=require("socket.io")(this._server);this._server.listen(b.get("port"),b.get("host"),a),this.io=c},addListener:function(a,b){this._server.on(a,b)},stop:function(){this._server.close()}});module.exports={create:function(a){var b={env:"production",port:process.env.PORT||3e3,host:process.env.HOST||"localhost",views:"./views","static":"./public",routesCallback:void 0};a=a||{},_.defaults(a,b),a.routesCallback=a.routesCallback||_.noop;var c=httpServer.create();return c.setup(a),c}};