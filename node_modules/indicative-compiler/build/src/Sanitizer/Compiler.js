"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const indicative_parser_1 = require("indicative-parser");
const TreeWalker_1 = require("../TreeWalker");
const ArrayWrapper_1 = require("./ArrayWrapper");
const SanitizationsRunner_1 = require("./SanitizationsRunner");
class Compiler {
    constructor(schema, _sanitizations) {
        this._sanitizations = _sanitizations;
        this._parsedSchema = indicative_parser_1.rulesParser(schema);
    }
    compile() {
        return new TreeWalker_1.TreeWalker((field, _type, rules, dotPath) => {
            return new SanitizationsRunner_1.SanitizationsRunner(field, dotPath, rules, this._sanitizations);
        }, (index, field, children, dotPath) => {
            return new ArrayWrapper_1.ArrayWrapper(field, index, children, dotPath);
        }).walk(this._parsedSchema);
    }
}
exports.Compiler = Compiler;
