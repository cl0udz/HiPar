"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const indicative_utils_1 = require("indicative-utils");
const subset_1 = require("../../raw/subset");
const isString_1 = require("../../raw/isString");
const MISSING_VALUE = 'subset:make sure to define subset collection';
const validation = {
    async: false,
    compile(args) {
        indicative_utils_1.ensureLength(args, MISSING_VALUE, 1);
        return args.map((arg) => indicative_utils_1.cast(arg, 'string'));
    },
    validate: (data, field, args, config) => {
        let fieldValue = indicative_utils_1.getValue(data, field);
        if (indicative_utils_1.skippable(fieldValue, field, config)) {
            return true;
        }
        if (isString_1.isString(fieldValue)) {
            fieldValue = fieldValue.split(',').map((val) => val.trim());
        }
        else if (Array.isArray(fieldValue)) {
            fieldValue = fieldValue.map((value) => indicative_utils_1.cast(value, 'string'));
        }
        else {
            return false;
        }
        if (!subset_1.subset(fieldValue, args)) {
            return false;
        }
        indicative_utils_1.patchValue(data, field, fieldValue);
        return true;
    },
};
exports.default = validation;
