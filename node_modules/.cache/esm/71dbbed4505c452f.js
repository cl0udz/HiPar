"main";let ObjectID;_505‍.w("mongodb",[["ObjectID",["ObjectID"],function(v){ObjectID=v}]]);let settings;_505‍.w("../../lib/settings",[["default",["settings"],function(v){settings=v}]]);let db;_505‍.w("../../lib/mongo",[["db",["db"],function(v){db=v}]]);let utils;_505‍.w("../../lib/utils",[["default",["utils"],function(v){utils=v}]]);let parse;_505‍.w("../../lib/parse",[["default",["parse"],function(v){parse=v}]]);let OrdersService;_505‍.w("./orders",[["default",["OrdersService"],function(v){OrdersService=v}]]);






class OrderAddressService {
	constructor() {}

	updateBillingAddress(id, data) {
		if (!ObjectID.isValid(id)) {
			return Promise.reject('Invalid identifier');
		}
		const orderObjectID = new ObjectID(id);
		const billing_address = this.getValidDocumentForUpdate(
			id,
			data,
			'billing_address'
		);

		return db
			.collection('orders')
			.updateOne(
				{
					_id: orderObjectID
				},
				{ $set: billing_address }
			)
			.then(res => OrdersService.getSingleOrder(id));
	}

	updateShippingAddress(id, data) {
		if (!ObjectID.isValid(id)) {
			return Promise.reject('Invalid identifier');
		}
		const orderObjectID = new ObjectID(id);
		const shipping_address = this.getValidDocumentForUpdate(
			id,
			data,
			'shipping_address'
		);

		return db
			.collection('orders')
			.updateOne(
				{
					_id: orderObjectID
				},
				{ $set: shipping_address }
			)
			.then(res => OrdersService.getSingleOrder(id));
	}

	getValidDocumentForUpdate(id, data, addressTypeName) {
		const keys = Object.keys(data);
		if (keys.length === 0) {
			return new Error('Required fields are missing');
		}

		let address = {};

		keys.forEach(key => {
			const value = data[key];
			if (key === 'coordinates' || key === 'details') {
				address[`${addressTypeName}.${key}`] = value;
			} else {
				address[`${addressTypeName}.${key}`] = parse.getString(value);
			}
		});

		return address;
	}
}

_505‍.d(new OrderAddressService());
