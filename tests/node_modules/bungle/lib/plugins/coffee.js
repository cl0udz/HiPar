import compiler from 'coffee-script';
import { ModPipe } from '../pipe';


export default class ExtPipe extends ModPipe {
    constructor() {
        super(...arguments);

        this.defaultConfig({
            pattern: '**/*.coffee'
        });
    }

    static schema() {
        return {
            description: 'Compile CoffeeScript to Javascript'
        };
    }

    rename(name) {
        return name.replace(/coffee$/, 'js');
    }

    async generate(file) {
        const source = (await file.source.content()).toString();
        return new Buffer(compiler.compile(source, {bare: true}));
    }
}
