'use strict';

require("core-js/modules/es.symbol");

require("core-js/modules/es.symbol.description");

require("core-js/modules/es.symbol.iterator");

require("core-js/modules/es.array.iterator");

require("core-js/modules/es.date.to-string");

require("core-js/modules/es.object.to-string");

require("core-js/modules/es.regexp.to-string");

require("core-js/modules/es.string.iterator");

require("core-js/modules/web.dom-collections.iterator");

function _typeof3(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof3 = function _typeof3(obj) { return typeof obj; }; } else { _typeof3 = function _typeof3(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof3(obj); }

function _typeof2(obj) {
  if (typeof Symbol === "function" && _typeof3(Symbol.iterator) === "symbol") {
    _typeof2 = function _typeof2(obj) {
      return _typeof3(obj);
    };
  } else {
    _typeof2 = function _typeof2(obj) {
      return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : _typeof3(obj);
    };
  }

  return _typeof2(obj);
}

require("core-js/modules/es.symbol");

require("core-js/modules/es.symbol.description");

require("core-js/modules/es.symbol.iterator");

require("core-js/modules/es.array.iterator");

require("core-js/modules/es.date.to-string");

require("core-js/modules/es.object.to-string");

require("core-js/modules/es.regexp.to-string");

require("core-js/modules/es.string.iterator");

require("core-js/modules/web.dom-collections.iterator");

function _typeof(obj) {
  if (typeof Symbol === "function" && _typeof2(Symbol.iterator) === "symbol") {
    _typeof = function _typeof(obj) {
      return _typeof2(obj);
    };
  } else {
    _typeof = function _typeof(obj) {
      return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : _typeof2(obj);
    };
  }

  return _typeof(obj);
}

var t = require('tap');

var test = t.test;

var _require = require('stream'),
    Readable = _require.Readable;

var internals = require('../../lib/contentTypeParser')[Symbol["for"]('internals')];

var Request = require('../../lib/request');

var Reply = require('../../lib/reply');

test('rawBody function', function (t) {
  t.plan(2);
  var body = Buffer.from('你好 世界');
  var parser = {
    asString: true,
    asBuffer: false,
    fn: function fn(req, bodyInString, done) {
      t.equal(bodyInString, body.toString());
      t.is(_typeof(done), 'function');
      return {
        then: function then(cb) {
          cb();
        }
      };
    }
  };
  var res = {};

  res.end = function () {};

  res.writeHead = function () {};

  res.log = {
    error: function error() {},
    info: function info() {}
  };
  var context = {
    Reply: Reply,
    Request: Request,
    preHandler: [],
    onSend: [],
    _parserOptions: {
      limit: 1024
    }
  };
  var rs = new Readable();

  rs._read = function () {};

  rs.headers = {
    'content-length': body.length
  };
  var request = new Request('params', rs, 'query', {
    'content-length': body.length
  }, 'log');
  var reply = new Reply(res, context, {});

  var done = function done() {};

  internals.rawBody(request, reply, reply.context._parserOptions, parser, done);
  rs.emit('data', body.toString());
  rs.emit('end');
});