'use strict';

var t = require('tap');

var test = t.test;

var Fastify = require('../..');

var supportedMethods = ['DELETE', 'GET', 'HEAD', 'PATCH', 'POST', 'PUT', 'OPTIONS'];
test('fastify.all should add all the methods to the same url', function (t) {
  t.plan(supportedMethods.length * 2);
  var fastify = Fastify();
  fastify.all('/', function (req, reply) {
    reply.send({
      method: req.raw.method
    });
  });
  supportedMethods.forEach(injectRequest);

  function injectRequest(method) {
    var options = {
      url: '/',
      method: method
    };

    if (method === 'POST' || method === 'PUT' || method === 'PATCH') {
      options.payload = {
        hello: 'world'
      };
    }

    fastify.inject(options, function (err, res) {
      t.error(err);
      var payload = JSON.parse(res.payload);
      t.deepEqual(payload, {
        method: method
      });
    });
  }
});