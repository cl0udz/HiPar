'use strict';

var t = require('tap');

var Fastify = require('..');

var fastify = Fastify();
fastify.route({
  method: 'POST',
  path: '/jsonBody',
  handler: function handler(req, reply) {
    throw new Error('kaboom');
  }
});
var reqOpts = {
  method: 'POST',
  url: '/jsonBody',
  payload: {
    hello: 'world'
  }
};
process.on('uncaughtException', function (err) {
  t.equal(err.message, 'kaboom');
});
fastify.inject(reqOpts, function (e, res) {
  t.plan(1);
  t.fail('should not be called');
});