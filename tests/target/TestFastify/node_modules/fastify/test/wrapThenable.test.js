'use strict';

var t = require('tap');

var test = t.test;

var _require = require('../lib/symbols'),
    kReplySentOverwritten = _require.kReplySentOverwritten;

var wrapThenable = require('../lib/wrapThenable');

test('should resolve immediately when reply[kReplySentOverwritten] is true', function (t) {
  var reply = {};
  reply[kReplySentOverwritten] = true;
  var thenable = Promise.resolve();
  wrapThenable(thenable, reply);
  t.end();
});
test('should reject immediately when reply[kReplySentOverwritten] is true', function (t) {
  t.plan(1);
  var reply = {
    res: {}
  };
  reply[kReplySentOverwritten] = true;
  reply.log = {
    error: function error(_ref) {
      var err = _ref.err;
      t.strictEqual(err.message, 'Reply sent already');
    }
  };
  var thenable = Promise.reject(new Error('Reply sent already'));
  wrapThenable(thenable, reply);
});