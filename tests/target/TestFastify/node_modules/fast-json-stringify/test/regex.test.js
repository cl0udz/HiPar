'use strict';

require("core-js/modules/es.regexp.constructor");

require("core-js/modules/es.regexp.exec");

require("core-js/modules/es.regexp.to-string");

var test = require('tap').test;

var validator = require('is-my-json-valid');

var build = require('..');

test('object with RexExp', function (t) {
  t.plan(3);
  var schema = {
    title: 'object with RegExp',
    type: 'object',
    properties: {
      reg: {
        type: 'string'
      }
    }
  };
  var obj = {
    reg: /"([^"]|\\")*"/
  };
  var stringify = build(schema);
  var validate = validator(schema);
  var output = stringify(obj);

  try {
    JSON.parse(output);
    t.pass();
  } catch (e) {
    t.fail();
  }

  t.equal(obj.reg.source, new RegExp(JSON.parse(output).reg).source);
  t.ok(validate(JSON.parse(output)), 'valid schema');
});