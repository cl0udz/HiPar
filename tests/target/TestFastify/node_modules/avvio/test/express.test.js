'use strict';

var t = require('tap');

var express = require('express');

var http = require('http');

var boot = require('..');

var app = express();
boot.express(app); // It does:
//
// boot(app, {
//   expose: {
//     use: 'load'
//   }
// })

t.plan(2);
var loaded = false;
app.load(function (app, opts, done) {
  loaded = true;
  app.use(function (req, res) {
    res.end('hello world');
  });
  done();
});
app.after(function (cb) {
  t.ok(loaded, 'plugin loaded');
  var server = app.listen(3000, cb);
  t.tearDown(server.close.bind(server));
});
app.ready(function () {
  http.get('http://localhost:3000').on('response', function (res) {
    var data = '';
    res.on('data', function (chunk) {
      data += chunk;
    });
    res.on('end', function () {
      t.equal(data, 'hello world');
    });
  });
});