"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const indicative_parser_1 = require("indicative-parser");
const ArrayWrapper_1 = require("./ArrayWrapper");
const ValidationsRunner_1 = require("./ValidationsRunner");
const TreeWalker_1 = require("../TreeWalker");
class Compiler {
    constructor(schema, messages, _validations) {
        this._validations = _validations;
        this._parsedSchema = indicative_parser_1.rulesParser(schema);
        this._parsedMessages = indicative_parser_1.messagesParser(messages);
    }
    compile() {
        return new TreeWalker_1.TreeWalker((field, type, rules, dotPath, pointer) => {
            const messages = this._parsedMessages.fields[pointer] || {};
            const genericMessage = this._parsedMessages.rules;
            return new ValidationsRunner_1.ValidationsRunner(field, type, dotPath, rules, this._validations, messages, genericMessage);
        }, (index, field, children, dotPath) => {
            return new ArrayWrapper_1.ArrayWrapper(field, index, children, dotPath);
        }).walk(this._parsedSchema);
    }
}
exports.Compiler = Compiler;
