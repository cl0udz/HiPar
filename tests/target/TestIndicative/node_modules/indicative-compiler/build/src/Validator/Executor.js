"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Collector_1 = require("./Collector");
class Executor {
    constructor(_fns) {
        this._fns = _fns;
    }
    async exec(data, Formatter, config, bail, removeAdditional) {
        const root = { tip: data, original: data, pointer: '' };
        const collector = new Collector_1.Collector(new Formatter(), removeAdditional);
        for (let fn of this._fns) {
            let passed = false;
            if (fn.async) {
                passed = await fn.execAsync(root, collector, config, bail);
            }
            else {
                passed = fn.exec(root, collector, config, bail);
            }
            if (!passed && bail) {
                break;
            }
        }
        const errors = collector.getErrors();
        if (!errors) {
            return removeAdditional ? collector.getData() : data;
        }
        throw errors;
    }
}
exports.Executor = Executor;
