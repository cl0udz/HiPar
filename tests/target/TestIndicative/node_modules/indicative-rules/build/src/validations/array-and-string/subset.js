"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var indicative_utils_1 = require("indicative-utils");

var subset_1 = require("../../raw/subset");

var isString_1 = require("../../raw/isString");

var MISSING_VALUE = 'subset:make sure to define subset collection';
var validation = {
  async: false,
  compile: function compile(args) {
    indicative_utils_1.ensureLength(args, MISSING_VALUE, 1);
    return args.map(function (arg) {
      return indicative_utils_1.cast(arg, 'string');
    });
  },
  validate: function validate(data, field, args, config) {
    var fieldValue = indicative_utils_1.getValue(data, field);

    if (indicative_utils_1.skippable(fieldValue, field, config)) {
      return true;
    }

    if (isString_1.isString(fieldValue)) {
      fieldValue = fieldValue.split(',').map(function (val) {
        return val.trim();
      });
    } else if (Array.isArray(fieldValue)) {
      fieldValue = fieldValue.map(function (value) {
        return indicative_utils_1.cast(value, 'string');
      });
    } else {
      return false;
    }

    if (!subset_1.subset(fieldValue, args)) {
      return false;
    }

    indicative_utils_1.patchValue(data, field, fieldValue);
    return true;
  }
};
exports["default"] = validation;