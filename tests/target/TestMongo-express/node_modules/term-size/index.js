'use strict';

require("core-js/modules/es.array.join");

require("core-js/modules/es.parse-int");

require("core-js/modules/es.regexp.exec");

require("core-js/modules/es.string.match");

require("core-js/modules/es.string.split");

var path = require('path');

var execa = require('execa');

var create = function create(columns, rows) {
  return {
    columns: parseInt(columns, 10),
    rows: parseInt(rows, 10)
  };
};

module.exports = function () {
  var env = process.env;
  var stdout = process.stdout;
  var stderr = process.stderr;

  if (stdout && stdout.columns && stdout.rows) {
    return create(stdout.columns, stdout.rows);
  }

  if (stderr && stderr.columns && stderr.rows) {
    return create(stderr.columns, stderr.rows);
  } // These values are static, so not the first choice


  if (env.COLUMNS && env.LINES) {
    return create(env.COLUMNS, env.LINES);
  }

  if (process.platform === 'win32') {
    try {
      // Binary: https://github.com/sindresorhus/win-term-size
      var size = execa.sync(path.join(__dirname, 'vendor/windows/term-size.exe')).stdout.split(/\r?\n/);

      if (size.length === 2) {
        return create(size[0], size[1]);
      }
    } catch (err) {}
  } else {
    if (process.platform === 'darwin') {
      try {
        // Binary: https://github.com/sindresorhus/macos-term-size
        var _size = execa.shellSync(path.join(__dirname, 'vendor/macos/term-size')).stdout.split(/\r?\n/);

        if (_size.length === 2) {
          return create(_size[0], _size[1]);
        }
      } catch (err) {}
    } // `resize` is preferred as it works even when all file descriptors are redirected
    // https://linux.die.net/man/1/resize


    try {
      var _size2 = execa.sync('resize', ['-u']).stdout.match(/\d+/g);

      if (_size2.length === 2) {
        return create(_size2[0], _size2[1]);
      }
    } catch (err) {}

    try {
      var columns = execa.sync('tput', ['cols']).stdout;
      var rows = execa.sync('tput', ['lines']).stdout;

      if (columns && rows) {
        return create(columns, rows);
      }
    } catch (err) {}
  }

  return create(80, 24);
};