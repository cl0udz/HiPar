'use strict';

require("core-js/modules/es.array.concat");

require("core-js/modules/es.array.concat");

var supertest = require('supertest');

var defaultConf = require('./testDefaultConfig');

var testUtils = require('./testUtils');

var middleware = require('../lib/middleware');

exports.createServer = function () {
  var app = middleware(defaultConf());
  var httpServer = app.listen();
  var request = supertest.agent(httpServer); // There is currently a race condition with collection registering to mongoDb.
  // @TODO fix the race condition and remove me

  return testUtils.timeoutPromise(50).then(function () {
    return {
      request: request,
      close: function close() {
        return testUtils.asPromise(function (cb) {
          return httpServer.close(cb);
        });
      }
    };
  });
};

exports.getDocumentUrl = function (db, collection, documentId) {
  return "/db/".concat(db, "/").concat(collection, "/").concat(JSON.stringify(documentId));
};