#!/usr/bin/env node
"use strict";

require("core-js/modules/es.array.join");

require("core-js/modules/es.array.slice");

require("core-js/modules/es.array.join");

require("core-js/modules/es.array.slice");

require("core-js/modules/es.array.join");

require("core-js/modules/es.array.slice");

var flat = require('.');

var fs = require('fs');

var path = require('path');

var readline = require('readline');

if (process.stdin.isTTY) {
  // Read from file
  var file = path.resolve(process.cwd(), process.argv.slice(2)[0]);
  if (!file) usage();
  if (!fs.existsSync(file)) usage();
  out(require(file));
} else {
  // Read from newline-delimited STDIN
  var lines = [];
  readline.createInterface({
    input: process.stdin,
    output: process.stdout,
    terminal: false
  }).on('line', function (line) {
    return lines.push(line);
  }).on('close', function () {
    return out(JSON.parse(lines.join('\n')));
  });
}

function out(data) {
  process.stdout.write(JSON.stringify(flat(data), null, 2));
}

function usage() {
  console.log("\nUsage:\n\nflat foo.json\ncat foo.json | flat\n");
  process.exit();
}