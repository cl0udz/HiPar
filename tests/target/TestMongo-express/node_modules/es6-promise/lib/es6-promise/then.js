"use strict";

require("core-js/modules/es.object.define-property");

require("core-js/modules/es.object.define-property");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = then;

var _internal = require("./-internal");

var _asap = require("./asap");

function then(onFulfillment, onRejection) {
  var parent = this;
  var child = new this.constructor(_internal.noop);

  if (child[_internal.PROMISE_ID] === undefined) {
    (0, _internal.makePromise)(child);
  }

  var state = parent._state;

  if (state) {
    var callback = arguments[state - 1];
    (0, _asap.asap)(function () {
      (0, _internal.invokeCallback)(state, child, callback, parent._result);
    });
  } else {
    (0, _internal.subscribe)(parent, child, onFulfillment, onRejection);
  }

  return child;
}