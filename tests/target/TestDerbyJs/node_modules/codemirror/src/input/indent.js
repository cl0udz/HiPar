"use strict";

require("core-js/modules/es.array.slice");

require("core-js/modules/es.object.define-property");

require("core-js/modules/es.regexp.exec");

require("core-js/modules/es.string.match");

require("core-js/modules/es.array.slice");

require("core-js/modules/es.object.define-property");

require("core-js/modules/es.regexp.exec");

require("core-js/modules/es.string.match");

require("core-js/modules/es.array.slice");

require("core-js/modules/es.object.define-property");

require("core-js/modules/es.regexp.exec");

require("core-js/modules/es.string.match");

require("core-js/modules/es.array.slice");

require("core-js/modules/es.object.define-property");

require("core-js/modules/es.regexp.exec");

require("core-js/modules/es.string.match");

require("core-js/modules/es.array.slice");

require("core-js/modules/es.object.define-property");

require("core-js/modules/es.regexp.exec");

require("core-js/modules/es.string.match");

require("core-js/modules/es.array.slice");

require("core-js/modules/es.object.define-property");

require("core-js/modules/es.regexp.exec");

require("core-js/modules/es.string.match");

require("core-js/modules/es.array.slice");

require("core-js/modules/es.object.define-property");

require("core-js/modules/es.regexp.exec");

require("core-js/modules/es.string.match");

require("core-js/modules/es.array.slice");

require("core-js/modules/es.object.define-property");

require("core-js/modules/es.regexp.exec");

require("core-js/modules/es.string.match");

require("core-js/modules/es.array.slice");

require("core-js/modules/es.object.define-property");

require("core-js/modules/es.regexp.exec");

require("core-js/modules/es.string.match");

require("core-js/modules/es.array.slice");

require("core-js/modules/es.regexp.exec");

require("core-js/modules/es.string.match");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.indentLine = indentLine;

var _highlight = require("../line/highlight.js");

var _pos2 = require("../line/pos.js");

var _utils_line = require("../line/utils_line.js");

var _changes = require("../model/changes.js");

var _selection = require("../model/selection.js");

var _selection_updates = require("../model/selection_updates.js");

var _misc = require("../util/misc.js");

function indentLine(cm, n, how, aggressive) {
  var doc = cm.doc,
      state;
  if (how == null) how = "add";

  if (how == "smart") {
    // Fall back to "prev" when the mode doesn't have an indentation
    // method.
    if (!doc.mode.indent) how = "prev";else state = (0, _highlight.getContextBefore)(cm, n).state;
  }

  var tabSize = cm.options.tabSize;
  var line = (0, _utils_line.getLine)(doc, n),
      curSpace = (0, _misc.countColumn)(line.text, null, tabSize);
  if (line.stateAfter) line.stateAfter = null;
  var curSpaceString = line.text.match(/^\s*/)[0],
      indentation;

  if (!aggressive && !/\S/.test(line.text)) {
    indentation = 0;
    how = "not";
  } else if (how == "smart") {
    indentation = doc.mode.indent(state, line.text.slice(curSpaceString.length), line.text);

    if (indentation == _misc.Pass || indentation > 150) {
      if (!aggressive) return;
      how = "prev";
    }
  }

  if (how == "prev") {
    if (n > doc.first) indentation = (0, _misc.countColumn)((0, _utils_line.getLine)(doc, n - 1).text, null, tabSize);else indentation = 0;
  } else if (how == "add") {
    indentation = curSpace + cm.options.indentUnit;
  } else if (how == "subtract") {
    indentation = curSpace - cm.options.indentUnit;
  } else if (typeof how == "number") {
    indentation = curSpace + how;
  }

  indentation = Math.max(0, indentation);
  var indentString = "",
      pos = 0;
  if (cm.options.indentWithTabs) for (var i = Math.floor(indentation / tabSize); i; --i) {
    pos += tabSize;
    indentString += "\t";
  }
  if (pos < indentation) indentString += (0, _misc.spaceStr)(indentation - pos);

  if (indentString != curSpaceString) {
    (0, _changes.replaceRange)(doc, indentString, (0, _pos2.Pos)(n, 0), (0, _pos2.Pos)(n, curSpaceString.length), "+input");
    line.stateAfter = null;
    return true;
  } else {
    // Ensure that, if the cursor was in the whitespace at the start
    // of the line, it is moved to the end of that space.
    for (var _i = 0; _i < doc.sel.ranges.length; _i++) {
      var range = doc.sel.ranges[_i];

      if (range.head.line == n && range.head.ch < curSpaceString.length) {
        var _pos = (0, _pos2.Pos)(n, curSpaceString.length);

        (0, _selection_updates.replaceOneSelection)(doc, _i, new _selection.Range(_pos, _pos));
        break;
      }
    }
  }
}