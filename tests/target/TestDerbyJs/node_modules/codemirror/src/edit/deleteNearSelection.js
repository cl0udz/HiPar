"use strict";

require("core-js/modules/es.object.define-property");

require("core-js/modules/es.object.define-property");

require("core-js/modules/es.object.define-property");

require("core-js/modules/es.object.define-property");

require("core-js/modules/es.object.define-property");

require("core-js/modules/es.object.define-property");

require("core-js/modules/es.object.define-property");

require("core-js/modules/es.object.define-property");

require("core-js/modules/es.object.define-property");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.deleteNearSelection = deleteNearSelection;

var _operations = require("../display/operations.js");

var _scrolling = require("../display/scrolling.js");

var _pos = require("../line/pos.js");

var _changes = require("../model/changes.js");

var _misc = require("../util/misc.js");

function deleteNearSelection(cm, compute) {
  var ranges = cm.doc.sel.ranges,
      kill = []; // Build up a set of ranges to kill first, merging overlapping
  // ranges.

  for (var i = 0; i < ranges.length; i++) {
    var toKill = compute(ranges[i]);

    while (kill.length && (0, _pos.cmp)(toKill.from, (0, _misc.lst)(kill).to) <= 0) {
      var replaced = kill.pop();

      if ((0, _pos.cmp)(replaced.from, toKill.from) < 0) {
        toKill.from = replaced.from;
        break;
      }
    }

    kill.push(toKill);
  } // Next, remove those actual ranges.


  (0, _operations.runInOp)(cm, function () {
    for (var _i = kill.length - 1; _i >= 0; _i--) {
      (0, _changes.replaceRange)(cm.doc, "", kill[_i].from, kill[_i].to, "+delete");
    }

    (0, _scrolling.ensureCursorVisible)(cm);
  });
}