require=function(require){var exposedRequire=function t(e,n){return t.m.hasOwnProperty(e)?t.m[e]:"function"!=typeof require||n?"function"==typeof t.r?t.r(e,1):void 0:require(e,1)};exposedRequire.m={},exposedRequire.r=require;var createModuleFactory=function(t){var e;return function(n){return e||t(e={exports:{},parent:n},e.exports),e.exports}},_$documentListeners_20=createModuleFactory(function(t,e){function n(t){var e=t.type;return"text"===e||"textarea"===e||"search"===e||"url"===e||"tel"===e||"password"===e}function r(t){var e=t.type;return"number"===e||"range"===e&&!t.multiple}e.add=function(t){t.addEventListener("input",o,!0),t.addEventListener("change",s,!0),parseFloat(window.navigator.appVersion.split("MSIE ")[1])<=9&&t.addEventListener("selectionchange",function(t){document.activeElement&&o({target:document.activeElement})},!0);var e=document.createElement("input");if(e.type="number",e.value="7",e.valueAsNumber!=e.valueAsNumber){var n=i;i=function(t){return"number"===t.type?r(t)?parseFloat(t.value):t.value:n.apply(this,arguments)}}},e.inputSupportsSelection=n;var i=function(t){return r(t)?t.valueAsNumber:t.value};function o(t){var e=t.target;"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName||c(t,e)}function s(t){var e=t.target;"INPUT"===e.tagName?(a(e,"checked"),c(t,e)):"SELECT"===e.tagName?function t(e){for(var n=e.firstChild;n;n=n.nextSibling)"OPTION"===n.tagName?a(n,"selected"):n.hasChildNodes()&&t(n)}(e):"TEXTAREA"===e.tagName&&c(t,e)}function a(t,e){var n=t.$bindAttributes&&t.$bindAttributes[e];if(n&&!n.isUnbound()){var r=t[e];n.template.expression.set(n.context,r)}}function c(t,e){var r=e.$bindAttributes&&e.$bindAttributes.value;if(r&&!r.isUnbound())if(n(e)){var o={$event:t};!function(t,e,n){var r=t.template.expression,i=r.pathSegments(t.context);if(i){var o=t.context.controller.model.pass(n);_$textDiff_22.onTextInput(o,i,e)}else r.set&&r.set(t.context,e)}(r,e.value,o)}else{var s=i(e);r.template.expression.set(r.context,s)}}}),_$templates_11=createModuleFactory(function(t,e){var n=_$serializeObject_66({}),r=_$options_10({}).DependencyOptions,i=_$util_12.concat,o=_$util_12.hasKeys,s=_$util_12.traverseAndCreate;function a(t,e,n,r){for(var i=0;i<e.length;i++)t=c(t,e[i],n,r);return t}function c(t,e,n,r){var o=l(e,n,r);return i(t,o)}function l(t,e,n){return t.dependencies(e,n)}!function(){for(var t in _$saddle_65)e[t]=_$saddle_65[t]}(),e.Marker=h,e.View=d,e.ViewInstance=m,e.DynamicViewInstance=_,e.ViewParent=g,e.ContextClosure=y,e.Views=b,e.MarkupHook=w,e.ElementOn=E,e.ComponentOn=x,e.AsProperty=C,e.AsObject=S,e.AsObjectComponent=k,e.AsArray=T,e.AsArrayComponent=$,e.emptyTemplate=new _$saddle_65.Template([]),_$saddle_65.Template.prototype.isUnbound=function(t){return t.unbound},_$saddle_65.Binding.prototype.isUnbound=function(){return this.template.expression.isUnbound(this.context)},_$saddle_65.Template.prototype.resolve=function(){},_$saddle_65.Template.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e))return a(null,this.content,t,e)},_$saddle_65.Doctype.prototype.dependencies=function(){},_$saddle_65.Text.prototype.dependencies=function(){},_$saddle_65.DynamicText.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e))return l(this.expression,t,e)},_$saddle_65.Comment.prototype.dependencies=function(){},_$saddle_65.DynamicComment.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e))return l(this.expression,t,e)},_$saddle_65.Html.prototype.dependencies=function(){},_$saddle_65.DynamicHtml.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e))return l(this.expression,t,e)},_$saddle_65.Element.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e)){var n=function(t,e,n,r){for(var i in e)t=c(t,e[i],n,r);return t}(null,this.attributes,t,e);return this.content?a(n,this.content,t,e):n}},_$saddle_65.DynamicElement.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e))return c(_$saddle_65.Element.prototype.dependencies(t,e),this.tagName,t,e)},_$saddle_65.Block.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e)){var n=this.expression.meta&&"on"===this.expression.meta.blockType?l(this.expression,t,e):null,i=t.child(this.expression);return a(n,this.content,i,e)}},_$saddle_65.ConditionalBlock.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e)){var n=this.getCondition(t);if(null==n)return l(this.expressions[0],t,e);var i=function(t,e,n,r,i){for(var o=0;o<=i;o++)t=c(t,e[o],n,r);return t}(null,this.expressions,t,e,n),o=this.expressions[n];return a(i,this.contents[n],t.child(o),e)}},_$saddle_65.EachBlock.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e)){var n=l(this.expression,t,e),i=this.expression.get(t);if(i&&i.length)for(var o=0;o<i.length;o++){var s=t.eachChild(this.expression,o);n=a(n,this.content,s,e)}else this.elseContent&&(n=a(n,this.elseContent,t,e));return n}},_$saddle_65.Attribute.prototype.dependencies=function(){},_$saddle_65.DynamicAttribute.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e))return l(this.expression,t,e)};var u=[{emit:function(t,e){e.$component=t.controller,t.controller.markerNode=e}}];function h(t){_$saddle_65.Comment.call(this,t,u)}function p(t){for(var e=t.split(/\s+/),n=0,r=e.length;n<r;n++)this[e[n]]=!0}function f(t){for(var e=t.split(/\s+/),n=0,r=e.length;n<r;n++){var i=e[n].split("/");this[i[0]]=i[1]||i[0]}}function d(t,e,n,r){this.views=t,this.name=e,this.source=n,this.options=r;var i=(this.name||"").split(":"),o=i.pop();this.namespace=i.join(":"),this.registeredName="index"===o?this.namespace:this.name,this.attributesMap=r&&r.attributes&&new p(r.attributes),this.arraysMap=r&&r.arrays&&new f(r.arrays),this.unminified=r&&(r.unminified||""===r.unminified),this.string=r&&(r.string||""===r.string),this.literal=r&&(r.literal||""===r.literal),this.template=null,this.componentFactory=null,this.fromSerialized=!1}function m(t,e,n,r){this.name=t,this.attributes=e,this.hooks=n,this.initHooks=r,this.view=null}function _(t,e,n,r){this.nameExpression=t,this.attributes=e,this.hooks=n,this.initHooks=r}function g(t){this.template=t}function y(t,e){this.template=t,this.context=e}function v(){}function b(){this.nameMap=new v,this.tagMap=new v,this.elementMap=this.tagMap}function w(){}function E(t,e){this.name=t,this.expression=e}function x(t,e){this.name=t,this.expression=e}function C(t){this.segments=t,this.lastSegment=t.pop()}function S(t,e){C.call(this,t),this.keyExpression=e}function k(t,e){S.call(this,t,e)}function T(t){C.call(this,t)}function $(t){T.call(this,t)}h.prototype=Object.create(_$saddle_65.Comment.prototype),h.prototype.constructor=h,h.prototype.type="Marker",h.prototype.serialize=function(){return n.instance(this,this.data)},h.prototype.get=function(){return""},d.prototype=Object.create(_$saddle_65.Template.prototype),d.prototype.constructor=d,d.prototype.type="View",d.prototype.serialize=function(){return null},d.prototype._isComponent=function(t){return!!this.componentFactory&&(!t.attributes||!t.attributes.extend)},d.prototype._initComponent=function(t){return this._isComponent(t)?this.componentFactory.init(t):t},d.prototype._queueCreate=function(t,e){if(this._isComponent(t)){var n=this.componentFactory;if(t.queue(function(){n.create(e)}),!t.hooks)return;t.queue(function(){for(var n=0,r=t.hooks.length;n<r;n++)t.hooks[n].emit(t,e.controller)})}},d.prototype.get=function(t,e){var n=this._initComponent(t);return(this.template||this.parse()).get(n,e)},d.prototype.getFragment=function(t,e){var n=this._initComponent(t),r=(this.template||this.parse()).getFragment(n,e);return this._queueCreate(t,n),r},d.prototype.appendTo=function(t,e){var n=this._initComponent(e);(this.template||this.parse()).appendTo(t,n),this._queueCreate(e,n)},d.prototype.attachTo=function(t,e,n){var r=this._initComponent(n);e=(this.template||this.parse()).attachTo(t,e,r);return this._queueCreate(n,r),e},d.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e)){var n=this.template||this.parse(),i=this._isComponent(t)?t.componentChild(null):t;return n.dependencies(i,e)}},d.prototype.parse=function(){if(this._parse(),this.componentFactory){var t=new h(this.name);this.template.content.unshift(t)}return this.template},d.prototype._parse=function(){throw new Error("View parsing not available")},m.prototype=Object.create(_$saddle_65.Template.prototype),m.prototype.constructor=m,m.prototype.type="ViewInstance",m.prototype.serialize=function(){return n.instance(this,this.name,this.attributes,this.hooks,this.initHooks)},m.prototype.get=function(t,e){var n=this._find(t),r=t.viewChild(n,this.attributes,this.hooks,this.initHooks);return n.get(r,e)},m.prototype.getFragment=function(t,e){var n=this._find(t),r=t.viewChild(n,this.attributes,this.hooks,this.initHooks);return n.getFragment(r,e)},m.prototype.appendTo=function(t,e){var n=this._find(e),r=e.viewChild(n,this.attributes,this.hooks,this.initHooks);n.appendTo(t,r)},m.prototype.attachTo=function(t,e,n){var r=this._find(n),i=n.viewChild(r,this.attributes,this.hooks,this.initHooks);return r.attachTo(t,e,i)},m.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e)){var n=this._find(t),i=t.viewChild(n,this.attributes,this.hooks,this.initHooks);return n.dependencies(i,e)}},m.prototype._find=function(t){if(this.view)return this.view;var e=t.getView(),n=e&&e.namespace;if(this.view=t.meta.views.find(this.name,n),!this.view){var r=t.meta.views.findErrorMessage(this.name,e);throw new Error(r)}return this.view},_.prototype=Object.create(m.prototype),_.prototype.constructor=_,_.prototype.type="DynamicViewInstance",_.prototype.serialize=function(){return n.instance(this,this.nameExpression,this.attributes,this.hooks,this.initHooks)},_.prototype._find=function(t){var n=this.nameExpression.get(t),r=t.getView(),i=r&&r.namespace;return n&&t.meta.views.find(n,i)||e.emptyTemplate},_.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e)){var n=this.nameExpression.dependencies(t),o=m.prototype.dependencies.call(this,t,e);return i(n,o)}},g.prototype=Object.create(_$saddle_65.Template.prototype),g.prototype.constructor=g,g.prototype.type="ViewParent",g.prototype.serialize=function(){return n.instance(this,this.template)},g.prototype.get=function(t,e){var n=t.forViewParent();return this.template.get(n,e)},g.prototype.getFragment=function(t,e){var n=t.forViewParent();return this.template.getFragment(n,e)},g.prototype.appendTo=function(t,e){var n=e.forViewParent();this.template.appendTo(t,n)},g.prototype.attachTo=function(t,e,n){var r=n.forViewParent();return this.template.attachTo(t,e,r)},g.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e)){var n=t.forViewParent();return this.template.dependencies(n,e)}},y.prototype=Object.create(_$saddle_65.Template.prototype),y.prototype.constructor=y,y.prototype.serialize=function(){throw new Error("ContextClosure cannot be serialized")},y.prototype.get=function(t,e){var n=t.closureChild(this.context);return this.template.get(n,e)},y.prototype.getFragment=function(t,e){var n=t.closureChild(this.context);return this.template.getFragment(n,e)},y.prototype.appendTo=function(t,e){var n=e.closureChild(this.context);this.template.appendTo(t,n)},y.prototype.attachTo=function(t,e,n){var r=n.closureChild(this.context);return this.template.attachTo(t,e,r)},y.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this.template,e)){var n=t.closureChild(this.context);return this.template.dependencies(n,e)}},y.prototype.equals=function(t){return t instanceof y&&this.context===t.context&&this.template.equals(t.template)},b.prototype.find=function(t,e){var n=this.nameMap;if(s=n[e?e+":"+t:t])return s;var r=t.split(":"),i=r.length;for(e&&(r=e.split(":").concat(r));i>0;){for(var o=r.slice();o.length>i;){var s;if(o.splice(-1-i,1),s=n[o.join(":")])return s}i--}},b.prototype.register=function(t,e,n){var r=t.replace(/:index$/,""),i=this.nameMap[r];if(i){var o=i.componentFactory;d.call(i,this,t,e,n),i.componentFactory=o}else i=new d(this,t,e,n);this.nameMap[r]=i;var s=n&&(n.tag||n.element);return s&&(this.tagMap[s]=i),i},b.prototype.deserialize=function(t){for(var e=0;e<t.length;e++){var n=t[e],r=n[0],i=n[1],o=n[2],s=n[3],a=this.register(i,o,s);a.parse=r,a.fromSerialized=!0}},b.prototype.serialize=function(t){var r=t&&t.server,i=t&&t.minify,s=[];for(var a in this.nameMap){var c=this.nameMap[a],l=c.template||c.parse();if(!r&&c.options){if(c.options.serverOnly)continue;c.options.server&&(l=e.emptyTemplate)}s.push("[function(){return this.template="+l.serialize()+"},"+n.args([c.name,i?null:c.source,o(c.options)?c.options:null])+"]")}return"function(derbyTemplates, views){var expressions = derbyTemplates.expressions,templates = derbyTemplates.templates;views.deserialize(["+s.join(",")+"])}"},b.prototype.findErrorMessage=function(t,e){var n=Object.keys(this.nameMap),r='Cannot find view "'+t+'" in'+[""].concat(n).join("\n  ")+"\n";return e&&(r+='\nWithin template "'+e.name+'":\n'+e.source),r},w.prototype.module=_$saddle_65.Template.prototype.module,E.prototype=Object.create(w.prototype),E.prototype.constructor=E,E.prototype.type="ElementOn",E.prototype.serialize=function(){return n.instance(this,this.name,this.expression)},E.prototype.emit=function(t,e){var n=this;if("create"===this.name)this.apply(t,e);else if("destroy"===this.name){(e.$destroyListeners||(e.$destroyListeners=[])).push(function(){n.apply(t,e)})}else e.addEventListener(this.name,function(r){return n.apply(t,e,r)},!1)},E.prototype.apply=function(t,e,n){var r=t.controller.model.data;r.$event=n,r.$element=e;var i=this.expression.apply(t);return delete r.$event,delete r.$element,i},x.prototype=Object.create(w.prototype),x.prototype.constructor=x,x.prototype.type="ComponentOn",x.prototype.serialize=function(){return n.instance(this,this.name,this.expression)},x.prototype.emit=function(t,e){var n=this.expression;e.on(this.name,function(){var e=arguments.length&&Array.prototype.slice.call(arguments);return n.apply(t,e)})},C.prototype=Object.create(w.prototype),C.prototype.constructor=C,C.prototype.type="AsProperty",C.prototype.serialize=function(){var t=this.segments.concat(this.lastSegment);return n.instance(this,t)},C.prototype.emit=function(t,e){s(t.controller,this.segments)[this.lastSegment]=e},S.prototype=Object.create(C.prototype),S.prototype.constructor=S,S.prototype.type="AsObject",S.prototype.serialize=function(){var t=this.segments.concat(this.lastSegment);return n.instance(this,t,this.keyExpression)},S.prototype.emit=function(t,e){var n=s(t.controller,this.segments),r=n[this.lastSegment]||(n[this.lastSegment]={}),i=this.keyExpression.get(t);r[i]=e,this.addListeners(e,r,i)},S.prototype.addListeners=function(t,e,n){this.addDestroyListener(t,function(){delete e[n]})},S.prototype.addDestroyListener=function(t,e){(t.$destroyListeners||(t.$destroyListeners=[])).push(e)},k.prototype=Object.create(S.prototype),k.prototype.constructor=k,k.prototype.type="AsObjectComponent",k.prototype.addDestroyListener=function(t,e){t.on("destroy",e)},T.prototype=Object.create(C.prototype),T.prototype.constructor=T,T.prototype.type="AsArray",T.prototype.emit=function(t,e){for(var n=s(t.controller,this.segments),r=n[this.lastSegment]||(n[this.lastSegment]=[]),i=r.length;i--;){var o=r[i];if(o===e)return;if(4&this.comparePosition(e,o))return r.splice(i+1,0,e),void this.addListeners(e,r)}r.unshift(e),this.addListeners(e,r)},T.prototype.addListeners=function(t,e){this.addDestroyListener(t,function(){var n=e.indexOf(t);-1!==n&&e.splice(n,1)})},T.prototype.comparePosition=function(t,e){return e.compareDocumentPosition(t)},T.prototype.addDestroyListener=S.prototype.addDestroyListener,$.prototype=Object.create(T.prototype),$.prototype.constructor=$,$.prototype.type="AsArrayComponent",$.prototype.comparePosition=function(t,e){return e.markerNode.compareDocumentPosition(t.markerNode)},$.prototype.addDestroyListener=k.prototype.addDestroyListener}),_$options_10=createModuleFactory(function(t,e){var n=_$templates_11({});function r(t){this.setIgnoreTemplate(t&&t.ignoreTemplate)}e.DependencyOptions=r,r.shouldIgnoreTemplate=function(t,e){return!!e&&e.ignoreTemplate===t},r.prototype.setIgnoreTemplate=function(t){for(;t instanceof n.ContextClosure;)t=t.template;this.ignoreTemplate=t}}),_$serializeObject_66=createModuleFactory(function(t,e){function n(t){for(var e=[],n=t.length;n--;){var i=r(t[n]);e.unshift(i)}for(n=e.length;n--;){if("void 0"!==(i=e[n])&&"null"!==i)break;e.pop()}return e.join(", ")}function r(t){if(t&&t.serialize)return t.serialize();if(void 0===t)return"void 0";if(null===t)return"null";if("string"==typeof t)return i(t);if("number"==typeof t||"boolean"==typeof t)return t+"";if(Array.isArray(t)){for(var e=[],n=0;n<t.length;n++){var o=r(t[n]);e.push(o)}return"["+e.join(", ")+"]"}if("object"==typeof t){e=[];for(var s in t){o=r(t[s]);e.push(i(s)+": "+o)}return"{"+e.join(", ")+"}"}}function i(t){return"'"+t.replace(/['\r\n\\]/g,function(t){return"'"===t?"\\'":"\r"===t?"\\r":"\n"===t?"\\n":"\\"===t?"\\\\":""})+"'"}e.instance=function(t){var e=Array.prototype.slice.call(arguments,1);return"new "+t.module+"."+t.type+"("+n(e)+")"},e.args=n,e.value=r}),_$pathBrowserify_29=createModuleFactory(function(t,e){(function(t){function n(t,e){for(var n=0,r=t.length-1;r>=0;r--){var i=t[r];"."===i?t.splice(r,1):".."===i?(t.splice(r,1),n++):n&&(t.splice(r,1),n--)}if(e)for(;n--;n)t.unshift("..");return t}function r(t,e){if(t.filter)return t.filter(e);for(var n=[],r=0;r<t.length;r++)e(t[r],r,t)&&n.push(t[r]);return n}e.resolve=function(){for(var e="",i=!1,o=arguments.length-1;o>=-1&&!i;o--){var s=o>=0?arguments[o]:t.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(e=s+"/"+e,i="/"===s.charAt(0))}return(i?"/":"")+(e=n(r(e.split("/"),function(t){return!!t}),!i).join("/"))||"."},e.normalize=function(t){var o=e.isAbsolute(t),s="/"===i(t,-1);return(t=n(r(t.split("/"),function(t){return!!t}),!o).join("/"))||o||(t="."),t&&s&&(t+="/"),(o?"/":"")+t},e.isAbsolute=function(t){return"/"===t.charAt(0)},e.join=function(){var t=Array.prototype.slice.call(arguments,0);return e.normalize(r(t,function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},e.relative=function(t,n){function r(t){for(var e=0;e<t.length&&""===t[e];e++);for(var n=t.length-1;n>=0&&""===t[n];n--);return e>n?[]:t.slice(e,n-e+1)}t=e.resolve(t).substr(1),n=e.resolve(n).substr(1);for(var i=r(t.split("/")),o=r(n.split("/")),s=Math.min(i.length,o.length),a=s,c=0;c<s;c++)if(i[c]!==o[c]){a=c;break}var l=[];for(c=a;c<i.length;c++)l.push("..");return(l=l.concat(o.slice(a))).join("/")},e.sep="/",e.delimiter=":",e.dirname=function(t){if("string"!=typeof t&&(t+=""),0===t.length)return".";for(var e=t.charCodeAt(0),n=47===e,r=-1,i=!0,o=t.length-1;o>=1;--o)if(47===(e=t.charCodeAt(o))){if(!i){r=o;break}}else i=!1;return-1===r?n?"/":".":n&&1===r?"/":t.slice(0,r)},e.basename=function(t,e){var n=function(t){"string"!=typeof t&&(t+="");var e,n=0,r=-1,i=!0;for(e=t.length-1;e>=0;--e)if(47===t.charCodeAt(e)){if(!i){n=e+1;break}}else-1===r&&(i=!1,r=e+1);return-1===r?"":t.slice(n,r)}(t);return e&&n.substr(-1*e.length)===e&&(n=n.substr(0,n.length-e.length)),n},e.extname=function(t){"string"!=typeof t&&(t+="");for(var e=-1,n=0,r=-1,i=!0,o=0,s=t.length-1;s>=0;--s){var a=t.charCodeAt(s);if(47!==a)-1===r&&(i=!1,r=s+1),46===a?-1===e?e=s:1!==o&&(o=1):-1!==e&&(o=-1);else if(!i){n=s+1;break}}return-1===e||-1===r||0===o||1===o&&e===r-1&&e===n+1?"":t.slice(e,r)};var i="b"==="ab".substr(-1)?function(t,e,n){return t.substr(e,n)}:function(t,e,n){return e<0&&(e=t.length+e),t.substr(e,n)}}).call(this,_$browser_30)}),objectCreate=Object.create||objectCreatePolyfill,objectKeys=Object.keys||objectKeysPolyfill,bind=Function.prototype.bind||functionBindPolyfill;function EventEmitter(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=objectCreate(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}var _$EventEmitter_23=EventEmitter;EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0;var defaultMaxListeners=10,hasDefineProperty;try{var o={};Object.defineProperty&&Object.defineProperty(o,"x",{value:0}),hasDefineProperty=0===o.x}catch(t){hasDefineProperty=!1}function $getMaxListeners(t){return void 0===t._maxListeners?EventEmitter.defaultMaxListeners:t._maxListeners}function emitNone(t,e,n){if(e)t.call(n);else for(var r=t.length,i=arrayClone(t,r),o=0;o<r;++o)i[o].call(n)}function emitOne(t,e,n,r){if(e)t.call(n,r);else for(var i=t.length,o=arrayClone(t,i),s=0;s<i;++s)o[s].call(n,r)}function emitTwo(t,e,n,r,i){if(e)t.call(n,r,i);else for(var o=t.length,s=arrayClone(t,o),a=0;a<o;++a)s[a].call(n,r,i)}function emitThree(t,e,n,r,i,o){if(e)t.call(n,r,i,o);else for(var s=t.length,a=arrayClone(t,s),c=0;c<s;++c)a[c].call(n,r,i,o)}function emitMany(t,e,n,r){if(e)t.apply(n,r);else for(var i=t.length,o=arrayClone(t,i),s=0;s<i;++s)o[s].apply(n,r)}function _addListener(t,e,n,r){var i,o,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=t._events)?(o.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),s=o[e]):(o=t._events=objectCreate(null),t._eventsCount=0),s){if("function"==typeof s?s=o[e]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),!s.warned&&(i=$getMaxListeners(t))&&i>0&&s.length>i){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+' "'+String(e)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=s.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",a.name,a.message)}}else s=o[e]=n,++t._eventsCount;return t}function onceWrapper(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var t=new Array(arguments.length),e=0;e<t.length;++e)t[e]=arguments[e];this.listener.apply(this.target,t)}}function _onceWrap(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=bind.call(onceWrapper,r);return i.listener=n,r.wrapFn=i,i}function _listeners(t,e,n){var r=t._events;if(!r)return[];var i=r[e];return i?"function"==typeof i?n?[i.listener||i]:[i]:n?unwrapListeners(i):arrayClone(i,i.length):[]}function listenerCount(t){var e=this._events;if(e){var n=e[t];if("function"==typeof n)return 1;if(n)return n.length}return 0}function spliceOne(t,e){for(var n=e,r=n+1,i=t.length;r<i;n+=1,r+=1)t[n]=t[r];t.pop()}function arrayClone(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function unwrapListeners(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function objectCreatePolyfill(t){var e=function(){};return e.prototype=t,new e}function objectKeysPolyfill(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return n}function functionBindPolyfill(t){var e=this;return function(){return e.apply(t,arguments)}}hasDefineProperty?Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(t){if("number"!=typeof t||t<0||t!=t)throw new TypeError('"defaultMaxListeners" must be a positive number');defaultMaxListeners=t}}):EventEmitter.defaultMaxListeners=defaultMaxListeners,EventEmitter.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},EventEmitter.prototype.getMaxListeners=function(){return $getMaxListeners(this)},EventEmitter.prototype.emit=function(t){var e,n,r,i,o,s,a="error"===t;if(s=this._events)a=a&&null==s.error;else if(!a)return!1;if(a){if(arguments.length>1&&(e=arguments[1]),e instanceof Error)throw e;var c=new Error('Unhandled "error" event. ('+e+")");throw c.context=e,c}if(!(n=s[t]))return!1;var l="function"==typeof n;switch(r=arguments.length){case 1:emitNone(n,l,this);break;case 2:emitOne(n,l,this,arguments[1]);break;case 3:emitTwo(n,l,this,arguments[1],arguments[2]);break;case 4:emitThree(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];emitMany(n,l,this,i)}return!0},EventEmitter.prototype.addListener=function(t,e){return _addListener(this,t,e,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function(t,e){return _addListener(this,t,e,!0)},EventEmitter.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,_onceWrap(this,t,e)),this},EventEmitter.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,_onceWrap(this,t,e)),this},EventEmitter.prototype.removeListener=function(t,e){var n,r,i,o,s;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=objectCreate(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===e||n[o].listener===e){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():spliceOne(n,i),1===n.length&&(r[t]=n[0]),r.removeListener&&this.emit("removeListener",t,s||e)}return this},EventEmitter.prototype.removeAllListeners=function(t){var e,n,r;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=objectCreate(null),this._eventsCount=0):n[t]&&(0==--this._eventsCount?this._events=objectCreate(null):delete n[t]),this;if(0===arguments.length){var i,o=objectKeys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=objectCreate(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},EventEmitter.prototype.listeners=function(t){return _listeners(this,t,!0)},EventEmitter.prototype.rawListeners=function(t){return _listeners(this,t,!1)},EventEmitter.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):listenerCount.call(t,e)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var _$rng_89={};(function(t){var e,n=t.crypto||t.msCrypto;if(n&&n.getRandomValues){var r=new Uint8Array(16);e=function(){return n.getRandomValues(r),r}}if(!e){var i=new Array(16);e=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),i[e]=t>>>((3&e)<<3)&255;return i}}_$rng_89=e}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});for(var _byteToHex=[],_hexToByte={},i=0;i<256;i++)_byteToHex[i]=(i+256).toString(16).substr(1),_hexToByte[_byteToHex[i]]=i;function parse(t,e,n){var r=e&&n||0,i=0;for(e=e||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,function(t){i<16&&(e[r+i++]=_hexToByte[t])});i<16;)e[r+i++]=0;return e}function unparse(t,e){var n=e||0,r=_byteToHex;return r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]}var _seedBytes=_$rng_89(),_nodeId=[1|_seedBytes[0],_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]],_clockseq=16383&(_seedBytes[6]<<8|_seedBytes[7]),_lastMSecs=0,_lastNSecs=0;function v1(t,e,n){var r=e&&n||0,i=e||[],o=void 0!==(t=t||{}).clockseq?t.clockseq:_clockseq,s=void 0!==t.msecs?t.msecs:(new Date).getTime(),a=void 0!==t.nsecs?t.nsecs:_lastNSecs+1,c=s-_lastMSecs+(a-_lastNSecs)/1e4;if(c<0&&void 0===t.clockseq&&(o=o+1&16383),(c<0||s>_lastMSecs)&&void 0===t.nsecs&&(a=0),a>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_lastMSecs=s,_lastNSecs=a,_clockseq=o;var l=(1e4*(268435455&(s+=122192928e5))+a)%4294967296;i[r++]=l>>>24&255,i[r++]=l>>>16&255,i[r++]=l>>>8&255,i[r++]=255&l;var u=s/4294967296*1e4&268435455;i[r++]=u>>>8&255,i[r++]=255&u,i[r++]=u>>>24&15|16,i[r++]=u>>>16&255,i[r++]=o>>>8|128,i[r++]=255&o;for(var h=t.node||_nodeId,p=0;p<6;p++)i[r+p]=h[p];return e||unparse(i)}function v4(t,e,n){var r=e&&n||0;"string"==typeof t&&(e="binary"==t?new Array(16):null,t=null);var i=(t=t||{}).random||(t.rng||_$rng_89)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,e)for(var o=0;o<16;o++)e[r+o]=i[o];return e||unparse(i)}var uuid=v4;uuid.v1=v1,uuid.v4=v4,uuid.parse=parse,uuid.unparse=unparse;var _$uuid_90=uuid;Model.INITS=[];var _$Model_45=Model;function Model(t){this.root=this;var e=Model.INITS;t||(t={}),this.debug=t.debug||{};for(var n=0;n<e.length;n++)e[n](this,t)}function ChildModel(t){this.root=t.root,this._events=t._events,this._maxListeners=t._maxListeners,this._context=t._context,this._at=t._at,this._pass=t._pass,this._silent=t._silent,this._eventContext=t._eventContext,this._preventCompose=t._preventCompose}Model.prototype.id=function(){return _$uuid_90.v4()},Model.prototype._child=function(){return new ChildModel(this)},Model.ChildModel=ChildModel,ChildModel.prototype=new Model;var isArray=Array.isArray,keyList=Object.keys,hasProp=Object.prototype.hasOwnProperty,_$equal_24=function t(e,n){if(e===n)return!0;if(e&&n&&"object"==typeof e&&"object"==typeof n){var r,i,o,s=isArray(e),a=isArray(n);if(s&&a){if((i=e.length)!=n.length)return!1;for(r=i;0!=r--;)if(!t(e[r],n[r]))return!1;return!0}if(s!=a)return!1;var c=e instanceof Date,l=n instanceof Date;if(c!=l)return!1;if(c&&l)return e.getTime()==n.getTime();var u=e instanceof RegExp,h=n instanceof RegExp;if(u!=h)return!1;if(u&&h)return e.toString()==n.toString();var p=keyList(e);if((i=p.length)!==keyList(n).length)return!1;for(r=i;0!=r--;)if(!hasProp.call(n,p[r]))return!1;for(r=i;0!=r--;)if(!t(e[o=p[r]],n[o]))return!1;return!0}return e!=e&&n!=n},_$browser_30={},process=_$browser_30={},cachedSetTimeout,cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(t){if(cachedSetTimeout===setTimeout)return setTimeout(t,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(t,0);try{return cachedSetTimeout(t,0)}catch(e){try{return cachedSetTimeout.call(null,t,0)}catch(e){return cachedSetTimeout.call(this,t,0)}}}function runClearTimeout(t){if(cachedClearTimeout===clearTimeout)return clearTimeout(t);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(t);try{return cachedClearTimeout(t)}catch(e){try{return cachedClearTimeout.call(null,t)}catch(e){return cachedClearTimeout.call(this,t)}}}!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(t){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(t){cachedClearTimeout=defaultClearTimeout}}();var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var t=runTimeout(cleanUpNextTick);draining=!0;for(var e=queue.length;e;){for(currentQueue=queue,queue=[];++queueIndex<e;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,e=queue.length}currentQueue=null,draining=!1,runClearTimeout(t)}}function Item(t,e){this.fun=t,this.array=e}function noop(){}process.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];queue.push(new Item(t,e)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(t){return[]},process.binding=function(t){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(t){throw new Error("process.chdir is not supported")},process.umask=function(){return 0};var _$util_64={};(function(t){var e="browser"!==t.title;function n(t){this.cb=t,this.isDone=!1,this.count=0}function r(t){var e=new t.constructor;for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function i(t){return t!=t}function o(t){return/^[0-9]+$/.test(t)}function s(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}_$util_64.isServer=e,_$util_64.asyncGroup=function(t){var e=new n(t);return function(){return e.add()}},_$util_64.castSegments=function(t){for(var e=t.length;e--;){var n=t[e];"string"==typeof n&&o(n)&&(t[e]=+n)}return t},_$util_64.contains=function(t,e){for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0},_$util_64.copy=function(t){if(t instanceof Date)return new Date(t);if("object"==typeof t)return null===t?null:Array.isArray(t)?t.slice():r(t);return t},_$util_64.copyObject=r,_$util_64.deepCopy=function t(e){if(e instanceof Date)return new Date(e);if("object"==typeof e){if(null===e)return null;if(Array.isArray(e)){for(var n=[],r=e.length;r--;)n[r]=t(e[r]);return n}var i=new e.constructor;for(var o in e)e.hasOwnProperty(o)&&(i[o]=t(e[o]));return i}return e},_$util_64.deepEqual=_$equal_24,_$util_64.equal=function(t,e){return t===e||i(t)&&i(e)},_$util_64.equalsNaN=i,_$util_64.isArrayIndex=o,_$util_64.lookup=function(t,e){if(!t)return e;for(var n=0,r=t.length;n<r;n++){if(null==e)return e;e=e[t[n]]}return e},_$util_64.mergeInto=function(t,e){for(var n in e)t[n]=e[n];return t},_$util_64.mayImpact=s,_$util_64.mayImpactAny=function(t,e){for(var n=0,r=t.length;n<r;n++)if(s(t[n],e))return!0;return!1},_$util_64.serverRequire=function(t,n){if(!e)return;return t.require(n)},_$util_64.serverUse=function(t,n,r){if(!e)return this;var i=t.require(n);return this.use(i,r)},_$util_64.use=function(t,e){var n=this._plugins||(this._plugins=[]);-1===n.indexOf(t)&&(n.push(t),t(this,e));return this},n.prototype.add=function(){this.count++;var t=this;return function(e){if(t.count--,!t.isDone)return e?(t.isDone=!0,void t.cb(e)):void(t.count>0||(t.isDone=!0,t.cb()))}}}).call(this,_$browser_30);var _$unbundle_62={};_$Model_45.prototype.unbundle=function(t){for(var e in this.connection&&this.connection.startBulk(),this._initQueries(t.queries),t.collections){var n=t.collections[e];for(var r in n)this.getOrCreateDoc(e,r,n[r])}for(var i in t.contexts){var o=t.contexts[i],s=this.context(i);for(var e in o.fetchedDocs){n=o.fetchedDocs[e];for(var r in n)for(var a=n[r];a--;)s._context.fetchDoc(e,r),this._fetchedDocs.increment(e,r)}for(var e in o.subscribedDocs){n=o.subscribedDocs[e];for(var r in n)for(a=n[r];a--;)s.subscribeDoc(e,r)}for(var e in o.createdDocs){n=o.createdDocs[e];for(var r in n)s._context.createDoc(e,r)}}this.connection&&this.connection.endBulk();for(var c=0;c<t.refs.length;c++){var l=t.refs[c];this.ref(l[0],l[1])}for(c=0;c<t.refLists.length;c++){l=t.refLists[c];this.refList(l[0],l[1],l[2],l[3])}for(c=0;c<t.fns.length;c++){l=t.fns[c];this.start.apply(this,l)}for(c=0;c<t.filters.length;c++){l=t.filters[c];this._filters.add(l[1],l[2],l[3],l[4],l[5]).ref(l[0])}};var _$events_52={},__EventEmitter_52=_$EventEmitter_23.EventEmitter;function patternContained(t,e,n){var r=n.patternSegments;if(!r)return!1;if(t===n.pattern||"**"===t)return!0;var i=e.length;if(i>r.length)return!1;for(var o=0;o<i;o++)if(e[o]!==r[o])return!1;return!0}function Passed(t,e){for(var n in t)this[n]=t[n];for(var n in e)this[n]=e[n]}function eventListener(t,e,n,r,i){var o,s,a;if(i?(o=n,s=r,a=i):r?(a=r,t.isPath(n)?o=n:s=n):a=n,s&&s.useEventObjects)var c=!0;if(o){var l=t.path(o);return c?modelEventListener(e,l,a,t._eventContext):modelEventListenerLegacy(l,a,t._eventContext)}var u=t.path();return u?c?modelEventListener(e,u,a,t._eventContext):modelEventListenerLegacy(u,a,t._eventContext):a}function modelEventListenerLegacy(t,e,n){var r=_$util_64.castSegments(t.split(".")),i=testPatternFn(t,r);function o(t,n){var r=i(t);if(r){var o=r.length?r.concat(n):n;return e.apply(null,o),!0}}return o.pattern=t,o.patternSegments=r,o.eventContext=n,o}function modelEventListener(t,e,n,r){var i=_$util_64.castSegments(e.split(".")),o=testPatternFn(e,i),s=getEventFactory(t);function a(t,e){var r=o(t);if(r){var i=s(e);return n(i,r),!0}}return a.pattern=e,a.patternSegments=i,a.eventContext=r,a}function getEventFactory(t){switch(t){case"change":return function(t){return new ChangeEvent(t)};case"insert":return function(t){return new InsertEvent(t)};case"remove":return function(t){return new RemoveEvent(t)};case"move":return function(t){return new MoveEvent(t)};case"load":return function(t){return new LoadEvent(t)};case"unload":return function(t){return new UnloadEvent(t)};case"all":return function(t){return getEventFactory(t[0])(t.slice(1))};default:throw new Error("Unknown event: "+t)}}function ChangeEvent(t){this.value=t[0],this.previous=t[1],this.passed=t[2]}function InsertEvent(t){this.index=t[0],this.values=t[1],this.passed=t[2]}function RemoveEvent(t){this.index=t[0],this.removed=t[1],this.passed=t[2]}function MoveEvent(t){this.from=t[0],this.to=t[1],this.howMany=t[2],this.passed=t[3]}function LoadEvent(t){this.document=t[0],this.passed=t[1]}function UnloadEvent(t){this.previousDocument=t[0],this.passed=t[1]}function testPatternFn(t,e){if("**"===t)return function(t){return[t.join(".")]};var n=stripRestWildcard(e);return function(t){var r=e.length;if(!(r>t.length)&&(r===t.length||n)){for(var i=[],o=0;o<r;o++){var s=e[o],a=t[o];if("*"!==s&&"**"!==s){if(s!==a)return}else i.push(a)}if(n){var c=t.slice(o).join(".");i.push(c)}return i}}}function stripRestWildcard(t){var e=t.length-1,n=t[e];if("**"===n)return t.pop(),!0;if("string"!=typeof n)return!1;var r=/^([^\*]+)\*\*$/.exec(n);return!!r&&(t[e]=r[1],!0)}_$Model_45.MUTATOR_EVENTS={change:!0,insert:!0,remove:!0,move:!0,load:!0,unload:!0},_$Model_45.INITS.push(function(t){__EventEmitter_52.call(this),t.setMaxListeners(0),t.root._defaultCallback=function(e){e&&t._emitError(e)},t.root._mutatorEventQueue=null,t.root._pass=new Passed({},{}),t.root._silent=null,t.root._eventContext=null}),_$util_64.mergeInto(_$Model_45.prototype,__EventEmitter_52.prototype),_$Model_45.prototype.wrapCallback=function(t){if(!t)return this.root._defaultCallback;var e=this;return function(){try{return t.apply(this,arguments)}catch(t){e._emitError(t)}}},_$Model_45.prototype._emitError=function(t,e){var n=t.message?t.message:"string"==typeof t?t:"Unknown model error";if(e&&(n+=" "+e),t.data)try{n+=" "+JSON.stringify(t.data)}catch(t){}t instanceof Error?t.message=n:t=new Error(n),this.emit("error",t)},_$Model_45.prototype._emit=__EventEmitter_52.prototype.emit,_$Model_45.prototype.emit=function(t){if("error"===t)return this._emit.apply(this,arguments);if(_$Model_45.MUTATOR_EVENTS[t]){if(this._silent)return this;var e=arguments[1],n=arguments[2];if(this._emit(t+"Immediate",e,n),this.root._mutatorEventQueue)return this.root._mutatorEventQueue.push([t,e,n]),this;for(this.root._mutatorEventQueue=[],this._emit(t,e,n),this._emit("all",e,[t].concat(n));this.root._mutatorEventQueue.length;){var r=this.root._mutatorEventQueue.shift();t=r[0],e=r[1],n=r[2],this._emit(t,e,n),this._emit("all",e,[t].concat(n))}return this.root._mutatorEventQueue=null,this}return this._emit.apply(this,arguments)},_$Model_45.prototype._on=__EventEmitter_52.prototype.on,_$Model_45.prototype.addListener=_$Model_45.prototype.on=function(t,e,n,r){var i=eventListener(this,t,e,n,r);return this._on(t,i),i},_$Model_45.prototype.once=function(t,e,n,r){var i=eventListener(this,t,e,n,r);function o(){i.apply(null,arguments)&&this.removeListener(t,o)}return this._on(t,o),o},_$Model_45.prototype._removeAllListeners=__EventEmitter_52.prototype.removeAllListeners,_$Model_45.prototype.removeAllListeners=function(t,e){if(!t){for(var n in this._events)this.removeAllListeners(n,e);return this}var r=this.path(e);if(!r)return 0===arguments.length?this._removeAllListeners():this._removeAllListeners(t);for(var i=this.listeners(t),o=r.split("."),s=i.length;s--;){var a=i[s];patternContained(r,o,a)&&this.removeListener(t,a)}return this},_$Model_45.prototype.pass=function(t,e){var n=this._child();return n._pass=e?new Passed(t,this._pass):new Passed(this._pass,t),n},_$Model_45.prototype.silent=function(t){var e=this._child();return e._silent=null==t||t,e},_$Model_45.prototype.eventContext=function(t){var e=this._child();return e._eventContext=t,e},_$Model_45.prototype.removeContextListeners=function(t){for(var e in 0===arguments.length&&(t=this._eventContext),this._events)for(var n=this.listeners(e),r=n.length;r--;){var i=n[r];i.eventContext===t&&this.removeListener(e,i)}return this},ChangeEvent.prototype.type="change",InsertEvent.prototype.type="insert",RemoveEvent.prototype.type="remove",MoveEvent.prototype.type="move",LoadEvent.prototype.type="load",UnloadEvent.prototype.type="unload";var _$paths_57={};function createScoped(t,e){var n=t._child();return n._at=e,n}_$paths_57.mixin={},_$Model_45.prototype._splitPath=function(t){var e=this.path(t);return e&&e.split(".")||[]},_$Model_45.prototype.path=function(t){return null==t||""===t?this._at?this._at:"":"string"==typeof t||"number"==typeof t?this._at?this._at+"."+t:""+t:"function"==typeof t.path?t.path():void 0},_$Model_45.prototype.isPath=function(t){return null!=this.path(t)},_$Model_45.prototype.scope=function(t){if(arguments.length>1)for(var e=1;e<arguments.length;e++)t=t+"."+arguments[e];return createScoped(this,t)},_$Model_45.prototype.at=function(t){if(arguments.length>1)for(var e=1;e<arguments.length;e++)t=t+"."+arguments[e];return createScoped(this,this.path(t))},_$Model_45.prototype.parent=function(t){null==t&&(t=1);var e=this._splitPath(),n=Math.max(0,e.length-t),r=e.slice(0,n).join(".");return this.scope(r)},_$Model_45.prototype.leaf=function(t){t||(t=this.path());var e=t.lastIndexOf(".");return t.slice(e+1)};var _$Doc_43=Doc;function Doc(t,e,n){this.collectionName=e,this.id=n,this.collectionData=t&&t.data[e]}Doc.prototype.path=function(t){var e=this.collectionName+"."+this.id;return t&&t.length&&(e+="."+t.join(".")),e},Doc.prototype._errorMessage=function(t,e,n){return t+" at "+this.path(e)+": "+JSON.stringify(n,null,2)};var _$LocalDoc_44=LocalDoc;function LocalDoc(t,e,n,r){_$Doc_43.call(this,t,e,n),this.data=r,this._updateCollectionData()}function nodeCreateArray(t,e){return t=t[e]||(t[e]=[])}LocalDoc.prototype=new _$Doc_43,LocalDoc.prototype._updateCollectionData=function(){this.collectionData[this.id]=this.data},LocalDoc.prototype.create=function(t,e){if(void 0!==this.data){var n=this._errorMessage("create on local document with data",null,this.data);return e(new Error(n))}this.data=t,this._updateCollectionData(),e()},LocalDoc.prototype.set=function(t,e,n){return this._apply(t,function(t,n){var r=t[n];return t[n]=e,r},n)},LocalDoc.prototype.del=function(t,e){var n=this.get(t);if(void 0!==n)return this._apply(t,function(t,e){return delete t[e],n},e);e()},LocalDoc.prototype.increment=function(t,e,n){var r=this;return this._validatedApply(t,function(e){if("number"!=typeof e&&null!=e)return new TypeError(r._errorMessage("increment on non-number",t,e))},function(t,n){var r=(t[n]||0)+e;return t[n]=r,r},n)},LocalDoc.prototype.push=function(t,e,n){return this._arrayApply(t,function(t){return t.push(e)},n)},LocalDoc.prototype.unshift=function(t,e,n){return this._arrayApply(t,function(t){return t.unshift(e)},n)},LocalDoc.prototype.insert=function(t,e,n,r){return this._arrayApply(t,function(t){return t.splice.apply(t,[e,0].concat(n)),t.length},r)},LocalDoc.prototype.pop=function(t,e){return this._arrayApply(t,function(t){return t.pop()},e)},LocalDoc.prototype.shift=function(t,e){return this._arrayApply(t,function(t){return t.shift()},e)},LocalDoc.prototype.remove=function(t,e,n,r){return this._arrayApply(t,function(t){return t.splice(e,n)},r)},LocalDoc.prototype.move=function(t,e,n,r,i){return this._arrayApply(t,function(t){var i=t.splice(e,r);return t.splice.apply(t,[n,0].concat(i)),i},i)},LocalDoc.prototype.stringInsert=function(t,e,n,r){var i=this;return this._validatedApply(t,function(e){if("string"!=typeof e&&null!=e)return new TypeError(i._errorMessage("stringInsert on non-string",t,e))},function(t,r){var i=t[r];return null==i?(t[r]=n,i):(t[r]=i.slice(0,e)+n+i.slice(e),i)},r)},LocalDoc.prototype.stringRemove=function(t,e,n,r){var i=this;return this._validatedApply(t,function(e){if("string"!=typeof e&&null!=e)return new TypeError(i._errorMessage("stringRemove on non-string",t,e))},function(t,r){var i=t[r];return null==i?i:(e<0&&(e+=i.length),t[r]=i.slice(0,e)+i.slice(e+n),i)},r)},LocalDoc.prototype.get=function(t){return _$util_64.lookup(t,this.data)},LocalDoc.prototype._createImplied=function(t,e){for(var n=this,r="data",i=0,o=t[i++];null!=o;)n=n[r]||(n[r]=/^\d+$/.test(o)?[]:{}),r=o,o=t[i++];return e(n,r)},LocalDoc.prototype._apply=function(t,e,n){var r=this._createImplied(t,e);return this._updateCollectionData(),n(),r},LocalDoc.prototype._validatedApply=function(t,e,n,r){var i=this._createImplied(t,function(t,i){var o=e(t[i]);return o?r(o):n(t,i)});return this._updateCollectionData(),r(),i},LocalDoc.prototype._arrayApply=function(t,e,n){var r=this._createImplied(t,nodeCreateArray);if(!Array.isArray(r)){var i=this._errorMessage(e.name+" on non-array",t,r);return n(new TypeError(i))}var o=e(r);return this._updateCollectionData(),n(),o};var _$collections_48={};function CollectionMap(){}function ModelData(){}function DocMap(){}function CollectionData(){}function Collection(t,e,n){this.model=t,this.name=e,this.Doc=n,this.docs=new DocMap,this.data=t.data[e]=new CollectionData}function noKeys(t){for(var e in t)return!1;return!0}_$Model_45.INITS.push(function(t){t.root.collections=new CollectionMap,t.root.data=new ModelData}),_$Model_45.prototype.getCollection=function(t){return this.root.collections[t]},_$Model_45.prototype.getDoc=function(t,e){var n=this.root.collections[t];return n&&n.docs[e]},_$Model_45.prototype.get=function(t){var e=this._splitPath(t);return this._get(e)},_$Model_45.prototype._get=function(t){return _$util_64.lookup(t,this.root.data)},_$Model_45.prototype.getCopy=function(t){var e=this._splitPath(t);return this._getCopy(e)},_$Model_45.prototype._getCopy=function(t){var e=this._get(t);return _$util_64.copy(e)},_$Model_45.prototype.getDeepCopy=function(t){var e=this._splitPath(t);return this._getDeepCopy(e)},_$Model_45.prototype._getDeepCopy=function(t){var e=this._get(t);return _$util_64.deepCopy(e)},_$Model_45.prototype.getOrCreateCollection=function(t){var e=this.root.collections[t];if(e)return e;var n=this._getDocConstructor(t);return e=new Collection(this.root,t,n),this.root.collections[t]=e,e},_$Model_45.prototype._getDocConstructor=function(){return _$LocalDoc_44},_$Model_45.prototype.getOrCreateDoc=function(t,e,n){var r=this.getOrCreateCollection(t);return r.docs[e]||r.add(e,n)},_$Model_45.prototype.destroy=function(t){var e=this._splitPath(t),n=this.silent();if(n.removeAllListeners(null,t),n._removeAllRefs(e),n._stopAll(e),n._removeAllFilters(e),0===e.length){this.root.collections=new CollectionMap;var r=this.root.data;for(var i in r)delete r[i]}else if(1===e.length){var o=this.getCollection(e[0]);o&&o.destroy()}else n._del(e)},Collection.prototype.add=function(t,e){var n=new this.Doc(this.model,this.name,t,e,this);return this.docs[t]=n,n},Collection.prototype.destroy=function(){delete this.model.collections[this.name],delete this.model.data[this.name]},Collection.prototype.remove=function(t){delete this.docs[t],delete this.data[t],noKeys(this.docs)&&this.destroy()},Collection.prototype.get=function(){return this.data};var _$mutators_56={};_$Model_45.prototype._mutate=function(t,e,n){n=this.wrapCallback(n);var r=t[0],i=t[1];if(!r||!i){var o=e.name+" must be performed under a collection and document id. Invalid path: "+t.join(".");return n(new Error(o))}var s=this.getOrCreateDoc(r,i),a=t.slice(2);if(this._preventCompose&&s.shareDoc){var c=s.shareDoc.preventCompose;s.shareDoc.preventCompose=!0;var l=e(s,a,n);return s.shareDoc.preventCompose=c,l}return e(s,a,n)},_$Model_45.prototype.set=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._set(r,e,n)},_$Model_45.prototype._set=function(t,e,n){t=this._dereference(t);var r=this;return this._mutate(t,function(n,i,o){var s=n.set(i,e,o);return 0===i.length&&(e=n.get(i)),r.emit("change",t,[e,s,r._pass]),s},n)},_$Model_45.prototype.setNull=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._setNull(r,e,n)},_$Model_45.prototype._setNull=function(t,e,n){t=this._dereference(t);var r=this;return this._mutate(t,function(n,i,o){var s=n.get(i);return null!=s?(o(),s):(n.set(i,e,o),r.emit("change",t,[e,s,r._pass]),e)},n)},_$Model_45.prototype.setEach=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._setEach(r,e,n)},_$Model_45.prototype._setEach=function(t,e,n){t=this._dereference(t);var r=_$util_64.asyncGroup(this.wrapCallback(n));for(var i in e){var o=e[i];this._set(t.concat(i),o,r())}},_$Model_45.prototype.create=function(){var t,e,n;0===arguments.length?e={}:1===arguments.length?"function"==typeof arguments[0]?(e={},n=arguments[0]):e=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._create(r,e,n)},_$Model_45.prototype._create=function(t,e,n){if(2!==(t=this._dereference(t)).length){var r="create may only be used on a document path. Invalid path: "+t.join(".");return(n=this.wrapCallback(n))(new Error(r))}var i=this;this._mutate(t,function(n,r,o){n.create(e,o),e=n.get(),i.emit("change",t,[e,void 0,i._pass])},n)},_$Model_45.prototype.createNull=function(){var t,e,n;0===arguments.length?e={}:1===arguments.length?"function"==typeof arguments[0]?(e={},n=arguments[0]):e=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._createNull(r,e,n)},_$Model_45.prototype._createNull=function(t,e,n){t=this._dereference(t);var r=this.getDoc(t[0],t[1]);r&&null!=r.get()||this._create(t,e,n)},_$Model_45.prototype.add=function(){var t,e,n;0===arguments.length?e={}:1===arguments.length?"function"==typeof arguments[0]?(e={},n=arguments[0]):e=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._add(r,e,n)},_$Model_45.prototype._add=function(t,e,n){if("object"!=typeof e){var r="add requires an object value. Invalid value: "+e;return(n=this.wrapCallback(n))(new Error(r))}var i=e.id||this.id();e.id=i,t=this._dereference(t.concat(i));var o=this;return this._mutate(t,function(n,r,i){var s;r.length?s=n.set(r,e,i):(n.create(e,i),e=n.get()),o.emit("change",t,[e,s,o._pass])},n),i},_$Model_45.prototype.del=function(){var t,e;1===arguments.length?"function"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:(t=arguments[0],e=arguments[1]);var n=this._splitPath(t);return this._del(n,e)},_$Model_45.prototype._del=function(t,e){t=this._dereference(t);var n=this;return this._mutate(t,function(e,r,i){var o=e.del(r,i);if(2===t.length){var s=t[0],a=t[1];n.root.collections[s].remove(a)}return n.emit("change",t,[void 0,o,n._pass]),o},e)},_$Model_45.prototype.increment=function(){var t,e,n;1===arguments.length?"function"==typeof arguments[0]?n=arguments[0]:"number"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(n=arguments[1],"number"==typeof arguments[0]?e=arguments[0]:t=arguments[0]):(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._increment(r,e,n)},_$Model_45.prototype._increment=function(t,e,n){t=this._dereference(t),null==e&&(e=1);var r=this;return this._mutate(t,function(n,i,o){var s=n.increment(i,e,o),a=s-e;return r.emit("change",t,[s,a,r._pass]),s},n)},_$Model_45.prototype.push=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._push(r,e,n)},_$Model_45.prototype._push=function(t,e,n){t=this._dereference(t,!0);var r=this;return this._mutate(t,function(n,i,o){var s=n.push(i,e,o);return r.emit("insert",t,[s-1,[e],r._pass]),s},n)},_$Model_45.prototype.unshift=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._unshift(r,e,n)},_$Model_45.prototype._unshift=function(t,e,n){t=this._dereference(t,!0);var r=this;return this._mutate(t,function(n,i,o){var s=n.unshift(i,e,o);return r.emit("insert",t,[0,[e],r._pass]),s},n)},_$Model_45.prototype.insert=function(){var t,e,n,r;if(arguments.length<2)throw new Error("Not enough arguments for insert");2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?(t=arguments[0],e=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]);var i=this._splitPath(t);return this._insert(i,+e,n,r)},_$Model_45.prototype._insert=function(t,e,n,r){t=this._dereference(t,!0);var i=this;return this._mutate(t,function(r,o,s){var a=Array.isArray(n)?n:[n],c=r.insert(o,e,a,s);return i.emit("insert",t,[e,a,i._pass]),c},r)},_$Model_45.prototype.pop=function(){var t,e;1===arguments.length?"function"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:(t=arguments[0],e=arguments[1]);var n=this._splitPath(t);return this._pop(n,e)},_$Model_45.prototype._pop=function(t,e){t=this._dereference(t,!0);var n=this;return this._mutate(t,function(e,r,i){var o=e.get(r),s=o&&o.length;if(s){var a=e.pop(r,i);return n.emit("remove",t,[s-1,[a],n._pass]),a}i()},e)},_$Model_45.prototype.shift=function(){var t,e;1===arguments.length?"function"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:(t=arguments[0],e=arguments[1]);var n=this._splitPath(t);return this._shift(n,e)},_$Model_45.prototype._shift=function(t,e){t=this._dereference(t,!0);var n=this;return this._mutate(t,function(e,r,i){var o=e.get(r);if(o&&o.length){var s=e.shift(r,i);return n.emit("remove",t,[0,[s],n._pass]),s}i()},e)},_$Model_45.prototype.remove=function(){var t,e,n,r;arguments.length<2?e=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(r=arguments[1],"number"==typeof arguments[0]?e=arguments[0]:t=arguments[0]):"number"==typeof arguments[0]?(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(r=arguments[2],"number"==typeof arguments[0]?(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1])):(t=arguments[0],e=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]);var i=this._splitPath(t);return null==e&&(e=i.pop()),this._remove(i,+e,n,r)},_$Model_45.prototype._remove=function(t,e,n,r){t=this._dereference(t,!0),null==n&&(n=1);var i=this;return this._mutate(t,function(r,o,s){var a=r.remove(o,e,n,s);return i.emit("remove",t,[e,a,i._pass]),a},r)},_$Model_45.prototype.move=function(){var t,e,n,r,i;if(arguments.length<2)throw new Error("Not enough arguments for move");2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(e=arguments[0],n=arguments[1],i=arguments[2]):"number"==typeof arguments[0]?(e=arguments[0],n=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2]):4===arguments.length?"function"==typeof arguments[3]?(i=arguments[3],"number"==typeof arguments[0]?(e=arguments[0],n=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2])):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3],i=arguments[4]);var o=this._splitPath(t);return this._move(o,e,n,r,i)},_$Model_45.prototype._move=function(t,e,n,r,i){t=this._dereference(t,!0),null==r&&(r=1);var o=this;return this._mutate(t,function(i,s,a){if(n=+n,(e=+e)<0||n<0){var c=i.get(s).length;e<0&&(e+=c),n<0&&(n+=c)}var l=i.move(s,e,n,r,a);return o.emit("move",t,[e,n,l.length,o._pass]),l},i)},_$Model_45.prototype.stringInsert=function(){var t,e,n,r;if(arguments.length<2)throw new Error("Not enough arguments for stringInsert");2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(e=arguments[0],n=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]);var i=this._splitPath(t);return this._stringInsert(i,e,n,r)},_$Model_45.prototype._stringInsert=function(t,e,n,r){t=this._dereference(t);var i=this;return this._mutate(t,function(r,o,s){var a=r.stringInsert(o,e,n,s),c=r.get(o),l=i.pass({$stringInsert:{index:e,text:n}})._pass;i.emit("change",t,[c,a,l])},r)},_$Model_45.prototype.stringRemove=function(){var t,e,n,r;if(arguments.length<2)throw new Error("Not enough arguments for stringRemove");2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(e=arguments[0],n=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]);var i=this._splitPath(t);return this._stringRemove(i,e,n,r)},_$Model_45.prototype._stringRemove=function(t,e,n,r){t=this._dereference(t);var i=this;return this._mutate(t,function(r,o,s){var a=r.stringRemove(o,e,n,s),c=r.get(o),l=i.pass({$stringRemove:{index:e,howMany:n}})._pass;i.emit("change",t,[c,a,l])},r)},_$Model_45.prototype.subtypeSubmit=function(){var t,e,n,r;if(arguments.length<2)throw new Error("Not enough arguments for subtypeSubmit");2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(e=arguments[0],n=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]);var i=this._splitPath(t);return this._subtypeSubmit(i,e,n,r)},_$Model_45.prototype._subtypeSubmit=function(t,e,n,r){t=this._dereference(t);var i=this;return this._mutate(t,function(r,o,s){var a=r.subtypeSubmit(o,e,n,s),c=r.get(o),l=i.pass({$subtype:{type:e,op:n}})._pass;return i.emit("change",t,[c,void 0,l]),a},r)};var _$arrayDiff_2=arrayDiff;function InsertDiff(t,e){this.index=t,this.values=e}function RemoveDiff(t,e){this.index=t,this.howMany=e}function MoveDiff(t,e,n){this.from=t,this.to=e,this.howMany=n}function strictEqual(t,e){return t===e}function arrayDiff(t,e,n){n||(n=strictEqual);for(var r=t.length,i=e.length,o=[],s={},a={},c=0;c<r;c++)for(var l=t[c],u=0;u<i;u++)if(!a[u]&&n(l,e[u])){var h=c,p=u,f=0;do{s[c++]=a[u++]=!0,f++}while(c<r&&u<i&&n(t[c],e[u])&&!a[u]);o.push(new MoveDiff(h,p,f)),c--;break}var d=[];for(c=0;c<r;)if(s[c])c++;else{var m=c;for(f=0;c<r&&!s[c++];)f++;d.push(new RemoveDiff(m,f))}var _=[];for(u=0;u<i;)if(a[u])u++;else{for(m=u,f=0;u<i&&!a[u++];)f++;var g=e.slice(m,m+f);_.push(new InsertDiff(m,g))}var y,v,b=_.length,w=d.length,E=o.length,x=0;for(y=0;y<w;y++){var C=d[y];for(C.index-=x,x+=C.howMany,v=0;v<E;v++){($=o[v]).from>=C.index&&($.from-=C.howMany)}}for(y=b;y--;){var S=_[y];f=S.values.length;for(v=E;v--;){($=o[v]).to>=S.index&&($.to-=f)}}for(y=E;y-- >1;){if(($=o[y]).to!==$.from)for(v=y;v--;){var k=o[v];k.to>=$.to&&(k.to-=$.howMany),k.to>=$.from&&(k.to+=$.howMany)}}var T=[];for(y=0;y<E;y++){var $;if(($=o[y]).to!==$.from)for(T.push($),v=y+1;v<E;v++){var D=o[v];D.from>=$.from&&(D.from-=$.howMany),D.from>=$.to&&(D.from+=$.howMany)}}return d.concat(T,_)}arrayDiff.InsertDiff=InsertDiff,arrayDiff.RemoveDiff=RemoveDiff,arrayDiff.MoveDiff=MoveDiff,InsertDiff.prototype.type="insert",InsertDiff.prototype.toJSON=function(){return{type:this.type,index:this.index,values:this.values}},RemoveDiff.prototype.type="remove",RemoveDiff.prototype.toJSON=function(){return{type:this.type,index:this.index,howMany:this.howMany}},MoveDiff.prototype.type="move",MoveDiff.prototype.toJSON=function(){return{type:this.type,from:this.from,to:this.to,howMany:this.howMany}};var _$setDiff_60={};function diffDeep(t,e,n,r,i){if("object"==typeof n&&n&&"object"==typeof r&&r)if(Array.isArray(n)&&Array.isArray(r)){var o=_$arrayDiff_2(n,r,_$util_64.deepEqual);if(!o.length)return;if(2===o.length&&o[0].index===o[1].index&&o[0]instanceof _$arrayDiff_2.RemoveDiff&&1===o[0].howMany&&o[1]instanceof _$arrayDiff_2.InsertDiff&&1===o[1].values.length){var s=o[0].index;return void diffDeep(t,c=e.concat(s),n[s],r[s],i)}t._applyArrayDiff(e,o,i())}else{for(var a in n)if(!(a in r)){var c=e.concat(a);t._del(c,i())}for(var a in r){if(!_$util_64.deepEqual(n[a],r[a]))diffDeep(t,c=e.concat(a),n[a],r[a],i)}}else t._setDiff(e,r,i())}_$Model_45.prototype.setDiff=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._setDiff(r,e,n)},_$Model_45.prototype._setDiff=function(t,e,n){t=this._dereference(t);var r=this;return this._mutate(t,function(n,i,o){var s=n.get(i);return _$util_64.equal(s,e)?(o(),s):(n.set(i,e,o),r.emit("change",t,[e,s,r._pass]),s)},n)},_$Model_45.prototype.setDiffDeep=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._setDiffDeep(r,e,n)},_$Model_45.prototype._setDiffDeep=function(t,e,n){var r=this._get(t);n=this.wrapCallback(n);var i=_$util_64.asyncGroup(n),o=i();diffDeep(this,t,r,e,i),o()},_$Model_45.prototype.setArrayDiff=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._setArrayDiff(r,e,n)},_$Model_45.prototype.setArrayDiffDeep=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._setArrayDiffDeep(r,e,n)},_$Model_45.prototype._setArrayDiffDeep=function(t,e,n){return this._setArrayDiff(t,e,n,_$util_64.deepEqual)},_$Model_45.prototype._setArrayDiff=function(t,e,n,r){var i=this._get(t);if(i===e)return this.wrapCallback(n)();if(Array.isArray(i)&&Array.isArray(e)){var o=_$arrayDiff_2(i,e,r);this._applyArrayDiff(t,o,n)}else this._set(t,e,n)},_$Model_45.prototype._applyArrayDiff=function(t,e,n){if(!e.length)return this.wrapCallback(n)();t=this._dereference(t);var r=this;return this._mutate(t,function(n,i,o){for(var s=_$util_64.asyncGroup(o),a=0,c=e.length;a<c;a++){var l=e[a];if(l instanceof _$arrayDiff_2.InsertDiff)n.insert(i,l.index,l.values,s()),r.emit("insert",t,[l.index,l.values,r._pass]);else if(l instanceof _$arrayDiff_2.RemoveDiff){var u=n.remove(i,l.index,l.howMany,s());r.emit("remove",t,[l.index,u,r._pass])}else if(l instanceof _$arrayDiff_2.MoveDiff){var h=n.move(i,l.from,l.to,l.howMany,s());r.emit("move",t,[l.from,l.to,h.length,r._pass])}}},n)};var _$emitter_74={},__EventEmitter_74=_$EventEmitter_23.EventEmitter;function mixin(t){for(var e in __EventEmitter_74.prototype)t.prototype[e]=__EventEmitter_74.prototype[e]}_$emitter_74.EventEmitter=__EventEmitter_74,_$emitter_74.mixin=mixin;var SUPPORTED_METHODS=["info","warn","error"];function Logger(){var t={};SUPPORTED_METHODS.forEach(function(e){t[e]=console[e].bind(console)}),this.setMethods(t)}var _$Logger_77=Logger;Logger.prototype.setMethods=function(t){t=t||{};var e=this;SUPPORTED_METHODS.forEach(function(n){"function"==typeof t[n]&&(e[n]=t[n])})};var logger=new _$Logger_77,_$logger_76=logger;function ShareDBError(t,e){this.code=t,this.message=e||"",Error.captureStackTrace?Error.captureStackTrace(this,ShareDBError):this.stack=(new Error).stack}ShareDBError.prototype=Object.create(Error.prototype),ShareDBError.prototype.constructor=ShareDBError,ShareDBError.prototype.name="ShareDBError",ShareDBError.CODES={ERR_APPLY_OP_VERSION_DOES_NOT_MATCH_SNAPSHOT:"ERR_APPLY_OP_VERSION_DOES_NOT_MATCH_SNAPSHOT",ERR_APPLY_SNAPSHOT_NOT_PROVIDED:"ERR_APPLY_SNAPSHOT_NOT_PROVIDED",ERR_CLIENT_ID_BADLY_FORMED:"ERR_CLIENT_ID_BADLY_FORMED",ERR_CONNECTION_STATE_TRANSITION_INVALID:"ERR_CONNECTION_STATE_TRANSITION_INVALID",ERR_DATABASE_ADAPTER_NOT_FOUND:"ERR_DATABASE_ADAPTER_NOT_FOUND",ERR_DATABASE_DOES_NOT_SUPPORT_SUBSCRIBE:"ERR_DATABASE_DOES_NOT_SUPPORT_SUBSCRIBE",ERR_DATABASE_METHOD_NOT_IMPLEMENTED:"ERR_DATABASE_METHOD_NOT_IMPLEMENTED",ERR_DEFAULT_TYPE_MISMATCH:"ERR_DEFAULT_TYPE_MISMATCH",ERR_DOC_MISSING_VERSION:"ERR_DOC_MISSING_VERSION",ERR_DOC_ALREADY_CREATED:"ERR_DOC_ALREADY_CREATED",ERR_DOC_DOES_NOT_EXIST:"ERR_DOC_DOES_NOT_EXIST",ERR_DOC_TYPE_NOT_RECOGNIZED:"ERR_DOC_TYPE_NOT_RECOGNIZED",ERR_DOC_WAS_DELETED:"ERR_DOC_WAS_DELETED",ERR_INFLIGHT_OP_MISSING:"ERR_INFLIGHT_OP_MISSING",ERR_INGESTED_SNAPSHOT_HAS_NO_VERSION:"ERR_INGESTED_SNAPSHOT_HAS_NO_VERSION",ERR_MAX_SUBMIT_RETRIES_EXCEEDED:"ERR_MAX_SUBMIT_RETRIES_EXCEEDED",ERR_MESSAGE_BADLY_FORMED:"ERR_MESSAGE_BADLY_FORMED",ERR_MILESTONE_ARGUMENT_INVALID:"ERR_MILESTONE_ARGUMENT_INVALID",ERR_OP_ALREADY_SUBMITTED:"ERR_OP_ALREADY_SUBMITTED",ERR_OP_NOT_ALLOWED_IN_PROJECTION:"ERR_OP_NOT_ALLOWED_IN_PROJECTION",ERR_OP_SUBMIT_REJECTED:"ERR_OP_SUBMIT_REJECTED",ERR_OP_VERSION_MISMATCH_AFTER_TRANSFORM:"ERR_OP_VERSION_MISMATCH_AFTER_TRANSFORM",ERR_OP_VERSION_MISMATCH_DURING_TRANSFORM:"ERR_OP_VERSION_MISMATCH_DURING_TRANSFORM",ERR_OP_VERSION_NEWER_THAN_CURRENT_SNAPSHOT:"ERR_OP_VERSION_NEWER_THAN_CURRENT_SNAPSHOT",ERR_OT_OP_BADLY_FORMED:"ERR_OT_OP_BADLY_FORMED",ERR_OT_OP_NOT_PROVIDED:"ERR_OT_OP_NOT_PROVIDED",ERR_PROTOCOL_VERSION_NOT_SUPPORTED:"ERR_PROTOCOL_VERSION_NOT_SUPPORTED",ERR_QUERY_EMITTER_LISTENER_NOT_ASSIGNED:"ERR_QUERY_EMITTER_LISTENER_NOT_ASSIGNED",ERR_SNAPSHOT_READ_SILENT_REJECTION:"ERR_SNAPSHOT_READ_SILENT_REJECTION",ERR_SNAPSHOT_READS_REJECTED:"ERR_SNAPSHOT_READS_REJECTED",ERR_SUBMIT_TRANSFORM_OPS_NOT_FOUND:"ERR_SUBMIT_TRANSFORM_OPS_NOT_FOUND",ERR_TYPE_CANNOT_BE_PROJECTED:"ERR_TYPE_CANNOT_BE_PROJECTED",ERR_UNKNOWN_ERROR:"ERR_UNKNOWN_ERROR"};var _$ShareDBError_75=ShareDBError,_$bootstrapTransform_25=bootstrapTransform;function bootstrapTransform(t,e,n,r){var i=t.transformX=function(t,o){n(t),n(o);for(var s,a,c,l=[],u=0;u<o.length;u++){for(var h=o[u],p=[],f=0;f<t.length;){var d=[];if(s=t[f],c=d,e(p,s,a=h,"left"),e(c,a,s,"right"),f++,1!==d.length){if(0===d.length){for(var m=f;m<t.length;m++)r(p,t[m]);h=null;break}for(var _=i(t.slice(f),d),g=0;g<_[0].length;g++)r(p,_[0][g]);for(var y=0;y<_[1].length;y++)r(l,_[1][y]);h=null;break}h=d[0]}null!=h&&r(l,h),t=p}return[t,l]};t.transform=function(t,n,r){if("left"!==r&&"right"!==r)throw new Error("type must be 'left' or 'right'");return 0===n.length?t:1===t.length&&1===n.length?e([],t[0],n[0],r):"left"===r?i(t,n)[0]:i(n,t)[1]}}var _$text0_28={},text=_$text0_28={name:"text0",uri:"http://sharejs.org/types/textv0",create:function(t){if(null!=t&&"string"!=typeof t)throw new Error("Initial data must be a string");return t||""}},strInject=function(t,e,n){return t.slice(0,e)+n+t.slice(e)},checkValidComponent=function(t){if("number"!=typeof t.p)throw new Error("component missing position field");if("string"==typeof t.i==("string"==typeof t.d))throw new Error("component needs an i or d field");if(t.p<0)throw new Error("position cannot be negative")},checkValidOp=function(t){for(var e=0;e<t.length;e++)checkValidComponent(t[e])};text.apply=function(t,e){var n;checkValidOp(e);for(var r=0;r<e.length;r++){var i=e[r];if(null!=i.i)t=strInject(t,i.p,i.i);else{if(n=t.slice(i.p,i.p+i.d.length),i.d!==n)throw new Error("Delete component '"+i.d+"' does not match deleted text '"+n+"'");t=t.slice(0,i.p)+t.slice(i.p+i.d.length)}}return t};var append=text._append=function(t,e){if(""!==e.i&&""!==e.d)if(0===t.length)t.push(e);else{var n=t[t.length-1];null!=n.i&&null!=e.i&&n.p<=e.p&&e.p<=n.p+n.i.length?t[t.length-1]={i:strInject(n.i,e.p-n.p,e.i),p:n.p}:null!=n.d&&null!=e.d&&e.p<=n.p&&n.p<=e.p+e.d.length?t[t.length-1]={d:strInject(e.d,n.p-e.p,n.d),p:e.p}:t.push(e)}};text.compose=function(t,e){checkValidOp(t),checkValidOp(e);for(var n=t.slice(),r=0;r<e.length;r++)append(n,e[r]);return n},text.normalize=function(t){var e=[];null==t.i&&null==t.p||(t=[t]);for(var n=0;n<t.length;n++){var r=t[n];null==r.p&&(r.p=0),append(e,r)}return e};var transformPosition=function(t,e,n){return null!=e.i?e.p<t||e.p===t&&n?t+e.i.length:t:t<=e.p?t:t<=e.p+e.d.length?e.p:t-e.d.length};text.transformCursor=function(t,e,n){for(var r="right"===n,i=0;i<e.length;i++)t=transformPosition(t,e[i],r);return t};var transformComponent=text._tc=function(t,e,n,r){if(checkValidComponent(e),checkValidComponent(n),null!=e.i)append(t,{i:e.i,p:transformPosition(e.p,n,"right"===r)});else if(null!=n.i){var i=e.d;e.p<n.p&&(append(t,{d:i.slice(0,n.p-e.p),p:e.p}),i=i.slice(n.p-e.p)),""!==i&&append(t,{d:i,p:e.p+n.i.length})}else if(e.p>=n.p+n.d.length)append(t,{d:e.d,p:e.p-n.d.length});else if(e.p+e.d.length<=n.p)append(t,e);else{var o={d:"",p:e.p};e.p<n.p&&(o.d=e.d.slice(0,n.p-e.p)),e.p+e.d.length>n.p+n.d.length&&(o.d+=e.d.slice(n.p+n.d.length-e.p));var s=Math.max(e.p,n.p),a=Math.min(e.p+e.d.length,n.p+n.d.length);if(e.d.slice(s-e.p,a-e.p)!==n.d.slice(s-n.p,a-n.p))throw new Error("Delete ops delete different text in the same region of the document");""!==o.d&&(o.p=transformPosition(o.p,n),append(t,o))}return t},invertComponent=function(t){return null!=t.i?{d:t.i,p:t.p}:{i:t.d,p:t.p}};text.invert=function(t){t=t.slice().reverse();for(var e=0;e<t.length;e++)t[e]=invertComponent(t[e]);return t},_$bootstrapTransform_25(text,transformComponent,checkValidOp,append);var __isArray_27=function(t){return"[object Array]"==Object.prototype.toString.call(t)},isObject=function(t){return!!t&&t.constructor===Object},clone=function(t){return JSON.parse(JSON.stringify(t))},json={name:"json0",uri:"http://sharejs.org/types/JSONv0"},subtypes={};function convertFromText(t){t.t="text0";var e={p:t.p.pop()};null!=t.si&&(e.i=t.si),null!=t.sd&&(e.d=t.sd),t.o=[e]}function convertToText(t){t.p.push(t.o[0].p),null!=t.o[0].i&&(t.si=t.o[0].i),null!=t.o[0].d&&(t.sd=t.o[0].d),delete t.t,delete t.o}json.registerSubtype=function(t){subtypes[t.name]=t},json.create=function(t){return void 0===t?null:clone(t)},json.invertComponent=function(t){var e={p:t.p};return t.t&&subtypes[t.t]&&(e.t=t.t,e.o=subtypes[t.t].invert(t.o)),void 0!==t.si&&(e.sd=t.si),void 0!==t.sd&&(e.si=t.sd),void 0!==t.oi&&(e.od=t.oi),void 0!==t.od&&(e.oi=t.od),void 0!==t.li&&(e.ld=t.li),void 0!==t.ld&&(e.li=t.ld),void 0!==t.na&&(e.na=-t.na),void 0!==t.lm&&(e.lm=t.p[t.p.length-1],e.p=t.p.slice(0,t.p.length-1).concat([t.lm])),e},json.invert=function(t){for(var e=t.slice().reverse(),n=[],r=0;r<e.length;r++)n.push(json.invertComponent(e[r]));return n},json.checkValidOp=function(t){for(var e=0;e<t.length;e++)if(!__isArray_27(t[e].p))throw new Error("Missing path")},json.checkList=function(t){if(!__isArray_27(t))throw new Error("Referenced element not a list")},json.checkObj=function(t){if(!isObject(t))throw new Error("Referenced element not an object (it was "+JSON.stringify(t)+")")},json.apply=function(t,e){json.checkValidOp(e),e=clone(e);for(var n={data:t},r=0;r<e.length;r++){var i=e[r];null==i.si&&null==i.sd||convertFromText(i);for(var o=null,s=n,a="data",c=0;c<i.p.length;c++){var l=i.p[c];if(o=s,a,s=s[a],a=l,null==o)throw new Error("Path invalid")}if(i.t&&void 0!==i.o&&subtypes[i.t])s[a]=subtypes[i.t].apply(s[a],i.o);else if(void 0!==i.na){if("number"!=typeof s[a])throw new Error("Referenced element not a number");s[a]+=i.na}else if(void 0!==i.li&&void 0!==i.ld)json.checkList(s),s[a]=i.li;else if(void 0!==i.li)json.checkList(s),s.splice(a,0,i.li);else if(void 0!==i.ld)json.checkList(s),s.splice(a,1);else if(void 0!==i.lm){if(json.checkList(s),i.lm!=a){var u=s[a];s.splice(a,1),s.splice(i.lm,0,u)}}else if(void 0!==i.oi)json.checkObj(s),s[a]=i.oi;else{if(void 0===i.od)throw new Error("invalid / missing instruction in op");json.checkObj(s),delete s[a]}}return n.data},json.shatter=function(t){for(var e=[],n=0;n<t.length;n++)e.push([t[n]]);return e},json.incrementalApply=function(t,e,n){for(var r=0;r<e.length;r++){var i=[e[r]];n(i,t=json.apply(t,i))}return t};var pathMatches=json.pathMatches=function(t,e,n){if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(t[r]!==e[r]&&(!n||r!==t.length-1))return!1;return!0};json.append=function(t,e){if(e=clone(e),0!==t.length){var n=t[t.length-1];if(null==e.si&&null==e.sd||null==n.si&&null==n.sd||(convertFromText(e),convertFromText(n)),pathMatches(e.p,n.p))if(e.t&&n.t&&e.t===n.t&&subtypes[e.t]){if(n.o=subtypes[e.t].compose(n.o,e.o),null!=e.si||null!=e.sd){for(var r=e.p,i=0;i<n.o.length-1;i++)e.o=[n.o.pop()],e.p=r.slice(),convertToText(e),t.push(e);convertToText(n)}}else null!=n.na&&null!=e.na?t[t.length-1]={p:n.p,na:n.na+e.na}:void 0!==n.li&&void 0===e.li&&e.ld===n.li?void 0!==n.ld?delete n.li:t.pop():void 0!==n.od&&void 0===n.oi&&void 0!==e.oi&&void 0===e.od?n.oi=e.oi:void 0!==n.oi&&void 0!==e.od?void 0!==e.oi?n.oi=e.oi:void 0!==n.od?delete n.oi:t.pop():void 0!==e.lm&&e.p[e.p.length-1]===e.lm||t.push(e);else null==e.si&&null==e.sd||null==n.si&&null==n.sd||(convertToText(e),convertToText(n)),t.push(e)}else t.push(e)},json.compose=function(t,e){json.checkValidOp(t),json.checkValidOp(e);for(var n=clone(t),r=0;r<e.length;r++)json.append(n,e[r]);return n},json.normalize=function(t){var e=[];t=__isArray_27(t)?t:[t];for(var n=0;n<t.length;n++){var r=t[n];null==r.p&&(r.p=[]),json.append(e,r)}return e},json.commonLengthForOps=function(t,e){var n=t.p.length,r=e.p.length;if((null!=t.na||t.t)&&n++,(null!=e.na||e.t)&&r++,0===n)return-1;if(0===r)return null;n--,r--;for(var i=0;i<n;i++){var o=t.p[i];if(i>=r||o!==e.p[i])return null}return n},json.canOpAffectPath=function(t,e){return null!=json.commonLengthForOps({p:e},t)},json.transformComponent=function(t,e,n,r){e=clone(e);var i=json.commonLengthForOps(n,e),o=json.commonLengthForOps(e,n),s=e.p.length,a=n.p.length;if((null!=e.na||e.t)&&s++,(null!=n.na||n.t)&&a++,null!=o&&a>s&&e.p[o]==n.p[o])if(void 0!==e.ld)(l=clone(n)).p=l.p.slice(s),e.ld=json.apply(clone(e.ld),[l]);else if(void 0!==e.od){(l=clone(n)).p=l.p.slice(s),e.od=json.apply(clone(e.od),[l])}if(null!=i){var c=s==a,l=n;if(null==e.si&&null==e.sd||null==n.si&&null==n.sd||(convertFromText(e),convertFromText(l=clone(n))),l.t&&subtypes[l.t]){if(e.t&&e.t===l.t){var u=subtypes[e.t].transform(e.o,l.o,r);if(null!=e.si||null!=e.sd)for(var h=e.p,p=0;p<u.length;p++)e.o=[u[p]],e.p=h.slice(),convertToText(e),json.append(t,e);else(!__isArray_27(u)||u.length>0)&&(e.o=u,json.append(t,e));return t}}else if(void 0!==n.na);else if(void 0!==n.li&&void 0!==n.ld){if(n.p[i]===e.p[i]){if(!c)return t;if(void 0!==e.ld){if(void 0===e.li||"left"!==r)return t;e.ld=clone(n.li)}}}else if(void 0!==n.li)void 0!==e.li&&void 0===e.ld&&c&&e.p[i]===n.p[i]?"right"===r&&e.p[i]++:n.p[i]<=e.p[i]&&e.p[i]++,void 0!==e.lm&&c&&n.p[i]<=e.lm&&e.lm++;else if(void 0!==n.ld){if(void 0!==e.lm&&c){if(n.p[i]===e.p[i])return t;h=n.p[i];var f=e.p[i];(h<(d=e.lm)||h===d&&f<d)&&e.lm--}if(n.p[i]<e.p[i])e.p[i]--;else if(n.p[i]===e.p[i]){if(a<s)return t;if(void 0!==e.ld){if(void 0===e.li)return t;delete e.ld}}}else if(void 0!==n.lm)if(void 0!==e.lm&&s===a){f=e.p[i];var d=e.lm,m=n.p[i],_=n.lm;if(m!==_)if(f===m){if("left"!==r)return t;e.p[i]=_,f===d&&(e.lm=_)}else f>m&&e.p[i]--,f>_?e.p[i]++:f===_&&m>_&&(e.p[i]++,f===d&&e.lm++),d>m?e.lm--:d===m&&d>f&&e.lm--,d>_?e.lm++:d===_&&(_>m&&d>f||_<m&&d<f?"right"===r&&e.lm++:d>f?e.lm++:d===m&&e.lm--)}else if(void 0!==e.li&&void 0===e.ld&&c){f=n.p[i],d=n.lm;(h=e.p[i])>f&&e.p[i]--,h>d&&e.p[i]++}else{f=n.p[i],d=n.lm;(h=e.p[i])===f?e.p[i]=d:(h>f&&e.p[i]--,h>d?e.p[i]++:h===d&&f>d&&e.p[i]++)}else if(void 0!==n.oi&&void 0!==n.od){if(e.p[i]===n.p[i]){if(void 0===e.oi||!c)return t;if("right"===r)return t;e.od=n.oi}}else if(void 0!==n.oi){if(void 0!==e.oi&&e.p[i]===n.p[i]){if("left"!==r)return t;json.append(t,{p:e.p,od:n.oi})}}else if(void 0!==n.od&&e.p[i]==n.p[i]){if(!c)return t;if(void 0===e.oi)return t;delete e.od}}return json.append(t,e),t},_$bootstrapTransform_25(json,json.transformComponent,json.checkValidOp,json.append),json.registerSubtype(_$text0_28);var _$json_27=json,_$lib_26={type:_$json_27},_$types_79={};_$types_79.defaultType=_$lib_26.type,_$types_79.map={},_$types_79.register=function(t){t.name&&(_$types_79.map[t.name]=t),t.uri&&(_$types_79.map[t.uri]=t)},_$types_79.register(_$types_79.defaultType);var _$Doc_68={};(function(t){var e=_$ShareDBError_75.CODES;function n(t,e,n){_$emitter_74.EventEmitter.call(this),this.connection=t,this.collection=e,this.id=n,this.version=null,this.type=null,this.data=void 0,this.inflightFetch=[],this.inflightSubscribe=[],this.inflightUnsubscribe=[],this.pendingFetch=[],this.subscribed=!1,this.wantSubscribe=!1,this.inflightOp=null,this.pendingOps=[],this.type=null,this.applyStack=null,this.preventCompose=!1}function r(t,e,n){if(e){var r=t.pop();t.push(function(t){r&&r(t),n&&n(t)})}else t.push(n)}function i(t,n){if(t.del)return delete(r=n).op,delete r.create,void delete r.del;var r;if(n.del)return new _$ShareDBError_75(e.ERR_DOC_WAS_DELETED,"Document was deleted");if(n.create)return new _$ShareDBError_75(e.ERR_DOC_ALREADY_CREATED,"Document already created");if(n.op){if(t.create)return new _$ShareDBError_75(e.ERR_DOC_ALREADY_CREATED,"Document already created");if(t.type.transformX){var i=t.type.transformX(t.op,n.op);t.op=i[0],n.op=i[1]}else{var o=t.type.transform(t.op,n.op,"left"),s=t.type.transform(n.op,t.op,"right");t.op=o,n.op=s}}}function o(t,e){for(var n=!1,r=0;r<t.length;r++){var i=t[r];i&&(i(e),n=!0)}return n}_$Doc_68=n,_$emitter_74.mixin(n),n.prototype.destroy=function(t){var e=this;e.whenNothingPending(function(){e.wantSubscribe?e.unsubscribe(function(n){if(n)return t?t(n):e.emit("error",n);e.connection._destroyDoc(e),t&&t()}):(e.connection._destroyDoc(e),t&&t())})},n.prototype._setType=function(t){if("string"==typeof t&&(t=_$types_79.map[t]),t)this.type=t;else{if(null!==t){var n=new _$ShareDBError_75(e.ERR_DOC_TYPE_NOT_RECOGNIZED,"Missing type "+t);return this.emit("error",n)}this.type=t,this.data=void 0}},n.prototype.ingestSnapshot=function(t,n){if(!t)return n&&n();if("number"!=typeof t.v){var r=new _$ShareDBError_75(e.ERR_INGESTED_SNAPSHOT_HAS_NO_VERSION,"Missing version in ingested snapshot. "+this.collection+"."+this.id);return n?n(r):this.emit("error",r)}if(this.type||this.hasWritePending()){if(null==this.version){if(this.hasWritePending())return n&&this.once("no write pending",n);r=new _$ShareDBError_75(e.ERR_DOC_MISSING_VERSION,"Cannot ingest snapshot in doc with null version. "+this.collection+"."+this.id);return n?n(r):this.emit("error",r)}return t.v>this.version?this.fetch(n):n&&n()}if(this.version>t.v)return n&&n();this.version=t.v;var i=void 0===t.type?_$types_79.defaultType:t.type;this._setType(i),this.data=this.type&&this.type.deserialize?this.type.deserialize(t.data):t.data,this.emit("load"),n&&n()},n.prototype.whenNothingPending=function(e){var n=this;t.nextTick(function(){n.hasPending()?n.once("nothing pending",e):e()})},n.prototype.hasPending=function(){return!!(this.inflightOp||this.pendingOps.length||this.inflightFetch.length||this.inflightSubscribe.length||this.inflightUnsubscribe.length||this.pendingFetch.length)},n.prototype.hasWritePending=function(){return!(!this.inflightOp&&!this.pendingOps.length)},n.prototype._emitNothingPending=function(){this.hasWritePending()||(this.emit("no write pending"),this.hasPending()||this.emit("nothing pending"))},n.prototype._emitResponseError=function(t,n){return t&&t.code===e.ERR_SNAPSHOT_READ_SILENT_REJECTION?(this.wantSubscribe=!1,n&&n(),void this._emitNothingPending()):n?(n(t),void this._emitNothingPending()):(this._emitNothingPending(),void this.emit("error",t))},n.prototype._handleFetch=function(t,e){var n=this.inflightFetch.shift();if(t)return this._emitResponseError(t,n);this.ingestSnapshot(e,n),this._emitNothingPending()},n.prototype._handleSubscribe=function(t,e){var n=this.inflightSubscribe.shift();if(t)return this._emitResponseError(t,n);this.wantSubscribe&&(this.subscribed=!0),this.ingestSnapshot(e,n),this._emitNothingPending()},n.prototype._handleUnsubscribe=function(t){var e=this.inflightUnsubscribe.shift();if(t)return this._emitResponseError(t,e);e&&e(),this._emitNothingPending()},n.prototype._handleOp=function(t,n){if(t)return this.inflightOp?(t.code===e.ERR_OP_SUBMIT_REJECTED&&(t=null),this._rollback(t)):this.emit("error",t);if(this.inflightOp&&n.src===this.inflightOp.src&&n.seq===this.inflightOp.seq)this._opAcknowledged(n);else if(null==this.version||n.v>this.version)this.fetch();else if(!(n.v<this.version)){if(this.inflightOp)if(o=i(this.inflightOp,n))return this._hardRollback(o);for(var r=0;r<this.pendingOps.length;r++){var o;if(o=i(this.pendingOps[r],n))return this._hardRollback(o)}this.version++;try{this._otApply(n,!1)}catch(t){return this._hardRollback(t)}}},n.prototype._onConnectionStateChanged=function(){if(this.connection.canSend)this.flush(),this._resubscribe();else if(this.inflightOp&&(this.pendingOps.unshift(this.inflightOp),this.inflightOp=null),this.subscribed=!1,(this.inflightFetch.length||this.inflightSubscribe.length)&&(this.pendingFetch=this.pendingFetch.concat(this.inflightFetch,this.inflightSubscribe),this.inflightFetch.length=0,this.inflightSubscribe.length=0),this.inflightUnsubscribe.length){var t=this.inflightUnsubscribe;this.inflightUnsubscribe=[],o(t)}},n.prototype._resubscribe=function(){var t=this.pendingFetch;if(this.pendingFetch=[],this.wantSubscribe)return t.length?void this.subscribe(function(e){o(t,e)}):void this.subscribe();t.length&&this.fetch(function(e){o(t,e)})},n.prototype.fetch=function(t){if(this.connection.canSend){var e=this.connection.sendFetch(this);r(this.inflightFetch,e,t)}else this.pendingFetch.push(t)},n.prototype.subscribe=function(t){if(this.wantSubscribe=!0,this.connection.canSend){var e=this.connection.sendSubscribe(this);r(this.inflightSubscribe,e,t)}else this.pendingFetch.push(t)},n.prototype.unsubscribe=function(e){if(this.wantSubscribe=!1,this.subscribed=!1,this.connection.canSend){var n=this.connection.sendUnsubscribe(this);r(this.inflightUnsubscribe,n,e)}else e&&t.nextTick(e)},n.prototype.flush=function(){this.connection.canSend&&!this.inflightOp&&!this.paused&&this.pendingOps.length&&this._sendOp()},n.prototype._otApply=function(t,n){if(t.op){if(!this.type)throw new _$ShareDBError_75(e.ERR_DOC_DOES_NOT_EXIST,"Cannot apply op to uncreated document. "+this.collection+"."+this.id);if(!n&&this.type===_$types_79.defaultType&&t.op.length>1){this.applyStack||(this.applyStack=[]);for(var r=this.applyStack.length,o=0;o<t.op.length;o++){for(var s={op:[t.op[o]]},a=r;a<this.applyStack.length;a++){var c=i(this.applyStack[a],s);if(c)return this._hardRollback(c)}this.emit("before op",s.op,n),this.data=this.type.apply(this.data,s.op),this.emit("op",s.op,n)}return void this._popApplyStack(r)}return this.emit("before op",t.op,n),this.data=this.type.apply(this.data,t.op),void this.emit("op",t.op,n)}if(t.create)return this._setType(t.create.type),this.data=this.type.deserialize?this.type.createDeserialized?this.type.createDeserialized(t.create.data):this.type.deserialize(this.type.create(t.create.data)):this.type.create(t.create.data),void this.emit("create",n);if(t.del){var l=this.data;return this._setType(null),void this.emit("del",l,n)}},n.prototype._sendOp=function(){var t=this.connection.id;if(t){this.inflightOp||(this.inflightOp=this.pendingOps.shift());var n=this.inflightOp;if(!n){var r=new _$ShareDBError_75(e.ERR_INFLIGHT_OP_MISSING,"No op to send on call to _sendOp");return this.emit("error",r)}n.sentAt=Date.now(),n.retries=null==n.retries?0:n.retries+1,null==n.seq&&(n.seq=this.connection.seq++),this.connection.sendOp(this,n),null==n.src&&(n.src=t)}},n.prototype._submit=function(n,r,i){if(r||(r=!0),n.op){if(!this.type){var o=new _$ShareDBError_75(e.ERR_DOC_DOES_NOT_EXIST,"Cannot submit op. Document has not been created. "+this.collection+"."+this.id);return i?i(o):this.emit("error",o)}this.type.normalize&&(n.op=this.type.normalize(n.op))}try{this._pushOp(n,i),this._otApply(n,r)}catch(t){return this._hardRollback(t)}var s=this;t.nextTick(function(){s.flush()})},n.prototype._pushOp=function(t,e){if(this.applyStack)this.applyStack.push(t);else{var n=this._tryCompose(t);if(n)return void n.callbacks.push(e)}t.type=this.type,t.callbacks=[e],this.pendingOps.push(t)},n.prototype._popApplyStack=function(t){if(t>0)this.applyStack.length=t;else{var e=this.applyStack[0];if(this.applyStack=null,e)if(-1!==(r=this.pendingOps.indexOf(e)))for(var n=this.pendingOps.splice(r),r=0;r<n.length;r++){e=n[r];var i=this._tryCompose(e);i?i.callbacks=i.callbacks.concat(e.callbacks):this.pendingOps.push(e)}}},n.prototype._tryCompose=function(t){if(!this.preventCompose){var e=this.pendingOps[this.pendingOps.length-1];if(e&&!e.sentAt)return e.create&&t.op?(e.create.data=this.type.apply(e.create.data,t.op),e):e.op&&t.op&&this.type.compose?(e.op=this.type.compose(e.op,t.op),e):void 0}},n.prototype.submitOp=function(t,e,n){"function"==typeof e&&(n=e,e=null);var r={op:t},i=e&&e.source;this._submit(r,i,n)},n.prototype.create=function(t,n,r,i){if("function"==typeof n?(i=n,r=null,n=null):"function"==typeof r&&(i=r,r=null),n||(n=_$types_79.defaultType.uri),this.type){var o=new _$ShareDBError_75(e.ERR_DOC_ALREADY_CREATED,"Document already exists");return i?i(o):this.emit("error",o)}var s={create:{type:n,data:t}},a=r&&r.source;this._submit(s,a,i)},n.prototype.del=function(t,n){if("function"==typeof t&&(n=t,t=null),!this.type){var r=new _$ShareDBError_75(e.ERR_DOC_DOES_NOT_EXIST,"Document does not exist");return n?n(r):this.emit("error",r)}var i=t&&t.source;this._submit({del:!0},i,n)},n.prototype.pause=function(){this.paused=!0},n.prototype.resume=function(){this.paused=!1,this.flush()},n.prototype._opAcknowledged=function(t){if(this.inflightOp.create)this.version=t.v;else if(t.v!==this.version)return _$logger_76.warn("Invalid version from server. Expected: "+this.version+" Received: "+t.v,t),this.fetch();this.version++,this._clearInflightOp()},n.prototype._rollback=function(t){var e=this.inflightOp;if(e.op&&e.type.invert){e.op=e.type.invert(e.op);for(var n=0;n<this.pendingOps.length;n++){var r=i(this.pendingOps[n],e);if(r)return this._hardRollback(r)}try{this._otApply(e,!1)}catch(t){return this._hardRollback(t)}this._clearInflightOp(t)}else this._hardRollback(t)},n.prototype._hardRollback=function(t){var e=[];this.inflightOp&&e.push(this.inflightOp),e=e.concat(this.pendingOps),this._setType(null),this.version=null,this.inflightOp=null,this.pendingOps=[];var n=this;this.fetch(function(){for(var r=!!e.length,i=0;i<e.length;i++)r=o(e[i].callbacks,t)&&r;if(t&&!r)return n.emit("error",t)})},n.prototype._clearInflightOp=function(t){var e=this.inflightOp;this.inflightOp=null;var n=o(e.callbacks,t);if(this.flush(),this._emitNothingPending(),t&&!n)return this.emit("error",t)}}).call(this,_$browser_30);var _$Query_70={};(function(t){function e(t,e,n,r,i,o,s){_$emitter_74.EventEmitter.call(this),this.action=t,this.connection=e,this.id=n,this.collection=r,this.query=i,this.results=null,o&&o.results&&(this.results=o.results,delete o.results),this.extra=void 0,this.options=o,this.callback=s,this.ready=!1,this.sent=!1}_$Query_70=e,_$emitter_74.mixin(e),e.prototype.hasPending=function(){return!this.ready},e.prototype.send=function(){if(this.connection.canSend){var t={a:this.action,id:this.id,c:this.collection,q:this.query};if(this.options&&(t.o=this.options),this.results){for(var e=[],n=0;n<this.results.length;n++){var r=this.results[n];e.push([r.id,r.version])}t.r=e}this.connection.send(t),this.sent=!0}},e.prototype.destroy=function(e){this.connection.canSend&&"qs"===this.action&&this.connection.send({a:"qu",id:this.id}),this.connection._destroyQuery(this),e&&t.nextTick(e)},e.prototype._onConnectionStateChanged=function(){this.connection.canSend&&!this.sent?this.send():this.sent=!1},e.prototype._handleFetch=function(t,e,n){this.connection._destroyQuery(this),this._handleResponse(t,e,n)},e.prototype._handleSubscribe=function(t,e,n){this._handleResponse(t,e,n)},e.prototype._handleResponse=function(t,e,n){var r=this.callback;if(this.callback=null,t)return this._finishResponse(t,r);if(!e)return this._finishResponse(null,r);var i=this,o=1,s=function(t){if(t)return i._finishResponse(t,r);--o||i._finishResponse(null,r)};if(Array.isArray(e))o+=e.length,this.results=this._ingestSnapshots(e,s),this.extra=n;else for(var a in e){o++;var c=e[a];this.connection.get(c.c||this.collection,a).ingestSnapshot(c,s)}s()},e.prototype._ingestSnapshots=function(t,e){for(var n=[],r=0;r<t.length;r++){var i=t[r],o=this.connection.get(i.c||this.collection,i.d);o.ingestSnapshot(i,e),n.push(o)}return n},e.prototype._finishResponse=function(t,e){if(this.emit("ready"),this.ready=!0,t)return this.connection._destroyQuery(this),e?e(t):this.emit("error",t);e&&e(null,this.results,this.extra)},e.prototype._handleError=function(t){this.emit("error",t)},e.prototype._handleDiff=function(t){for(var e=0;e<t.length;e++){"insert"===(n=t[e]).type&&(n.values=this._ingestSnapshots(n.values))}for(e=0;e<t.length;e++){var n;switch((n=t[e]).type){case"insert":var r=n.values;Array.prototype.splice.apply(this.results,[n.index,0].concat(r)),this.emit("insert",r,n.index);break;case"remove":var i=n.howMany||1,o=this.results.splice(n.index,i);this.emit("remove",o,n.index);break;case"move":i=n.howMany||1;var s=this.results.splice(n.from,i);Array.prototype.splice.apply(this.results,[n.to,0].concat(s)),this.emit("move",s,n.from,n.to)}}this.emit("changed",this.results)},e.prototype._handleExtra=function(t){this.extra=t,this.emit("extra",t)}}).call(this,_$browser_30);var _$Snapshot_78=Snapshot;function Snapshot(t,e,n,r,i){this.id=t,this.v=e,this.type=n,this.data=r,this.m=i}var _$SnapshotRequest_71=SnapshotRequest;function SnapshotRequest(t,e,n,r,i){if(_$emitter_74.EventEmitter.call(this),"function"!=typeof i)throw new Error("Callback is required for SnapshotRequest");this.requestId=e,this.connection=t,this.id=r,this.collection=n,this.callback=i,this.sent=!1}_$emitter_74.mixin(SnapshotRequest),SnapshotRequest.prototype.send=function(){this.connection.canSend&&(this.connection.send(this._message()),this.sent=!0)},SnapshotRequest.prototype._onConnectionStateChanged=function(){this.connection.canSend?this.sent||this.send():this.sent=!1},SnapshotRequest.prototype._handleResponse=function(t,e){if(this.emit("ready"),t)return this.callback(t);var n=e.meta?e.meta:null,r=new _$Snapshot_78(this.id,e.v,e.type,e.data,n);this.callback(null,r)};var _$util_80={};function doNothing(){}_$util_80.doNothing=doNothing,_$util_80.hasKeys=function(t){for(var e in t)return!0;return!1},_$util_80.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},_$util_80.isValidVersion=function(t){return null===t||_$util_80.isInteger(t)&&t>=0},_$util_80.isValidTimestamp=function(t){return _$util_80.isValidVersion(t)};var _$SnapshotVersionRequest_73=SnapshotVersionRequest;function SnapshotVersionRequest(t,e,n,r,i,o){if(_$SnapshotRequest_71.call(this,t,e,n,r,o),!_$util_80.isValidVersion(i))throw new Error("Snapshot version must be a positive integer or null");this.version=i}SnapshotVersionRequest.prototype=Object.create(_$SnapshotRequest_71.prototype),SnapshotVersionRequest.prototype._message=function(){return{a:"nf",id:this.requestId,c:this.collection,d:this.id,v:this.version}};var _$SnapshotTimestampRequest_72=SnapshotTimestampRequest;function SnapshotTimestampRequest(t,e,n,r,i,o){if(_$SnapshotRequest_71.call(this,t,e,n,r,o),!_$util_80.isValidTimestamp(i))throw new Error("Snapshot timestamp must be a positive integer or null");this.timestamp=i}SnapshotTimestampRequest.prototype=Object.create(_$SnapshotRequest_71.prototype),SnapshotTimestampRequest.prototype._message=function(){return{a:"nt",id:this.requestId,c:this.collection,d:this.id,ts:this.timestamp}};var _$Connection_67={};(function(t){var e=_$ShareDBError_75.CODES;function n(t){return 0===t.readyState||1===t.readyState?"connecting":"disconnected"}function r(t){_$emitter_74.EventEmitter.call(this),this.collections={},this.nextQueryId=1,this.nextSnapshotRequestId=1,this.queries={},this._snapshotRequests={},this.seq=1,this.id=null,this.agent=null,this.debug=!1,this.state=n(t),this.bindToSocket(t)}function i(t,e){var n=new Error(t.message);return n.code=t.code,e&&(n.data=e),n}function o(t){return t.hasPending()}function s(t){return t.hasWritePending()}_$Connection_67=r,_$emitter_74.mixin(r),r.prototype.bindToSocket=function(e){this.socket&&(this.socket.close(),this.socket.onmessage=null,this.socket.onopen=null,this.socket.onerror=null,this.socket.onclose=null),this.socket=e;var r=n(e);this._setState(r),this.canSend=!1;var i=this;e.onmessage=function(e){try{var n="string"==typeof e.data?JSON.parse(e.data):e.data}catch(t){return void _$logger_76.warn("Failed to parse message",e)}i.debug&&_$logger_76.info("RECV",JSON.stringify(n));var r={data:n};if(i.emit("receive",r),r.data)try{i.handleMessage(r.data)}catch(e){t.nextTick(function(){i.emit("error",e)})}},e.onopen=function(){i._setState("connecting")},e.onerror=function(t){i.emit("connection error",t)},e.onclose=function(t){"closed"===t||"Closed"===t?i._setState("closed",t):"stopped"===t||"Stopped by server"===t?i._setState("stopped",t):i._setState("disconnected",t)}},r.prototype.handleMessage=function(t){var n=null;switch(t.error&&(n=i(t.error,t),delete t.error),t.a){case"init":return 1!==t.protocol?(n=new _$ShareDBError_75(e.ERR_PROTOCOL_VERSION_NOT_SUPPORTED,"Unsupported protocol version: "+t.protocol),this.emit("error",n)):_$types_79.map[t.type]!==_$types_79.defaultType?(n=new _$ShareDBError_75(e.ERR_DEFAULT_TYPE_MISMATCH,t.type+" does not match the server default type"),this.emit("error",n)):"string"!=typeof t.id?(n=new _$ShareDBError_75(e.ERR_CLIENT_ID_BADLY_FORMED,"Client id must be a string"),this.emit("error",n)):(this.id=t.id,void this._setState("connected"));case"qf":return void((r=this.queries[t.id])&&r._handleFetch(n,t.data,t.extra));case"qs":return void((r=this.queries[t.id])&&r._handleSubscribe(n,t.data,t.extra));case"qu":return;case"q":var r;if(!(r=this.queries[t.id]))return;return n?r._handleError(n):(t.diff&&r._handleDiff(t.diff),void(t.hasOwnProperty("extra")&&r._handleExtra(t.extra)));case"bf":return this._handleBulkMessage(n,t,"_handleFetch");case"bs":return this._handleBulkMessage(n,t,"_handleSubscribe");case"bu":return this._handleBulkMessage(n,t,"_handleUnsubscribe");case"nf":case"nt":return this._handleSnapshotFetch(n,t);case"f":return void((o=this.getExisting(t.c,t.d))&&o._handleFetch(n,t.data));case"s":return void((o=this.getExisting(t.c,t.d))&&o._handleSubscribe(n,t.data));case"u":return void((o=this.getExisting(t.c,t.d))&&o._handleUnsubscribe(n));case"op":var o;return void((o=this.getExisting(t.c,t.d))&&o._handleOp(n,t));default:_$logger_76.warn("Ignoring unrecognized message",t)}},r.prototype._handleBulkMessage=function(t,e,n){if(e.data)for(var r in e.data){var o=e.data[r];(a=this.getExisting(e.c,r))&&(t?a[n](t):o.error?a[n](i(o.error)):a[n](null,o))}else if(Array.isArray(e.b))for(var s=0;s<e.b.length;s++){r=e.b[s];(a=this.getExisting(e.c,r))&&a[n](t)}else if(e.b)for(var r in e.b){var a;(a=this.getExisting(e.c,r))&&a[n](t)}else _$logger_76.error("Invalid bulk message",e)},r.prototype._reset=function(){this.seq=1,this.id=null,this.agent=null},r.prototype._setState=function(t,n){if(this.state!==t){if("connecting"===t&&"disconnected"!==this.state&&"stopped"!==this.state&&"closed"!==this.state||"connected"===t&&"connecting"!==this.state){var r=new _$ShareDBError_75(e.ERR_CONNECTION_STATE_TRANSITION_INVALID,"Cannot transition directly from "+this.state+" to "+t);return this.emit("error",r)}for(var i in this.state=t,this.canSend="connected"===t,"disconnected"!==t&&"stopped"!==t&&"closed"!==t||this._reset(),this.startBulk(),this.queries){this.queries[i]._onConnectionStateChanged()}for(var o in this.collections){var s=this.collections[o];for(var i in s)s[i]._onConnectionStateChanged()}for(var i in this._snapshotRequests){this._snapshotRequests[i]._onConnectionStateChanged()}this.endBulk(),this.emit(t,n),this.emit("state",t,n)}},r.prototype.startBulk=function(){this.bulk||(this.bulk={})},r.prototype.endBulk=function(){if(this.bulk)for(var t in this.bulk){var e=this.bulk[t];this._sendBulk("f",t,e.f),this._sendBulk("s",t,e.s),this._sendBulk("u",t,e.u)}this.bulk=null},r.prototype._sendBulk=function(t,e,n){if(n){var r,i=[],o={},s=0;for(var a in n){var c=n[a];null==c?i.push(a):(o[a]=c,r=a,s++)}if(1===i.length){a=i[0];this.send({a:t,c:e,d:a})}else i.length&&this.send({a:"b"+t,c:e,b:i});if(1===s){var l=o[r];this.send({a:t,c:e,d:r,v:l})}else s&&this.send({a:"b"+t,c:e,b:o})}},r.prototype._sendAction=function(t,e,n){if(this._addDoc(e),this.bulk){var r=this.bulk[e.collection]||(this.bulk[e.collection]={}),i=r[t]||(r[t]={}),o=i.hasOwnProperty(e.id);return i[e.id]=n,o}var s={a:t,c:e.collection,d:e.id,v:n};this.send(s)},r.prototype.sendFetch=function(t){return this._sendAction("f",t,t.version)},r.prototype.sendSubscribe=function(t){return this._sendAction("s",t,t.version)},r.prototype.sendUnsubscribe=function(t){return this._sendAction("u",t)},r.prototype.sendOp=function(t,e){this._addDoc(t);var n={a:"op",c:t.collection,d:t.id,v:t.version,src:e.src,seq:e.seq};e.op&&(n.op=e.op),e.create&&(n.create=e.create),e.del&&(n.del=e.del),this.send(n)},r.prototype.send=function(t){this.debug&&_$logger_76.info("SEND",JSON.stringify(t)),this.emit("send",t),this.socket.send(JSON.stringify(t))},r.prototype.close=function(){this.socket.close()},r.prototype.getExisting=function(t,e){if(this.collections[t])return this.collections[t][e]},r.prototype.get=function(t,e){var n=this.collections[t]||(this.collections[t]={}),r=n[e];return r||(r=n[e]=new _$Doc_68(this,t,e),this.emit("doc",r)),r},r.prototype._destroyDoc=function(t){var e=this.collections[t.collection];e&&(delete e[t.id],_$util_80.hasKeys(e)||delete this.collections[t.collection])},r.prototype._addDoc=function(t){var e=this.collections[t.collection];e||(e=this.collections[t.collection]={}),e[t.id]!==t&&(e[t.id]=t)},r.prototype._createQuery=function(t,e,n,r,i){var o=this.nextQueryId++,s=new _$Query_70(t,this,o,e,n,r,i);return this.queries[o]=s,s.send(),s},r.prototype._destroyQuery=function(t){delete this.queries[t.id]},r.prototype.createFetchQuery=function(t,e,n,r){return this._createQuery("qf",t,e,n,r)},r.prototype.createSubscribeQuery=function(t,e,n,r){return this._createQuery("qs",t,e,n,r)},r.prototype.hasPending=function(){return!!(this._firstDoc(o)||this._firstQuery(o)||this._firstSnapshotRequest())},r.prototype.hasWritePending=function(){return!!this._firstDoc(s)},r.prototype.whenNothingPending=function(e){var n=this._firstDoc(o);if(n)n.once("nothing pending",this._nothingPendingRetry(e));else{var r=this._firstQuery(o);if(r)r.once("ready",this._nothingPendingRetry(e));else{var i=this._firstSnapshotRequest();i?i.once("ready",this._nothingPendingRetry(e)):t.nextTick(e)}}},r.prototype._nothingPendingRetry=function(e){var n=this;return function(){t.nextTick(function(){n.whenNothingPending(e)})}},r.prototype._firstDoc=function(t){for(var e in this.collections){var n=this.collections[e];for(var r in n){var i=n[r];if(t(i))return i}}},r.prototype._firstQuery=function(t){for(var e in this.queries){var n=this.queries[e];if(t(n))return n}},r.prototype._firstSnapshotRequest=function(){for(var t in this._snapshotRequests)return this._snapshotRequests[t]},r.prototype.fetchSnapshot=function(t,e,n,r){"function"==typeof n&&(r=n,n=null);var i=this.nextSnapshotRequestId++,o=new _$SnapshotVersionRequest_73(this,i,t,e,n,r);this._snapshotRequests[o.requestId]=o,o.send()},r.prototype.fetchSnapshotByTimestamp=function(t,e,n,r){"function"==typeof n&&(r=n,n=null);var i=this.nextSnapshotRequestId++,o=new _$SnapshotTimestampRequest_72(this,i,t,e,n,r);this._snapshotRequests[o.requestId]=o,o.send()},r.prototype._handleSnapshotFetch=function(t,e){var n=this._snapshotRequests[e.id];n&&(delete this._snapshotRequests[e.id],n._handleResponse(t,e))}}).call(this,_$browser_30);var _$client_69={};_$client_69.Connection=_$Connection_67,_$client_69.Doc=_$Doc_68,_$client_69.Error=_$ShareDBError_75,_$client_69.Query=_$Query_70,_$client_69.types=_$types_79,_$client_69.logger=_$logger_76;var _$RemoteDoc_47=RemoteDoc;function RemoteDoc(t,e,n,r,i){i&&(i.docs[n]=this),_$Doc_43.call(this,t,e,n),this.model=t.pass({$remote:!0}),this.debugMutations=t.root.debug.remoteMutations,this.shareDoc=t.root.connection.get(e,n),this.shareDoc.ingestSnapshot(r),this._initShareDoc()}function createInsertOp(t,e,n){if(!Array.isArray(n))return[new ListInsertOp(t,e,n)];for(var r=[],i=0,o=n.length;i<o;i++)r.push(new ListInsertOp(t,e++,n[i]));return r}function ImpliedOp(t,e){this.op=t,this.value=e}function ObjectReplaceOp(t,e,n){this.p=_$util_64.castSegments(t),this.od=e,this.oi=void 0===n?null:n}function ObjectInsertOp(t,e){this.p=_$util_64.castSegments(t),this.oi=void 0===e?null:e}function ObjectDeleteOp(t,e){this.p=_$util_64.castSegments(t),this.od=void 0===e?null:e}function ListReplaceOp(t,e,n,r){this.p=_$util_64.castSegments(t.concat(e)),this.ld=n,this.li=void 0===r?null:r}function ListInsertOp(t,e,n){this.p=_$util_64.castSegments(t.concat(e)),this.li=void 0===n?null:n}function ListRemoveOp(t,e,n){this.p=_$util_64.castSegments(t.concat(e)),this.ld=void 0===n?null:n}function ListMoveOp(t,e,n){this.p=_$util_64.castSegments(t.concat(e)),this.lm=n}function StringInsertOp(t,e,n){this.p=_$util_64.castSegments(t.concat(e)),this.si=n}function StringRemoveOp(t,e,n){this.p=_$util_64.castSegments(t.concat(e)),this.sd=n}function IncrementOp(t,e){this.p=_$util_64.castSegments(t),this.na=e}function SubtypeOp(t,e,n){this.p=_$util_64.castSegments(t),this.t=e,this.o=n}function defined(t){return void 0!==t}RemoteDoc.prototype=new _$Doc_43,RemoteDoc.prototype._initShareDoc=function(){var t=this,e=this.model,n=this.collectionName,r=this.id,i=this.shareDoc;e.root.debug.disableSubmit&&(i.submitOp=function(){},i.create=function(){},i.del=function(){}),i.on("op",function(e,n){n||(t._updateCollectionData(),t._onOp(e))}),i.on("del",function(i,o){o||(delete t.collectionData[r],e.emit("change",[n,r],[void 0,i,e._pass]))}),i.on("create",function(o){if(!o){t._updateCollectionData();var s=i.data;e.emit("change",[n,r],[s,void 0,e._pass])}}),i.on("error",function(t){e._emitError(t,n+"."+r)}),i.on("load",function(){t._updateCollectionData();var o=i.data;void 0!==o&&e.emit("load",[n,r],[o,e._pass])}),this._updateCollectionData()},RemoteDoc.prototype._updateCollectionData=function(){var t=this.shareDoc.data;"object"!=typeof t||Array.isArray(t)||null===t||(t.id=this.id),this.collectionData[this.id]=t},RemoteDoc.prototype.create=function(t,e){this.debugMutations&&console.log("RemoteDoc create",this.path(),t);var n=_$util_64.deepCopy(t);n&&delete n.id,this.shareDoc.create(n,e),this.shareDoc.data=t,this._updateCollectionData(),this.model._context.createDoc(this.collectionName,this.id)},RemoteDoc.prototype.set=function(t,e,n){this.debugMutations&&console.log("RemoteDoc set",this.path(t),e);var r=this._createImplied(t),i=t[t.length-1];if(r instanceof ImpliedOp)return r.value[i]=e,this.shareDoc.submitOp(r.op,n),void this._updateCollectionData();var o=_$util_64.isArrayIndex(i)?[new ListReplaceOp(t.slice(0,-1),i,r,e)]:[new ObjectReplaceOp(t,r,e)];return this.shareDoc.submitOp(o,n),this._updateCollectionData(),r},RemoteDoc.prototype.del=function(t,e){if(this.debugMutations&&console.log("RemoteDoc del",this.path(t)),0===t.length){var n=this.get();return this.shareDoc.del(e),delete this.collectionData[this.id],n}if(void 0!==(n=this.get(t))){var r=[new ObjectDeleteOp(t,n)];return this.shareDoc.submitOp(r,e),this._updateCollectionData(),n}e()},RemoteDoc.prototype.increment=function(t,e,n){this.debugMutations&&console.log("RemoteDoc increment",this.path(t),e);var r=this._createImplied(t);if(r instanceof ImpliedOp){var i=t[t.length-1];return r.value[i]=e,this.shareDoc.submitOp(r.op,n),this._updateCollectionData(),e}if(null==r){i=t[t.length-1];var o=_$util_64.isArrayIndex(i)?[new ListInsertOp(t.slice(0,-1),i,e)]:[new ObjectInsertOp(t,e)];return this.shareDoc.submitOp(o,n),this._updateCollectionData(),e}o=[new IncrementOp(t,e)];return this.shareDoc.submitOp(o,n),this._updateCollectionData(),r+e},RemoteDoc.prototype.push=function(t,e,n){this.debugMutations&&console.log("RemoteDoc push",this.path(t),e);var r=this.shareDoc;return this._arrayApply(t,function(n,i){var o=[new ListInsertOp(t,n.length,e)];return r.submitOp(o,i),n.length},n)},RemoteDoc.prototype.unshift=function(t,e,n){this.debugMutations&&console.log("RemoteDoc unshift",this.path(t),e);var r=this.shareDoc;return this._arrayApply(t,function(n,i){var o=[new ListInsertOp(t,0,e)];return r.submitOp(o,i),n.length},n)},RemoteDoc.prototype.insert=function(t,e,n,r){this.debugMutations&&console.log("RemoteDoc insert",this.path(t),e,n);var i=this.shareDoc;return this._arrayApply(t,function(r,o){var s=createInsertOp(t,e,n);return i.submitOp(s,o),r.length},r)},RemoteDoc.prototype.pop=function(t,e){this.debugMutations&&console.log("RemoteDoc pop",this.path(t));var n=this.shareDoc;return this._arrayApply(t,function(e,r){var i=e.length-1,o=e[i],s=[new ListRemoveOp(t,i,o)];return n.submitOp(s,r),o},e)},RemoteDoc.prototype.shift=function(t,e){this.debugMutations&&console.log("RemoteDoc shift",this.path(t));var n=this.shareDoc;return this._arrayApply(t,function(e,r){var i=e[0],o=[new ListRemoveOp(t,0,i)];return n.submitOp(o,r),i},e)},RemoteDoc.prototype.remove=function(t,e,n,r){this.debugMutations&&console.log("RemoteDoc remove",this.path(t),e,n);var i=this.shareDoc;return this._arrayApply(t,function(r,o){for(var s=r.slice(e,e+n),a=[],c=0,l=s.length;c<l;c++)a.push(new ListRemoveOp(t,e,s[c]));return i.submitOp(a,o),s},r)},RemoteDoc.prototype.move=function(t,e,n,r,i){this.debugMutations&&console.log("RemoteDoc move",this.path(t),e,n,r);var o=this.shareDoc;return this._arrayApply(t,function(i,s){for(var a=i.slice(e,e+r),c=[],l=0;l<r;l++)c.push(new ListMoveOp(t,e<n?e:e+r-1,e<n?n+r-1:n));return o.submitOp(c,s),a},i)},RemoteDoc.prototype.stringInsert=function(t,e,n,r){this.debugMutations&&console.log("RemoteDoc stringInsert",this.path(t),e,n);var i=this._createImplied(t);if(i instanceof ImpliedOp){var o=t[t.length-1];return i.value[o]=n,this.shareDoc.submitOp(i.op,r),void this._updateCollectionData()}if(null==i){o=t[t.length-1];var s=_$util_64.isArrayIndex(o)?[new ListInsertOp(t.slice(0,-1),o,n)]:[new ObjectInsertOp(t,n)];return this.shareDoc.submitOp(s,r),this._updateCollectionData(),i}s=[new StringInsertOp(t,e,n)];return this.shareDoc.submitOp(s,r),this._updateCollectionData(),i},RemoteDoc.prototype.stringRemove=function(t,e,n,r){this.debugMutations&&console.log("RemoteDoc stringRemove",this.path(t),e,n);var i=this._createImplied(t);if(!(i instanceof ImpliedOp)){if(null==i)return i;var o=[new StringRemoveOp(t,e,i.slice(e,e+n))];return this.shareDoc.submitOp(o,r),this._updateCollectionData(),i}},RemoteDoc.prototype.subtypeSubmit=function(t,e,n,r){this.debugMutations&&console.log("RemoteDoc subtypeSubmit",this.path(t),e,n);var i=this._createImplied(t);i instanceof ImpliedOp&&(this.shareDoc.submitOp(i.op),i=void 0);var o=new SubtypeOp(t,e,n);return this.shareDoc.submitOp(o,r),this._updateCollectionData(),i},RemoteDoc.prototype.get=function(t){return _$util_64.lookup(t,this.shareDoc.data)},RemoteDoc.prototype._createImplied=function(t){if(!this.shareDoc.type)throw new Error("Mutation on uncreated remote document");for(var e,n,r=this.shareDoc,i="data",o=r[i],s=0,a=t[s++];null!=a;)o||(e?n=n[i]=_$util_64.isArrayIndex(a)?[]:{}:(n=_$util_64.isArrayIndex(a)?[]:{},e=Array.isArray(r)?i>=r.length?new ListInsertOp(t.slice(0,s-2),i,n):new ListReplaceOp(t.slice(0,s-2),i,o,n):new ObjectInsertOp(t.slice(0,s-1),n)),o=n),o=(r=o)[i=a],a=t[s++];return e?new ImpliedOp(e,n):o},RemoteDoc.prototype._arrayApply=function(t,e,n){var r=this._createImplied(t);if(r instanceof ImpliedOp&&(this.shareDoc.submitOp(r.op),r=this.get(t)),null==r){var i=t[t.length-1],o=_$util_64.isArrayIndex(i)?[new ListInsertOp(t.slice(0,-1),i,[])]:[new ObjectInsertOp(t,[])];this.shareDoc.submitOp(o),r=this.get(t)}if(!Array.isArray(r)){var s=this._errorMessage(e.name+" on non-array",t,r);return n(new TypeError(s))}var a=e(r,n);return this._updateCollectionData(),a},RemoteDoc.prototype._onOp=function(t){var e;if(1!==t.length){if(0===t.length)return;try{t=JSON.stringify(t)}catch(t){}throw new Error("Received op with multiple components from ShareDB "+t)}e=t[0];var n=[this.collectionName,this.id].concat(e.p),r=this.model;if(defined(e.oi)||defined(e.od)){var i=e.oi,o=e.od;r.emit("change",n,[i,o,r._pass])}else if(defined(e.li)&&defined(e.ld)){i=e.li,o=e.ld;r.emit("change",n,[i,o,r._pass])}else if(defined(e.li)){var s=n[n.length-1],a=[e.li];r.emit("insert",n.slice(0,-1),[s,a,r._pass])}else if(defined(e.ld)){s=n[n.length-1];var c=[e.ld];r.emit("remove",n.slice(0,-1),[s,c,r._pass])}else if(defined(e.lm)){var l=n[n.length-1],u=e.lm,h=1;r.emit("move",n.slice(0,-1),[l,u,h,r._pass])}else if(defined(e.si)){s=n[n.length-1];var p=e.si;n=n.slice(0,-1);o=(i=r._get(n)).slice(0,s)+i.slice(s+p.length);var f=r.pass({$stringInsert:{index:s,text:p}})._pass;r.emit("change",n,[i,o,f])}else if(defined(e.sd)){s=n[n.length-1],h=(p=e.sd).length;n=n.slice(0,-1);o=(i=r._get(n)).slice(0,s)+p+i.slice(s),f=r.pass({$stringRemove:{index:s,howMany:h}})._pass;r.emit("change",n,[i,o,f])}else if(defined(e.na)){o=(i=this.get(e.p))-e.na;r.emit("change",n,[i,o,r._pass])}else if(defined(e.t)){i=this.get(e.p),o=void 0;var d=e.t;t=e.o,f=r.pass({$subtype:{type:d,op:t}})._pass;r.emit("change",n,[i,o,f])}};var _$connection_49={},Connection=_$client_69.Connection;_$Model_45.INITS.push(function(t){t.root._preventCompose=!1}),_$Model_45.prototype.preventCompose=function(){var t=this._child();return t._preventCompose=!0,t},_$Model_45.prototype.allowCompose=function(){var t=this._child();return t._preventCompose=!1,t},_$Model_45.prototype.createConnection=function(t){this.root.socket=this._createSocket(t);var e=this;this.root.connection=new Connection(this.root.socket),this.root.connection.on("state",function(t,n){e._setDiff(["$connection","state"],t),e._setDiff(["$connection","reason"],n)}),this._set(["$connection","state"],"connected"),this._finishCreateConnection()},_$Model_45.prototype._finishCreateConnection=function(){var t=this;this.root.connection.on("error",function(e){t._emitError(e)}),this.root.connection.on("doc",function(e){t.getOrCreateDoc(e.collection,e.id)})},_$Model_45.prototype.connect=function(){this.root.socket.open()},_$Model_45.prototype.disconnect=function(){this.root.socket.close()},_$Model_45.prototype.reconnect=function(){this.disconnect(),this.connect()},_$Model_45.prototype.close=function(t){t=this.wrapCallback(t);var e=this;this.whenNothingPending(function(){e.root.socket.close(),t()})},_$Model_45.prototype.getAgent=function(){return this.root.connection.agent},_$Model_45.prototype._isLocal=function(t){var e=t.charAt(0);return"_"===e||"$"===e},_$Model_45.prototype._getDocConstructor=function(t){return this._isLocal(t)?_$LocalDoc_44:_$RemoteDoc_47},_$Model_45.prototype.hasPending=function(){return this.root.connection.hasPending()},_$Model_45.prototype.hasWritePending=function(){return this.root.connection.hasWritePending()},_$Model_45.prototype.whenNothingPending=function(t){return this.root.connection.whenNothingPending(t)};var _$Query_46={};(function(t){var e=_$client_69.types.defaultType;function n(){this.map={},this.collections={}}function r(t,e,n,r){this.model=t.pass({$query:this}),this.collectionName=e,this.expression=n,this.options=r,this.hash=i(e,n,r),this.segments=["$queries",this.hash],this.idsSegments=["$queries",this.hash,"ids"],this.extraSegments=["$queries",this.hash,"extra"],this._pendingSubscribeCallbacks=[],this.subscribeCount=0,this.fetchCount=0,this.created=!1,this.shareQuery=null,this.idMap={}}function i(t,e,n){var r=[t,e,n];return JSON.stringify(r).replace(/\./g,"|")}function o(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];e.push(r.id)}return e}_$Query_46=r,_$Model_45.INITS.push(function(t){t.root._queries=new n}),_$Model_45.prototype.query=function(t,e,n){return"string"==typeof n&&(n={db:n}),this._getOrCreateQuery(t,e,n,r)},_$Model_45.prototype._getOrCreateQuery=function(t,e,n,r){e=this.sanitizeQuery(e);var i=this.root._queries.get(t,e,n);return i||(i=new r(this,t,e,n),this.root._queries.add(i),i)},_$Model_45.prototype.sanitizeQuery=function(t){if(t&&"object"==typeof t)for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];void 0===n?t[e]=null:this.sanitizeQuery(n)}return t},_$Model_45.prototype._initQueries=function(t){for(var e=this.root._queries,n=0;n<t.length;n++){var i=t[n],o=i[0],s=i[1],a=i[2],c=i[3]||[],l=i[4],u=i[5],h=this.root._queries.get(s,a,l);h||(h=new r(this,s,a,l),e.add(h)),h._setExtra(u);for(var p=[],f=0;f<c.length;f++){var d=c[f];if("string"!=typeof d){var m=d[0],_=d[1],g=d[2]||m.id,y=d[3];p.push(g);var v={data:m,v:_,type:y};this.getOrCreateDoc(s,g,v)}else p.push(d)}h._addMapIds(p),this._set(h.idsSegments,p);for(var b=0;b<o.length;b++){var w=o[b],E=w[0]||0,x=w[1]||0,C=w[2];for(C&&h.model.setContext(C);E--;)h.subscribe();for(h.fetchCount+=x;x--;)h.model._context.fetchQuery(h)}}},n.prototype.add=function(t){this.map[t.hash]=t,(this.collections[t.collectionName]||(this.collections[t.collectionName]={}))[t.hash]=t},n.prototype.remove=function(t){delete this.map[t.hash];var e=this.collections[t.collectionName];if(e){for(var n in delete e[t.hash],e)return;delete this.collections[t.collectionName]}},n.prototype.get=function(t,e,n){var r=i(t,e,n);return this.map[r]},n.prototype.toJSON=function(){var t=[];for(var e in this.map){var n=this.map[e];(n.subscribeCount||n.fetchCount)&&t.push(n.serialize())}return t},r.prototype.create=function(){this.created=!0,this.model.root._queries.add(this)},r.prototype.destroy=function(){var t=this.getIds();this.created=!1,this.shareQuery&&(this.shareQuery.destroy(),this.shareQuery=null),this.model.root._queries.remove(this),this.idMap={},this.model._del(this.segments),this._maybeUnloadDocs(t)},r.prototype.fetch=function(t){t=this.model.wrapCallback(t),this.model._context.fetchQuery(this),this.fetchCount++,this.created||this.create();var e=this;return this.model.root.connection.createFetchQuery(this.collectionName,this.expression,this.options,function(n,r,i){if(n)return t(n);e._setExtra(i),e._setResults(r),t()}),this},r.prototype.subscribe=function(e){if(e=this.model.wrapCallback(e),this.model._context.subscribeQuery(this),this.subscribeCount++){var n=this;return t.nextTick(function(){n.model._get(n.segments)?e():n._pendingSubscribeCallbacks.push(e)}),this}this.created||this.create();var r=this.options?_$util_64.copy(this.options):{};return r.results=this._getShareResults(),this.model.root.fetchOnly?this._shareFetchedSubscribe(r,e):this._shareSubscribe(r,e),this},r.prototype._subscribeCb=function(t){var e=this;return function(n,r,i){if(n)return e._flushSubscribeCallbacks(n,t);e._setExtra(i),e._setResults(r),e._flushSubscribeCallbacks(null,t)}},r.prototype._shareFetchedSubscribe=function(t,e){this.model.root.connection.createFetchQuery(this.collectionName,this.expression,t,this._subscribeCb(e))},r.prototype._shareSubscribe=function(t,e){var n=this;this.shareQuery&&this.shareQuery.destroy(),this.shareQuery=this.model.root.connection.createSubscribeQuery(this.collectionName,this.expression,t,this._subscribeCb(e)),this.shareQuery.on("insert",function(t,e){var r=o(t);n._addMapIds(r),n.model._insert(n.idsSegments,e,r)}),this.shareQuery.on("remove",function(t,e){var r=o(t);n._removeMapIds(r),n.model._remove(n.idsSegments,e,t.length)}),this.shareQuery.on("move",function(t,e,r){n.model._move(n.idsSegments,e,r,t.length)}),this.shareQuery.on("extra",function(t){n.model._setDiffDeep(n.extraSegments,t)}),this.shareQuery.on("error",function(t){n.model._emitError(t,n.hash)})},r.prototype._removeMapIds=function(t){for(var e=t.length;e--;){var n=t[e];this.idMap[n]>1?this.idMap[n]--:delete this.idMap[n]}if(this.model.root.unloadDelay){var r=this;setTimeout(function(){r._maybeUnloadDocs(t)},this.model.root.unloadDelay)}else this._maybeUnloadDocs(t)},r.prototype._addMapIds=function(t){for(var e=t.length;e--;){var n=t[e];this.idMap[n]=(this.idMap[n]||0)+1}},r.prototype._diffMapIds=function(t){for(var e=[],n=[],r={},i=t.length;i--;){r[o=t[i]]=!0,this.idMap[o]||e.push(o)}for(var o in this.idMap)r[o]||n.push(o);e.length&&this._addMapIds(e),n.length&&this._removeMapIds(n)},r.prototype._setExtra=function(t){void 0!==t&&this.model._setDiffDeep(this.extraSegments,t)},r.prototype._setResults=function(t){var e=o(t);this._setResultIds(e)},r.prototype._setResultIds=function(t){this._diffMapIds(t),this.model._setArrayDiff(this.idsSegments,t)},r.prototype._maybeUnloadDocs=function(t){for(var e=0;e<t.length;e++){var n=t[e];this.model._maybeUnloadDoc(this.collectionName,n)}},r.prototype._flushSubscribeCallbacks=function(t,e){var n;for(e(t);n=this._pendingSubscribeCallbacks.shift();)n(t)},r.prototype.unfetch=function(t){if(t=this.model.wrapCallback(t),this.model._context.unfetchQuery(this),!this.fetchCount)return t(),this;var e=this;function n(){var n=--e.fetchCount;if(n)return t(null,n);e.subscribeCount||e.destroy(),t(null,0)}return this.model.root.unloadDelay?setTimeout(n,this.model.root.unloadDelay):n(),this},r.prototype.unsubscribe=function(t){if(t=this.model.wrapCallback(t),this.model._context.unsubscribeQuery(this),!this.subscribeCount)return t(),this;var e=this;function n(){var n=--e.subscribeCount;if(n)return t(null,n);e.shareQuery&&(e.shareQuery.destroy(),e.shareQuery=null),function(n){if(n)return t(n);e.fetchCount||e.destroy();t(null,0)}()}return this.model.root.unloadDelay?setTimeout(n,this.model.root.unloadDelay):n(),this},r.prototype._getShareResults=function(){var t=this.model._get(this.idsSegments);if(t){var e=this.model.getCollection(this.collectionName);if(e){for(var n=[],r=0;r<t.length;r++){var i=t[r],o=e.docs[i];n.push(o&&o.shareDoc)}return n}}},r.prototype.get=function(){var t=[],e=this.model._get(this.segments);if(!e)return console.warn("You must fetch or subscribe to a query before getting its results."),t;var n=e.ids;if(!n)return t;for(var r=this.model.getCollection(this.collectionName),i=0,o=n.length;i<o;i++){var s=n[i],a=r&&r.docs[s];t.push(a&&a.get())}return t},r.prototype.getIds=function(){return this.model._get(this.idsSegments)||[]},r.prototype.getExtra=function(){return this.model._get(this.extraSegments)},r.prototype.ref=function(t){var e=this.idsSegments.join(".");return this.model.refList(t,this.collectionName,e)},r.prototype.refIds=function(t){var e=this.idsSegments.join(".");return this.model.root.ref(t,e)},r.prototype.refExtra=function(t,e){var n=this.extraSegments.join(".");return e&&(n+="."+e),this.model.root.ref(t,n)},r.prototype.serialize=function(){var t,n=this.getIds(),r=this.model.getCollection(this.collectionName);if(r){t=[];for(var i=0;i<n.length;i++){var o=n[i],s=r.docs[o];if(s){delete r.docs[o];var a=s.shareDoc.data,c=[a,s.shareDoc.version];a&&a.id===o||(c[2]=o),s.shareDoc.type!==e&&(c[3]=s.shareDoc.type&&s.shareDoc.type.name),t.push(c)}else t.push(o)}}var l=[],u=this.model.root._contexts;for(var h in u){var p=u[h],f=p.subscribedQueries[this.hash]||0,d=p.fetchedQueries[this.hash]||0;(f||d)&&("root"!==h?l.push([f,d,h]):d?l.push([f,d]):l.push([f]))}for(var m=[l,this.collectionName,this.expression,t,this.options,this.getExtra()];null==m[m.length-1];)m.pop();return m}}).call(this,_$browser_30);var _$CollectionCounter_42=CollectionCounter;function CollectionCounter(){this.reset()}CollectionCounter.prototype.reset=function(){this.collections={}},CollectionCounter.prototype.get=function(t,e){var n=this.collections[t];return n&&n[e]},CollectionCounter.prototype.increment=function(t,e){var n=this.collections[t]||(this.collections[t]={}),r=(n[e]||0)+1;return n[e]=r,r},CollectionCounter.prototype.decrement=function(t,e){var n=this.collections[t],r=n&&n[e];if(null!=r){if(r>1)return r--,n[e]=r,r;for(var i in delete n[e],n)return 0;return delete this.collections[t],0}},CollectionCounter.prototype.toJSON=function(){for(var t in this.collections)return this.collections};var _$subscriptions_61={};(function(t){_$Model_45.INITS.push(function(t,e){t.root.fetchOnly=e.fetchOnly,t.root.unloadDelay=e.unloadDelay||_$util_64.isServer?0:1e3,t.root._fetchedDocs=new _$CollectionCounter_42,t.root._subscribedDocs=new _$CollectionCounter_42}),_$Model_45.prototype.fetch=function(){return this._forSubscribable(arguments,"fetch"),this},_$Model_45.prototype.unfetch=function(){return this._forSubscribable(arguments,"unfetch"),this},_$Model_45.prototype.subscribe=function(){return this._forSubscribable(arguments,"subscribe"),this},_$Model_45.prototype.unsubscribe=function(){return this._forSubscribable(arguments,"unsubscribe"),this},_$Model_45.prototype._forSubscribable=function(e,n){var r,i;if(e.length)if("function"==typeof e[0])r=[null],i=e[0];else if(Array.isArray(e[0]))r=e[0],i=e[1];else{"function"==typeof(r=Array.prototype.slice.call(e))[r.length-1]&&(i=r.pop())}else r=[null];var o=_$util_64.asyncGroup(this.wrapCallback(i)),s=o(),a=n+"Doc";this.root.connection.startBulk();for(var c=0;c<r.length;c++){var l=r[c];if(l instanceof _$Query_46)l[n](o());else{var u=this._dereference(this._splitPath(l));if(2===u.length)this[a](u[0],u[1],o());else{var h="Cannot "+n+" to path: "+u.join(".");o()(new Error(h))}}}this.root.connection.endBulk(),t.nextTick(s)},_$Model_45.prototype.fetchDoc=function(t,e,n){n=this.wrapCallback(n),this._context.fetchDoc(t,e),this.root._fetchedDocs.increment(t,e),this.getOrCreateDoc(t,e).shareDoc.fetch(n)},_$Model_45.prototype.subscribeDoc=function(t,e,n){n=this.wrapCallback(n),this._context.subscribeDoc(t,e),this.root._subscribedDocs.increment(t,e);var r=this.getOrCreateDoc(t,e);if(r.shareDoc.subscribed)return n();this.root.fetchOnly?r.shareDoc.fetch(n):r.shareDoc.subscribe(n)},_$Model_45.prototype.unfetchDoc=function(t,e,n){if(n=this.wrapCallback(n),this._context.unfetchDoc(t,e),!this.root._fetchedDocs.get(t,e))return n();var r=this;function i(){var i=r.root._fetchedDocs.decrement(t,e);if(i)return n(null,i);r._maybeUnloadDoc(t,e),n(null,0)}this.root.unloadDelay?setTimeout(i,this.root.unloadDelay):i()},_$Model_45.prototype.unsubscribeDoc=function(t,e,n){if(n=this.wrapCallback(n),this._context.unsubscribeDoc(t,e),!this.root._subscribedDocs.get(t,e))return n();var r=this;function i(){var i=r.root._subscribedDocs.decrement(t,e);if(i)return n(null,i);if(r.root.fetchOnly)o();else{var s=r.getDoc(t,e),a=s&&s.shareDoc;if(!a)return o();a.unsubscribe(o)}}function o(i){if(r._maybeUnloadDoc(t,e),i)return n(i);n(null,0)}this.root.unloadDelay?setTimeout(i,this.root.unloadDelay):i()},_$Model_45.prototype._maybeUnloadDoc=function(t,e){var n=this.getDoc(t,e);if(n&&!(this._hasDocReferences(t,e)||n.shareDoc&&n.shareDoc.hasPending())){var r=n.get();this.root.collections[t].remove(e),n.shareDoc&&n.shareDoc.destroy(),this.emit("unload",[t,e],[r,this._pass])}},_$Model_45.prototype._hasDocReferences=function(t,e){var n=this.root._queries.collections[t];if(n)for(var r in n){var i=n[r];if((i.subscribeCount||i.fetchCount)&&i.idMap[e]>0)return!0}return!(!this.root._fetchedDocs.get(t,e)&&!this.root._subscribedDocs.get(t,e))}}).call(this,_$browser_30);var _$contexts_50={};function Contexts(){}function FetchedQueries(){}function SubscribedQueries(){}function Context(t,e){this.model=t,this.id=e,this.fetchedDocs=new _$CollectionCounter_42,this.subscribedDocs=new _$CollectionCounter_42,this.createdDocs=new _$CollectionCounter_42,this.fetchedQueries=new FetchedQueries,this.subscribedQueries=new SubscribedQueries}function mapIncrement(t,e){t[e]=(t[e]||0)+1}function mapDecrement(t,e){t[e]&&t[e]--,t[e]||delete t[e]}_$Model_45.INITS.push(function(t){t.root._contexts=new Contexts,t.root.setContext("root")}),_$Model_45.prototype.context=function(t){var e=this._child();return e.setContext(t),e},_$Model_45.prototype.setContext=function(t){this._context=this.getOrCreateContext(t)},_$Model_45.prototype.getOrCreateContext=function(t){return this.root._contexts[t]||(this.root._contexts[t]=new Context(this,t))},_$Model_45.prototype.unload=function(t){var e=t?this.root._contexts[t]:this._context;e&&e.unload()},_$Model_45.prototype.unloadAll=function(){var t=this.root._contexts;for(var e in t)t[e].unload()},Context.prototype.toJSON=function(){var t=this.fetchedDocs.toJSON(),e=this.subscribedDocs.toJSON(),n=this.createdDocs.toJSON();if(t||e||n)return{fetchedDocs:t,subscribedDocs:e,createdDocs:n}},Context.prototype.fetchDoc=function(t,e){this.fetchedDocs.increment(t,e)},Context.prototype.subscribeDoc=function(t,e){this.subscribedDocs.increment(t,e)},Context.prototype.unfetchDoc=function(t,e){this.fetchedDocs.decrement(t,e)},Context.prototype.unsubscribeDoc=function(t,e){this.subscribedDocs.decrement(t,e)},Context.prototype.createDoc=function(t,e){this.createdDocs.increment(t,e)},Context.prototype.fetchQuery=function(t){mapIncrement(this.fetchedQueries,t.hash)},Context.prototype.subscribeQuery=function(t){mapIncrement(this.subscribedQueries,t.hash)},Context.prototype.unfetchQuery=function(t){mapDecrement(this.fetchedQueries,t.hash)},Context.prototype.unsubscribeQuery=function(t){mapDecrement(this.subscribedQueries,t.hash)},Context.prototype.unload=function(){var t=this.model;for(var e in this.fetchedQueries){if(r=t.root._queries.map[e])for(var n=this.fetchedQueries[e];n--;)r.unfetch()}for(var e in this.subscribedQueries){var r;if(r=t.root._queries.map[e])for(n=this.subscribedQueries[e];n--;)r.unsubscribe()}for(var i in this.fetchedDocs.collections){var o=this.fetchedDocs.collections[i];for(var s in o)for(n=o[s];n--;)t.unfetchDoc(i,s)}for(var i in this.subscribedDocs.collections){o=this.subscribedDocs.collections[i];for(var s in o)for(n=o[s];n--;)t.unsubscribeDoc(i,s)}for(var i in this.createdDocs.collections){o=this.createdDocs.collections[i];for(var s in o)t._maybeUnloadDoc(i,s)}this.createdDocs.reset()};var _$defaultFns_51={},defaultFns=_$defaultFns_51=new DefaultFns;function DefaultFns(){}function FnPair(t,e){this.get=t,this.set=e}function getReverse(t){return t&&t.slice().reverse()}function setReverse(t){return{0:getReverse(t)}}function asc(t,e){return t<e?-1:t>e?1:0}function desc(t,e){return t>e?-1:t<e?1:0}defaultFns.reverse=new FnPair(getReverse,setReverse),defaultFns.asc=asc,defaultFns.desc=desc;var _$fn_54={};(function(t){function e(){}function n(t,e,n){var r,i,o,s,a,c=e.pop();"string"==typeof c?i=c:r=c,n&&(o=t.path(e.shift())),c=e[e.length-1],Array.isArray(c)||t.isPath(c)||(s=e.pop());for(var l=(a=1===e.length&&Array.isArray(e[0])?e[0]:e).length;l--;)a[l]=t.path(a[l]);return{name:i,path:o,inputPaths:a,fns:r,options:s}}function r(){}function i(t){this.model=t,this.nameMap=t.root._namedFns,this.fromMap=new r}function o(t,e,n,r,i,o){if(this.model=t.pass({$fn:this}),this.name=e,this.from=n,this.inputPaths=r,this.options=o,!i)throw new TypeError("Model function not found: "+e);this.getFn=i.get||i,this.setFn=i.set,this.fromSegments=n&&n.split("."),this.inputsSegments=[];for(var s=0;s<this.inputPaths.length;s++){var a=this.inputPaths[s].split(".");this.inputsSegments.push(a)}var c=o&&o.copy||"output";this.copyInput="input"===c||"both"===c,this.copyOutput="output"===c||"both"===c,this.mode=o&&o.mode||"diffDeep",this.async=!(!o||!o.async),this.eventPending=!1}_$Model_45.INITS.push(function(t){t.root._namedFns=new e,t.root._fns=new i(t),t.on("all",function(e,n){var r=n[n.length-1],i=t.root._fns.fromMap;for(var o in i){var s=i[o];r.$fn!==s&&(_$util_64.mayImpactAny(s.inputsSegments,e)?s.onInput(r):_$util_64.mayImpact(s.fromSegments,e)&&s.onOutput(r))}})}),_$Model_45.prototype.fn=function(t,e){this.root._namedFns[t]=e},_$Model_45.prototype.evaluate=function(){var t=n(this,Array.prototype.slice.call(arguments),!1);return this.root._fns.get(t.name,t.inputPaths,t.fns,t.options)},_$Model_45.prototype.start=function(){var t=n(this,Array.prototype.slice.call(arguments),!0);return this.root._fns.start(t.name,t.path,t.inputPaths,t.fns,t.options)},_$Model_45.prototype.stop=function(t){var e=this.path(t);this._stop(e)},_$Model_45.prototype._stop=function(t){this.root._fns.stop(t)},_$Model_45.prototype.stopAll=function(t){var e=this._splitPath(t);this._stopAll(e)},_$Model_45.prototype._stopAll=function(t){var e=this.root._fns.fromMap;for(var n in e){var r=e[n].fromSegments;_$util_64.contains(t,r)&&this._stop(n)}},i.prototype.get=function(t,e,n,r){return n||(n=this.nameMap[t]||_$defaultFns_51[t]),new o(this.model,t,null,e,n,r).get()},i.prototype.start=function(t,e,n,r,i){r||(r=this.nameMap[t]||_$defaultFns_51[t]);var s=new o(this.model,t,e,n,r,i);return this.fromMap[e]=s,s._onInput()},i.prototype.stop=function(t){var e=this.fromMap[t];return delete this.fromMap[t],e},i.prototype.toJSON=function(){var t=[];for(var e in this.fromMap){var n=this.fromMap[e];if(n.name){var r=[n.from].concat(n.inputPaths);n.options&&r.push(n.options),r.push(n.name),t.push(r)}}return t},o.prototype.apply=function(t,e){for(var n=0,r=this.inputsSegments.length;n<r;n++){var i=this.model._get(this.inputsSegments[n]);e.push(this.copyInput?_$util_64.deepCopy(i):i)}return t.apply(this.model,e)},o.prototype.get=function(){return this.apply(this.getFn,[])},o.prototype.set=function(t,e){if(this.setFn){var n=this.apply(this.setFn,[t]);if(n){var r=this.inputsSegments,i=this.model.pass(e,!0);for(var o in n){t=this.copyOutput?_$util_64.deepCopy(n[o]):n[o];this._setValue(i,r[o],t)}}}},o.prototype.onInput=function(e){if(!this.async)return this._onInput(e);if(!this.eventPending){this.eventPending=!0;var n=this;t.nextTick(function(){n._onInput(e),n.eventPending=!1})}},o.prototype._onInput=function(t){var e=this.copyOutput?_$util_64.deepCopy(this.get()):this.get();return this._setValue(this.model.pass(t,!0),this.fromSegments,e),e},o.prototype.onOutput=function(t){var e=this.model._get(this.fromSegments);return this.set(e,t)},o.prototype._setValue=function(t,e,n){"diffDeep"===this.mode?t._setDiffDeep(e,n):"arrayDeep"===this.mode?t._setArrayDiffDeep(e,n):"array"===this.mode?t._setArrayDiff(e,n):t._setDiff(e,n)}}).call(this,_$browser_30);var _$filter_53={};function parseFilterArguments(t,e){var n,r=e.pop();t.isPath(e[e.length-1])||(n=e.pop());for(var i=t.path(e.shift()),o=e.length;o--;)e[o]=t.path(e[o]);return{path:i,inputPaths:e.length?e:null,options:n,fn:r}}function FromMap(){}function Filters(t){this.model=t,this.fromMap=new FromMap}function Filter(t,e,n,r,i,o){if(this.filters=t,this.model=t.model.pass({$filter:this}),this.path=e,this.segments=e.split("."),this.filterName=null,this.sortName=null,this.bundle=!0,this.filterFn=null,this.sortFn=null,this.inputPaths=i,this.inputsSegments=null,i){this.inputsSegments=[];for(var s=0;s<this.inputPaths.length;s++){var a=this.inputPaths[s].split(".");this.inputsSegments.push(a)}}this.options=o,this.skip=o&&o.skip,this.limit=o&&o.limit,n&&this.filter(n),r&&this.sort(r),this.idsSegments=null,this.from=null,this.fromSegments=null}_$Model_45.INITS.push(function(t){t.root._filters=new Filters(t),t.on("all",function(e,n){var r=n[n.length-1],i=t.root._filters.fromMap;for(var o in i){var s=i[o];r.$filter!==s&&((_$util_64.mayImpact(s.segments,e)||s.inputsSegments&&_$util_64.mayImpactAny(s.inputsSegments,e))&&s.update(r))}})}),_$Model_45.prototype.filter=function(){var t=parseFilterArguments(this,Array.prototype.slice.call(arguments));return this.root._filters.add(t.path,t.fn,null,t.inputPaths,t.options)},_$Model_45.prototype.sort=function(){var t=parseFilterArguments(this,Array.prototype.slice.call(arguments));return this.root._filters.add(t.path,null,t.fn||"asc",t.inputPaths,t.options)},_$Model_45.prototype.removeAllFilters=function(t){var e=this._splitPath(t);this._removeAllFilters(e)},_$Model_45.prototype._removeAllFilters=function(t){var e=this.root._filters.fromMap;for(var n in e)_$util_64.contains(t,e[n].fromSegments)&&e[n].destroy()},Filters.prototype.add=function(t,e,n,r,i){return new Filter(this,t,e,n,r,i)},Filters.prototype.toJSON=function(){var t=[];for(var e in this.fromMap){var n=this.fromMap[e];if(n.bundle){var r=[e,n.path,n.filterName,n.sortName,n.inputPaths];n.options&&r.push(n.options),t.push(r)}}return t},Filter.prototype.filter=function(t){if("function"==typeof t)return this.filterFn=t,this.bundle=!1,this;if("string"==typeof t&&(this.filterName=t,this.filterFn=this.model.root._namedFns[t]||_$defaultFns_51[t],!this.filterFn))throw new TypeError("Filter function not found: "+t);return this},Filter.prototype.sort=function(t){if(t||(t="asc"),"function"==typeof t)return this.sortFn=t,this.bundle=!1,this;if("string"==typeof t&&(this.sortName=t,this.sortFn=this.model.root._namedFns[t]||_$defaultFns_51[t],!this.sortFn))throw new TypeError("Sort function not found: "+t);return this},Filter.prototype._slice=function(t){if(null==this.skip&&null==this.limit)return t;var e,n=this.skip||0;return this.limit&&(e=n+this.limit),t.slice(n,e)},Filter.prototype.getInputs=function(){if(this.inputsSegments){for(var t=[],e=0,n=this.inputsSegments.length;e<n;e++){var r=this.model._get(this.inputsSegments[e]);t.push(r)}return t}},Filter.prototype.callFilter=function(t,e,n){var r=t[e];return n?this.filterFn.apply(this.model,[r,e,t].concat(n)):this.filterFn.call(this.model,r,e,t)},Filter.prototype.ids=function(){var t=this.model._get(this.segments),e=[];if(!t)return e;if(Array.isArray(t))throw new Error("model.filter is not currently supported on arrays");if(this.filterFn){var n=this.getInputs();for(var r in t)t.hasOwnProperty(r)&&this.callFilter(t,r,n)&&e.push(r)}else e=Object.keys(t);var i=this.sortFn;return i&&e.sort(function(e,n){return i(t[e],t[n])}),this._slice(e)},Filter.prototype.get=function(){var t=this.model._get(this.segments),e=[];if(Array.isArray(t))throw new Error("model.filter is not currently supported on arrays");if(this.filterFn){var n=this.getInputs();for(var r in t)t.hasOwnProperty(r)&&this.callFilter(t,r,n)&&e.push(t[r])}else for(var r in t)t.hasOwnProperty(r)&&e.push(t[r]);return this.sortFn&&e.sort(this.sortFn),this._slice(e)},Filter.prototype.update=function(t){var e=this.ids();this.model.pass(t,!0)._setArrayDiff(this.idsSegments,e)},Filter.prototype.ref=function(t){return t=this.model.path(t),this.from=t,this.fromSegments=t.split("."),this.filters.fromMap[t]=this,this.idsSegments=["$filters",t.replace(/\./g,"|")],this.update(),this.model.refList(t,this.path,this.idsSegments.join("."))},Filter.prototype.destroy=function(){delete this.filters.fromMap[this.from],this.model._removeRef(this.idsSegments),this.model._del(this.idsSegments)};var _$refList_59={};function addListener(t,e){t.on(e+"Immediate",function(n,r){var i=r[r.length-1],o=t._refLists.fromMap;for(var s in o){var a=o[s];i.$refList!==a&&a.onMutation(e,n,r)}})}function patchFromEvent(t,e,n,r){var i=r.fromSegments.length,o=e.length,s=n[n.length-1],a=r.model.pass(s,!0);if(o!==i)if(o<i)a._setArrayDiff(r.fromSegments,r.get());else{u=e[i];var c=a._get(r.fromSegments.concat(u)),l=r.toSegmentsByItem(c);if(o>i+1)throw new Error("Mutation on descendant of refList `from` should have been dereferenced: "+e.join("."));if("change"===t)return a._set(l,c),void updateIdForValue(a,r,u,c);if("insert"===t||"remove"===t||"move"===t)throw new Error("Array mutation on child of refList `from`should have been dereferenced: "+e.join("."))}else{if("insert"===t){var u=n[0],h=setNewToValues(a,r,g=n[1]);return void a._insert(r.idsSegments,u,h)}if("remove"===t){var u=n[0],p=n[1].length;h=a._remove(r.idsSegments,u,p);if(r.deleteRemoved)for(var f=0;f<h.length;f++){var d=r.itemById(h[f]);a._del(r.toSegmentsByItem(d))}return}if("move"===t){var m=n[0],_=n[1];p=n[2];return void a._move(r.idsSegments,m,_,p)}var g;if(!(g="change"===t?n[0]:a._get(r.fromSegments)))return void a._set(r.idsSegments,[]);h=setNewToValues(a,r,g);a._set(r.idsSegments,h)}}function setNewToValues(t,e,n){for(var r=[],i=0;i<n.length;i++){var o=n[i],s=e.idByItem(o);void 0===s&&"object"==typeof o&&(s=o.id=t.id());var a=e.toSegmentsByItem(o);if(void 0===s||void 0===a)throw new Error("Unable to add item to refList: "+o);t._get(a)!==o&&t._set(a,o),r.push(s)}return r}function updateIdForValue(t,e,n,r){var i=e.idByItem(r),o=e.idsSegments.concat(n);t._set(o,i)}function patchToEvent(t,e,n,r){var i=r.toSegments.length,o=e.length,s=n[n.length-1],a=r.model.pass(s,!0);if(o===i){if("insert"===t){for(var c=n[1],l=0;l<c.length;l++){var u=c[l];if(v=r.indicesByItem(u))for(var h=0;h<v.length;h++){var p=r.fromSegments.concat(v[h]);a._set(p,u)}}return}if("remove"===t){for(var f=n[0],d=(l=f,f+(c=n[1]).length);l<d;l++){if(v=r.indicesByItem(c[l])){h=0;for(var m=v.length;h<m;h++){p=r.fromSegments.concat(v[h]);a._set(p,void 0)}}}return}if("move"===t)return}if(o<=i)a._setArrayDiff(r.fromSegments,r.get());else if(o>i+1){u=a._get(e.slice(0,i+1));if(!(v=r.indicesByItem(u)))return;var _=e.slice(i+1);for(l=0;l<v.length;l++){var g=v[l],y=r.fromSegments.concat(g,_);y=a._dereference(y,null,r),(n=n.slice())[n.length-1]=a._pass,a.emit(t,y,n)}}else if("change"!==t&&"load"!==t&&"unload"!==t){var v;u=a._get(e.slice(0,i+1));if((v=r.indicesByItem(u))&&("insert"===t||"remove"===t||"move"===t))for(l=0;l<v.length;l++){y=r.fromSegments.concat(v[l]);y=a._dereference(y,null,r),(n=n.slice())[n.length-1]=a._pass,a.emit(t,y,n)}}else{var b;"change"===t?(u=n[0],b=n[1]):"load"===t?(u=n[0],b=void 0):"unload"===t&&(u=void 0,b=n[0]);var w=r.indicesByItem(u),E=r.indicesByItem(b);if(!w&&!E)return;if(E&&!equivalentArrays(E,w))for(var l=0;l<E.length;l++){p=r.fromSegments.concat(E[l]);a._set(p,void 0)}if(w)for(l=0;l<w.length;l++){p=r.fromSegments.concat(w[l]);a._set(p,u)}}}function equivalentArrays(t,e){if(!t||!e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function patchIdsEvent(t,e,n,r){var i=r.idsSegments.length,o=e.length,s=n[n.length-1],a=r.model.pass(s,!0);if(o===i){if("insert"===t){for(var c=n[0],l=n[1],u=[],h=0;h<l.length;h++){var p=r.itemById(l[h]);u.push(p)}return void a._insert(r.fromSegments,c,u)}if("remove"===t){c=n[0];var f=n[1].length;return void a._remove(r.fromSegments,c,f)}if("move"===t){var d=n[0],m=n[1];f=n[2];return void a._move(r.fromSegments,d,m,f)}}if(o<=i)a._setArrayDiff(r.fromSegments,r.get());else{c=e[i];var _=r.idByIndex(c),g=r.itemById(_),y=r.fromSegments.concat(c);a._get(y)!==g&&a._set(y,g)}}function RefList(t,e,n,r,i){this.model=t&&t.pass({$refList:this}),this.from=e,this.to=n,this.ids=r,this.fromSegments=e&&e.split("."),this.toSegments=n&&n.split("."),this.idsSegments=r&&r.split("."),this.options=i,this.deleteRemoved=i&&i.deleteRemoved}function __FromMap_59(){}function RefLists(){this.fromMap=new __FromMap_59}_$Model_45.INITS.push(function(t){var e=t.root;for(var n in e._refLists=new RefLists,_$Model_45.MUTATOR_EVENTS)addListener(e,n)}),_$Model_45.prototype.refList=function(){var t,e,n,r;2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?this.isPath(arguments[2])?(t=arguments[0],e=arguments[1],n=arguments[2]):(e=arguments[0],n=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]);var i,o=this.path(t);if(Array.isArray(e)){i=[];for(var s=0;s<e.length;s++)i.push(this.path(e[s]))}else i=this.path(e);var a=this.path(n),c=new RefList(this.root,o,i,a,r);return this.root._refLists.remove(o),c.model._setArrayDiff(c.fromSegments,c.get()),this.root._refLists.add(c),this.scope(o)},RefList.prototype.get=function(){var t=this.model._get(this.idsSegments);if(!t)return[];for(var e=this.model._get(this.toSegments),n=[],r=0;r<t.length;r++){var i=t[r];n.push(e&&e[i])}return n},RefList.prototype.dereference=function(t,e){var n=t.slice(e+1),r=this.idByIndex(n[0]);return null==r?[]:(n[0]=r,this.toSegments.concat(n))},RefList.prototype.toSegmentsByItem=function(t){var e=this.idByItem(t);if(void 0!==e)return this.toSegments.concat(e)},RefList.prototype.idByItem=function(t){if(t&&t.id)return t.id;var e=this.model._get(this.toSegments);for(var n in e)if(t===e[n])return n},RefList.prototype.indicesByItem=function(t){var e=this.idByItem(t),n=this.model._get(this.idsSegments);if(n){for(var r,i=-1;-1!==(i=n.indexOf(e,i+1));)r?r.push(i):r=[i];return r}},RefList.prototype.itemById=function(t){return this.model._get(this.toSegments.concat(t))},RefList.prototype.idByIndex=function(t){return this.model._get(this.idsSegments.concat(t))},RefList.prototype.onMutation=function(t,e,n){_$util_64.mayImpact(this.toSegments,e)?patchToEvent(t,e,n,this):_$util_64.mayImpact(this.idsSegments,e)?patchIdsEvent(t,e,n,this):_$util_64.mayImpact(this.fromSegments,e)&&patchFromEvent(t,e,n,this)},RefLists.prototype.add=function(t){this.fromMap[t.from]=t},RefLists.prototype.remove=function(t){var e=this.fromMap[t];return delete this.fromMap[t],e},RefLists.prototype.toJSON=function(){var t=[];for(var e in this.fromMap){var n=this.fromMap[e];t.push([n.from,n.to,n.ids,n.options])}return t};var _$ref_58={};function addIndexListeners(t){function e(e,n){var r=t._refs.fromMap;for(var i in r){var o=r[i];if(o.updateIndices&&_$util_64.contains(e,o.toSegments)&&o.toSegments.length>e.length){var s=+o.toSegments[e.length],a=n(s);s!==a&&(t._refs.remove(i),o.toSegments[e.length]=""+a,o.to=o.toSegments.join("."),t._refs.add(o))}}}t.on("insertImmediate",function(t,n){var r=n[0],i=n[1].length;e(t,function(t){return r<=t?t+i:t})}),t.on("removeImmediate",function(t,n){var r=n[0],i=n[1].length;e(t,function(t){return r<=t?t-i:t})}),t.on("moveImmediate",function(t,n){var r=n[0],i=n[1],o=n[2];e(t,function(t){return r<=t&&t<r+o?t+i-r:(r<=t&&(t-=o),i<=t&&(t+=o),t)})})}function refChange(t,e,n,r){var i=n[0];if(void 0===i){var o=r.slice(),s=o.pop(),a=t._get(o);if(!(a&&s in a))return void t._del(e)}t._set(e,i)}function refLoad(t,e,n){var r=n[0];t._set(e,r)}function refUnload(t,e){t._del(e)}function refInsert(t,e,n){var r=n[0],i=n[1];t._insert(e,r,i)}function refRemove(t,e,n){var r=n[0],i=n[1].length;t._remove(e,r,i)}function refMove(t,e,n){var r=n[0],i=n[1],o=n[2];t._move(e,r,i,o)}function __addListener_58(t,e,n){t.on(e+"Immediate",function(r,i){for(var o,s=i[i.length-1],a=t._refs.toMap,c=0,l=r.length;c<l;c++){o=o?o+"."+r[c]:r[c];var u=a[o];if(u){u=u.slice();for(var h=r.slice(c+1),p=0,f=u.length;p<f;p++){var d=u[p],m=d.fromSegments.concat(h);if(t._get(m)===t._get(r))t.emit(e,m,i);else{var _=d.model.pass(s,!0);_._dereference=noopDereference,n(_,m,i,r)}}}}var g=t._refs.parentToMap;if(!(u=g[o]))return;for(var p=0,f=u.length;p<f;p++){var d=u[p],y=t._get(d.toSegments),v=t._get(d.fromSegments);if(v!==y){var _=d.model.pass(s,!0);_._dereference=noopDereference,_._set(d.fromSegments,y)}}})}function noopDereference(t){return t}function Ref(t,e,n,r){this.model=t&&t.pass({$ref:this}),this.from=e,this.to=n,this.fromSegments=e.split("."),this.toSegments=n.split("."),this.parentTos=[];for(var i=1,o=this.toSegments.length;i<o;i++){var s=this.toSegments.slice(0,i).join(".");this.parentTos.push(s)}this.updateIndices=r&&r.updateIndices}function __FromMap_58(){}function ToMap(){}function Refs(){this.fromMap=new __FromMap_58,this.toMap=new ToMap,this.parentToMap=new ToMap}function listMapAdd(t,e,n){t[e]||(t[e]=[]),t[e].push(n)}function listMapRemove(t,e,n){var r=t[e];if(r){var i=r.indexOf(n);-1!==i&&(r.splice(i,1),r.length||delete t[e])}}_$Model_45.INITS.push(function(t){var e=t.root;e._refs=new Refs,addIndexListeners(e),__addListener_58(e,"change",refChange),__addListener_58(e,"load",refLoad),__addListener_58(e,"unload",refUnload),__addListener_58(e,"insert",refInsert),__addListener_58(e,"remove",refRemove),__addListener_58(e,"move",refMove)}),_$Model_45.prototype._canRefTo=function(t){return this.isPath(t)||t&&"function"==typeof t.ref},_$Model_45.prototype.ref=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?this._canRefTo(arguments[1])?(t=arguments[0],e=arguments[1]):(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this.path(t),i=this.path(e);if(!i)return e.ref(r);var o=new Ref(this.root,r,i,n);if(o.fromSegments.length<2)throw new Error("ref must be performed under a collection and document id. Invalid path: "+r);this.root._refs.remove(r),this.root._refLists.remove(r);var s=this.get(e);return o.model._set(o.fromSegments,s),this.root._refs.add(o),this.scope(r)},_$Model_45.prototype.removeRef=function(t){var e=this._splitPath(t),n=e.join(".");this._removeRef(e,n)},_$Model_45.prototype._removeRef=function(t,e){this.root._refs.remove(e),this.root._refLists.remove(e),this._del(t)},_$Model_45.prototype.removeAllRefs=function(t){var e=this._splitPath(t);this._removeAllRefs(e)},_$Model_45.prototype._removeAllRefs=function(t){this._removeMapRefs(t,this.root._refs.fromMap),this._removeMapRefs(t,this.root._refLists.fromMap)},_$Model_45.prototype._removeMapRefs=function(t,e){for(var n in e){var r=e[n].fromSegments;_$util_64.contains(t,r)&&this._removeRef(r,n)}},_$Model_45.prototype.dereference=function(t){var e=this._splitPath(t);return this._dereference(e).join(".")},_$Model_45.prototype._dereference=function(t,e,n){if(0===t.length)return t;var r,i=this.root._refs.fromMap,o=this.root._refLists.fromMap;do{var s="";r=!1;for(var a=0,c=t.length;a<c;a++){var l=i[s=s?s+"."+t[a]:t[a]];if(l){var u=t.slice(a+1);t=l.toSegments.concat(u),r=!0;break}var h=o[s];if(h&&h!==n){if(!(a+2<c||e&&a+1<c))continue;t=h.dereference(t,a),r=!0;break}}}while(r);return 0===t.length?["$null"]:t},Refs.prototype.add=function(t){this.fromMap[t.from]=t,listMapAdd(this.toMap,t.to,t);for(var e=0,n=t.parentTos.length;e<n;e++)listMapAdd(this.parentToMap,t.parentTos[e],t)},Refs.prototype.remove=function(t){var e=this.fromMap[t];if(e){delete this.fromMap[t],listMapRemove(this.toMap,e.to,e);for(var n=0,r=e.parentTos.length;n<r;n++)listMapRemove(this.parentToMap,e.parentTos[n],e);return e}},Refs.prototype.toJSON=function(){var t=[];for(var e in this.fromMap){var n=this.fromMap[e];t.push([n.from,n.to])}return t};var _$Model_55={exports:{}};_$Model_55.exports=_$Model_45,_$util_64.serverRequire(_$Model_55,"./bundle"),_$util_64.serverRequire(_$Model_55,"./connection.server"),_$Model_55=_$Model_55.exports;var _$Racer_63={exports:{}},__EventEmitter_63=_$EventEmitter_23.EventEmitter;function Racer(){__EventEmitter_63.call(this)}_$Racer_63.exports=Racer,_$util_64.mergeInto(Racer.prototype,__EventEmitter_63.prototype),Racer.prototype.Model=_$Model_55,Racer.prototype.util=_$util_64,Racer.prototype.use=_$util_64.use,Racer.prototype.serverUse=_$util_64.serverUse,Racer.prototype.createModel=function(t){var e=new _$Model_55;return t&&(e.createConnection(t),e.unbundle(t)),e},_$util_64.serverRequire(_$Racer_63,"./Racer.server"),_$Racer_63=_$Racer_63.exports;var _$lib_racer=new _$Racer_63,_$bcsocketUncompressed_3={};!function(){var f,aa=aa||{},l=this;function ba(t){t=t.split(".");for(var e,n=l;e=t.shift();){if(null==n[e])return null;n=n[e]}return n}function ca(){}function da(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function m(t){return"array"==da(t)}function ea(t){var e=da(t);return"array"==e||"object"==e&&"number"==typeof t.length}function n(t){return"string"==typeof t}function fa(t){return"function"==da(t)}var ga="closure_uid_"+(1e9*Math.random()>>>0),ha=0;function ia(t,e,n){return t.call.apply(t.bind,arguments)}function ja(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function p(t,e,n){return(p=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ia:ja).apply(null,arguments)}var q=Date.now||function(){return+new Date};function s(t,e){function n(){}n.prototype=e.prototype,t.pa=e.prototype,t.prototype=new n,t.Hc=function(t,n,r){var i=Array.prototype.slice.call(arguments,2);return e.prototype[n].apply(t,i)}}function ka(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function la(t){return ma.test(t)?(-1!=t.indexOf("&")&&(t=t.replace(na,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(oa,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(pa,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(qa,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(ra,"&#39;")),t):t}var na=/&/g,oa=/</g,pa=/>/g,qa=/"/g,ra=/'/g,ma=/[&<>"']/,x,ua,va,wa,ya;function sa(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^q()).toString(36)}function ta(t,e){return t<e?-1:t>e?1:0}function xa(){return l.navigator?l.navigator.userAgent:null}if(wa=va=ua=x=!1,ya=xa()){var za=l.navigator;x=0==ya.lastIndexOf("Opera",0),ua=!x&&(-1!=ya.indexOf("MSIE")||-1!=ya.indexOf("Trident")),va=!x&&-1!=ya.indexOf("WebKit"),wa=!x&&!va&&!ua&&"Gecko"==za.product}var Aa=x,y=ua,Ba=wa,z=va,Da;function Ca(){var t=l.document;return t?t.documentMode:void 0}t:{var Ea="",Fa;if(Aa&&l.opera)var Ga=l.opera.version,Ea="function"==typeof Ga?Ga():Ga;else if(Ba?Fa=/rv\:([^\);]+)(\)|;)/:y?Fa=/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/:z&&(Fa=/WebKit\/(\S+)/),Fa)var Ha=Fa.exec(xa()),Ea=Ha?Ha[1]:"";if(y){var Ia=Ca();if(Ia>parseFloat(Ea)){Da=String(Ia);break t}}Da=Ea}var Ja={};function A(t){var e;if(!(e=Ja[t])){e=0;for(var n=String(Da).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),r=String(t).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"",c=RegExp("(\\d*)(\\D*)","g"),l=RegExp("(\\d*)(\\D*)","g");do{var u=c.exec(s)||["","",""],h=l.exec(a)||["","",""];if(0==u[0].length&&0==h[0].length)break;e=ta(0==u[1].length?0:parseInt(u[1],10),0==h[1].length?0:parseInt(h[1],10))||ta(0==u[2].length,0==h[2].length)||ta(u[2],h[2])}while(0==e)}e=Ja[t]=0<=e}return e}var La=l.document,Ma=La&&y?Ca()||("CSS1Compat"==La.compatMode?parseInt(Da,10):5):void 0;function Na(t){Error.captureStackTrace?Error.captureStackTrace(this,Na):this.stack=Error().stack||"",t&&(this.message=String(t))}function Oa(t,e){e.unshift(t),Na.call(this,ka.apply(null,e)),e.shift()}function Pa(t,e){throw new Oa("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}s(Na,Error),Na.prototype.name="CustomError",s(Oa,Na),Oa.prototype.name="AssertionError";var Qa=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$");function Ra(t){if(Sa){Sa=!1;var e=l.location;if(e){var n=e.href;if(n&&(n=(n=Ra(n)[3]||null)&&decodeURIComponent(n))&&n!=e.hostname)throw Sa=!0,Error()}}return t.match(Qa)}var Sa=z;function Ta(t){var e,n=[],r=0;for(e in t)n[r++]=t[e];return n}function Ua(t){var e,n=[],r=0;for(e in t)n[r++]=e;return n}var Va="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Wa(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<Va.length;o++)n=Va[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}var B=Array.prototype,Xa=B.indexOf?function(t,e,n){return B.indexOf.call(t,e,n)}:function(t,e,r){if(r=null==r?0:0>r?Math.max(0,t.length+r):r,n(t))return n(e)&&1==e.length?t.indexOf(e,r):-1;for(;r<t.length;r++)if(r in t&&t[r]===e)return r;return-1},Ya=B.forEach?function(t,e,n){B.forEach.call(t,e,n)}:function(t,e,r){for(var i=t.length,o=n(t)?t.split(""):t,s=0;s<i;s++)s in o&&e.call(r,o[s],s,t)};function Za(t){var e;t:{e=$a;for(var r=t.length,i=n(t)?t.split(""):t,o=0;o<r;o++)if(o in i&&e.call(void 0,i[o],o,t)){e=o;break t}e=-1}return 0>e?null:n(t)?t.charAt(e):t[e]}function ab(t){return B.concat.apply(B,arguments)}function bb(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function cb(t,e){this.O={},this.j=[],this.o=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t){t instanceof cb?(n=t.ca(),r=t.N()):(n=Ua(t),r=Ta(t));for(var i=0;i<n.length;i++)this.set(n[i],r[i])}}function db(t){if(t.o!=t.j.length){for(var e=0,n=0;e<t.j.length;){var r=t.j[e];C(t.O,r)&&(t.j[n++]=r),e++}t.j.length=n}if(t.o!=t.j.length){var i={};for(n=e=0;e<t.j.length;)C(i,r=t.j[e])||(t.j[n++]=r,i[r]=1),e++;t.j.length=n}}function C(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function eb(t){if("function"==typeof t.N)return t.N();if(n(t))return t.split("");if(ea(t)){for(var e=[],r=t.length,i=0;i<r;i++)e.push(t[i]);return e}return Ta(t)}function D(t,e,r){if("function"==typeof t.forEach)t.forEach(e,r);else if(ea(t)||n(t))Ya(t,e,r);else{var i;if("function"==typeof t.ca)i=t.ca();else if("function"!=typeof t.N)if(ea(t)||n(t)){i=[];for(var o=t.length,s=0;s<o;s++)i.push(s)}else i=Ua(t);else i=void 0;s=(o=eb(t)).length;for(var a=0;a<s;a++)e.call(r,o[a],i&&i[a],t)}}function E(t,e){var n;if(t instanceof E)this.D=void 0!==e?e:t.D,fb(this,t.oa),n=t.eb,F(this),this.eb=n,gb(this,t.ja),hb(this,t.Ca),ib(this,t.I),jb(this,t.R.n()),n=t.Na,F(this),this.Na=n;else if(t&&(n=Ra(String(t)))){this.D=!!e,fb(this,n[1]||"",!0);var r=n[2]||"";F(this),this.eb=r?decodeURIComponent(r):"",gb(this,n[3]||"",!0),hb(this,n[4]),ib(this,n[5]||"",!0),jb(this,n[6]||"",!0),n=n[7]||"",F(this),this.Na=n?decodeURIComponent(n):""}else this.D=!!e,this.R=new kb(null,0,this.D)}function fb(t,e,n){F(t),t.oa=n?e?decodeURIComponent(e):"":e,t.oa&&(t.oa=t.oa.replace(/:$/,""))}function gb(t,e,n){F(t),t.ja=n?e?decodeURIComponent(e):"":e}function hb(t,e){if(F(t),e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.Ca=e}else t.Ca=null}function ib(t,e,n){F(t),t.I=n?e?decodeURIComponent(e):"":e}function jb(t,e,n){F(t),e instanceof kb?(t.R=e,t.R.ub(t.D)):(n||(e=lb(e,qb)),t.R=new kb(e,0,t.D))}function G(t,e,n){F(t),t.R.set(e,n)}function rb(t,e,n){F(t),m(n)||(n=[String(n)]),sb(t.R,e,n)}function H(t){return F(t),G(t,"zx",sa()),t}function F(t){if(t.oc)throw Error("Tried to modify a read-only Uri")}function tb(t){return t instanceof E?t.n():new E(t,void 0)}function ub(t,e,n,r){var i=new E(null,void 0);return t&&fb(i,t),e&&gb(i,e),n&&hb(i,n),r&&ib(i,r),i}function lb(t,e){return n(t)?encodeURI(t).replace(e,vb):null}function vb(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}f=cb.prototype,f.N=function(){db(this);for(var t=[],e=0;e<this.j.length;e++)t.push(this.O[this.j[e]]);return t},f.ca=function(){return db(this),this.j.concat()},f.wa=function(t){return C(this.O,t)},f.remove=function(t){return!!C(this.O,t)&&(delete this.O[t],this.o--,this.j.length>2*this.o&&db(this),!0)},f.get=function(t,e){return C(this.O,t)?this.O[t]:e},f.set=function(t,e){C(this.O,t)||(this.o++,this.j.push(t)),this.O[t]=e},f.n=function(){return new cb(this)},f=E.prototype,f.oa="",f.eb="",f.ja="",f.Ca=null,f.I="",f.Na="",f.oc=!1,f.D=!1,f.toString=function(){var t=[],e=this.oa;if(e&&t.push(lb(e,mb),":"),e=this.ja){t.push("//");var n=this.eb;n&&t.push(lb(n,mb),"@"),t.push(encodeURIComponent(String(e))),null!=(e=this.Ca)&&t.push(":",String(e))}return(e=this.I)&&(this.ja&&"/"!=e.charAt(0)&&t.push("/"),t.push(lb(e,"/"==e.charAt(0)?nb:ob))),(e=this.R.toString())&&t.push("?",e),(e=this.Na)&&t.push("#",lb(e,pb)),t.join("")},f.n=function(){return new E(this)},f.ub=function(t){return this.D=t,this.R&&this.R.ub(t),this};var mb=/[#\/\?@]/g,ob=/[\#\?:]/g,nb=/[\#\?]/g,qb=/[\#\?@]/g,pb=/#/g;function kb(t,e,n){this.C=t||null,this.D=!!n}function I(t){if(!t.h&&(t.h=new cb,t.o=0,t.C))for(var e=t.C.split("&"),n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null,o=null;0<=r?(i=e[n].substring(0,r),o=e[n].substring(r+1)):i=e[n],i=J(t,i=decodeURIComponent(i.replace(/\+/g," "))),t.add(i,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}function sb(t,e,n){t.remove(e),0<n.length&&(t.C=null,t.h.set(J(t,e),bb(n)),t.o+=n.length)}function J(t,e){var n=String(e);return t.D&&(n=n.toLowerCase()),n}function wb(a){if(a=String(a),!/^\s*$/.test(a)&&/^[\],:{}\s\u2028\u2029]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r\u2028\u2029\x00-\x08\x0a-\x1f]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,"")))try{return eval("("+a+")")}catch(t){}throw Error("Invalid JSON string: "+a)}function xb(a){return eval("("+a+")")}function yb(t){var e=[];return zb(new Ab,t,e),e.join("")}function Ab(){this.Ya=void 0}function zb(t,e,n){switch(typeof e){case"string":Bb(e,n);break;case"number":n.push(isFinite(e)&&!isNaN(e)?e:"null");break;case"boolean":n.push(e);break;case"undefined":n.push("null");break;case"object":if(null==e){n.push("null");break}if(m(e)){var r=e.length;n.push("[");for(var i="",o=0;o<r;o++)n.push(i),i=e[o],zb(t,t.Ya?t.Ya.call(e,String(o),i):i,n),i=",";n.push("]");break}for(o in n.push("{"),r="",e)Object.prototype.hasOwnProperty.call(e,o)&&("function"!=typeof(i=e[o])&&(n.push(r),Bb(o,n),n.push(":"),zb(t,t.Ya?t.Ya.call(e,o,i):i,n),r=","));n.push("}");break;case"function":break;default:throw Error("Unknown type: "+typeof e)}}f=kb.prototype,f.h=null,f.o=null,f.add=function(t,e){I(this),this.C=null,t=J(this,t);var n=this.h.get(t);return n||this.h.set(t,n=[]),n.push(e),this.o++,this},f.remove=function(t){return I(this),t=J(this,t),!!this.h.wa(t)&&(this.C=null,this.o-=this.h.get(t).length,this.h.remove(t))},f.wa=function(t){return I(this),t=J(this,t),this.h.wa(t)},f.ca=function(){I(this);for(var t=this.h.N(),e=this.h.ca(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},f.N=function(t){I(this);var e=[];if(n(t))this.wa(t)&&(e=ab(e,this.h.get(J(this,t))));else{t=this.h.N();for(var r=0;r<t.length;r++)e=ab(e,t[r])}return e},f.set=function(t,e){return I(this),this.C=null,t=J(this,t),this.wa(t)&&(this.o-=this.h.get(t).length),this.h.set(t,[e]),this.o++,this},f.get=function(t,e){var n=t?this.N(t):[];return 0<n.length?String(n[0]):e},f.toString=function(){if(this.C)return this.C;if(!this.h)return"";for(var t=[],e=this.h.ca(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),o=(r=this.N(r),0);o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.C=t.join("&")},f.n=function(){var t=new kb;return t.C=this.C,this.h&&(t.h=this.h.n(),t.o=this.o),t},f.ub=function(t){t&&!this.D&&(I(this),this.C=null,D(this.h,function(t,e){var n=e.toLowerCase();e!=n&&(this.remove(e),sb(this,n,t))},this)),this.D=t};var Cb={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},Db=/\uffff/.test("")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g;function Bb(t,e){e.push('"',t.replace(Db,function(t){if(t in Cb)return Cb[t];var e=t.charCodeAt(0),n="\\u";return 16>e?n+="000":256>e?n+="00":4096>e&&(n+="0"),Cb[t]=n+e.toString(16)}),'"')}function Eb(t){return Fb(t||arguments.callee.caller,[])}function Fb(t,e){var n=[];if(0<=Xa(e,t))n.push("[...circular reference...]");else if(t&&50>e.length){n.push(Gb(t)+"(");for(var r=t.arguments,i=0;i<r.length;i++){var o;switch(0<i&&n.push(", "),typeof(o=r[i])){case"object":o=o?"object":"null";break;case"string":break;case"number":o=String(o);break;case"boolean":o=o?"true":"false";break;case"function":o=(o=Gb(o))?o:"[fn]";break;default:o=typeof o}40<o.length&&(o=o.substr(0,40)+"..."),n.push(o)}e.push(t),n.push(")\n");try{n.push(Fb(t.caller,e))}catch(t){n.push("[exception trying to get caller]\n")}}else t?n.push("[...long stack...]"):n.push("[end]");return n.join("")}function Gb(t){if(Hb[t])return Hb[t];if(t=String(t),!Hb[t]){var e=/function ([^\(]+)/.exec(t);Hb[t]=e?e[1]:"[Anonymous]"}return Hb[t]}var Hb={};function Ib(t,e,n,r,i){this.reset(t,e,n,r,i)}Ib.prototype.Fb=null,Ib.prototype.Eb=null;var Jb=0;function L(t){this.rc=t}function Kb(t,e){this.name=t,this.value=e}Ib.prototype.reset=function(t,e,n,r,i){"number"==typeof i||Jb++,r||q(),this.Aa=t,this.qc=e,delete this.Fb,delete this.Eb},Ib.prototype.$b=function(t){this.Aa=t},L.prototype.Sa=null,L.prototype.Aa=null,L.prototype.jb=null,L.prototype.Jb=null,Kb.prototype.toString=function(){return this.name};var Lb=new Kb("SEVERE",1e3),Mb=new Kb("WARNING",900),Nb=new Kb("INFO",800),Ob=new Kb("CONFIG",700),Pb=new Kb("FINE",500);function Qb(t){return t.Aa?t.Aa:t.Sa?Qb(t.Sa):(Pa("Root logger has no level set."),null)}f=L.prototype,f.getParent=function(){return this.Sa},f.$b=function(t){this.Aa=t},f.log=function(t,e,n){if(t.value>=Qb(this).value)for(fa(e)&&(e=e()),e="log:"+(t=this.mc(t,e,n)).qc,l.console&&(l.console.timeStamp?l.console.timeStamp(e):l.console.markTimeline&&l.console.markTimeline(e)),l.msWriteProfilerMark&&l.msWriteProfilerMark(e),e=this;e;){var r=t;if((n=e).Jb)for(var i=0,o=void 0;o=n.Jb[i];i++)o(r);e=e.getParent()}},f.mc=function(t,e,r){var i=new Ib(t,String(e),this.rc);if(r){var o;i.Fb=r;var s=arguments.callee.caller;try{var a,c=ba("window.location.href");if(n(r))a={message:r,name:"Unknown error",lineNumber:"Not available",fileName:c,stack:"Not available"};else{var u,h,p=!1;try{u=r.lineNumber||r.Ic||"Not available"}catch(t){u="Not available",p=!0}try{h=r.fileName||r.filename||r.sourceURL||l.$googDebugFname||c}catch(t){h="Not available",p=!0}a=!p&&r.lineNumber&&r.fileName&&r.stack&&r.message&&r.name?r:{message:r.message||"Not available",name:r.name||"UnknownError",lineNumber:u,fileName:h,stack:r.stack||"Not available"}}o="Message: "+la(a.message)+'\nUrl: <a href="view-source:'+a.fileName+'" target="_new">'+a.fileName+"</a>\nLine: "+a.lineNumber+"\n\nBrowser stack:\n"+la(a.stack+"-> ")+"[end]\n\nJS stack traversal:\n"+la(Eb(s)+"-> ")}catch(t){o="Exception trying to expose exception! You win, we lose. "+t}i.Eb=o}return i},f.J=function(t,e){this.log(Lb,t,e)},f.Z=function(t,e){this.log(Mb,t,e)},f.info=function(t,e){this.log(Nb,t,e)};var Rb={},Sb=null;function Tb(t){var e;if(Sb||(Sb=new L(""),Rb[""]=Sb,Sb.$b(Ob)),!(e=Rb[t])){e=new L(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=Tb(t.substr(0,n))).jb||(n.jb={}),n.jb[r]=e,e.Sa=n,Rb[t]=e}return e}function M(t,e){t&&t.log(Pb,e,void 0)}function N(){this.r=Tb("goog.net.BrowserChannel")}function Ub(t,e,n,r){t.info("XMLHTTP TEXT ("+e+"): "+Vb(t,n)+(r?" "+r:""))}function Wb(t,e,n){t.J((n||"Exception")+e)}function Vb(t,e){if(!e||e==Xb)return e;try{var n=xb(e);if(n)for(var r=0;r<n.length;r++)if(m(n[r])){var i=n[r];if(!(2>i.length)){var o=i[1];if(m(o)&&!(1>o.length)){var s=o[0];if("noop"!=s&&"stop"!=s)for(var a=1;a<o.length;a++)o[a]=""}}}return yb(n)}catch(n){return t.debug("Exception parsing expected JS array - probably was not JS"),e}}function Yb(t,e){this.P=e?xb:wb}function O(){0!=Zb&&($b[this[ga]||(this[ga]=++ha)]=this)}N.prototype.debug=function(t){this.info(t)},N.prototype.info=function(t){var e=this.r;e&&e.info(t,void 0)},N.prototype.Z=function(t){var e=this.r;e&&e.Z(t,void 0)},N.prototype.J=function(t){var e=this.r;e&&e.J(t,void 0)},Yb.prototype.parse=function(t){return this.P(t)};var Zb=0,$b={};O.prototype.mb=!1,O.prototype.Ja=function(){if(!this.mb&&(this.mb=!0,this.u(),0!=Zb)){var t=this[ga]||(this[ga]=++ha);delete $b[t]}},O.prototype.u=function(){if(this.Pb)for(;this.Pb.length;)this.Pb.shift()()};var ac="closure_listenable_"+(1e6*Math.random()|0);function bc(t){try{return!(!t||!t[ac])}catch(t){return!1}}var cc=0;function dc(t,e,n,r,i){this.fa=t,this.Ua=null,this.src=e,this.type=n,this.capture=!!r,this.Oa=i,this.key=++cc,this.na=this.Ia=!1}function ec(t){t.na=!0,t.fa=null,t.Ua=null,t.src=null,t.Oa=null}function P(t){this.src=t,this.s={},this.Ga=0}function gc(t,e){var n=e.type;if(!(n in t.s))return!1;var r,i=t.s[n],o=Xa(i,e);return(r=0<=o)&&B.splice.call(i,o,1),r&&(ec(e),0==t.s[n].length&&(delete t.s[n],t.Ga--)),r}function fc(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.na&&o.fa==e&&o.capture==!!n&&o.Oa==r)return i}return-1}P.prototype.add=function(t,e,n,r,i){var o=this.s[t];o||(o=this.s[t]=[],this.Ga++);var s=fc(o,e,r,i);return-1<s?(t=o[s],n||(t.Ia=!1)):((t=new dc(e,this.src,t,!!r,i)).Ia=n,o.push(t)),t},P.prototype.remove=function(t,e,n,r){if(!(t in this.s))return!1;var i=this.s[t];return-1<(e=fc(i,e,n,r))&&(ec(i[e]),B.splice.call(i,e,1),0==i.length&&(delete this.s[t],this.Ga--),!0)},P.prototype.Xa=function(t){var e,n=0;for(e in this.s)if(!t||e==t){for(var r=this.s[e],i=0;i<r.length;i++)++n,ec(r[i]);delete this.s[e],this.Ga--}return n},P.prototype.ya=function(t,e,n,r){var i=-1;return(t=this.s[t])&&(i=fc(t,e,n,r)),-1<i?t[i]:null};var hc=!y||y&&9<=Ma,ic=y&&!A("9");function Q(t,e){this.type=t,this.currentTarget=this.target=e}function jc(t){return jc[" "](t),t}function kc(t,e){if(Q.call(this,t?t.type:""),this.relatedTarget=this.currentTarget=this.target=null,this.charCode=this.keyCode=this.button=this.screenY=this.screenX=this.clientY=this.clientX=this.offsetY=this.offsetX=0,this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.Db=this.state=null,t){var n=this.type=t.type;this.target=t.target||t.srcElement,this.currentTarget=e;var r=t.relatedTarget;if(r){if(Ba){var i;t:{try{jc(r.nodeName),i=!0;break t}catch(t){}i=!1}i||(r=null)}}else"mouseover"==n?r=t.fromElement:"mouseout"==n&&(r=t.toElement);this.relatedTarget=r,this.offsetX=z||void 0!==t.offsetX?t.offsetX:t.layerX,this.offsetY=z||void 0!==t.offsetY?t.offsetY:t.layerY,this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0,this.button=t.button,this.keyCode=t.keyCode||0,this.charCode=t.charCode||("keypress"==n?t.keyCode:0),this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.state=t.state,this.Db=t,t.defaultPrevented&&this.preventDefault(),delete this.ga}}!z||A("528"),Ba&&A("1.9b")||y&&A("8")||Aa&&A("9.5")||z&&A("528"),Ba&&!A("8")||y&&A("9"),f=Q.prototype,f.u=function(){},f.Ja=function(){},f.ga=!1,f.defaultPrevented=!1,f.Yb=!0,f.preventDefault=function(){this.defaultPrevented=!0,this.Yb=!1},jc[" "]=ca,s(kc,Q),kc.prototype.preventDefault=function(){kc.pa.preventDefault.call(this);var t=this.Db;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,ic)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}},kc.prototype.u=function(){};var lc="closure_lm_"+(1e6*Math.random()|0),mc={},nc=0;function oc(t,e,n,r,i){if(m(e)){for(var o=0;o<e.length;o++)oc(t,e[o],n,r,i);return null}if(n=pc(n),bc(t))t=t.Ra(e,n,r,i);else{if(!e)throw Error("Invalid event type");o=!!r;var s=qc(t);s||(t[lc]=s=new P(t)),(n=s.add(e,n,!1,r,i)).Ua||(r=rc(),n.Ua=r,r.src=t,r.fa=n,t.addEventListener?t.addEventListener(e,r,o):t.attachEvent(e in mc?mc[e]:mc[e]="on"+e,r),nc++),t=n}return t}function rc(){var t=sc,e=hc?function(n){return t.call(e.src,e.fa,n)}:function(n){if(!(n=t.call(e.src,e.fa,n)))return n};return e}function tc(t,e,n,r,i){if(m(e))for(var o=0;o<e.length;o++)tc(t,e[o],n,r,i);else n=pc(n),bc(t)?t.vb(e,n,r,i):t&&(t=qc(t))&&(e=t.ya(e,n,!!r,i))&&uc(e)}function uc(t){if("number"==typeof t||!t||t.na)return!1;var e=t.src;if(bc(e))return gc(e.W,t);var n=t.type,r=t.Ua;return e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent&&e.detachEvent(n in mc?mc[n]:mc[n]="on"+n,r),nc--,(n=qc(e))?(gc(n,t),0==n.Ga&&(n.src=null,e[lc]=null)):ec(t),!0}function vc(t,e,n,r){var i=1;if((t=qc(t))&&(e=t.s[e]))for(e=bb(e),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.na&&(i&=!1!==wc(o,r))}return Boolean(i)}function wc(t,e){var n=t.fa,r=t.Oa||t.src;return t.Ia&&uc(t),n.call(r,e)}function sc(t,e){if(t.na)return!0;if(!hc){var n=e||ba("window.event"),r=new kc(n,this),i=!0;if(!(0>n.keyCode||null!=n.returnValue)){t:{var o=!1;if(0==n.keyCode)try{n.keyCode=-1;break t}catch(t){o=!0}(o||null==n.returnValue)&&(n.returnValue=!0)}for(n=[],o=r.currentTarget;o;o=o.parentNode)n.push(o);o=t.type;for(var s=n.length-1;!r.ga&&0<=s;s--)r.currentTarget=n[s],i&=vc(n[s],o,!0,r);for(s=0;!r.ga&&s<n.length;s++)r.currentTarget=n[s],i&=vc(n[s],o,!1,r)}return i}return wc(t,new kc(e,this))}function qc(t){return(t=t[lc])instanceof P?t:null}var xc="__closure_events_fn_"+(1e9*Math.random()>>>0);function pc(t){return fa(t)?t:t[xc]||(t[xc]=function(e){return t.handleEvent(e)})}function R(){O.call(this),this.W=new P(this),this.fc=this}function yc(t,e,n,r){if(!(e=t.W.s[String(e)]))return!0;e=bb(e);for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.na&&s.capture==n){var a=s.fa,c=s.Oa||s.src;s.Ia&&gc(t.W,s),i=!1!==a.call(c,r)&&i}}return i&&0!=r.Yb}function zc(t,e){R.call(this),this.ea=t||1,this.ra=e||l,this.ib=p(this.Gc,this),this.sb=q()}s(R,O),R.prototype[ac]=!0,f=R.prototype,f.tb=null,f.addEventListener=function(t,e,n,r){oc(this,t,e,n,r)},f.removeEventListener=function(t,e,n,r){tc(this,t,e,n,r)},f.dispatchEvent=function(t){var e;if(r=this.tb)for(e=[];r;r=r.tb)e.push(r);var r=this.fc,i=t.type||t;if(n(t))t=new Q(t,r);else if(t instanceof Q)t.target=t.target||r;else{var o=t;Wa(t=new Q(i,r),o)}var s;o=!0;if(e)for(var a=e.length-1;!t.ga&&0<=a;a--)o=yc(s=t.currentTarget=e[a],i,!0,t)&&o;if(t.ga||(o=yc(s=t.currentTarget=r,i,!0,t)&&o,t.ga||(o=yc(s,i,!1,t)&&o)),e)for(a=0;!t.ga&&a<e.length;a++)o=yc(s=t.currentTarget=e[a],i,!1,t)&&o;return o},f.u=function(){R.pa.u.call(this),this.W&&this.W.Xa(void 0),this.tb=null},f.Ra=function(t,e,n,r){return this.W.add(String(t),e,!1,n,r)},f.vb=function(t,e,n,r){return this.W.remove(String(t),e,n,r)},f.ya=function(t,e,n,r){return this.W.ya(String(t),e,n,r)},s(zc,R),f=zc.prototype,f.enabled=!1,f.l=null,f.setInterval=function(t){this.ea=t,this.l&&this.enabled?(this.stop(),this.start()):this.l&&this.stop()},f.Gc=function(){if(this.enabled){var t=q()-this.sb;0<t&&t<.8*this.ea?this.l=this.ra.setTimeout(this.ib,this.ea-t):(this.l&&(this.ra.clearTimeout(this.l),this.l=null),this.dispatchEvent(Ac),this.enabled&&(this.l=this.ra.setTimeout(this.ib,this.ea),this.sb=q()))}},f.start=function(){this.enabled=!0,this.l||(this.l=this.ra.setTimeout(this.ib,this.ea),this.sb=q())},f.stop=function(){this.enabled=!1,this.l&&(this.ra.clearTimeout(this.l),this.l=null)},f.u=function(){zc.pa.u.call(this),this.stop(),delete this.ra};var Ac="tick",Fc;function Bc(t,e,n){if(fa(t))n&&(t=p(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=p(t.handleEvent,t)}return 2147483647<e?-1:l.setTimeout(t,e||0)}function Cc(){}function Dc(t){var e;return(e=t.Ab)||(e={},Ec(t)&&(e[0]=!0,e[1]=!0),e=t.Ab=e),e}function Gc(){}function Hc(t){return(t=Ec(t))?new ActiveXObject(t):new XMLHttpRequest}function Ec(t){if(!t.Kb&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.Kb=r}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return t.Kb}function Ic(t){R.call(this),this.headers=new cb,this.gb=t||null,this.T=!1,this.fb=this.f=null,this.Mb=this.Qa="",this.ka=0,this.q="",this.da=this.qb=this.Pa=this.nb=!1,this.Fa=0,this.bb=null,this.Xb=Jc,this.cb=this.dc=!1}Cc.prototype.Ab=null,s(Gc,Cc),Fc=new Gc,s(Ic,R);var Jc="";Ic.prototype.r=Tb("goog.net.XhrIo");var Kc=/^https?$/i,Lc=["POST","PUT"];function Oc(t){return y&&A(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}function $a(t){return"content-type"==t.toLowerCase()}function Mc(t,e){t.T=!1,t.f&&(t.da=!0,t.f.abort(),t.da=!1),t.q=e,t.ka=5,Pc(t),Qc(t)}function Pc(t){t.nb||(t.nb=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Rc(t){if(t.T&&void 0!==aa)if(t.fb[1]&&4==T(t)&&2==Sc(t))M(t.r,S(t,"Local request error detected and ignored"));else if(t.Pa&&4==T(t))Bc(t.Qb,0,t);else if(t.dispatchEvent("readystatechange"),4==T(t)){M(t.r,S(t,"Request complete")),t.T=!1;try{var e,n,r=Sc(t);t:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:n=!0;break t;default:n=!1}if(!(e=n)){var i;if(i=0===r){if(!(s=Ra(String(t.Qa))[1]||null)&&self.location)var o=self.location.protocol,s=o.substr(0,o.length-1);i=!Kc.test(s?s.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{var a;t.ka=6;try{a=2<T(t)?t.f.statusText:""}catch(e){M(t.r,"Can not get status: "+e.message),a=""}t.q=a+" ["+Sc(t)+"]",Pc(t)}}finally{Qc(t)}}}function Qc(t,e){if(t.f){Nc(t);var n=t.f,r=t.fb[0]?ca:null;t.f=null,t.fb=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(e){(n=t.r)&&n.J("Problem encountered resetting onreadystatechange: "+e.message,void 0)}}}function Nc(t){t.f&&t.cb&&(t.f.ontimeout=null),"number"==typeof t.bb&&(l.clearTimeout(t.bb),t.bb=null)}function T(t){return t.f?t.f.readyState:0}function Sc(t){try{return 2<T(t)?t.f.status:-1}catch(e){return(t=t.r)&&t.Z("Can not get status: "+e.message,void 0),-1}}function Tc(t){try{return t.f?t.f.responseText:""}catch(e){return M(t.r,"Can not get responseText: "+e.message),""}}function S(t,e){return e+" ["+t.Mb+" "+t.Qa+" "+Sc(t)+"]"}function Uc(){this.Wb=q()}function Vc(t){O.call(this),this.e=t,this.j={}}f=Ic.prototype,f.send=function(t,e,n,r){if(this.f)throw Error("[goog.net.XhrIo] Object is active with another request="+this.Qa+"; newUri="+t);e=e?e.toUpperCase():"GET",this.Qa=t,this.q="",this.ka=0,this.Mb=e,this.nb=!1,this.T=!0,this.f=this.gb?Hc(this.gb):Hc(Fc),this.fb=this.gb?Dc(this.gb):Dc(Fc),this.f.onreadystatechange=p(this.Qb,this);try{M(this.r,S(this,"Opening Xhr")),this.qb=!0,this.f.open(e,t,!0),this.qb=!1}catch(t){return M(this.r,S(this,"Error opening Xhr: "+t.message)),void Mc(this,t)}t=n||"";var i=this.headers.n();r&&D(r,function(t,e){i.set(e,t)}),r=Za(i.ca()),n=l.FormData&&t instanceof l.FormData,!(0<=Xa(Lc,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),D(i,function(t,e){this.f.setRequestHeader(e,t)},this),this.Xb&&(this.f.responseType=this.Xb),"withCredentials"in this.f&&(this.f.withCredentials=this.dc);try{Nc(this),0<this.Fa&&(this.cb=Oc(this.f),M(this.r,S(this,"Will abort after "+this.Fa+"ms if incomplete, xhr2 "+this.cb)),this.cb?(this.f.timeout=this.Fa,this.f.ontimeout=p(this.qa,this)):this.bb=Bc(this.qa,this.Fa,this)),M(this.r,S(this,"Sending request")),this.Pa=!0,this.f.send(t),this.Pa=!1}catch(t){M(this.r,S(this,"Send error: "+t.message)),Mc(this,t)}},f.qa=function(){void 0!==aa&&this.f&&(this.q="Timed out after "+this.Fa+"ms, aborting",this.ka=8,M(this.r,S(this,this.q)),this.dispatchEvent("timeout"),this.abort(8))},f.abort=function(t){this.f&&this.T&&(M(this.r,S(this,"Aborting")),this.T=!1,this.da=!0,this.f.abort(),this.da=!1,this.ka=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Qc(this))},f.u=function(){this.f&&(this.T&&(this.T=!1,this.da=!0,this.f.abort(),this.da=!1),Qc(this,!0)),Ic.pa.u.call(this)},f.Qb=function(){this.mb||(this.qb||this.Pa||this.da?Rc(this):this.uc())},f.uc=function(){Rc(this)},f.isActive=function(){return!!this.f},f.Ib=function(){return n(this.q)?this.q:String(this.q)},new Uc,Uc.prototype.set=function(t){this.Wb=t},Uc.prototype.reset=function(){this.set(q())},Uc.prototype.get=function(){return this.Wb},s(Vc,O);var Wc=[];function Xc(t,e,n){O.call(this),this.pc=t,this.ea=e,this.e=n,this.jc=p(this.vc,this)}function Yc(t){t.l=Bc(t.jc,t.ea),t.pc.call(t.e)}function U(t,e,n,r,i){this.b=t,this.a=e,this.Y=n,this.B=r,this.Ea=i||1,this.qa=Zc,this.ob=new Vc(this),this.Ta=new zc,this.Ta.setInterval($c)}f=Vc.prototype,f.Ra=function(t,e,n,r){m(e)||(Wc[0]=e,e=Wc);for(var i=0;i<e.length;i++){var o=oc(t,e[i],n||this.handleEvent,r||!1,this.e||this);if(!o)break;this.j[o.key]=o}return this},f.vb=function(t,e,n,r,i){if(m(e))for(var o=0;o<e.length;o++)this.vb(t,e[o],n,r,i);else n=n||this.handleEvent,i=i||this.e||this,n=pc(n),r=!!r,(e=bc(t)?t.ya(e,n,r,i):t&&(t=qc(t))?t.ya(e,n,r,i):null)&&(uc(e),delete this.j[e.key]);return this},f.Xa=function(){var t,e=this.j,n=uc;for(t in e)n.call(void 0,e[t],t,e);this.j={}},f.u=function(){Vc.pa.u.call(this),this.Xa()},f.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},s(Xc,O),f=Xc.prototype,f.Za=!1,f.Vb=0,f.l=null,f.stop=function(){this.l&&(l.clearTimeout(this.l),this.l=null,this.Za=!1)},f.u=function(){Xc.pa.u.call(this),this.stop()},f.vc=function(){this.l=null,this.Za&&!this.Vb&&(this.Za=!1,Yc(this))},f=U.prototype,f.v=null,f.F=!1,f.ua=null,f.xb=null,f.Da=null,f.sa=null,f.U=null,f.w=null,f.X=null,f.k=null,f.Ha=0,f.K=null,f.ta=null,f.q=null,f.g=-1,f.Zb=!0,f.$=!1,f.ma=0,f.Va=null;var Zc=45e3,$c=250;function ad(t,e){switch(t){case 0:return"Non-200 return code ("+e+")";case 1:return"XMLHTTP failure (no data)";case 2:return"HttpConnection timeout";default:return"Unknown error"}}var bd={},dd={};function ed(){return!y||y&&10<=Ma}function fd(t,e,n){t.sa=1,t.U=H(e.n()),t.X=n,t.Cb=!0,gd(t,null)}function hd(t,e,n,r,i){t.sa=1,t.U=H(e.n()),t.X=null,t.Cb=n,i&&(t.Zb=!1),gd(t,r)}function gd(t,e){var n;if(t.Da=q(),id(t),t.w=t.U.n(),rb(t.w,"t",t.Ea),t.Ha=0,t.k=t.b.lb(t.b.$a()?e:null),0<t.ma&&(t.Va=new Xc(p(t.ec,t,t.k),t.ma)),t.ob.Ra(t.k,"readystatechange",t.Bc),t.v){n=t.v;var r,i={};for(r in n)i[r]=n[r];n=i}else n={};if(t.X?(t.ta="POST",n["Content-Type"]="application/x-www-form-urlencoded",t.k.send(t.w,t.ta,t.X,n)):(t.ta="GET",t.Zb&&!z&&(n.Connection="close"),t.k.send(t.w,t.ta,null,n)),t.b.H(jd),i=t.X)for(n="",i=i.split("&"),r=0;r<i.length;r++){if(1<(s=i[r].split("=")).length){var o=s[0],s=s[1],a=o.split("_");n=2<=a.length&&"type"==a[1]?n+(o+"=")+s+"&":n+(o+"=redacted&")}}else n=null;t.a.info("XMLHTTP REQ ("+t.B+") [attempt "+t.Ea+"]: "+t.ta+"\n"+t.w+"\n"+n)}function nd(t,e,n){for(var r=!0;!t.$&&t.Ha<n.length;){var i=qd(t,n);if(i==dd){4==e&&(t.q=4,W(),r=!1),Ub(t.a,t.B,null,"[Incomplete Response]");break}if(i==bd){t.q=4,W(),Ub(t.a,t.B,n,"[Invalid Chunk]"),r=!1;break}Ub(t.a,t.B,i,null),od(t,i)}4==e&&0==n.length&&(t.q=1,W(),r=!1),t.F=t.F&&r,r||(Ub(t.a,t.B,n,"[Invalid Chunked Response]"),V(t),pd(t))}function qd(t,e){var n=t.Ha,r=e.indexOf("\n",n);if(-1==r)return dd;if(n=Number(e.substring(n,r)),isNaN(n))return bd;if((r+=1)+n>e.length)return dd;var i=e.substr(r,n);return t.Ha=r+n,i}function rd(t,e){t.Da=q(),id(t);var n=e?window.location.hostname:"";t.w=t.U.n(),G(t.w,"DOMAIN",n),G(t.w,"t",t.Ea);try{t.K=new ActiveXObject("htmlfile")}catch(e){return t.a.J("ActiveX blocked"),V(t),t.q=7,W(),void pd(t)}var r="<html><body>";e&&(r+='<script>document.domain="'+n+'"<\/script>'),r+="</body></html>",t.K.open(),t.K.write(r),t.K.close(),t.K.parentWindow.m=p(t.yc,t),t.K.parentWindow.d=p(t.Ub,t,!0),t.K.parentWindow.rpcClose=p(t.Ub,t,!1),n=t.K.createElement("div"),t.K.parentWindow.document.body.appendChild(n),n.innerHTML='<iframe src="'+t.w+'"></iframe>',t.a.info("TRIDENT REQ ("+t.B+") [ attempt "+t.Ea+"]: GET\n"+t.w),t.b.H(jd)}function id(t){t.xb=q()+t.qa,td(t,t.qa)}function td(t,e){if(null!=t.ua)throw Error("WatchDog timer not null");t.ua=Y(p(t.zc,t),e)}function md(t){t.ua&&(l.clearTimeout(t.ua),t.ua=null)}function pd(t){t.b.Lb()||t.$||t.b.la(t)}function V(t){md(t);var e=t.Va;e&&"function"==typeof e.Ja&&e.Ja(),t.Va=null,t.Ta.stop(),t.ob.Xa(),t.k&&(e=t.k,t.k=null,e.abort(),e.Ja()),t.K&&(t.K=null)}function od(t,e){try{t.b.Rb(t,e),t.b.H(sd)}catch(e){Wb(t.a,e,"Error in httprequest callback")}}function ud(t,e,n,r,i){if((new N).debug("TestLoadImageWithRetries: "+i),0==r)n(!1);else{var o=i||0;r--,vd(t,e,function(i){i?n(!0):l.setTimeout(function(){ud(t,e,n,r,o)},o)})}}function vd(t,e,n){function r(t,e){return function(){try{i.debug("TestLoadImage: "+e),o.onload=null,o.onerror=null,o.onabort=null,o.ontimeout=null,l.clearTimeout(s),n(t)}catch(t){Wb(i,t)}}}var i=new N;i.debug("TestLoadImage: loading "+t);var o=new Image,s=null;o.onload=r(!0,"loaded"),o.onerror=r(!1,"error"),o.onabort=r(!1,"abort"),o.ontimeout=r(!1,"timeout"),s=l.setTimeout(function(){o.ontimeout&&o.ontimeout()},e),o.src=t}function wd(t,e){this.b=t,this.a=e,this.P=new Yb(0,!0)}function yd(t){var e=Ad(t.b,t.va,"/mail/images/cleardot.gif");H(e),ud(e.toString(),5e3,p(t.kc,t),3,2e3),t.H(jd)}function zd(t){t.a.debug("TestConnection: starting stage 2");var e=t.b.Dc;if(null!=e)t.a.debug("Buffered"),W(),e?(W(),Bd(t.b,t,!1)):(W(),Bd(t.b,t,!0));else if(t.A=new U(t,t.a,void 0,void 0,void 0),t.A.S(t.v),e=Cd(t.b,t.L,t.I),W(),ed())rb(e,"TYPE","xmlhttp"),hd(t.A,e,!1,t.L,!1);else{rb(e,"TYPE","html");var n=t.A;t=Boolean(t.L),n.sa=3,n.U=H(e.n()),rd(n,t)}}function Ed(t,e,n){this.Bb=t||null,this.c=Fd,this.t=[],this.Q=[],this.a=new N,this.P=new Yb(0,!0),this.Gb=e||null,this.Dc=null!=n?n:null}function Gd(t,e){this.Ob=t,this.map=e}f=U.prototype,f.S=function(t){this.v=t},f.setTimeout=function(t){this.qa=t},f.bc=function(t){this.ma=t},f.Bc=function(t){t=t.target;var e=this.Va;e&&3==T(t)?(this.a.debug("Throttling readystatechange."),e.l||e.Vb?e.Za=!0:Yc(e)):this.ec(t)},f.ec=function(t){try{if(t==this.k)t:{var e=T(this.k),n=this.k.ka,r=Sc(this.k);if(!ed()||z&&!A("420+")){if(4>e)break t}else if(3>e||3==e&&!Aa&&!Tc(this.k))break t;this.$||4!=e||7==n||(8==n||0>=r?this.b.H(kd):this.b.H(ld)),md(this);var i=Sc(this.k);this.g=i;var o=Tc(this.k);o||this.a.debug("No response text for uri "+this.w+" status "+i),this.F=200==i,this.a.info("XMLHTTP RESP ("+this.B+") [ attempt "+this.Ea+"]: "+this.ta+"\n"+this.w+"\n"+e+" "+i),this.F?(4==e&&V(this),this.Cb?(nd(this,e,o),Aa&&this.F&&3==e&&(this.ob.Ra(this.Ta,Ac,this.Ac),this.Ta.start())):(Ub(this.a,this.B,o,null),od(this,o)),this.F&&!this.$&&(4==e?this.b.la(this):(this.F=!1,id(this)))):(400==i&&0<o.indexOf("Unknown SID")?(this.q=3,W(),this.a.Z("XMLHTTP Unknown SID ("+this.B+")")):(this.q=0,W(),this.a.Z("XMLHTTP Bad status "+i+" ("+this.B+")")),V(this),pd(this))}else this.a.Z("Called back with an unexpected xmlhttp")}catch(t){this.a.debug("Failed call to OnXmlHttpReadyStateChanged_"),this.k&&Tc(this.k)?Wb(this.a,t,"ResponseText: "+Tc(this.k)):Wb(this.a,t,"No response text")}},f.Ac=function(){var t=T(this.k),e=Tc(this.k);this.Ha<e.length&&(md(this),nd(this,t,e),this.F&&4!=t&&id(this))},f.yc=function(t){Y(p(this.xc,this,t),0)},f.xc=function(t){if(!this.$){var e=this.a;e.info("TRIDENT TEXT ("+this.B+"): "+Vb(e,t)),md(this),od(this,t),id(this)}},f.Ub=function(t){Y(p(this.wc,this,t),0)},f.wc=function(t){this.$||(this.a.info("TRIDENT TEXT ("+this.B+"): "+t?"success":"failure"),V(this),this.F=t,this.b.la(this),this.b.H(sd))},f.nc=function(){md(this),this.b.la(this)},f.cancel=function(){this.$=!0,V(this)},f.zc=function(){this.ua=null;var t=q();0<=t-this.xb?(this.F&&this.a.J("Received watchdog timeout even though request loaded successfully"),this.a.info("TIMEOUT: "+this.w),2!=this.sa&&this.b.H(kd),V(this),this.q=2,W(),pd(this)):(this.a.Z("WatchDog timer called too early"),td(this,this.xb-t))},f.Ib=function(){return this.q},f=wd.prototype,f.v=null,f.A=null,f.Wa=!1,f.cc=null,f.La=null,f.rb=null,f.I=null,f.c=null,f.g=-1,f.L=null,f.va=null,f.S=function(t){this.v=t},f.ac=function(t){this.P=t},f.kb=function(t){this.I=t,t=xd(this.b,this.I),W(),this.cc=q();var e=this.b.Gb;null!=e?(this.L=this.b.correctHostPrefix(e[0]),(this.va=e[1])?(this.c=1,yd(this)):(this.c=2,zd(this))):(rb(t,"MODE","init"),this.A=new U(this,this.a,void 0,void 0,void 0),this.A.S(this.v),hd(this.A,t,!1,null,!0),this.c=0)},f.kc=function(t){if(t)this.c=2,zd(this);else{W();var e=this.b;e.a.debug("Test Connection Blocked"),e.g=e.V.g,Z(e,9)}t&&this.H(ld)},f.lb=function(t){return this.b.lb(t)},f.abort=function(){this.A&&(this.A.cancel(),this.A=null),this.g=-1},f.Lb=function(){return!1},f.Rb=function(t,e){if(this.g=t.g,0==this.c)if(this.a.debug("TestConnection: Got data for stage 1"),e){try{var n=this.P.parse(e)}catch(t){return Wb(this.a,t),void Dd(this.b,this)}this.L=this.b.correctHostPrefix(n[0]),this.va=n[1]}else this.a.debug("TestConnection: Null responseText"),Dd(this.b,this);else 2==this.c&&(this.Wa?(W(),this.rb=q()):"11111"==e?(W(),this.Wa=!0,this.La=q(),n=this.La-this.cc,(ed()||500>n)&&(this.g=200,this.A.cancel(),this.a.debug("Test connection succeeded; using streaming connection"),W(),Bd(this.b,this,!0))):(W(),this.La=this.rb=q(),this.Wa=!1))},f.la=function(){if(this.g=this.A.g,this.A.F){if(0==this.c)this.a.debug("TestConnection: request complete for initial check"),this.va?(this.c=1,yd(this)):(this.c=2,zd(this));else if(2==this.c){this.a.debug("TestConnection: request complete for stage 2");(ed()?this.Wa:!(200>this.rb-this.La))?(this.a.debug("Test connection succeeded; using streaming connection"),W(),Bd(this.b,this,!0)):(this.a.debug("Test connection failed; not using streaming"),W(),Bd(this.b,this,!1))}}else this.a.debug("TestConnection: request failed, in state "+this.c),0==this.c?W():2==this.c&&W(),Dd(this.b,this)},f.$a=function(){return this.b.$a()},f.isActive=function(){return this.b.isActive()},f.H=function(t){this.b.H(t)},f=Ed.prototype,f.v=null,f.xa=null,f.p=null,f.i=null,f.I=null,f.Ma=null,f.zb=null,f.L=null,f.hc=!0,f.Ba=0,f.sc=0,f.Ka=!1,f.e=null,f.G=null,f.M=null,f.aa=null,f.V=null,f.wb=null,f.gc=!0,f.za=-1,f.Nb=-1,f.g=-1,f.ba=0,f.ha=0,f.ic=5e3,f.Cc=1e4,f.pb=2,f.Hb=2e4,f.ma=0,f.ab=!1,f.ia=8;var Fd=1,Hd=new R;function Id(t){Q.call(this,"statevent",t)}function Jd(t,e){Q.call(this,"timingevent",t),this.size=e}s(Id,Q),s(Jd,Q);var jd=1,ld=2,kd=3,sd=4;function Kd(t){Q.call(this,"serverreachability",t)}s(Kd,Q);var Xb="y2f%",$,Yd;function Md(t){t.V&&(t.V.abort(),t.V=null),t.i&&(t.i.cancel(),t.i=null),t.M&&(l.clearTimeout(t.M),t.M=null),Pd(t),t.p&&(t.p.cancel(),t.p=null),t.G&&(l.clearTimeout(t.G),t.G=null)}function Qd(t){t.p||t.G||(t.G=Y(p(t.Tb,t),0),t.ba=0)}function Sd(t,e){var n,r;e?6<t.ia?(t.t=t.Q.concat(t.t),t.Q.length=0,n=t.Ba-1,r=Rd(t)):(n=e.B,r=e.X):(n=t.Ba++,r=Rd(t));var i=t.Ma.n();G(i,"SID",t.Y),G(i,"RID",n),G(i,"AID",t.za),Nd(t,i),(n=new U(t,t.a,t.Y,n,t.ba+1)).S(t.v),n.setTimeout(Math.round(.5*t.Hb)+Math.round(.5*t.Hb*Math.random())),t.p=n,fd(n,i,r)}function Nd(t,e){if(t.e){var n=t.e.getAdditionalParams(t);n&&D(n,function(t,n){G(e,n,t)})}}function Rd(t){var e,n=Math.min(t.t.length,1e3),r=["count="+n];6<t.ia&&0<n?(e=t.t[0].Ob,r.push("ofs="+e)):e=0;for(var i=0;i<n;i++){var o=t.t[i].Ob,s=t.t[i].map;o=6>=t.ia?i:o-e;try{D(s,function(t,e){r.push("req"+o+"_"+e+"="+encodeURIComponent(t))})}catch(e){r.push("req"+o+"_type="+encodeURIComponent("_badmap")),t.e&&t.e.badMapError(t,s)}}return t.Q=t.Q.concat(t.t.splice(0,n)),r.join("&")}function Td(t){t.i||t.M||(t.yb=1,t.M=Y(p(t.Sb,t),0),t.ha=0)}function Ud(t){return t.i||t.M?(t.a.J("Request already in progress"),!1):!(3<=t.ha)&&(t.a.debug("Going to retry GET"),t.yb++,t.M=Y(p(t.Sb,t),Vd(t,t.ha)),t.ha++,!0)}function Ld(t){if(t.e){var e=t.e.okToMakeRequest(t);if(0!=e)return t.a.debug("Handler returned error code from okToMakeRequest"),Z(t,e),!1}return!0}function Bd(t,e,n){t.a.debug("Test Connection Finished"),t.wb=t.gc&&n,t.g=e.g,t.a.debug("connectChannel_()"),t.lc(Fd,0),t.Ma=xd(t,t.I),Qd(t)}function Dd(t,e){t.a.debug("Test Connection Failed"),t.g=e.g,Z(t,2)}function Pd(t){null!=t.aa&&(l.clearTimeout(t.aa),t.aa=null)}function Vd(t,e){var n=t.ic+Math.floor(Math.random()*t.Cc);return t.isActive()||(t.a.debug("Inactive channel"),n*=2),n*e}function Z(t,e){if(t.a.info("Error code "+e),2==e||9==e){var n=null;t.e&&(n=t.e.getNetworkTestImageUri(t));var r=p(t.Fc,t);n||H(n=new E("//www.google.com/images/cleardot.gif")),vd(n.toString(),1e4,r)}else W();Wd(t,e)}function Wd(t,e){t.a.debug("HttpChannel: error - "+e),t.c=0,t.e&&t.e.channelError(t,e),Od(t),Md(t)}function Od(t){if(t.c=0,t.g=-1,t.e)if(0==t.Q.length&&0==t.t.length)t.e.channelClosed(t);else{t.a.debug("Number of undelivered maps, pending: "+t.Q.length+", outgoing: "+t.t.length);var e=bb(t.Q),n=bb(t.t);t.Q.length=0,t.t.length=0,t.e.channelClosed(t,e,n)}}function xd(t,e){var n=Ad(t,null,e);return t.a.debug("GetForwardChannelUri: "+n),n}function Cd(t,e,n){return e=Ad(t,t.$a()?e:null,n),t.a.debug("GetBackChannelUri: "+e),e}function Ad(t,e,n){if(""!=(i=tb(n)).ja)e&&gb(i,e+"."+i.ja),hb(i,i.Ca);else var r=window.location,i=ub(r.protocol,e?e+"."+r.hostname:r.hostname,r.port,n);return t.xa&&D(t.xa,function(t,e){G(i,e,t)}),G(i,"VER",t.ia),Nd(t,i),i}function Y(t,e){if(!fa(t))throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){t()},e)}function W(){Hd.dispatchEvent(new Id(Hd))}function Xd(){}f=Ed.prototype,f.kb=function(t,e,n,r,i){this.a.debug("connect()"),W(),this.I=e,this.xa=n||{},r&&void 0!==i&&(this.xa.OSID=r,this.xa.OAID=i),this.a.debug("connectTest_()"),Ld(this)&&(this.V=new wd(this,this.a),this.V.S(this.v),this.V.ac(this.P),this.V.kb(t))},f.disconnect=function(){if(this.a.debug("disconnect()"),Md(this),3==this.c){var t=this.Ba++,e=this.Ma.n();G(e,"SID",this.Y),G(e,"RID",t),G(e,"TYPE","terminate"),Nd(this,e),(t=new U(this,this.a,this.Y,t,void 0)).sa=2,t.U=H(e.n()),(e=new Image).src=t.U,e.onload=e.onerror=p(t.nc,t),t.Da=q(),id(t)}Od(this)},f.S=function(t){this.v=t},f.bc=function(t){this.ma=t},f.Lb=function(){return 0==this.c},f.ac=function(t){this.P=t},f.Tb=function(t){if(this.G=null,this.a.debug("startForwardChannel_"),Ld(this))if(this.c==Fd)if(t)this.a.J("Not supposed to retry the open");else{this.a.debug("open_()"),this.Ba=Math.floor(1e5*Math.random()),t=this.Ba++;var e=new U(this,this.a,"",t,void 0);e.S(this.v);var n=Rd(this),r=this.Ma.n();G(r,"RID",t),this.Bb&&G(r,"CVER",this.Bb),Nd(this,r),fd(e,r,n),this.p=e,this.c=2}else 3==this.c&&(t?Sd(this,t):0==this.t.length?this.a.debug("startForwardChannel_ returned: nothing to send"):this.p?this.a.J("startForwardChannel_ returned: connection already in progress"):(Sd(this),this.a.debug("startForwardChannel_ finished, sent request")))},f.Sb=function(){if(this.M=null,Ld(this)){this.a.debug("Creating new HttpRequest"),this.i=new U(this,this.a,this.Y,"rpc",this.yb),this.i.S(this.v),this.i.bc(this.ma);var t=this.zb.n();if(G(t,"RID","rpc"),G(t,"SID",this.Y),G(t,"CI",this.wb?"0":"1"),G(t,"AID",this.za),Nd(this,t),ed())G(t,"TYPE","xmlhttp"),hd(this.i,t,!0,this.L,!1);else{G(t,"TYPE","html");var e=this.i,n=Boolean(this.L);e.sa=3,e.U=H(t.n()),rd(e,n)}this.a.debug("New Request created")}},f.Rb=function(t,e){if(0!=this.c&&(this.i==t||this.p==t))if(this.g=t.g,this.p==t&&3==this.c)if(7<this.ia){var n;try{n=this.P.parse(e)}catch(t){n=null}if(m(n)&&3==n.length)if(0==(r=n)[0])t:if(this.a.debug("Server claims our backchannel is missing."),this.M)this.a.debug("But we are currently starting the request.");else{if(this.i){if(!(this.i.Da+3e3<this.p.Da))break t;Pd(this),this.i.cancel(),this.i=null}else this.a.Z("We do not have a BackChannel established");Ud(this),W()}else this.Nb=r[1],0<(n=this.Nb-this.za)&&(r=r[2],this.a.debug(r+" bytes (in "+n+" arrays) are outstanding on the BackChannel"),37500>r&&this.wb&&0==this.ha&&!this.aa&&(this.aa=Y(p(this.tc,this),6e3)));else this.a.debug("Bad POST response data returned"),Z(this,11)}else e!=Xb&&(this.a.debug("Bad data returned - missing/invald magic cookie"),Z(this,11));else if(this.i==t&&Pd(this),!/^[\s\xa0]*$/.test(e)){n=this.P.parse(e);for(var r=this.e&&this.e.channelHandleMultipleArrays?[]:null,i=0;i<n.length;i++){var o=n[i];this.za=o[0],o=o[1],2==this.c?"c"==o[0]?(this.Y=o[1],this.L=this.correctHostPrefix(o[2]),o=o[3],this.ia=null!=o?o:6,this.c=3,this.e&&this.e.channelOpened(this),this.zb=Cd(this,this.L,this.I),Td(this)):"stop"==o[0]&&Z(this,7):3==this.c&&("stop"==o[0]?(r&&0!=r.length&&(this.e.channelHandleMultipleArrays(this,r),r.length=0),Z(this,7)):"noop"!=o[0]&&(r?r.push(o):this.e&&this.e.channelHandleArray(this,o)),this.ha=0)}r&&0!=r.length&&this.e.channelHandleMultipleArrays(this,r)}},f.correctHostPrefix=function(t){return this.hc?this.e?this.e.correctHostPrefix(t):t:null},f.tc=function(){null!=this.aa&&(this.aa=null,this.i.cancel(),this.i=null,Ud(this),W())},f.la=function(t){var e;if(this.a.debug("Request complete"),this.i==t)Pd(this),this.i=null,e=2;else{if(this.p!=t)return;this.p=null,e=1}if(this.g=t.g,0!=this.c)if(t.F)1==e?(q(),Hd.dispatchEvent(new Jd(Hd,t.X?t.X.length:0)),Qd(this),this.Q.length=0):Td(this);else{var n=t.Ib();if(3==n||7==n||0==n&&0<this.g)this.a.debug("Not retrying due to error type");else{var r;if(this.a.debug("Maybe retrying, last error: "+ad(n,this.g)),(r=1==e)&&(this.p||this.G?(this.a.J("Request already in progress"),r=!1):this.c==Fd||this.ba>=(this.Ka?0:this.pb)?r=!1:(this.a.debug("Going to retry POST"),this.G=Y(p(this.Tb,this,t),Vd(this,this.ba)),this.ba++,r=!0)),r||2==e&&Ud(this))return;this.a.debug("Exceeded max number of retries")}switch(this.a.debug("Error: HTTP request failed"),n){case 1:Z(this,5);break;case 4:Z(this,10);break;case 3:Z(this,6);break;case 7:Z(this,12);break;default:Z(this,2)}}},f.lc=function(t){if(!(0<=Xa(arguments,this.c)))throw Error("Unexpected channel state: "+this.c)},f.Fc=function(t){t?(this.a.info("Successfully pinged google.com"),W()):(this.a.info("Failed to ping google.com"),W(),Wd(this,8))},f.lb=function(t){if(t&&!this.ab)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Ic).dc=this.ab,t},f.isActive=function(){return!!this.e&&this.e.isActive(this)},f.H=function(){Hd.dispatchEvent(new Kd(Hd))},f.$a=function(){return this.ab||!ed()},f=Xd.prototype,f.channelHandleMultipleArrays=null,f.okToMakeRequest=function(){return 0},f.channelOpened=function(){},f.channelHandleArray=function(){},f.channelError=function(){},f.channelClosed=function(){},f.getAdditionalParams=function(){return{}},f.getNetworkTestImageUri=function(){return null},f.isActive=function(){return!0},f.badMapError=function(){},f.correctHostPrefix=function(t){return t},Yd={0:"Ok",4:"User is logging out",6:"Unknown session ID",7:"Stopped by server",8:"General network error",2:"Request failed",9:"Blocked by a network administrator",5:"No data from server",10:"Got bad data from the server",11:"Got a bad response from the server"},$=function(t,e){var n,r,i,o,s,a,c,u,h,p,f,d,_,g;if(!(this instanceof $))return new $(t,e);p=this,t||(t="channel"),t.match(/:\/\//)&&t.replace(/^ws/,"http"),e||(e={}),m(e||"string"==typeof e)&&(e={}),u=e.reconnectTime||3e3,n=e.extraHeaders||null,r=e.extraParams||null,null!==e.affinity&&(r||(r={}),e.affinityParam||(e.affinityParam="a"),this.affinity=e.affinity||sa(),r[e.affinityParam]=this.affinity),(_=function(t){p.readyState=p.readyState=t})(this.CLOSED),d=null,a=null!=(g=e.prev)?g.Ec:void 0,i=function(t,e,n,r,i){try{return"function"==typeof p[t]?p[t](n,r,i):void 0}catch(t){throw"undefined"!=typeof console&&null!==console&&console.error(t.stack),t}},(o=new Xd).channelOpened=function(){return a=d,_($.OPEN),i("onopen")},s=null,o.channelError=function(t,e){var n;return n=Yd[e],s=e,p.readyState!==$.CLOSED&&_($.hb),i("onerror",0,n,e)},h=null,o.channelClosed=function(t,n,r){var o;if(p.readyState!==$.CLOSED)return d=null,t=s?Yd[s]:"Closed",_($.CLOSED),e.reconnect&&7!==s&&0!==s&&(o=6===s?0:u,clearTimeout(h),h=setTimeout(c,o)),i("onclose",0,t,n,r),s=null},o.channelHandleArray=function(t,e){return i("onmessage",0,{type:"message",data:e})},c=function(){if(d)throw Error("Reconnect() called from invalid state");if(_($.CONNECTING),i("onconnecting"),clearTimeout(h),p.Ec=d=new Ed(e.appVersion,null!=a?a.Gb:void 0),e.crossDomainXhr&&(d.ab=!0),d.e=o,n&&d.S(n),s=null,e.failFast){var c=d;c.Ka=!0,c.a.info("setFailFast: true"),(c.p||c.G)&&c.ba>(c.Ka?0:c.pb)&&(c.a.info("Retry count "+c.ba+" > new maxRetries "+(c.Ka?0:c.pb)+". Fail immediately!"),c.p?(c.p.cancel(),c.la(c.p)):(l.clearTimeout(c.G),c.G=null,Z(c,2)))}return d.kb(t+"/test",t+"/bind",r,null!=a?a.Y:void 0,null!=a?a.za:void 0)},this.open=function(){if(p.readyState!==p.CLOSED)throw Error("Already open");return c()},this.close=function(){if(clearTimeout(h),s=0,p.readyState!==$.CLOSED)return _($.hb),d.disconnect()},this.sendMap=f=function(t){var e;if((e=p.readyState)!==$.hb&&e!==$.CLOSED){if(0==(e=d).c)throw Error("Invalid operation: sending map when state is closed");1e3==e.t.length&&e.a.J("Already have 1000 queued maps upon queueing "+yb(t)),e.t.push(new Gd(e.sc++,t)),2!=e.c&&3!=e.c||Qd(e)}},this.send=function(t){return f("string"==typeof t?{_S:t}:{JSON:yb(t)})},c()},$.prototype.canSendWhileConnecting=$.canSendWhileConnecting=!0,$.prototype.canSendJSON=$.canSendJSON=!0,$.prototype.CONNECTING=$.CONNECTING=$.CONNECTING=0,$.prototype.OPEN=$.OPEN=$.OPEN=1,$.prototype.CLOSING=$.CLOSING=$.hb=2,$.prototype.CLOSED=$.CLOSED=$.CLOSED=3,(null!=_$bcsocketUncompressed_3?_$bcsocketUncompressed_3:window).BCSocket=$}();var _$Socket_41=Socket,BCSocket=_$bcsocketUncompressed_3.BCSocket;function Socket(t){this._options=t,this._messageQueue=[],this._connectedOnce=!1,this._attemptNum=0,this._url=getWebSocketURL(t),supportWebSockets()&&!t.browserChannelOnly?this._createWebSocket():this._createBrowserChannel()}function getRandom(t,e){return Math.random()*(e-t)+t}function supportWebSockets(){return"WebSocket"in window&&2===window.WebSocket.CLOSING}function getWebSocketURL(t){var e;window.location&&window.location.port&&(e=":"+window.location.port);var n=t.srvPort,r=t.srvSecurePort,i=t.srvHost||window.location.hostname,o="https:"===(t.srvProtocol||window.location.protocol)?"wss:":"ws:";return"ws:"===o&&n?e=":"+n:"wss:"===o&&r&&(e=":"+r),o+"//"+i+(e||"")+t.base}Socket.prototype._createWebSocket=function(){this._type="websocket",this._socket=new WebSocket(this._url),this.open=this._createWebSocket.bind(this),this._syncState(),this._socket.onmessage=this._ws_onmessage.bind(this),this._socket.onopen=this._ws_onopen.bind(this),this._socket.onclose=this._ws_onclose.bind(this)},Socket.prototype._createBrowserChannel=function(){this._type="browserchannel",this._socket=BCSocket(this._options.base,this._options),this.open=this._createBrowserChannel.bind(this),this._syncState(),this._socket.onmessage=this._bc_onmessage.bind(this),this._socket.onopen=this._bc_onopen.bind(this),this._socket.onclose=this._bc_onclose.bind(this)},Socket.prototype._ws_onmessage=function(t){this._syncState(),t.data=JSON.parse(t.data),this.onmessage&&this.onmessage(t)},Socket.prototype._ws_onopen=function(t){this._attemptNum=0,this._connectedOnce=!0,this._syncState(),this._flushQueue(),this.onopen&&this.onopen(t)},Socket.prototype._ws_onclose=function(t){if(this._syncState(),console.log("WebSocket: connection is broken",t),this.onclose&&this.onclose(t),!this._connectedOnce)return this._createBrowserChannel();var e=this;this._options.reconnect&&!t.wasClean&&setTimeout(function(){e.readyState===e.CLOSED&&e._createWebSocket()},this._getTimeout()),this._attemptNum++},Socket.prototype._getTimeout=function(){var t=this._options.timeout+this._options.timeoutIncrement*this._attemptNum;return getRandom(t/3,t)},Socket.prototype._bc_onmessage=function(t){this._syncState(),this.onmessage&&this.onmessage(t)},Socket.prototype._bc_onopen=function(t){this._syncState(),this.onopen&&this.onopen(t)},Socket.prototype._bc_onclose=function(t){this._syncState(),this.onclose&&this.onclose(t)},Socket.prototype._flushQueue=function(){for(;0!==this._messageQueue.length;){var t=this._messageQueue.shift();this._send(t)}},Socket.prototype._send=function(t){"websocket"===this._type&&"string"!=typeof t&&(t=JSON.stringify(t)),this._socket.send(t)},Socket.prototype.send=function(t){"websocket"===this._type?this._socket.readyState===WebSocket.OPEN&&0===this._messageQueue.length?this._send(t):this._messageQueue.push(t):this._send(t)},Socket.prototype.close=function(){this._socket.close()},Socket.prototype._syncState=function(){this.readyState=this._socket.readyState},Socket.prototype.reconnect=function(){"websocket"===this._type&&this.readyState===this.CLOSED&&this._createWebSocket()},Socket.prototype.canSendWhileConnecting=!0,Socket.prototype.canSendJSON=!0,Socket.prototype.CONNECTING=0,Socket.prototype.OPEN=1,Socket.prototype.CLOSING=2,Socket.prototype.CLOSED=3;var _$browser_40={},CLIENT_OPTIONS=JSON.parse('{"base":"/channel","reconnect":true,"browserChannelOnly":false,"timeout":10000,"timeoutIncrement":10000}');_$lib_racer.Model.prototype._createSocket=function(t){return new _$Socket_41(CLIENT_OPTIONS)};var _$showdown_81={exports:{}};(function(){function t(t){"use strict";var e={omitExtraWLInCodeBlocks:{defaultValue:!1,describe:"Omit the default extra whiteline added to code blocks",type:"boolean"},noHeaderId:{defaultValue:!1,describe:"Turn on/off generated header id",type:"boolean"},prefixHeaderId:{defaultValue:!1,describe:"Add a prefix to the generated header ids. Passing a string will prefix that string to the header id. Setting to true will add a generic 'section-' prefix",type:"string"},rawPrefixHeaderId:{defaultValue:!1,describe:'Setting this option to true will prevent showdown from modifying the prefix. This might result in malformed IDs (if, for instance, the " char is used in the prefix)',type:"boolean"},ghCompatibleHeaderId:{defaultValue:!1,describe:"Generate header ids compatible with github style (spaces are replaced with dashes, a bunch of non alphanumeric chars are removed)",type:"boolean"},rawHeaderId:{defaultValue:!1,describe:"Remove only spaces, ' and \" from generated header ids (including prefixes), replacing them with dashes (-). WARNING: This might result in malformed ids",type:"boolean"},headerLevelStart:{defaultValue:!1,describe:"The header blocks level start",type:"integer"},parseImgDimensions:{defaultValue:!1,describe:"Turn on/off image dimension parsing",type:"boolean"},simplifiedAutoLink:{defaultValue:!1,describe:"Turn on/off GFM autolink style",type:"boolean"},excludeTrailingPunctuationFromURLs:{defaultValue:!1,describe:"Excludes trailing punctuation from links generated with autoLinking",type:"boolean"},literalMidWordUnderscores:{defaultValue:!1,describe:"Parse midword underscores as literal underscores",type:"boolean"},literalMidWordAsterisks:{defaultValue:!1,describe:"Parse midword asterisks as literal asterisks",type:"boolean"},strikethrough:{defaultValue:!1,describe:"Turn on/off strikethrough support",type:"boolean"},tables:{defaultValue:!1,describe:"Turn on/off tables support",type:"boolean"},tablesHeaderId:{defaultValue:!1,describe:"Add an id to table headers",type:"boolean"},ghCodeBlocks:{defaultValue:!0,describe:"Turn on/off GFM fenced code blocks support",type:"boolean"},tasklists:{defaultValue:!1,describe:"Turn on/off GFM tasklist support",type:"boolean"},smoothLivePreview:{defaultValue:!1,describe:"Prevents weird effects in live previews due to incomplete input",type:"boolean"},smartIndentationFix:{defaultValue:!1,description:"Tries to smartly fix indentation in es6 strings",type:"boolean"},disableForced4SpacesIndentedSublists:{defaultValue:!1,description:"Disables the requirement of indenting nested sublists by 4 spaces",type:"boolean"},simpleLineBreaks:{defaultValue:!1,description:"Parses simple line breaks as <br> (GFM Style)",type:"boolean"},requireSpaceBeforeHeadingText:{defaultValue:!1,description:"Makes adding a space between `#` and the header text mandatory (GFM Style)",type:"boolean"},ghMentions:{defaultValue:!1,description:"Enables github @mentions",type:"boolean"},ghMentionsLink:{defaultValue:"https://github.com/{u}",description:"Changes the link generated by @mentions. Only applies if ghMentions option is enabled.",type:"string"},encodeEmails:{defaultValue:!0,description:"Encode e-mail addresses through the use of Character Entities, transforming ASCII e-mail addresses into its equivalent decimal entities",type:"boolean"},openLinksInNewWindow:{defaultValue:!1,description:"Open all links in new windows",type:"boolean"},backslashEscapesHTMLTags:{defaultValue:!1,description:"Support for HTML Tag escaping. ex: <div>foo</div>",type:"boolean"},emoji:{defaultValue:!1,description:"Enable emoji support. Ex: `this is a :smile: emoji`",type:"boolean"},underline:{defaultValue:!1,description:"Enable support for underline. Syntax is double or triple underscores: `__underline word__`. With this option enabled, underscores no longer parses into `<em>` and `<strong>`",type:"boolean"},completeHTMLDocument:{defaultValue:!1,description:"Outputs a complete html document, including `<html>`, `<head>` and `<body>` tags",type:"boolean"},metadata:{defaultValue:!1,description:"Enable support for document metadata (defined at the top of the document between `` and `` or between `---` and `---`).",type:"boolean"},splitAdjacentBlockquotes:{defaultValue:!1,description:"Split adjacent blockquote blocks",type:"boolean"}};if(!1===t)return JSON.parse(JSON.stringify(e));var n={};for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r].defaultValue);return n}var e={},n={},r={},i=t(!0),o="vanilla",s={github:{omitExtraWLInCodeBlocks:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,disableForced4SpacesIndentedSublists:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghCompatibleHeaderId:!0,ghMentions:!0,backslashEscapesHTMLTags:!0,emoji:!0,splitAdjacentBlockquotes:!0},original:{noHeaderId:!0,ghCodeBlocks:!1},ghost:{omitExtraWLInCodeBlocks:!0,parseImgDimensions:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,smoothLivePreview:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghMentions:!1,encodeEmails:!0},vanilla:t(!0),allOn:function(){"use strict";var e=t(!0),n={};for(var r in e)e.hasOwnProperty(r)&&(n[r]=!0);return n}()};function a(t,n){"use strict";var r=n?"Error in "+n+" extension->":"Error in unnamed extension",i={valid:!0,error:""};e.helper.isArray(t)||(t=[t]);for(var o=0;o<t.length;++o){var s=r+" sub-extension "+o+": ",a=t[o];if("object"!=typeof a)return i.valid=!1,i.error=s+"must be an object, but "+typeof a+" given",i;if(!e.helper.isString(a.type))return i.valid=!1,i.error=s+'property "type" must be a string, but '+typeof a.type+" given",i;var c=a.type=a.type.toLowerCase();if("language"===c&&(c=a.type="lang"),"html"===c&&(c=a.type="output"),"lang"!==c&&"output"!==c&&"listener"!==c)return i.valid=!1,i.error=s+"type "+c+' is not recognized. Valid values: "lang/language", "output/html" or "listener"',i;if("listener"===c){if(e.helper.isUndefined(a.listeners))return i.valid=!1,i.error=s+'. Extensions of type "listener" must have a property called "listeners"',i}else if(e.helper.isUndefined(a.filter)&&e.helper.isUndefined(a.regex))return i.valid=!1,i.error=s+c+' extensions must define either a "regex" property or a "filter" method',i;if(a.listeners){if("object"!=typeof a.listeners)return i.valid=!1,i.error=s+'"listeners" property must be an object but '+typeof a.listeners+" given",i;for(var l in a.listeners)if(a.listeners.hasOwnProperty(l)&&"function"!=typeof a.listeners[l])return i.valid=!1,i.error=s+'"listeners" property must be an hash of [event name]: [callback]. listeners.'+l+" must be a function but "+typeof a.listeners[l]+" given",i}if(a.filter){if("function"!=typeof a.filter)return i.valid=!1,i.error=s+'"filter" must be a function, but '+typeof a.filter+" given",i}else if(a.regex){if(e.helper.isString(a.regex)&&(a.regex=new RegExp(a.regex,"g")),!(a.regex instanceof RegExp))return i.valid=!1,i.error=s+'"regex" property must either be a string or a RegExp object, but '+typeof a.regex+" given",i;if(e.helper.isUndefined(a.replace))return i.valid=!1,i.error=s+'"regex" extensions must implement a replace string or function',i}}return i}function c(t,e){"use strict";return"E"+e.charCodeAt(0)+"E"}e.helper={},e.extensions={},e.setOption=function(t,e){"use strict";return i[t]=e,this},e.getOption=function(t){"use strict";return i[t]},e.getOptions=function(){"use strict";return i},e.resetOptions=function(){"use strict";i=t(!0)},e.setFlavor=function(t){"use strict";if(!s.hasOwnProperty(t))throw Error(t+" flavor was not found");e.resetOptions();var n=s[t];for(var r in o=t,n)n.hasOwnProperty(r)&&(i[r]=n[r])},e.getFlavor=function(){"use strict";return o},e.getFlavorOptions=function(t){"use strict";if(s.hasOwnProperty(t))return s[t]},e.getDefaultOptions=function(e){"use strict";return t(e)},e.subParser=function(t,r){"use strict";if(e.helper.isString(t)){if(void 0===r){if(n.hasOwnProperty(t))return n[t];throw Error("SubParser named "+t+" not registered!")}n[t]=r}},e.extension=function(t,n){"use strict";if(!e.helper.isString(t))throw Error("Extension 'name' must be a string");if(t=e.helper.stdExtName(t),e.helper.isUndefined(n)){if(!r.hasOwnProperty(t))throw Error("Extension named "+t+" is not registered!");return r[t]}"function"==typeof n&&(n=n()),e.helper.isArray(n)||(n=[n]);var i=a(n,t);if(!i.valid)throw Error(i.error);r[t]=n},e.getAllExtensions=function(){"use strict";return r},e.removeExtension=function(t){"use strict";delete r[t]},e.resetExtensions=function(){"use strict";r={}},e.validateExtension=function(t){"use strict";var e=a(t,null);return!!e.valid||(console.warn(e.error),!1)},e.hasOwnProperty("helper")||(e.helper={}),e.helper.isString=function(t){"use strict";return"string"==typeof t||t instanceof String},e.helper.isFunction=function(t){"use strict";return t&&"[object Function]"==={}.toString.call(t)},e.helper.isArray=function(t){"use strict";return Array.isArray(t)},e.helper.isUndefined=function(t){"use strict";return void 0===t},e.helper.forEach=function(t,n){"use strict";if(e.helper.isUndefined(t))throw new Error("obj param is required");if(e.helper.isUndefined(n))throw new Error("callback param is required");if(!e.helper.isFunction(n))throw new Error("callback param must be a function/closure");if("function"==typeof t.forEach)t.forEach(n);else if(e.helper.isArray(t))for(var r=0;r<t.length;r++)n(t[r],r,t);else{if("object"!=typeof t)throw new Error("obj does not seem to be an array or an iterable object");for(var i in t)t.hasOwnProperty(i)&&n(t[i],i,t)}},e.helper.stdExtName=function(t){"use strict";return t.replace(/[_?*+\/\\.^-]/g,"").replace(/\s/g,"").toLowerCase()},e.helper.escapeCharactersCallback=c,e.helper.escapeCharacters=function(t,e,n){"use strict";var r="(["+e.replace(/([\[\]\\])/g,"\\$1")+"])";n&&(r="\\\\"+r);var i=new RegExp(r,"g");return t=t.replace(i,c)},e.helper.unescapeHTMLEntities=function(t){"use strict";return t.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")};var l=function(t,e,n,r){"use strict";var i,o,s,a,c,l=r||"",u=l.indexOf("g")>-1,h=new RegExp(e+"|"+n,"g"+l.replace(/g/g,"")),p=new RegExp(e,l.replace(/g/g,"")),f=[];do{for(i=0;s=h.exec(t);)if(p.test(s[0]))i++||(a=(o=h.lastIndex)-s[0].length);else if(i&&!--i){c=s.index+s[0].length;var d={left:{start:a,end:o},match:{start:o,end:s.index},right:{start:s.index,end:c},wholeMatch:{start:a,end:c}};if(f.push(d),!u)return f}}while(i&&(h.lastIndex=o));return f};e.helper.matchRecursiveRegExp=function(t,e,n,r){"use strict";for(var i=l(t,e,n,r),o=[],s=0;s<i.length;++s)o.push([t.slice(i[s].wholeMatch.start,i[s].wholeMatch.end),t.slice(i[s].match.start,i[s].match.end),t.slice(i[s].left.start,i[s].left.end),t.slice(i[s].right.start,i[s].right.end)]);return o},e.helper.replaceRecursiveRegExp=function(t,n,r,i,o){"use strict";if(!e.helper.isFunction(n)){var s=n;n=function(){return s}}var a=l(t,r,i,o),c=t,u=a.length;if(u>0){var h=[];0!==a[0].wholeMatch.start&&h.push(t.slice(0,a[0].wholeMatch.start));for(var p=0;p<u;++p)h.push(n(t.slice(a[p].wholeMatch.start,a[p].wholeMatch.end),t.slice(a[p].match.start,a[p].match.end),t.slice(a[p].left.start,a[p].left.end),t.slice(a[p].right.start,a[p].right.end))),p<u-1&&h.push(t.slice(a[p].wholeMatch.end,a[p+1].wholeMatch.start));a[u-1].wholeMatch.end<t.length&&h.push(t.slice(a[u-1].wholeMatch.end)),c=h.join("")}return c},e.helper.regexIndexOf=function(t,n,r){"use strict";if(!e.helper.isString(t))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";if(n instanceof RegExp==!1)throw"InvalidArgumentError: second parameter of showdown.helper.regexIndexOf function must be an instance of RegExp";var i=t.substring(r||0).search(n);return i>=0?i+(r||0):i},e.helper.splitAtIndex=function(t,n){"use strict";if(!e.helper.isString(t))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";return[t.substring(0,n),t.substring(n)]},e.helper.encodeEmailAddress=function(t){"use strict";var e=[function(t){return"&#"+t.charCodeAt(0)+";"},function(t){return"&#x"+t.charCodeAt(0).toString(16)+";"},function(t){return t}];return t=t.replace(/./g,function(t){if("@"===t)t=e[Math.floor(2*Math.random())](t);else{var n=Math.random();t=n>.9?e[2](t):n>.45?e[1](t):e[0](t)}return t})},e.helper.padEnd=function(t,e,n){"use strict";return e>>=0,n=String(n||" "),t.length>e?String(t):((e-=t.length)>n.length&&(n+=n.repeat(e/n.length)),String(t)+n.slice(0,e))},"undefined"==typeof console&&(console={warn:function(t){"use strict";alert(t)},log:function(t){"use strict";alert(t)},error:function(t){"use strict";throw t}}),e.helper.regexes={asteriskDashAndColon:/([*_:~])/g},e.helper.emojis={"+1":"","-1":"",100:"",1234:"","1st_place_medal":"","2nd_place_medal":"","3rd_place_medal":"","8ball":"",a:"",ab:"",abc:"",abcd:"",accept:"",aerial_tramway:"",airplane:"",alarm_clock:"",alembic:"",alien:"",ambulance:"",amphora:"",anchor:"",angel:"",anger:"",angry:"",anguished:"",ant:"",apple:"",aquarius:"",aries:"",arrow_backward:"",arrow_double_down:"",arrow_double_up:"",arrow_down:"",arrow_down_small:"",arrow_forward:"",arrow_heading_down:"",arrow_heading_up:"",arrow_left:"",arrow_lower_left:"",arrow_lower_right:"",arrow_right:"",arrow_right_hook:"",arrow_up:"",arrow_up_down:"",arrow_up_small:"",arrow_upper_left:"",arrow_upper_right:"",arrows_clockwise:"",arrows_counterclockwise:"",art:"",articulated_lorry:"",artificial_satellite:"",astonished:"",athletic_shoe:"",atm:"",atom_symbol:"",avocado:"",b:"",baby:"",baby_bottle:"",baby_chick:"",baby_symbol:"",back:"",bacon:"",badminton:"",baggage_claim:"",baguette_bread:"",balance_scale:"",balloon:"",ballot_box:"",ballot_box_with_check:"",bamboo:"",banana:"",bangbang:"",bank:"",bar_chart:"",barber:"",baseball:"",basketball:"",basketball_man:"",basketball_woman:"&zwj;",bat:"",bath:"",bathtub:"",battery:"",beach_umbrella:"",bear:"",bed:"",bee:"",beer:"",beers:"",beetle:"",beginner:"",bell:"",bellhop_bell:"",bento:"",biking_man:"",bike:"",biking_woman:"&zwj;",bikini:"",biohazard:"",bird:"",birthday:"",black_circle:"",black_flag:"",black_heart:"",black_joker:"",black_large_square:"",black_medium_small_square:"",black_medium_square:"",black_nib:"",black_small_square:"",black_square_button:"",blonde_man:"",blonde_woman:"&zwj;",blossom:"",blowfish:"",blue_book:"",blue_car:"",blue_heart:"",blush:"",boar:"",boat:"",bomb:"",book:"",bookmark:"",bookmark_tabs:"",books:"",boom:"",boot:"",bouquet:"",bowing_man:"",bow_and_arrow:"",bowing_woman:"&zwj;",bowling:"",boxing_glove:"",boy:"",bread:"",bride_with_veil:"",bridge_at_night:"",briefcase:"",broken_heart:"",bug:"",building_construction:"",bulb:"",bullettrain_front:"",bullettrain_side:"",burrito:"",bus:"",business_suit_levitating:"",busstop:"",bust_in_silhouette:"",busts_in_silhouette:"",butterfly:"",cactus:"",cake:"",calendar:"",call_me_hand:"",calling:"",camel:"",camera:"",camera_flash:"",camping:"",cancer:"",candle:"",candy:"",canoe:"",capital_abcd:"",capricorn:"",car:"",card_file_box:"",card_index:"",card_index_dividers:"",carousel_horse:"",carrot:"",cat:"",cat2:"",cd:"",chains:"",champagne:"",chart:"",chart_with_downwards_trend:"",chart_with_upwards_trend:"",checkered_flag:"",cheese:"",cherries:"",cherry_blossom:"",chestnut:"",chicken:"",children_crossing:"",chipmunk:"",chocolate_bar:"",christmas_tree:"",church:"",cinema:"",circus_tent:"",city_sunrise:"",city_sunset:"",cityscape:"",cl:"",clamp:"",clap:"",clapper:"",classical_building:"",clinking_glasses:"",clipboard:"",clock1:"",clock10:"",clock1030:"",clock11:"",clock1130:"",clock12:"",clock1230:"",clock130:"",clock2:"",clock230:"",clock3:"",clock330:"",clock4:"",clock430:"",clock5:"",clock530:"",clock6:"",clock630:"",clock7:"",clock730:"",clock8:"",clock830:"",clock9:"",clock930:"",closed_book:"",closed_lock_with_key:"",closed_umbrella:"",cloud:"",cloud_with_lightning:"",cloud_with_lightning_and_rain:"",cloud_with_rain:"",cloud_with_snow:"",clown_face:"",clubs:"",cocktail:"",coffee:"",coffin:"",cold_sweat:"",comet:"",computer:"",computer_mouse:"",confetti_ball:"",confounded:"",confused:"",congratulations:"",construction:"",construction_worker_man:"",construction_worker_woman:"&zwj;",control_knobs:"",convenience_store:"",cookie:"",cool:"",policeman:"",copyright:"",corn:"",couch_and_lamp:"",couple:"",couple_with_heart_woman_man:"",couple_with_heart_man_man:"&zwj;&zwj;",couple_with_heart_woman_woman:"&zwj;&zwj;",couplekiss_man_man:"&zwj;&zwj;&zwj;",couplekiss_man_woman:"",couplekiss_woman_woman:"&zwj;&zwj;&zwj;",cow:"",cow2:"",cowboy_hat_face:"",crab:"",crayon:"",credit_card:"",crescent_moon:"",cricket:"",crocodile:"",croissant:"",crossed_fingers:"",crossed_flags:"",crossed_swords:"",crown:"",cry:"",crying_cat_face:"",crystal_ball:"",cucumber:"",cupid:"",curly_loop:"",currency_exchange:"",curry:"",custard:"",customs:"",cyclone:"",dagger:"",dancer:"",dancing_women:"",dancing_men:"&zwj;",dango:"",dark_sunglasses:"",dart:"",dash:"",date:"",deciduous_tree:"",deer:"",department_store:"",derelict_house:"",desert:"",desert_island:"",desktop_computer:"",male_detective:"",diamond_shape_with_a_dot_inside:"",diamonds:"",disappointed:"",disappointed_relieved:"",dizzy:"",dizzy_face:"",do_not_litter:"",dog:"",dog2:"",dollar:"",dolls:"",dolphin:"",door:"",doughnut:"",dove:"",dragon:"",dragon_face:"",dress:"",dromedary_camel:"",drooling_face:"",droplet:"",drum:"",duck:"",dvd:"","e-mail":"",eagle:"",ear:"",ear_of_rice:"",earth_africa:"",earth_americas:"",earth_asia:"",egg:"",eggplant:"",eight_pointed_black_star:"",eight_spoked_asterisk:"",electric_plug:"",elephant:"",email:"",end:"",envelope_with_arrow:"",euro:"",european_castle:"",european_post_office:"",evergreen_tree:"",exclamation:"",expressionless:"",eye:"",eye_speech_bubble:"&zwj;",eyeglasses:"",eyes:"",face_with_head_bandage:"",face_with_thermometer:"",fist_oncoming:"",factory:"",fallen_leaf:"",family_man_woman_boy:"",family_man_boy:"&zwj;",family_man_boy_boy:"&zwj;&zwj;",family_man_girl:"&zwj;",family_man_girl_boy:"&zwj;&zwj;",family_man_girl_girl:"&zwj;&zwj;",family_man_man_boy:"&zwj;&zwj;",family_man_man_boy_boy:"&zwj;&zwj;&zwj;",family_man_man_girl:"&zwj;&zwj;",family_man_man_girl_boy:"&zwj;&zwj;&zwj;",family_man_man_girl_girl:"&zwj;&zwj;&zwj;",family_man_woman_boy_boy:"&zwj;&zwj;&zwj;",family_man_woman_girl:"&zwj;&zwj;",family_man_woman_girl_boy:"&zwj;&zwj;&zwj;",family_man_woman_girl_girl:"&zwj;&zwj;&zwj;",family_woman_boy:"&zwj;",family_woman_boy_boy:"&zwj;&zwj;",family_woman_girl:"&zwj;",family_woman_girl_boy:"&zwj;&zwj;",family_woman_girl_girl:"&zwj;&zwj;",family_woman_woman_boy:"&zwj;&zwj;",family_woman_woman_boy_boy:"&zwj;&zwj;&zwj;",family_woman_woman_girl:"&zwj;&zwj;",family_woman_woman_girl_boy:"&zwj;&zwj;&zwj;",family_woman_woman_girl_girl:"&zwj;&zwj;&zwj;",fast_forward:"",fax:"",fearful:"",feet:"",female_detective:"&zwj;",ferris_wheel:"",ferry:"",field_hockey:"",file_cabinet:"",file_folder:"",film_projector:"",film_strip:"",fire:"",fire_engine:"",fireworks:"",first_quarter_moon:"",first_quarter_moon_with_face:"",fish:"",fish_cake:"",fishing_pole_and_fish:"",fist_raised:"",fist_left:"",fist_right:"",flags:"",flashlight:"",fleur_de_lis:"",flight_arrival:"",flight_departure:"",floppy_disk:"",flower_playing_cards:"",flushed:"",fog:"",foggy:"",football:"",footprints:"",fork_and_knife:"",fountain:"",fountain_pen:"",four_leaf_clover:"",fox_face:"",framed_picture:"",free:"",fried_egg:"",fried_shrimp:"",fries:"",frog:"",frowning:"",frowning_face:"",frowning_man:"&zwj;",frowning_woman:"",middle_finger:"",fuelpump:"",full_moon:"",full_moon_with_face:"",funeral_urn:"",game_die:"",gear:"",gem:"",gemini:"",ghost:"",gift:"",gift_heart:"",girl:"",globe_with_meridians:"",goal_net:"",goat:"",golf:"",golfing_man:"",golfing_woman:"&zwj;",gorilla:"",grapes:"",green_apple:"",green_book:"",green_heart:"",green_salad:"",grey_exclamation:"",grey_question:"",grimacing:"",grin:"",grinning:"",guardsman:"",guardswoman:"&zwj;",guitar:"",gun:"",haircut_woman:"",haircut_man:"&zwj;",hamburger:"",hammer:"",hammer_and_pick:"",hammer_and_wrench:"",hamster:"",hand:"",handbag:"",handshake:"",hankey:"",hatched_chick:"",hatching_chick:"",headphones:"",hear_no_evil:"",heart:"",heart_decoration:"",heart_eyes:"",heart_eyes_cat:"",heartbeat:"",heartpulse:"",hearts:"",heavy_check_mark:"",heavy_division_sign:"",heavy_dollar_sign:"",heavy_heart_exclamation:"",heavy_minus_sign:"",heavy_multiplication_x:"",heavy_plus_sign:"",helicopter:"",herb:"",hibiscus:"",high_brightness:"",high_heel:"",hocho:"",hole:"",honey_pot:"",horse:"",horse_racing:"",hospital:"",hot_pepper:"",hotdog:"",hotel:"",hotsprings:"",hourglass:"",hourglass_flowing_sand:"",house:"",house_with_garden:"",houses:"",hugs:"",hushed:"",ice_cream:"",ice_hockey:"",ice_skate:"",icecream:"",id:"",ideograph_advantage:"",imp:"",inbox_tray:"",incoming_envelope:"",tipping_hand_woman:"",information_source:"",innocent:"",interrobang:"",iphone:"",izakaya_lantern:"",jack_o_lantern:"",japan:"",japanese_castle:"",japanese_goblin:"",japanese_ogre:"",jeans:"",joy:"",joy_cat:"",joystick:"",kaaba:"",key:"",keyboard:"",keycap_ten:"",kick_scooter:"",kimono:"",kiss:"",kissing:"",kissing_cat:"",kissing_closed_eyes:"",kissing_heart:"",kissing_smiling_eyes:"",kiwi_fruit:"",koala:"",koko:"",label:"",large_blue_circle:"",large_blue_diamond:"",large_orange_diamond:"",last_quarter_moon:"",last_quarter_moon_with_face:"",latin_cross:"",laughing:"",leaves:"",ledger:"",left_luggage:"",left_right_arrow:"",leftwards_arrow_with_hook:"",lemon:"",leo:"",leopard:"",level_slider:"",libra:"",light_rail:"",link:"",lion:"",lips:"",lipstick:"",lizard:"",lock:"",lock_with_ink_pen:"",lollipop:"",loop:"",loud_sound:"",loudspeaker:"",love_hotel:"",love_letter:"",low_brightness:"",lying_face:"",m:"",mag:"",mag_right:"",mahjong:"",mailbox:"",mailbox_closed:"",mailbox_with_mail:"",mailbox_with_no_mail:"",man:"",man_artist:"&zwj;",man_astronaut:"&zwj;",man_cartwheeling:"&zwj;",man_cook:"&zwj;",man_dancing:"",man_facepalming:"&zwj;",man_factory_worker:"&zwj;",man_farmer:"&zwj;",man_firefighter:"&zwj;",man_health_worker:"&zwj;",man_in_tuxedo:"",man_judge:"&zwj;",man_juggling:"&zwj;",man_mechanic:"&zwj;",man_office_worker:"&zwj;",man_pilot:"&zwj;",man_playing_handball:"&zwj;",man_playing_water_polo:"&zwj;",man_scientist:"&zwj;",man_shrugging:"&zwj;",man_singer:"&zwj;",man_student:"&zwj;",man_teacher:"&zwj;",man_technologist:"&zwj;",man_with_gua_pi_mao:"",man_with_turban:"",tangerine:"",mans_shoe:"",mantelpiece_clock:"",maple_leaf:"",martial_arts_uniform:"",mask:"",massage_woman:"",massage_man:"&zwj;",meat_on_bone:"",medal_military:"",medal_sports:"",mega:"",melon:"",memo:"",men_wrestling:"&zwj;",menorah:"",mens:"",metal:"",metro:"",microphone:"",microscope:"",milk_glass:"",milky_way:"",minibus:"",minidisc:"",mobile_phone_off:"",money_mouth_face:"",money_with_wings:"",moneybag:"",monkey:"",monkey_face:"",monorail:"",moon:"",mortar_board:"",mosque:"",motor_boat:"",motor_scooter:"",motorcycle:"",motorway:"",mount_fuji:"",mountain:"",mountain_biking_man:"",mountain_biking_woman:"&zwj;",mountain_cableway:"",mountain_railway:"",mountain_snow:"",mouse:"",mouse2:"",movie_camera:"",moyai:"",mrs_claus:"",muscle:"",mushroom:"",musical_keyboard:"",musical_note:"",musical_score:"",mute:"",nail_care:"",name_badge:"",national_park:"",nauseated_face:"",necktie:"",negative_squared_cross_mark:"",nerd_face:"",neutral_face:"",new:"",new_moon:"",new_moon_with_face:"",newspaper:"",newspaper_roll:"",next_track_button:"",ng:"",no_good_man:"&zwj;",no_good_woman:"",night_with_stars:"",no_bell:"",no_bicycles:"",no_entry:"",no_entry_sign:"",no_mobile_phones:"",no_mouth:"",no_pedestrians:"",no_smoking:"","non-potable_water":"",nose:"",notebook:"",notebook_with_decorative_cover:"",notes:"",nut_and_bolt:"",o:"",o2:"",ocean:"",octopus:"",oden:"",office:"",oil_drum:"",ok:"",ok_hand:"",ok_man:"&zwj;",ok_woman:"",old_key:"",older_man:"",older_woman:"",om:"",on:"",oncoming_automobile:"",oncoming_bus:"",oncoming_police_car:"",oncoming_taxi:"",open_file_folder:"",open_hands:"",open_mouth:"",open_umbrella:"",ophiuchus:"",orange_book:"",orthodox_cross:"",outbox_tray:"",owl:"",ox:"",package:"",page_facing_up:"",page_with_curl:"",pager:"",paintbrush:"",palm_tree:"",pancakes:"",panda_face:"",paperclip:"",paperclips:"",parasol_on_ground:"",parking:"",part_alternation_mark:"",partly_sunny:"",passenger_ship:"",passport_control:"",pause_button:"",peace_symbol:"",peach:"",peanuts:"",pear:"",pen:"",pencil2:"",penguin:"",pensive:"",performing_arts:"",persevere:"",person_fencing:"",pouting_woman:"",phone:"",pick:"",pig:"",pig2:"",pig_nose:"",pill:"",pineapple:"",ping_pong:"",pisces:"",pizza:"",place_of_worship:"",plate_with_cutlery:"",play_or_pause_button:"",point_down:"",point_left:"",point_right:"",point_up:"",point_up_2:"",police_car:"",policewoman:"&zwj;",poodle:"",popcorn:"",post_office:"",postal_horn:"",postbox:"",potable_water:"",potato:"",pouch:"",poultry_leg:"",pound:"",rage:"",pouting_cat:"",pouting_man:"&zwj;",pray:"",prayer_beads:"",pregnant_woman:"",previous_track_button:"",prince:"",princess:"",printer:"",purple_heart:"",purse:"",pushpin:"",put_litter_in_its_place:"",question:"",rabbit:"",rabbit2:"",racehorse:"",racing_car:"",radio:"",radio_button:"",radioactive:"",railway_car:"",railway_track:"",rainbow:"",rainbow_flag:"&zwj;",raised_back_of_hand:"",raised_hand_with_fingers_splayed:"",raised_hands:"",raising_hand_woman:"",raising_hand_man:"&zwj;",ram:"",ramen:"",rat:"",record_button:"",recycle:"",red_circle:"",registered:"",relaxed:"",relieved:"",reminder_ribbon:"",repeat:"",repeat_one:"",rescue_worker_helmet:"",restroom:"",revolving_hearts:"",rewind:"",rhinoceros:"",ribbon:"",rice:"",rice_ball:"",rice_cracker:"",rice_scene:"",right_anger_bubble:"",ring:"",robot:"",rocket:"",rofl:"",roll_eyes:"",roller_coaster:"",rooster:"",rose:"",rosette:"",rotating_light:"",round_pushpin:"",rowing_man:"",rowing_woman:"&zwj;",rugby_football:"",running_man:"",running_shirt_with_sash:"",running_woman:"&zwj;",sa:"",sagittarius:"",sake:"",sandal:"",santa:"",satellite:"",saxophone:"",school:"",school_satchel:"",scissors:"",scorpion:"",scorpius:"",scream:"",scream_cat:"",scroll:"",seat:"",secret:"",see_no_evil:"",seedling:"",selfie:"",shallow_pan_of_food:"",shamrock:"",shark:"",shaved_ice:"",sheep:"",shell:"",shield:"",shinto_shrine:"",ship:"",shirt:"",shopping:"",shopping_cart:"",shower:"",shrimp:"",signal_strength:"",six_pointed_star:"",ski:"",skier:"",skull:"",skull_and_crossbones:"",sleeping:"",sleeping_bed:"",sleepy:"",slightly_frowning_face:"",slightly_smiling_face:"",slot_machine:"",small_airplane:"",small_blue_diamond:"",small_orange_diamond:"",small_red_triangle:"",small_red_triangle_down:"",smile:"",smile_cat:"",smiley:"",smiley_cat:"",smiling_imp:"",smirk:"",smirk_cat:"",smoking:"",snail:"",snake:"",sneezing_face:"",snowboarder:"",snowflake:"",snowman:"",snowman_with_snow:"",sob:"",soccer:"",soon:"",sos:"",sound:"",space_invader:"",spades:"",spaghetti:"",sparkle:"",sparkler:"",sparkles:"",sparkling_heart:"",speak_no_evil:"",speaker:"",speaking_head:"",speech_balloon:"",speedboat:"",spider:"",spider_web:"",spiral_calendar:"",spiral_notepad:"",spoon:"",squid:"",stadium:"",star:"",star2:"",star_and_crescent:"",star_of_david:"",stars:"",station:"",statue_of_liberty:"",steam_locomotive:"",stew:"",stop_button:"",stop_sign:"",stopwatch:"",straight_ruler:"",strawberry:"",stuck_out_tongue:"",stuck_out_tongue_closed_eyes:"",stuck_out_tongue_winking_eye:"",studio_microphone:"",stuffed_flatbread:"",sun_behind_large_cloud:"",sun_behind_rain_cloud:"",sun_behind_small_cloud:"",sun_with_face:"",sunflower:"",sunglasses:"",sunny:"",sunrise:"",sunrise_over_mountains:"",surfing_man:"",surfing_woman:"&zwj;",sushi:"",suspension_railway:"",sweat:"",sweat_drops:"",sweat_smile:"",sweet_potato:"",swimming_man:"",swimming_woman:"&zwj;",symbols:"",synagogue:"",syringe:"",taco:"",tada:"",tanabata_tree:"",taurus:"",taxi:"",tea:"",telephone_receiver:"",telescope:"",tennis:"",tent:"",thermometer:"",thinking:"",thought_balloon:"",ticket:"",tickets:"",tiger:"",tiger2:"",timer_clock:"",tipping_hand_man:"&zwj;",tired_face:"",tm:"",toilet:"",tokyo_tower:"",tomato:"",tongue:"",top:"",tophat:"",tornado:"",trackball:"",tractor:"",traffic_light:"",train:"",train2:"",tram:"",triangular_flag_on_post:"",triangular_ruler:"",trident:"",triumph:"",trolleybus:"",trophy:"",tropical_drink:"",tropical_fish:"",truck:"",trumpet:"",tulip:"",tumbler_glass:"",turkey:"",turtle:"",tv:"",twisted_rightwards_arrows:"",two_hearts:"",two_men_holding_hands:"",two_women_holding_hands:"",u5272:"",u5408:"",u55b6:"",u6307:"",u6708:"",u6709:"",u6e80:"",u7121:"",u7533:"",u7981:"",u7a7a:"",umbrella:"",unamused:"",underage:"",unicorn:"",unlock:"",up:"",upside_down_face:"",v:"",vertical_traffic_light:"",vhs:"",vibration_mode:"",video_camera:"",video_game:"",violin:"",virgo:"",volcano:"",volleyball:"",vs:"",vulcan_salute:"",walking_man:"",walking_woman:"&zwj;",waning_crescent_moon:"",waning_gibbous_moon:"",warning:"",wastebasket:"",watch:"",water_buffalo:"",watermelon:"",wave:"",wavy_dash:"",waxing_crescent_moon:"",wc:"",weary:"",wedding:"",weight_lifting_man:"",weight_lifting_woman:"&zwj;",whale:"",whale2:"",wheel_of_dharma:"",wheelchair:"",white_check_mark:"",white_circle:"",white_flag:"",white_flower:"",white_large_square:"",white_medium_small_square:"",white_medium_square:"",white_small_square:"",white_square_button:"",wilted_flower:"",wind_chime:"",wind_face:"",wine_glass:"",wink:"",wolf:"",woman:"",woman_artist:"&zwj;",woman_astronaut:"&zwj;",woman_cartwheeling:"&zwj;",woman_cook:"&zwj;",woman_facepalming:"&zwj;",woman_factory_worker:"&zwj;",woman_farmer:"&zwj;",woman_firefighter:"&zwj;",woman_health_worker:"&zwj;",woman_judge:"&zwj;",woman_juggling:"&zwj;",woman_mechanic:"&zwj;",woman_office_worker:"&zwj;",woman_pilot:"&zwj;",woman_playing_handball:"&zwj;",woman_playing_water_polo:"&zwj;",woman_scientist:"&zwj;",woman_shrugging:"&zwj;",woman_singer:"&zwj;",woman_student:"&zwj;",woman_teacher:"&zwj;",woman_technologist:"&zwj;",woman_with_turban:"&zwj;",womans_clothes:"",womans_hat:"",women_wrestling:"&zwj;",womens:"",world_map:"",worried:"",wrench:"",writing_hand:"",x:"",yellow_heart:"",yen:"",yin_yang:"",yum:"",zap:"",zipper_mouth_face:"",zzz:"",octocat:'<img alt=":octocat:" height="20" width="20" align="absmiddle" src="https://assets-cdn.github.com/images/icons/emoji/octocat.png">',showdown:"<span style=\"font-family: 'Anonymous Pro', monospace; text-decoration: underline; text-decoration-style: dashed; text-decoration-color: #3e8b8a;text-underline-position: under;\">S</span>"},e.Converter=function(t){"use strict";var n={},c=[],l=[],u={},h=o,p={parsed:{},raw:"",format:""};function f(t,n){if(n=n||null,e.helper.isString(t)){if(n=t=e.helper.stdExtName(t),e.extensions[t])return console.warn("DEPRECATION WARNING: "+t+" is an old extension that uses a deprecated loading method.Please inform the developer that the extension should be updated!"),void function(t,n){"function"==typeof t&&(t=t(new e.Converter));e.helper.isArray(t)||(t=[t]);var r=a(t,n);if(!r.valid)throw Error(r.error);for(var i=0;i<t.length;++i)switch(t[i].type){case"lang":c.push(t[i]);break;case"output":l.push(t[i]);break;default:throw Error("Extension loader error: Type unrecognized!!!")}}(e.extensions[t],t);if(e.helper.isUndefined(r[t]))throw Error('Extension "'+t+'" could not be loaded. It was either not found or is not a valid extension.');t=r[t]}"function"==typeof t&&(t=t()),e.helper.isArray(t)||(t=[t]);var i=a(t,n);if(!i.valid)throw Error(i.error);for(var o=0;o<t.length;++o){switch(t[o].type){case"lang":c.push(t[o]);break;case"output":l.push(t[o])}if(t[o].hasOwnProperty("listeners"))for(var s in t[o].listeners)t[o].listeners.hasOwnProperty(s)&&d(s,t[o].listeners[s])}}function d(t,n){if(!e.helper.isString(t))throw Error("Invalid argument in converter.listen() method: name must be a string, but "+typeof t+" given");if("function"!=typeof n)throw Error("Invalid argument in converter.listen() method: callback must be a function, but "+typeof n+" given");u.hasOwnProperty(t)||(u[t]=[]),u[t].push(n)}!function(){for(var r in t=t||{},i)i.hasOwnProperty(r)&&(n[r]=i[r]);if("object"!=typeof t)throw Error("Converter expects the passed parameter to be an object, but "+typeof t+" was passed instead.");for(var o in t)t.hasOwnProperty(o)&&(n[o]=t[o]);n.extensions&&e.helper.forEach(n.extensions,f)}(),this._dispatch=function(t,e,n,r){if(u.hasOwnProperty(t))for(var i=0;i<u[t].length;++i){var o=u[t][i](t,e,this,n,r);o&&void 0!==o&&(e=o)}return e},this.listen=function(t,e){return d(t,e),this},this.makeHtml=function(t){if(!t)return t;var r={gHtmlBlocks:[],gHtmlMdBlocks:[],gHtmlSpans:[],gUrls:{},gTitles:{},gDimensions:{},gListLevel:0,hashLinkCounts:{},langExtensions:c,outputModifiers:l,converter:this,ghCodeBlocks:[],metadata:{parsed:{},raw:"",format:""}};return t=(t=(t=(t=(t=t.replace(//g,"T")).replace(/\$/g,"D")).replace(/\r\n/g,"\n")).replace(/\r/g,"\n")).replace(/\u00A0/g,"&nbsp;"),n.smartIndentationFix&&(t=function(t){var e=t.match(/^\s*/)[0].length,n=new RegExp("^\\s{0,"+e+"}","gm");return t.replace(n,"")}(t)),t="\n\n"+t+"\n\n",t=(t=e.subParser("detab")(t,n,r)).replace(/^[ \t]+$/gm,""),e.helper.forEach(c,function(i){t=e.subParser("runExtension")(i,t,n,r)}),t=e.subParser("metadata")(t,n,r),t=e.subParser("hashPreCodeTags")(t,n,r),t=e.subParser("githubCodeBlocks")(t,n,r),t=e.subParser("hashHTMLBlocks")(t,n,r),t=e.subParser("hashCodeTags")(t,n,r),t=e.subParser("stripLinkDefinitions")(t,n,r),t=e.subParser("blockGamut")(t,n,r),t=e.subParser("unhashHTMLSpans")(t,n,r),t=(t=(t=e.subParser("unescapeSpecialChars")(t,n,r)).replace(/D/g,"$$")).replace(/T/g,""),t=e.subParser("completeHTMLDocument")(t,n,r),e.helper.forEach(l,function(i){t=e.subParser("runExtension")(i,t,n,r)}),p=r.metadata,t},this.makeMarkdown=this.makeMd=function(t,n){if(t=(t=(t=t.replace(/\r\n/g,"\n")).replace(/\r/g,"\n")).replace(/>[ \t]+</,">NBSP;<"),!n){if(!window||!window.document)throw new Error("HTMLParser is undefined. If in a webworker or nodejs environment, you need to provide a WHATWG DOM and HTML such as JSDOM");n=window.document}var r=n.createElement("div");r.innerHTML=t;var i={preList:function(t){for(var n=t.querySelectorAll("pre"),r=[],i=0;i<n.length;++i)if(1===n[i].childElementCount&&"code"===n[i].firstChild.tagName.toLowerCase()){var o=n[i].firstChild.innerHTML.trim(),s=n[i].firstChild.getAttribute("data-language")||"";if(""===s)for(var a=n[i].firstChild.className.split(" "),c=0;c<a.length;++c){var l=a[c].match(/^language-(.+)$/);if(null!==l){s=l[1];break}}o=e.helper.unescapeHTMLEntities(o),r.push(o),n[i].outerHTML='<precode language="'+s+'" precodenum="'+i.toString()+'"></precode>'}else r.push(n[i].innerHTML),n[i].innerHTML="",n[i].setAttribute("prenum",i.toString());return r}(r)};!function t(e){for(var n=0;n<e.childNodes.length;++n){var r=e.childNodes[n];3===r.nodeType?/\S/.test(r.nodeValue)?(r.nodeValue=r.nodeValue.split("\n").join(" "),r.nodeValue=r.nodeValue.replace(/(\s)+/g,"$1")):(e.removeChild(r),--n):1===r.nodeType&&t(r)}}(r);for(var o=r.childNodes,s="",a=0;a<o.length;a++)s+=e.subParser("makeMarkdown.node")(o[a],i);return s},this.setOption=function(t,e){n[t]=e},this.getOption=function(t){return n[t]},this.getOptions=function(){return n},this.addExtension=function(t,e){f(t,e=e||null)},this.useExtension=function(t){f(t)},this.setFlavor=function(t){if(!s.hasOwnProperty(t))throw Error(t+" flavor was not found");var e=s[t];for(var r in h=t,e)e.hasOwnProperty(r)&&(n[r]=e[r])},this.getFlavor=function(){return h},this.removeExtension=function(t){e.helper.isArray(t)||(t=[t]);for(var n=0;n<t.length;++n){for(var r=t[n],i=0;i<c.length;++i)c[i]===r&&c[i].splice(i,1);for(;0<l.length;++i)l[0]===r&&l[0].splice(i,1)}},this.getAllExtensions=function(){return{language:c,output:l}},this.getMetadata=function(t){return t?p.raw:p.parsed},this.getMetadataFormat=function(){return p.format},this._setMetadataPair=function(t,e){p.parsed[t]=e},this._setMetadataFormat=function(t){p.format=t},this._setMetadataRaw=function(t){p.raw=t}},e.subParser("anchors",function(t,n,r){"use strict";var i=function(t,i,o,s,a,c,l){if(e.helper.isUndefined(l)&&(l=""),o=o.toLowerCase(),t.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)s="";else if(!s){if(o||(o=i.toLowerCase().replace(/ ?\n/g," ")),s="#"+o,e.helper.isUndefined(r.gUrls[o]))return t;s=r.gUrls[o],e.helper.isUndefined(r.gTitles[o])||(l=r.gTitles[o])}var u='<a href="'+(s=s.replace(e.helper.regexes.asteriskDashAndColon,e.helper.escapeCharactersCallback))+'"';return""!==l&&null!==l&&(u+=' title="'+(l=(l=l.replace(/"/g,"&quot;")).replace(e.helper.regexes.asteriskDashAndColon,e.helper.escapeCharactersCallback))+'"'),n.openLinksInNewWindow&&!/^#/.test(s)&&(u+=' rel="noopener noreferrer" target="E95Eblank"'),u+=">"+i+"</a>"};return t=(t=(t=(t=(t=r.converter._dispatch("anchors.before",t,n,r)).replace(/\[((?:\[[^\]]*]|[^\[\]])*)] ?(?:\n *)?\[(.*?)]()()()()/g,i)).replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<([^>]*)>(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,i)).replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,i)).replace(/\[([^\[\]]+)]()()()()()/g,i),n.ghMentions&&(t=t.replace(/(^|\s)(\\)?(@([a-z\d]+(?:[a-z\d.-]+?[a-z\d]+)*))/gim,function(t,r,i,o,s){if("\\"===i)return r+o;if(!e.helper.isString(n.ghMentionsLink))throw new Error("ghMentionsLink option must be a string");var a=n.ghMentionsLink.replace(/\{u}/g,s),c="";return n.openLinksInNewWindow&&(c=' rel="noopener noreferrer" target="E95Eblank"'),r+'<a href="'+a+'"'+c+">"+o+"</a>"})),t=r.converter._dispatch("anchors.after",t,n,r)});var u=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+?\.[^'">\s]+?)()(\1)?(?=\s|$)(?!["<>])/gi,h=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+\.[^'">\s]+?)([.!?,()\[\]])?(\1)?(?=\s|$)(?!["<>])/gi,p=/()<(((https?|ftp|dict):\/\/|www\.)[^'">\s]+)()>()/gi,f=/(^|\s)(?:mailto:)?([A-Za-z0-9!#$%&'*+-/=?^_`{|}~.]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)(?=$|\s)/gim,d=/<()(?:mailto:)?([-.\w]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,m=function(t){"use strict";return function(n,r,i,o,s,a,c){var l=i=i.replace(e.helper.regexes.asteriskDashAndColon,e.helper.escapeCharactersCallback),u="",h="",p=r||"",f=c||"";return/^www\./i.test(i)&&(i=i.replace(/^www\./i,"http://www.")),t.excludeTrailingPunctuationFromURLs&&a&&(u=a),t.openLinksInNewWindow&&(h=' rel="noopener noreferrer" target="E95Eblank"'),p+'<a href="'+i+'"'+h+">"+l+"</a>"+u+f}},_=function(t,n){"use strict";return function(r,i,o){var s="mailto:";return i=i||"",o=e.subParser("unescapeSpecialChars")(o,t,n),t.encodeEmails?(s=e.helper.encodeEmailAddress(s+o),o=e.helper.encodeEmailAddress(o)):s+=o,i+'<a href="'+s+'">'+o+"</a>"}};e.subParser("autoLinks",function(t,e,n){"use strict";return t=(t=(t=n.converter._dispatch("autoLinks.before",t,e,n)).replace(p,m(e))).replace(d,_(e,n)),t=n.converter._dispatch("autoLinks.after",t,e,n)}),e.subParser("simplifiedAutoLinks",function(t,e,n){"use strict";return e.simplifiedAutoLink?(t=n.converter._dispatch("simplifiedAutoLinks.before",t,e,n),t=(t=e.excludeTrailingPunctuationFromURLs?t.replace(h,m(e)):t.replace(u,m(e))).replace(f,_(e,n)),t=n.converter._dispatch("simplifiedAutoLinks.after",t,e,n)):t}),e.subParser("blockGamut",function(t,n,r){"use strict";return t=r.converter._dispatch("blockGamut.before",t,n,r),t=e.subParser("blockQuotes")(t,n,r),t=e.subParser("headers")(t,n,r),t=e.subParser("horizontalRule")(t,n,r),t=e.subParser("lists")(t,n,r),t=e.subParser("codeBlocks")(t,n,r),t=e.subParser("tables")(t,n,r),t=e.subParser("hashHTMLBlocks")(t,n,r),t=e.subParser("paragraphs")(t,n,r),t=r.converter._dispatch("blockGamut.after",t,n,r)}),e.subParser("blockQuotes",function(t,n,r){"use strict";t=r.converter._dispatch("blockQuotes.before",t,n,r),t+="\n\n";var i=/(^ {0,3}>[ \t]?.+\n(.+\n)*\n*)+/gm;return n.splitAdjacentBlockquotes&&(i=/^ {0,3}>[\s\S]*?(?:\n\n)/gm),t=t.replace(i,function(t){return t=(t=(t=t.replace(/^[ \t]*>[ \t]?/gm,"")).replace(/0/g,"")).replace(/^[ \t]+$/gm,""),t=e.subParser("githubCodeBlocks")(t,n,r),t=(t=(t=e.subParser("blockGamut")(t,n,r)).replace(/(^|\n)/g,"$1  ")).replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(t,e){var n=e;return n=(n=n.replace(/^  /gm,"0")).replace(/0/g,"")}),e.subParser("hashBlock")("<blockquote>\n"+t+"\n</blockquote>",n,r)}),t=r.converter._dispatch("blockQuotes.after",t,n,r)}),e.subParser("codeBlocks",function(t,n,r){"use strict";t=r.converter._dispatch("codeBlocks.before",t,n,r);return t=(t=(t+="0").replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=0))/g,function(t,i,o){var s=i,a=o,c="\n";return s=e.subParser("outdent")(s,n,r),s=e.subParser("encodeCode")(s,n,r),s=(s=(s=e.subParser("detab")(s,n,r)).replace(/^\n+/g,"")).replace(/\n+$/g,""),n.omitExtraWLInCodeBlocks&&(c=""),s="<pre><code>"+s+c+"</code></pre>",e.subParser("hashBlock")(s,n,r)+a})).replace(/0/,""),t=r.converter._dispatch("codeBlocks.after",t,n,r)}),e.subParser("codeSpans",function(t,n,r){"use strict";return void 0===(t=r.converter._dispatch("codeSpans.before",t,n,r))&&(t=""),t=t.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(t,i,o,s){var a=s;return a=(a=a.replace(/^([ \t]*)/g,"")).replace(/[ \t]*$/g,""),a=i+"<code>"+(a=e.subParser("encodeCode")(a,n,r))+"</code>",a=e.subParser("hashHTMLSpans")(a,n,r)}),t=r.converter._dispatch("codeSpans.after",t,n,r)}),e.subParser("completeHTMLDocument",function(t,e,n){"use strict";if(!e.completeHTMLDocument)return t;t=n.converter._dispatch("completeHTMLDocument.before",t,e,n);var r="html",i="<!DOCTYPE HTML>\n",o="",s='<meta charset="utf-8">\n',a="",c="";for(var l in void 0!==n.metadata.parsed.doctype&&(i="<!DOCTYPE "+n.metadata.parsed.doctype+">\n","html"!==(r=n.metadata.parsed.doctype.toString().toLowerCase())&&"html5"!==r||(s='<meta charset="utf-8">')),n.metadata.parsed)if(n.metadata.parsed.hasOwnProperty(l))switch(l.toLowerCase()){case"doctype":break;case"title":o="<title>"+n.metadata.parsed.title+"</title>\n";break;case"charset":s="html"===r||"html5"===r?'<meta charset="'+n.metadata.parsed.charset+'">\n':'<meta name="charset" content="'+n.metadata.parsed.charset+'">\n';break;case"language":case"lang":a=' lang="'+n.metadata.parsed[l]+'"',c+='<meta name="'+l+'" content="'+n.metadata.parsed[l]+'">\n';break;default:c+='<meta name="'+l+'" content="'+n.metadata.parsed[l]+'">\n'}return t=i+"<html"+a+">\n<head>\n"+o+s+c+"</head>\n<body>\n"+t.trim()+"\n</body>\n</html>",t=n.converter._dispatch("completeHTMLDocument.after",t,e,n)}),e.subParser("detab",function(t,e,n){"use strict";return t=(t=(t=(t=(t=(t=n.converter._dispatch("detab.before",t,e,n)).replace(/\t(?=\t)/g,"    ")).replace(/\t/g,"AB")).replace(/B(.+?)A/g,function(t,e){for(var n=e,r=4-n.length%4,i=0;i<r;i++)n+=" ";return n})).replace(/A/g,"    ")).replace(/B/g,""),t=n.converter._dispatch("detab.after",t,e,n)}),e.subParser("ellipsis",function(t,e,n){"use strict";return t=(t=n.converter._dispatch("ellipsis.before",t,e,n)).replace(/\.\.\./g,""),t=n.converter._dispatch("ellipsis.after",t,e,n)}),e.subParser("emoji",function(t,n,r){"use strict";if(!n.emoji)return t;return t=(t=r.converter._dispatch("emoji.before",t,n,r)).replace(/:([\S]+?):/g,function(t,n){return e.helper.emojis.hasOwnProperty(n)?e.helper.emojis[n]:t}),t=r.converter._dispatch("emoji.after",t,n,r)}),e.subParser("encodeAmpsAndAngles",function(t,e,n){"use strict";return t=(t=(t=(t=(t=n.converter._dispatch("encodeAmpsAndAngles.before",t,e,n)).replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;")).replace(/<(?![a-z\/?$!])/gi,"&lt;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;"),t=n.converter._dispatch("encodeAmpsAndAngles.after",t,e,n)}),e.subParser("encodeBackslashEscapes",function(t,n,r){"use strict";return t=(t=(t=r.converter._dispatch("encodeBackslashEscapes.before",t,n,r)).replace(/\\(\\)/g,e.helper.escapeCharactersCallback)).replace(/\\([`*_{}\[\]()>#+.!~=|-])/g,e.helper.escapeCharactersCallback),t=r.converter._dispatch("encodeBackslashEscapes.after",t,n,r)}),e.subParser("encodeCode",function(t,n,r){"use strict";return t=(t=r.converter._dispatch("encodeCode.before",t,n,r)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/([*_{}\[\]\\=~-])/g,e.helper.escapeCharactersCallback),t=r.converter._dispatch("encodeCode.after",t,n,r)}),e.subParser("escapeSpecialCharsWithinTagAttributes",function(t,n,r){"use strict";return t=(t=(t=r.converter._dispatch("escapeSpecialCharsWithinTagAttributes.before",t,n,r)).replace(/<\/?[a-z\d_:-]+(?:[\s]+[\s\S]+?)?>/gi,function(t){return t.replace(/(.)<\/?code>(?=.)/g,"$1`").replace(/([\\`*_~=|])/g,e.helper.escapeCharactersCallback)})).replace(/<!(--(?:(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>/gi,function(t){return t.replace(/([\\`*_~=|])/g,e.helper.escapeCharactersCallback)}),t=r.converter._dispatch("escapeSpecialCharsWithinTagAttributes.after",t,n,r)}),e.subParser("githubCodeBlocks",function(t,n,r){"use strict";return n.ghCodeBlocks?(t=r.converter._dispatch("githubCodeBlocks.before",t,n,r),t=(t=(t+="0").replace(/(?:^|\n)(?: {0,3})(```+|~~~+)(?: *)([^\s`~]*)\n([\s\S]*?)\n(?: {0,3})\1/g,function(t,i,o,s){var a=n.omitExtraWLInCodeBlocks?"":"\n";return s=e.subParser("encodeCode")(s,n,r),s="<pre><code"+(o?' class="'+o+" language-"+o+'"':"")+">"+(s=(s=(s=e.subParser("detab")(s,n,r)).replace(/^\n+/g,"")).replace(/\n+$/g,""))+a+"</code></pre>",s=e.subParser("hashBlock")(s,n,r),"\n\nG"+(r.ghCodeBlocks.push({text:t,codeblock:s})-1)+"G\n\n"})).replace(/0/,""),r.converter._dispatch("githubCodeBlocks.after",t,n,r)):t}),e.subParser("hashBlock",function(t,e,n){"use strict";return t=(t=n.converter._dispatch("hashBlock.before",t,e,n)).replace(/(^\n+|\n+$)/g,""),t="\n\nK"+(n.gHtmlBlocks.push(t)-1)+"K\n\n",t=n.converter._dispatch("hashBlock.after",t,e,n)}),e.subParser("hashCodeTags",function(t,n,r){"use strict";t=r.converter._dispatch("hashCodeTags.before",t,n,r);return t=e.helper.replaceRecursiveRegExp(t,function(t,i,o,s){var a=o+e.subParser("encodeCode")(i,n,r)+s;return"C"+(r.gHtmlSpans.push(a)-1)+"C"},"<code\\b[^>]*>","</code>","gim"),t=r.converter._dispatch("hashCodeTags.after",t,n,r)}),e.subParser("hashElement",function(t,e,n){"use strict";return function(t,e){var r=e;return r=(r=(r=r.replace(/\n\n/g,"\n")).replace(/^\n/,"")).replace(/\n+$/g,""),r="\n\nK"+(n.gHtmlBlocks.push(r)-1)+"K\n\n"}}),e.subParser("hashHTMLBlocks",function(t,n,r){"use strict";t=r.converter._dispatch("hashHTMLBlocks.before",t,n,r);var i=["pre","div","h1","h2","h3","h4","h5","h6","blockquote","table","dl","ol","ul","script","noscript","form","fieldset","iframe","math","style","section","header","footer","nav","article","aside","address","audio","canvas","figure","hgroup","output","video","p"],o=function(t,e,n,i){var o=t;return-1!==n.search(/\bmarkdown\b/)&&(o=n+r.converter.makeHtml(e)+i),"\n\nK"+(r.gHtmlBlocks.push(o)-1)+"K\n\n"};n.backslashEscapesHTMLTags&&(t=t.replace(/\\<(\/?[^>]+?)>/g,function(t,e){return"&lt;"+e+"&gt;"}));for(var s=0;s<i.length;++s)for(var a,c=new RegExp("^ {0,3}(<"+i[s]+"\\b[^>]*>)","im"),l="<"+i[s]+"\\b[^>]*>",u="</"+i[s]+">";-1!==(a=e.helper.regexIndexOf(t,c));){var h=e.helper.splitAtIndex(t,a),p=e.helper.replaceRecursiveRegExp(h[1],o,l,u,"im");if(p===h[1])break;t=h[0].concat(p)}return t=t.replace(/(\n {0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,e.subParser("hashElement")(t,n,r)),t=(t=e.helper.replaceRecursiveRegExp(t,function(t){return"\n\nK"+(r.gHtmlBlocks.push(t)-1)+"K\n\n"},"^ {0,3}\x3c!--","--\x3e","gm")).replace(/(?:\n\n)( {0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,e.subParser("hashElement")(t,n,r)),t=r.converter._dispatch("hashHTMLBlocks.after",t,n,r)}),e.subParser("hashHTMLSpans",function(t,e,n){"use strict";function r(t){return"C"+(n.gHtmlSpans.push(t)-1)+"C"}return t=(t=(t=(t=(t=n.converter._dispatch("hashHTMLSpans.before",t,e,n)).replace(/<[^>]+?\/>/gi,function(t){return r(t)})).replace(/<([^>]+?)>[\s\S]*?<\/\1>/g,function(t){return r(t)})).replace(/<([^>]+?)\s[^>]+?>[\s\S]*?<\/\1>/g,function(t){return r(t)})).replace(/<[^>]+?>/gi,function(t){return r(t)}),t=n.converter._dispatch("hashHTMLSpans.after",t,e,n)}),e.subParser("unhashHTMLSpans",function(t,e,n){"use strict";t=n.converter._dispatch("unhashHTMLSpans.before",t,e,n);for(var r=0;r<n.gHtmlSpans.length;++r){for(var i=n.gHtmlSpans[r],o=0;/C(\d+)C/.test(i);){var s=RegExp.$1;if(i=i.replace("C"+s+"C",n.gHtmlSpans[s]),10===o){console.error("maximum nesting of 10 spans reached!!!");break}++o}t=t.replace("C"+r+"C",i)}return t=n.converter._dispatch("unhashHTMLSpans.after",t,e,n)}),e.subParser("hashPreCodeTags",function(t,n,r){"use strict";t=r.converter._dispatch("hashPreCodeTags.before",t,n,r);return t=e.helper.replaceRecursiveRegExp(t,function(t,i,o,s){var a=o+e.subParser("encodeCode")(i,n,r)+s;return"\n\nG"+(r.ghCodeBlocks.push({text:t,codeblock:a})-1)+"G\n\n"},"^ {0,3}<pre\\b[^>]*>\\s*<code\\b[^>]*>","^ {0,3}</code>\\s*</pre>","gim"),t=r.converter._dispatch("hashPreCodeTags.after",t,n,r)}),e.subParser("headers",function(t,n,r){"use strict";t=r.converter._dispatch("headers.before",t,n,r);var i=isNaN(parseInt(n.headerLevelStart))?1:parseInt(n.headerLevelStart),o=n.smoothLivePreview?/^(.+)[ \t]*\n={2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n=+[ \t]*\n+/gm,s=n.smoothLivePreview?/^(.+)[ \t]*\n-{2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n-+[ \t]*\n+/gm;t=(t=t.replace(o,function(t,o){var s=e.subParser("spanGamut")(o,n,r),a=n.noHeaderId?"":' id="'+c(o)+'"',l="<h"+i+a+">"+s+"</h"+i+">";return e.subParser("hashBlock")(l,n,r)})).replace(s,function(t,o){var s=e.subParser("spanGamut")(o,n,r),a=n.noHeaderId?"":' id="'+c(o)+'"',l=i+1,u="<h"+l+a+">"+s+"</h"+l+">";return e.subParser("hashBlock")(u,n,r)});var a=n.requireSpaceBeforeHeadingText?/^(#{1,6})[ \t]+(.+?)[ \t]*#*\n+/gm:/^(#{1,6})[ \t]*(.+?)[ \t]*#*\n+/gm;function c(t){var i,o;if(n.customizedHeaderId){var s=t.match(/\{([^{]+?)}\s*$/);s&&s[1]&&(t=s[1])}return i=t,o=e.helper.isString(n.prefixHeaderId)?n.prefixHeaderId:!0===n.prefixHeaderId?"section-":"",n.rawPrefixHeaderId||(i=o+i),i=n.ghCompatibleHeaderId?i.replace(/ /g,"-").replace(/&amp;/g,"").replace(/T/g,"").replace(/D/g,"").replace(/[&+$,\/:;=?@"#{}|^~\[\]`\\*)(%.!'<>]/g,"").toLowerCase():n.rawHeaderId?i.replace(/ /g,"-").replace(/&amp;/g,"&").replace(/T/g,"").replace(/D/g,"$").replace(/["']/g,"-").toLowerCase():i.replace(/[^\w]/g,"").toLowerCase(),n.rawPrefixHeaderId&&(i=o+i),r.hashLinkCounts[i]?i=i+"-"+r.hashLinkCounts[i]++:r.hashLinkCounts[i]=1,i}return t=t.replace(a,function(t,o,s){var a=s;n.customizedHeaderId&&(a=s.replace(/\s?\{([^{]+?)}\s*$/,""));var l=e.subParser("spanGamut")(a,n,r),u=n.noHeaderId?"":' id="'+c(s)+'"',h=i-1+o.length,p="<h"+h+u+">"+l+"</h"+h+">";return e.subParser("hashBlock")(p,n,r)}),t=r.converter._dispatch("headers.after",t,n,r)}),e.subParser("horizontalRule",function(t,n,r){"use strict";t=r.converter._dispatch("horizontalRule.before",t,n,r);var i=e.subParser("hashBlock")("<hr />",n,r);return t=(t=(t=t.replace(/^ {0,2}( ?-){3,}[ \t]*$/gm,i)).replace(/^ {0,2}( ?\*){3,}[ \t]*$/gm,i)).replace(/^ {0,2}( ?_){3,}[ \t]*$/gm,i),t=r.converter._dispatch("horizontalRule.after",t,n,r)}),e.subParser("images",function(t,n,r){"use strict";function i(t,n,i,o,s,a,c,l){var u=r.gUrls,h=r.gTitles,p=r.gDimensions;if(i=i.toLowerCase(),l||(l=""),t.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)o="";else if(""===o||null===o){if(""!==i&&null!==i||(i=n.toLowerCase().replace(/ ?\n/g," ")),o="#"+i,e.helper.isUndefined(u[i]))return t;o=u[i],e.helper.isUndefined(h[i])||(l=h[i]),e.helper.isUndefined(p[i])||(s=p[i].width,a=p[i].height)}n=n.replace(/"/g,"&quot;").replace(e.helper.regexes.asteriskDashAndColon,e.helper.escapeCharactersCallback);var f='<img src="'+(o=o.replace(e.helper.regexes.asteriskDashAndColon,e.helper.escapeCharactersCallback))+'" alt="'+n+'"';return l&&e.helper.isString(l)&&(f+=' title="'+(l=l.replace(/"/g,"&quot;").replace(e.helper.regexes.asteriskDashAndColon,e.helper.escapeCharactersCallback))+'"'),s&&a&&(f+=' width="'+(s="*"===s?"auto":s)+'"',f+=' height="'+(a="*"===a?"auto":a)+'"'),f+=" />"}return t=(t=(t=(t=(t=(t=r.converter._dispatch("images.before",t,n,r)).replace(/!\[([^\]]*?)] ?(?:\n *)?\[([\s\S]*?)]()()()()()/g,i)).replace(/!\[([^\]]*?)][ \t]*()\([ \t]?<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,function(t,e,n,r,o,s,a,c){return i(t,e,n,r=r.replace(/\s/g,""),o,s,0,c)})).replace(/!\[([^\]]*?)][ \t]*()\([ \t]?<([^>]*)>(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(?:(["'])([^"]*?)\6))?[ \t]?\)/g,i)).replace(/!\[([^\]]*?)][ \t]*()\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,i)).replace(/!\[([^\[\]]+)]()()()()()/g,i),t=r.converter._dispatch("images.after",t,n,r)}),e.subParser("italicsAndBold",function(t,e,n){"use strict";function r(t,e,n){return e+t+n}return t=n.converter._dispatch("italicsAndBold.before",t,e,n),t=e.literalMidWordUnderscores?(t=(t=t.replace(/\b___(\S[\s\S]*?)___\b/g,function(t,e){return r(e,"<strong><em>","</em></strong>")})).replace(/\b__(\S[\s\S]*?)__\b/g,function(t,e){return r(e,"<strong>","</strong>")})).replace(/\b_(\S[\s\S]*?)_\b/g,function(t,e){return r(e,"<em>","</em>")}):(t=(t=t.replace(/___(\S[\s\S]*?)___/g,function(t,e){return/\S$/.test(e)?r(e,"<strong><em>","</em></strong>"):t})).replace(/__(\S[\s\S]*?)__/g,function(t,e){return/\S$/.test(e)?r(e,"<strong>","</strong>"):t})).replace(/_([^\s_][\s\S]*?)_/g,function(t,e){return/\S$/.test(e)?r(e,"<em>","</em>"):t}),t=e.literalMidWordAsterisks?(t=(t=t.replace(/([^*]|^)\B\*\*\*(\S[\s\S]*?)\*\*\*\B(?!\*)/g,function(t,e,n){return r(n,e+"<strong><em>","</em></strong>")})).replace(/([^*]|^)\B\*\*(\S[\s\S]*?)\*\*\B(?!\*)/g,function(t,e,n){return r(n,e+"<strong>","</strong>")})).replace(/([^*]|^)\B\*(\S[\s\S]*?)\*\B(?!\*)/g,function(t,e,n){return r(n,e+"<em>","</em>")}):(t=(t=t.replace(/\*\*\*(\S[\s\S]*?)\*\*\*/g,function(t,e){return/\S$/.test(e)?r(e,"<strong><em>","</em></strong>"):t})).replace(/\*\*(\S[\s\S]*?)\*\*/g,function(t,e){return/\S$/.test(e)?r(e,"<strong>","</strong>"):t})).replace(/\*([^\s*][\s\S]*?)\*/g,function(t,e){return/\S$/.test(e)?r(e,"<em>","</em>"):t}),t=n.converter._dispatch("italicsAndBold.after",t,e,n)}),e.subParser("lists",function(t,n,r){"use strict";function i(t,i){r.gListLevel++,t=t.replace(/\n{2,}$/,"\n");var o=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(0| {0,3}([*+-]|\d+[.])[ \t]+))/gm,s=/\n[ \t]*\n(?!0)/.test(t+="0");return n.disableForced4SpacesIndentedSublists&&(o=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(0|\2([*+-]|\d+[.])[ \t]+))/gm),t=(t=t.replace(o,function(t,i,o,a,c,l,u){u=u&&""!==u.trim();var h=e.subParser("outdent")(c,n,r),p="";return l&&n.tasklists&&(p=' class="task-list-item" style="list-style-type: none;"',h=h.replace(/^[ \t]*\[(x|X| )?]/m,function(){var t='<input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"';return u&&(t+=" checked"),t+=">"})),h=h.replace(/^([-*+]|\d\.)[ \t]+[\S\n ]*/g,function(t){return"A"+t}),i||h.search(/\n{2,}/)>-1?(h=e.subParser("githubCodeBlocks")(h,n,r),h=e.subParser("blockGamut")(h,n,r)):(h=(h=e.subParser("lists")(h,n,r)).replace(/\n$/,""),h=(h=e.subParser("hashHTMLBlocks")(h,n,r)).replace(/\n\n+/g,"\n\n"),h=s?e.subParser("paragraphs")(h,n,r):e.subParser("spanGamut")(h,n,r)),h="<li"+p+">"+(h=h.replace("A",""))+"</li>\n"})).replace(/0/g,""),r.gListLevel--,i&&(t=t.replace(/\s+$/,"")),t}function o(t,e){if("ol"===e){var n=t.match(/^ *(\d+)\./);if(n&&"1"!==n[1])return' start="'+n[1]+'"'}return""}function s(t,e,r){var s=n.disableForced4SpacesIndentedSublists?/^ ?\d+\.[ \t]/gm:/^ {0,3}\d+\.[ \t]/gm,a=n.disableForced4SpacesIndentedSublists?/^ ?[*+-][ \t]/gm:/^ {0,3}[*+-][ \t]/gm,c="ul"===e?s:a,l="";if(-1!==t.search(c))!function n(u){var h=u.search(c),p=o(t,e);-1!==h?(l+="\n\n<"+e+p+">\n"+i(u.slice(0,h),!!r)+"</"+e+">\n",c="ul"===(e="ul"===e?"ol":"ul")?s:a,n(u.slice(h))):l+="\n\n<"+e+p+">\n"+i(u,!!r)+"</"+e+">\n"}(t);else{var u=o(t,e);l="\n\n<"+e+u+">\n"+i(t,!!r)+"</"+e+">\n"}return l}return t=r.converter._dispatch("lists.before",t,n,r),t+="0",t=(t=r.gListLevel?t.replace(/^(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,function(t,e,n){return s(e,n.search(/[*+-]/g)>-1?"ul":"ol",!0)}):t.replace(/(\n\n|^\n?)(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,function(t,e,n,r){return s(n,r.search(/[*+-]/g)>-1?"ul":"ol",!1)})).replace(/0/,""),t=r.converter._dispatch("lists.after",t,n,r)}),e.subParser("metadata",function(t,e,n){"use strict";if(!e.metadata)return t;function r(t){n.metadata.raw=t,(t=(t=t.replace(/&/g,"&amp;").replace(/"/g,"&quot;")).replace(/\n {4}/g," ")).replace(/^([\S ]+): +([\s\S]+?)$/gm,function(t,e,r){return n.metadata.parsed[e]=r,""})}return t=(t=(t=(t=n.converter._dispatch("metadata.before",t,e,n)).replace(/^\s*+(\S*?)\n([\s\S]+?)\n+\n/,function(t,e,n){return r(n),"M"})).replace(/^\s*---+(\S*?)\n([\s\S]+?)\n---+\n/,function(t,e,i){return e&&(n.metadata.format=e),r(i),"M"})).replace(/M/g,""),t=n.converter._dispatch("metadata.after",t,e,n)}),e.subParser("outdent",function(t,e,n){"use strict";return t=(t=(t=n.converter._dispatch("outdent.before",t,e,n)).replace(/^(\t|[ ]{1,4})/gm,"0")).replace(/0/g,""),t=n.converter._dispatch("outdent.after",t,e,n)}),e.subParser("paragraphs",function(t,n,r){"use strict";for(var i=(t=(t=(t=r.converter._dispatch("paragraphs.before",t,n,r)).replace(/^\n+/g,"")).replace(/\n+$/g,"")).split(/\n{2,}/g),o=[],s=i.length,a=0;a<s;a++){var c=i[a];c.search(/(K|G)(\d+)\1/g)>=0?o.push(c):c.search(/\S/)>=0&&(c=(c=e.subParser("spanGamut")(c,n,r)).replace(/^([ \t]*)/g,"<p>"),c+="</p>",o.push(c))}for(s=o.length,a=0;a<s;a++){for(var l="",u=o[a],h=!1;/(K|G)(\d+)\1/.test(u);){var p=RegExp.$1,f=RegExp.$2;l=(l="K"===p?r.gHtmlBlocks[f]:h?e.subParser("encodeCode")(r.ghCodeBlocks[f].text,n,r):r.ghCodeBlocks[f].codeblock).replace(/\$/g,"$$$$"),u=u.replace(/(\n\n)?(K|G)\d+\2(\n\n)?/,l),/^<pre\b[^>]*>\s*<code\b[^>]*>/.test(u)&&(h=!0)}o[a]=u}return t=(t=(t=o.join("\n")).replace(/^\n+/g,"")).replace(/\n+$/g,""),r.converter._dispatch("paragraphs.after",t,n,r)}),e.subParser("runExtension",function(t,e,n,r){"use strict";if(t.filter)e=t.filter(e,r.converter,n);else if(t.regex){var i=t.regex;i instanceof RegExp||(i=new RegExp(i,"g")),e=e.replace(i,t.replace)}return e}),e.subParser("spanGamut",function(t,n,r){"use strict";return t=r.converter._dispatch("spanGamut.before",t,n,r),t=e.subParser("codeSpans")(t,n,r),t=e.subParser("escapeSpecialCharsWithinTagAttributes")(t,n,r),t=e.subParser("encodeBackslashEscapes")(t,n,r),t=e.subParser("images")(t,n,r),t=e.subParser("anchors")(t,n,r),t=e.subParser("autoLinks")(t,n,r),t=e.subParser("simplifiedAutoLinks")(t,n,r),t=e.subParser("emoji")(t,n,r),t=e.subParser("underline")(t,n,r),t=e.subParser("italicsAndBold")(t,n,r),t=e.subParser("strikethrough")(t,n,r),t=e.subParser("ellipsis")(t,n,r),t=e.subParser("hashHTMLSpans")(t,n,r),t=e.subParser("encodeAmpsAndAngles")(t,n,r),n.simpleLineBreaks?/\n\nK/.test(t)||(t=t.replace(/\n+/g,"<br />\n")):t=t.replace(/  +\n/g,"<br />\n"),t=r.converter._dispatch("spanGamut.after",t,n,r)}),e.subParser("strikethrough",function(t,n,r){"use strict";return n.strikethrough&&(t=(t=r.converter._dispatch("strikethrough.before",t,n,r)).replace(/(?:~){2}([\s\S]+?)(?:~){2}/g,function(t,i){return function(t){return n.simplifiedAutoLink&&(t=e.subParser("simplifiedAutoLinks")(t,n,r)),"<del>"+t+"</del>"}(i)}),t=r.converter._dispatch("strikethrough.after",t,n,r)),t}),e.subParser("stripLinkDefinitions",function(t,n,r){"use strict";var i=function(t,i,o,s,a,c,l){return i=i.toLowerCase(),o.match(/^data:.+?\/.+?;base64,/)?r.gUrls[i]=o.replace(/\s/g,""):r.gUrls[i]=e.subParser("encodeAmpsAndAngles")(o,n,r),c?c+l:(l&&(r.gTitles[i]=l.replace(/"|'/g,"&quot;")),n.parseImgDimensions&&s&&a&&(r.gDimensions[i]={width:s,height:a}),"")};return t=(t=(t=(t+="0").replace(/^ {0,3}\[(.+)]:[ \t]*\n?[ \t]*<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n\n|(?=0)|(?=\n\[))/gm,i)).replace(/^ {0,3}\[(.+)]:[ \t]*\n?[ \t]*<?([^>\s]+)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n+|(?=0))/gm,i)).replace(/0/,"")}),e.subParser("tables",function(t,n,r){"use strict";if(!n.tables)return t;function i(t,i){return"<td"+i+">"+e.subParser("spanGamut")(t,n,r)+"</td>\n"}function o(t){var o,s=t.split("\n");for(o=0;o<s.length;++o)/^ {0,3}\|/.test(s[o])&&(s[o]=s[o].replace(/^ {0,3}\|/,"")),/\|[ \t]*$/.test(s[o])&&(s[o]=s[o].replace(/\|[ \t]*$/,"")),s[o]=e.subParser("codeSpans")(s[o],n,r);var a,c,l,u,h=s[0].split("|").map(function(t){return t.trim()}),p=s[1].split("|").map(function(t){return t.trim()}),f=[],d=[],m=[],_=[];for(s.shift(),s.shift(),o=0;o<s.length;++o)""!==s[o].trim()&&f.push(s[o].split("|").map(function(t){return t.trim()}));if(h.length<p.length)return t;for(o=0;o<p.length;++o)m.push((a=p[o],/^:[ \t]*--*$/.test(a)?' style="text-align:left;"':/^--*[ \t]*:[ \t]*$/.test(a)?' style="text-align:right;"':/^:[ \t]*--*[ \t]*:$/.test(a)?' style="text-align:center;"':""));for(o=0;o<h.length;++o)e.helper.isUndefined(m[o])&&(m[o]=""),d.push((c=h[o],l=m[o],u=void 0,u="",c=c.trim(),(n.tablesHeaderId||n.tableHeaderId)&&(u=' id="'+c.replace(/ /g,"_").toLowerCase()+'"'),"<th"+u+l+">"+(c=e.subParser("spanGamut")(c,n,r))+"</th>\n"));for(o=0;o<f.length;++o){for(var g=[],y=0;y<d.length;++y)e.helper.isUndefined(f[o][y]),g.push(i(f[o][y],m[y]));_.push(g)}return function(t,e){for(var n="<table>\n<thead>\n<tr>\n",r=t.length,i=0;i<r;++i)n+=t[i];for(n+="</tr>\n</thead>\n<tbody>\n",i=0;i<e.length;++i){n+="<tr>\n";for(var o=0;o<r;++o)n+=e[i][o];n+="</tr>\n"}return n+="</tbody>\n</table>\n"}(d,_)}return t=(t=(t=(t=r.converter._dispatch("tables.before",t,n,r)).replace(/\\(\|)/g,e.helper.escapeCharactersCallback)).replace(/^ {0,3}\|?.+\|.+\n {0,3}\|?[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*:?[ \t]*(?:[-=]){2,}[\s\S]+?(?:\n\n|0)/gm,o)).replace(/^ {0,3}\|.+\|[ \t]*\n {0,3}\|[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*\n( {0,3}\|.+\|[ \t]*\n)*(?:\n|0)/gm,o),t=r.converter._dispatch("tables.after",t,n,r)}),e.subParser("underline",function(t,n,r){"use strict";return n.underline?(t=r.converter._dispatch("underline.before",t,n,r),t=(t=n.literalMidWordUnderscores?(t=t.replace(/\b___(\S[\s\S]*?)___\b/g,function(t,e){return"<u>"+e+"</u>"})).replace(/\b__(\S[\s\S]*?)__\b/g,function(t,e){return"<u>"+e+"</u>"}):(t=t.replace(/___(\S[\s\S]*?)___/g,function(t,e){return/\S$/.test(e)?"<u>"+e+"</u>":t})).replace(/__(\S[\s\S]*?)__/g,function(t,e){return/\S$/.test(e)?"<u>"+e+"</u>":t})).replace(/(_)/g,e.helper.escapeCharactersCallback),t=r.converter._dispatch("underline.after",t,n,r)):t}),e.subParser("unescapeSpecialChars",function(t,e,n){"use strict";return t=(t=n.converter._dispatch("unescapeSpecialChars.before",t,e,n)).replace(/E(\d+)E/g,function(t,e){var n=parseInt(e);return String.fromCharCode(n)}),t=n.converter._dispatch("unescapeSpecialChars.after",t,e,n)}),e.subParser("makeMarkdown.blockquote",function(t,n){"use strict";var r="";if(t.hasChildNodes())for(var i=t.childNodes,o=i.length,s=0;s<o;++s){var a=e.subParser("makeMarkdown.node")(i[s],n);""!==a&&(r+=a)}return r="> "+(r=r.trim()).split("\n").join("\n> ")}),e.subParser("makeMarkdown.codeBlock",function(t,e){"use strict";var n=t.getAttribute("language"),r=t.getAttribute("precodenum");return"```"+n+"\n"+e.preList[r]+"\n```"}),e.subParser("makeMarkdown.codeSpan",function(t){"use strict";return"`"+t.innerHTML+"`"}),e.subParser("makeMarkdown.emphasis",function(t,n){"use strict";var r="";if(t.hasChildNodes()){r+="*";for(var i=t.childNodes,o=i.length,s=0;s<o;++s)r+=e.subParser("makeMarkdown.node")(i[s],n);r+="*"}return r}),e.subParser("makeMarkdown.header",function(t,n,r){"use strict";var i=new Array(r+1).join("#"),o="";if(t.hasChildNodes()){o=i+" ";for(var s=t.childNodes,a=s.length,c=0;c<a;++c)o+=e.subParser("makeMarkdown.node")(s[c],n)}return o}),e.subParser("makeMarkdown.hr",function(){"use strict";return"---"}),e.subParser("makeMarkdown.image",function(t){"use strict";var e="";return t.hasAttribute("src")&&(e+="!["+t.getAttribute("alt")+"](",e+="<"+t.getAttribute("src")+">",t.hasAttribute("width")&&t.hasAttribute("height")&&(e+=" ="+t.getAttribute("width")+"x"+t.getAttribute("height")),t.hasAttribute("title")&&(e+=' "'+t.getAttribute("title")+'"'),e+=")"),e}),e.subParser("makeMarkdown.links",function(t,n){"use strict";var r="";if(t.hasChildNodes()&&t.hasAttribute("href")){var i=t.childNodes,o=i.length;r="[";for(var s=0;s<o;++s)r+=e.subParser("makeMarkdown.node")(i[s],n);r+="](",r+="<"+t.getAttribute("href")+">",t.hasAttribute("title")&&(r+=' "'+t.getAttribute("title")+'"'),r+=")"}return r}),e.subParser("makeMarkdown.list",function(t,n,r){"use strict";var i="";if(!t.hasChildNodes())return"";for(var o=t.childNodes,s=o.length,a=t.getAttribute("start")||1,c=0;c<s;++c)if(void 0!==o[c].tagName&&"li"===o[c].tagName.toLowerCase()){i+=("ol"===r?a.toString()+". ":"- ")+e.subParser("makeMarkdown.listItem")(o[c],n),++a}return(i+="\n\x3c!-- --\x3e\n").trim()}),e.subParser("makeMarkdown.listItem",function(t,n){"use strict";for(var r="",i=t.childNodes,o=i.length,s=0;s<o;++s)r+=e.subParser("makeMarkdown.node")(i[s],n);return/\n$/.test(r)?r=r.split("\n").join("\n    ").replace(/^ {4}$/gm,"").replace(/\n\n+/g,"\n\n"):r+="\n",r}),e.subParser("makeMarkdown.node",function(t,n,r){"use strict";r=r||!1;var i="";if(3===t.nodeType)return e.subParser("makeMarkdown.txt")(t,n);if(8===t.nodeType)return"\x3c!--"+t.data+"--\x3e\n\n";if(1!==t.nodeType)return"";switch(t.tagName.toLowerCase()){case"h1":r||(i=e.subParser("makeMarkdown.header")(t,n,1)+"\n\n");break;case"h2":r||(i=e.subParser("makeMarkdown.header")(t,n,2)+"\n\n");break;case"h3":r||(i=e.subParser("makeMarkdown.header")(t,n,3)+"\n\n");break;case"h4":r||(i=e.subParser("makeMarkdown.header")(t,n,4)+"\n\n");break;case"h5":r||(i=e.subParser("makeMarkdown.header")(t,n,5)+"\n\n");break;case"h6":r||(i=e.subParser("makeMarkdown.header")(t,n,6)+"\n\n");break;case"p":r||(i=e.subParser("makeMarkdown.paragraph")(t,n)+"\n\n");break;case"blockquote":r||(i=e.subParser("makeMarkdown.blockquote")(t,n)+"\n\n");break;case"hr":r||(i=e.subParser("makeMarkdown.hr")(t,n)+"\n\n");break;case"ol":r||(i=e.subParser("makeMarkdown.list")(t,n,"ol")+"\n\n");break;case"ul":r||(i=e.subParser("makeMarkdown.list")(t,n,"ul")+"\n\n");break;case"precode":r||(i=e.subParser("makeMarkdown.codeBlock")(t,n)+"\n\n");break;case"pre":r||(i=e.subParser("makeMarkdown.pre")(t,n)+"\n\n");break;case"table":r||(i=e.subParser("makeMarkdown.table")(t,n)+"\n\n");break;case"code":i=e.subParser("makeMarkdown.codeSpan")(t,n);break;case"em":case"i":i=e.subParser("makeMarkdown.emphasis")(t,n);break;case"strong":case"b":i=e.subParser("makeMarkdown.strong")(t,n);break;case"del":i=e.subParser("makeMarkdown.strikethrough")(t,n);break;case"a":i=e.subParser("makeMarkdown.links")(t,n);break;case"img":i=e.subParser("makeMarkdown.image")(t,n);break;default:i=t.outerHTML+"\n\n"}return i}),e.subParser("makeMarkdown.paragraph",function(t,n){"use strict";var r="";if(t.hasChildNodes())for(var i=t.childNodes,o=i.length,s=0;s<o;++s)r+=e.subParser("makeMarkdown.node")(i[s],n);return r=r.trim()}),e.subParser("makeMarkdown.pre",function(t,e){"use strict";var n=t.getAttribute("prenum");return"<pre>"+e.preList[n]+"</pre>"}),e.subParser("makeMarkdown.strikethrough",function(t,n){"use strict";var r="";if(t.hasChildNodes()){r+="~~";for(var i=t.childNodes,o=i.length,s=0;s<o;++s)r+=e.subParser("makeMarkdown.node")(i[s],n);r+="~~"}return r}),e.subParser("makeMarkdown.strong",function(t,n){"use strict";var r="";if(t.hasChildNodes()){r+="**";for(var i=t.childNodes,o=i.length,s=0;s<o;++s)r+=e.subParser("makeMarkdown.node")(i[s],n);r+="**"}return r}),e.subParser("makeMarkdown.table",function(t,n){"use strict";var r,i,o="",s=[[],[]],a=t.querySelectorAll("thead>tr>th"),c=t.querySelectorAll("tbody>tr");for(r=0;r<a.length;++r){var l=e.subParser("makeMarkdown.tableCell")(a[r],n),u="---";if(a[r].hasAttribute("style"))switch(a[r].getAttribute("style").toLowerCase().replace(/\s/g,"")){case"text-align:left;":u=":---";break;case"text-align:right;":u="---:";break;case"text-align:center;":u=":---:"}s[0][r]=l.trim(),s[1][r]=u}for(r=0;r<c.length;++r){var h=s.push([])-1,p=c[r].getElementsByTagName("td");for(i=0;i<a.length;++i){var f=" ";void 0!==p[i]&&(f=e.subParser("makeMarkdown.tableCell")(p[i],n)),s[h].push(f)}}var d=3;for(r=0;r<s.length;++r)for(i=0;i<s[r].length;++i){var m=s[r][i].length;m>d&&(d=m)}for(r=0;r<s.length;++r){for(i=0;i<s[r].length;++i)1===r?":"===s[r][i].slice(-1)?s[r][i]=e.helper.padEnd(s[r][i].slice(-1),d-1,"-")+":":s[r][i]=e.helper.padEnd(s[r][i],d,"-"):s[r][i]=e.helper.padEnd(s[r][i],d);o+="| "+s[r].join(" | ")+" |\n"}return o.trim()}),e.subParser("makeMarkdown.tableCell",function(t,n){"use strict";var r="";if(!t.hasChildNodes())return"";for(var i=t.childNodes,o=i.length,s=0;s<o;++s)r+=e.subParser("makeMarkdown.node")(i[s],n,!0);return r.trim()}),e.subParser("makeMarkdown.txt",function(t){"use strict";var n=t.nodeValue;return n=(n=n.replace(/ +/g," ")).replace(/NBSP;/g," "),n=(n=(n=(n=(n=(n=(n=(n=(n=e.helper.unescapeHTMLEntities(n)).replace(/([*_~|`])/g,"\\$1")).replace(/^(\s*)>/g,"\\$1>")).replace(/^#/gm,"\\#")).replace(/^(\s*)([-=]{3,})(\s*)$/,"$1\\$2$3")).replace(/^( {0,3}\d+)\./gm,"$1\\.")).replace(/^( {0,3})([+-])/gm,"$1\\$2")).replace(/]([\s]*)\(/g,"\\]$1\\(")).replace(/^ {0,3}\[([\S \t]*?)]:/gm,"\\[$1]:")});"function"==typeof define&&define.amd?define(function(){"use strict";return e}):_$showdown_81.exports?_$showdown_81.exports=e:this.showdown=e}).call(this),_$showdown_81=_$showdown_81.exports;var _$utils_86={},toString={}.toString;function paramsEqual(t,e){return!Object.keys(t).some(function(n){return t[n]!=e[n]})}function acceptParams(t,e){for(var n=t.split(/ *; */),r={value:n[0],quality:1,params:{},originalIndex:e},i=1;i<n.length;++i){var o=n[i].split(/ *= */);"q"==o[0]?r.quality=parseFloat(o[1]):r.params[o[0]]=o[1]}return r}_$utils_86.etag=function(t){return'"'+crc32.signed(t)+'"'},_$utils_86.locals=function(t){return function t(e){for(var n in e)t[n]=e[n];return e}},_$utils_86.isAbsolute=function(t){return"/"==t[0]||(":"==t[1]&&"\\"==t[2]||void 0)},_$utils_86.flatten=function(t,e){e=e||[];for(var n=t.length,r=0;r<n;++r)Array.isArray(t[r])?_$utils_86.flatten(t[r],e):e.push(t[r]);return e},_$utils_86.normalizeType=function(t){return~t.indexOf("/")?acceptParams(t):{value:mime.lookup(t),params:{}}},_$utils_86.normalizeTypes=function(t){for(var e=[],n=0;n<t.length;++n)e.push(_$utils_86.normalizeType(t[n]));return e},_$utils_86.acceptsArray=function(t,e){if(!e)return t[0];for(var n=_$utils_86.parseAccept(e),r=_$utils_86.normalizeTypes(t),i=n.length,o=0;o<i;++o)for(var s=0,a=t.length;s<a;++s)if(_$utils_86.accept(r[s],n[o]))return t[s]},_$utils_86.accepts=function(t,e){return"string"==typeof t&&(t=t.split(/ *, */)),_$utils_86.acceptsArray(t,e)},_$utils_86.accept=function(t,e){var n=t.value.split("/");return(n[0]==e.type||"*"==e.type)&&(n[1]==e.subtype||"*"==e.subtype)&&paramsEqual(t.params,e.params)},_$utils_86.parseAccept=function(t){return _$utils_86.parseParams(t).map(function(t){var e=t.value.split("/");return t.type=e[0],t.subtype=e[1],t})},_$utils_86.parseParams=function(t){return t.split(/ *, */).map(acceptParams).filter(function(t){return t.quality}).sort(function(t,e){return t.quality===e.quality?t.originalIndex-e.originalIndex:e.quality-t.quality})},_$utils_86.escape=function(t){return String(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},_$utils_86.pathRegexp=function(t,e,n,r){return"[object RegExp]"==toString.call(t)?t:(Array.isArray(t)&&(t="("+t.join("|")+")"),t=t.concat(r?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g,function(t,n,r,i,o,s,a){return e.push({name:i,optional:!!s}),n=n||"",(s?"":n)+"(?:"+(s?n:"")+(r||"")+(o||(r?"([^/.]+?)":"([^/]+?)"))+")"+(s||"")+(a?"(/*)?":"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),new RegExp("^"+t+"$",n?"":"i"))};var _$Route_85=Route;function Route(t,e,n,r){r=r||{},this.path=e,this.method=t,this.callbacks=n,this.regexp=_$utils_86.pathRegexp(e,this.keys=[],r.sensitive,r.strict)}Route.prototype.match=function(t){var e=this.keys,n=this.params=[],r=this.regexp.exec(t);if(!r)return!1;for(var i=1,o=r.length;i<o;++i){var s=e[i-1],a="string"==typeof r[i]?decodeURIComponent(r[i]):r[i];s?n[s.name]=a:n.push(a)}return!0};var has=Object.prototype.hasOwnProperty,__isArray_36=Array.isArray,hexTable=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),compactQueue=function(t){for(;t.length>1;){var e=t.pop(),n=e.obj[e.prop];if(__isArray_36(n)){for(var r=[],i=0;i<n.length;++i)void 0!==n[i]&&r.push(n[i]);e.obj[e.prop]=r}}},arrayToObject=function(t,e){for(var n=e&&e.plainObjects?Object.create(null):{},r=0;r<t.length;++r)void 0!==t[r]&&(n[r]=t[r]);return n},merge=function t(e,n,r){if(!n)return e;if("object"!=typeof n){if(__isArray_36(e))e.push(n);else{if(!e||"object"!=typeof e)return[e,n];(r&&(r.plainObjects||r.allowPrototypes)||!has.call(Object.prototype,n))&&(e[n]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(n);var i=e;return __isArray_36(e)&&!__isArray_36(n)&&(i=arrayToObject(e,r)),__isArray_36(e)&&__isArray_36(n)?(n.forEach(function(n,i){if(has.call(e,i)){var o=e[i];o&&"object"==typeof o&&n&&"object"==typeof n?e[i]=t(o,n,r):e.push(n)}else e[i]=n}),e):Object.keys(n).reduce(function(e,i){var o=n[i];return has.call(e,i)?e[i]=t(e[i],o,r):e[i]=o,e},i)},assign=function(t,e){return Object.keys(e).reduce(function(t,n){return t[n]=e[n],t},t)},decode=function(t,e,n){var r=t.replace(/\+/g," ");if("iso-8859-1"===n)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(t){return r}},encode=function(t,e,n){if(0===t.length)return t;var r=t;if("symbol"==typeof t?r=Symbol.prototype.toString.call(t):"string"!=typeof t&&(r=String(t)),"iso-8859-1"===n)return escape(r).replace(/%u[0-9a-f]{4}/gi,function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"});for(var i="",o=0;o<r.length;++o){var s=r.charCodeAt(o);45===s||46===s||95===s||126===s||s>=48&&s<=57||s>=65&&s<=90||s>=97&&s<=122?i+=r.charAt(o):s<128?i+=hexTable[s]:s<2048?i+=hexTable[192|s>>6]+hexTable[128|63&s]:s<55296||s>=57344?i+=hexTable[224|s>>12]+hexTable[128|s>>6&63]+hexTable[128|63&s]:(o+=1,s=65536+((1023&s)<<10|1023&r.charCodeAt(o)),i+=hexTable[240|s>>18]+hexTable[128|s>>12&63]+hexTable[128|s>>6&63]+hexTable[128|63&s])}return i},compact=function(t){for(var e=[{obj:{o:t},prop:"o"}],n=[],r=0;r<e.length;++r)for(var i=e[r],o=i.obj[i.prop],s=Object.keys(o),a=0;a<s.length;++a){var c=s[a],l=o[c];"object"==typeof l&&null!==l&&-1===n.indexOf(l)&&(e.push({obj:o,prop:c}),n.push(l))}return compactQueue(e),t},isRegExp=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},isBuffer=function(t){return!(!t||"object"!=typeof t)&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},combine=function(t,e){return[].concat(t,e)},_$utils_36={arrayToObject:arrayToObject,assign:assign,combine:combine,compact:compact,decode:decode,encode:encode,isBuffer:isBuffer,isRegExp:isRegExp,merge:merge},replace=String.prototype.replace,percentTwenties=/%20/g,Format={RFC1738:"RFC1738",RFC3986:"RFC3986"},_$formats_32=_$utils_36.assign({default:Format.RFC3986,formatters:{RFC1738:function(t){return replace.call(t,percentTwenties,"+")},RFC3986:function(t){return String(t)}}},Format),__has_35=Object.prototype.hasOwnProperty,arrayPrefixGenerators={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},__isArray_35=Array.isArray,push=Array.prototype.push,pushToArray=function(t,e){push.apply(t,__isArray_35(e)?e:[e])},toISO=Date.prototype.toISOString,defaultFormat=_$formats_32.default,defaults={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:_$utils_36.encode,encodeValuesOnly:!1,format:defaultFormat,formatter:_$formats_32.formatters[defaultFormat],indices:!1,serializeDate:function(t){return toISO.call(t)},skipNulls:!1,strictNullHandling:!1},isNonNullishPrimitive=function(t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t||"symbol"==typeof t||"bigint"==typeof t},stringify=function t(e,n,r,i,o,s,a,c,l,u,h,p,f){var d=e;if("function"==typeof a?d=a(n,d):d instanceof Date?d=u(d):"comma"===r&&__isArray_35(d)&&(d=d.join(",")),null===d){if(i)return s&&!p?s(n,defaults.encoder,f,"key"):n;d=""}if(isNonNullishPrimitive(d)||_$utils_36.isBuffer(d))return s?[h(p?n:s(n,defaults.encoder,f,"key"))+"="+h(s(d,defaults.encoder,f,"value"))]:[h(n)+"="+h(String(d))];var m,_=[];if(void 0===d)return _;if(__isArray_35(a))m=a;else{var g=Object.keys(d);m=c?g.sort(c):g}for(var y=0;y<m.length;++y){var v=m[y];o&&null===d[v]||(__isArray_35(d)?pushToArray(_,t(d[v],"function"==typeof r?r(n,v):n,r,i,o,s,a,c,l,u,h,p,f)):pushToArray(_,t(d[v],n+(l?"."+v:"["+v+"]"),r,i,o,s,a,c,l,u,h,p,f)))}return _},normalizeStringifyOptions=function(t){if(!t)return defaults;if(null!==t.encoder&&void 0!==t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||defaults.charset;if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=_$formats_32.default;if(void 0!==t.format){if(!__has_35.call(_$formats_32.formatters,t.format))throw new TypeError("Unknown format option provided.");n=t.format}var r=_$formats_32.formatters[n],i=defaults.filter;return("function"==typeof t.filter||__isArray_35(t.filter))&&(i=t.filter),{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:defaults.addQueryPrefix,allowDots:void 0===t.allowDots?defaults.allowDots:!!t.allowDots,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:defaults.charsetSentinel,delimiter:void 0===t.delimiter?defaults.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:defaults.encode,encoder:"function"==typeof t.encoder?t.encoder:defaults.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:defaults.encodeValuesOnly,filter:i,formatter:r,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:defaults.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:defaults.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:defaults.strictNullHandling}},_$stringify_35=function(t,e){var n,r=t,i=normalizeStringifyOptions(e);"function"==typeof i.filter?r=(0,i.filter)("",r):__isArray_35(i.filter)&&(n=i.filter);var o,s=[];if("object"!=typeof r||null===r)return"";o=e&&e.arrayFormat in arrayPrefixGenerators?e.arrayFormat:e&&"indices"in e?e.indices?"indices":"repeat":"indices";var a=arrayPrefixGenerators[o];n||(n=Object.keys(r)),i.sort&&n.sort(i.sort);for(var c=0;c<n.length;++c){var l=n[c];i.skipNulls&&null===r[l]||pushToArray(s,stringify(r[l],l,a,i.strictNullHandling,i.skipNulls,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.formatter,i.encodeValuesOnly,i.charset))}var u=s.join(i.delimiter),h=!0===i.addQueryPrefix?"?":"";return i.charsetSentinel&&("iso-8859-1"===i.charset?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),u.length>0?h+u:""},__has_34=Object.prototype.hasOwnProperty,__isArray_34=Array.isArray,__defaults_34={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:_$utils_36.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},interpretNumericEntities=function(t){return t.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},isoSentinel="utf8=%26%2310003%3B",charsetSentinel="utf8=%E2%9C%93",parseValues=function(t,e){var n,r={},i=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,o=e.parameterLimit===1/0?void 0:e.parameterLimit,s=i.split(e.delimiter,o),a=-1,c=e.charset;if(e.charsetSentinel)for(n=0;n<s.length;++n)0===s[n].indexOf("utf8=")&&(s[n]===charsetSentinel?c="utf-8":s[n]===isoSentinel&&(c="iso-8859-1"),a=n,n=s.length);for(n=0;n<s.length;++n)if(n!==a){var l,u,h=s[n],p=h.indexOf("]="),f=-1===p?h.indexOf("="):p+1;-1===f?(l=e.decoder(h,__defaults_34.decoder,c,"key"),u=e.strictNullHandling?null:""):(l=e.decoder(h.slice(0,f),__defaults_34.decoder,c,"key"),u=e.decoder(h.slice(f+1),__defaults_34.decoder,c,"value")),u&&e.interpretNumericEntities&&"iso-8859-1"===c&&(u=interpretNumericEntities(u)),u&&"string"==typeof u&&e.comma&&u.indexOf(",")>-1&&(u=u.split(",")),h.indexOf("[]=")>-1&&(u=__isArray_34(u)?[u]:u),__has_34.call(r,l)?r[l]=_$utils_36.combine(r[l],u):r[l]=u}return r},parseObject=function(t,e,n){for(var r=e,i=t.length-1;i>=0;--i){var o,s=t[i];if("[]"===s&&n.parseArrays)o=[].concat(r);else{o=n.plainObjects?Object.create(null):{};var a="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,c=parseInt(a,10);n.parseArrays||""!==a?!isNaN(c)&&s!==a&&String(c)===a&&c>=0&&n.parseArrays&&c<=n.arrayLimit?(o=[])[c]=r:o[a]=r:o={0:r}}r=o}return r},parseKeys=function(t,e,n){if(t){var r=n.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,i=/(\[[^[\]]*])/g,o=n.depth>0&&/(\[[^[\]]*])/.exec(r),s=o?r.slice(0,o.index):r,a=[];if(s){if(!n.plainObjects&&__has_34.call(Object.prototype,s)&&!n.allowPrototypes)return;a.push(s)}for(var c=0;n.depth>0&&null!==(o=i.exec(r))&&c<n.depth;){if(c+=1,!n.plainObjects&&__has_34.call(Object.prototype,o[1].slice(1,-1))&&!n.allowPrototypes)return;a.push(o[1])}return o&&a.push("["+r.slice(o.index)+"]"),parseObject(a,e,n)}},normalizeParseOptions=function(t){if(!t)return __defaults_34;if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new Error("The charset option must be either utf-8, iso-8859-1, or undefined");var e=void 0===t.charset?__defaults_34.charset:t.charset;return{allowDots:void 0===t.allowDots?__defaults_34.allowDots:!!t.allowDots,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:__defaults_34.allowPrototypes,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:__defaults_34.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:__defaults_34.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:__defaults_34.comma,decoder:"function"==typeof t.decoder?t.decoder:__defaults_34.decoder,delimiter:"string"==typeof t.delimiter||_$utils_36.isRegExp(t.delimiter)?t.delimiter:__defaults_34.delimiter,depth:"number"==typeof t.depth||!1===t.depth?+t.depth:__defaults_34.depth,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:__defaults_34.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:__defaults_34.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:__defaults_34.plainObjects,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:__defaults_34.strictNullHandling}},_$parse_34=function(t,e){var n=normalizeParseOptions(e);if(""===t||null==t)return n.plainObjects?Object.create(null):{};for(var r="string"==typeof t?parseValues(t,n):t,i=n.plainObjects?Object.create(null):{},o=Object.keys(r),s=0;s<o.length;++s){var a=o[s],c=parseKeys(a,r[a],n);i=_$utils_36.merge(i,c,n)}return _$utils_36.compact(i)},_$lib_33={formats:_$formats_32,parse:_$parse_34,stringify:_$stringify_35},_$punycode_31={exports:{}};(function(t){!function(e){var n="object"==typeof _$punycode_31.exports&&_$punycode_31.exports&&!_$punycode_31.exports.nodeType&&_$punycode_31.exports,r=_$punycode_31&&!_$punycode_31.nodeType&&_$punycode_31,i="object"==typeof t&&t;i.global!==i&&i.window!==i&&i.self!==i||(e=i);var o,s,a=2147483647,c=36,l=1,u=26,h=38,p=700,f=72,d=128,m="-",_=/^xn--/,g=/[^\x20-\x7E]/,y=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},b=c-l,w=Math.floor,E=String.fromCharCode;function x(t){throw new RangeError(v[t])}function C(t,e){for(var n=t.length,r=[];n--;)r[n]=e(t[n]);return r}function S(t,e){var n=t.split("@"),r="";return n.length>1&&(r=n[0]+"@",t=n[1]),r+C((t=t.replace(y,".")).split("."),e).join(".")}function k(t){for(var e,n,r=[],i=0,o=t.length;i<o;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<o?56320==(64512&(n=t.charCodeAt(i++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),i--):r.push(e);return r}function T(t){return C(t,function(t){var e="";return t>65535&&(e+=E((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=E(t)}).join("")}function $(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function D(t,e,n){var r=0;for(t=n?w(t/p):t>>1,t+=w(t/e);t>b*u>>1;r+=c)t=w(t/b);return w(r+(b+1)*t/(t+h))}function R(t){var e,n,r,i,o,s,h,p,_,g,y,v=[],b=t.length,E=0,C=d,S=f;for((n=t.lastIndexOf(m))<0&&(n=0),r=0;r<n;++r)t.charCodeAt(r)>=128&&x("not-basic"),v.push(t.charCodeAt(r));for(i=n>0?n+1:0;i<b;){for(o=E,s=1,h=c;i>=b&&x("invalid-input"),((p=(y=t.charCodeAt(i++))-48<10?y-22:y-65<26?y-65:y-97<26?y-97:c)>=c||p>w((a-E)/s))&&x("overflow"),E+=p*s,!(p<(_=h<=S?l:h>=S+u?u:h-S));h+=c)s>w(a/(g=c-_))&&x("overflow"),s*=g;S=D(E-o,e=v.length+1,0==o),w(E/e)>a-C&&x("overflow"),C+=w(E/e),E%=e,v.splice(E++,0,C)}return T(v)}function O(t){var e,n,r,i,o,s,h,p,_,g,y,v,b,C,S,T=[];for(v=(t=k(t)).length,e=d,n=0,o=f,s=0;s<v;++s)(y=t[s])<128&&T.push(E(y));for(r=i=T.length,i&&T.push(m);r<v;){for(h=a,s=0;s<v;++s)(y=t[s])>=e&&y<h&&(h=y);for(h-e>w((a-n)/(b=r+1))&&x("overflow"),n+=(h-e)*b,e=h,s=0;s<v;++s)if((y=t[s])<e&&++n>a&&x("overflow"),y==e){for(p=n,_=c;!(p<(g=_<=o?l:_>=o+u?u:_-o));_+=c)S=p-g,C=c-g,T.push(E($(g+S%C,0))),p=w(S/C);T.push(E($(p,0))),o=D(n,b,r==i),n=0,++r}++n,++e}return T.join("")}if(o={version:"1.4.1",ucs2:{decode:k,encode:T},decode:R,encode:O,toASCII:function(t){return S(t,function(t){return g.test(t)?"xn--"+O(t):t})},toUnicode:function(t){return S(t,function(t){return _.test(t)?R(t.slice(4).toLowerCase()):t})}},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return o});else if(n&&r)if(_$punycode_31.exports==n)r.exports=o;else for(s in o)o.hasOwnProperty(s)&&(n[s]=o[s]);else e.punycode=o}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),_$punycode_31=_$punycode_31.exports;var _$util_88={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}};function hasOwnProperty(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var _$decode_37=function(t,e,n,r){e=e||"&",n=n||"=";var i={};if("string"!=typeof t||0===t.length)return i;var o=/\+/g;t=t.split(e);var s=1e3;r&&"number"==typeof r.maxKeys&&(s=r.maxKeys);var a=t.length;s>0&&a>s&&(a=s);for(var c=0;c<a;++c){var l,u,h,p,f=t[c].replace(o,"%20"),d=f.indexOf(n);d>=0?(l=f.substr(0,d),u=f.substr(d+1)):(l=f,u=""),h=decodeURIComponent(l),p=decodeURIComponent(u),hasOwnProperty(i,h)?__isArray_37(i[h])?i[h].push(p):i[h]=[i[h],p]:i[h]=p}return i},__isArray_37=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},stringifyPrimitive=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}},_$encode_38=function(t,e,n,r){return e=e||"&",n=n||"=",null===t&&(t=void 0),"object"==typeof t?map(__objectKeys_38(t),function(r){var i=encodeURIComponent(stringifyPrimitive(r))+n;return __isArray_38(t[r])?map(t[r],function(t){return i+encodeURIComponent(stringifyPrimitive(t))}).join(e):i+encodeURIComponent(stringifyPrimitive(t[r]))}).join(e):r?encodeURIComponent(stringifyPrimitive(r))+n+encodeURIComponent(stringifyPrimitive(t)):""},__isArray_38=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function map(t,e){if(t.map)return t.map(e);for(var n=[],r=0;r<t.length;r++)n.push(e(t[r],r));return n}var __objectKeys_38=Object.keys||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e},_$querystringEs3_39={};_$querystringEs3_39.decode=_$querystringEs3_39.parse=_$decode_37,_$querystringEs3_39.encode=_$querystringEs3_39.stringify=_$encode_38;var _$url_87={};function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}_$url_87.parse=urlParse,_$url_87.resolve=urlResolve,_$url_87.resolveObject=urlResolveObject,_$url_87.format=urlFormat,_$url_87.Url=Url;var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,delims=["<",">",'"',"`"," ","\r","\n","\t"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function urlParse(t,e,n){if(t&&_$util_88.isObject(t)&&t instanceof Url)return t;var r=new Url;return r.parse(t,e,n),r}function urlFormat(t){return _$util_88.isString(t)&&(t=urlParse(t)),t instanceof Url?t.format():Url.prototype.format.call(t)}function urlResolve(t,e){return urlParse(t,!1,!0).resolve(e)}function urlResolveObject(t,e){return t?urlParse(t,!1,!0).resolveObject(e):e}Url.prototype.parse=function(t,e,n){if(!_$util_88.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var r=t.indexOf("?"),i=-1!==r&&r<t.indexOf("#")?"?":"#",o=t.split(i);o[0]=o[0].replace(/\\/g,"/");var s=t=o.join(i);if(s=s.trim(),!n&&1===t.split("#").length){var a=simplePathPattern.exec(s);if(a)return this.path=s,this.href=s,this.pathname=a[1],a[2]?(this.search=a[2],this.query=e?_$querystringEs3_39.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var c=protocolPattern.exec(s);if(c){var l=(c=c[0]).toLowerCase();this.protocol=l,s=s.substr(c.length)}if(n||c||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var u="//"===s.substr(0,2);!u||c&&hostlessProtocol[c]||(s=s.substr(2),this.slashes=!0)}if(!hostlessProtocol[c]&&(u||c&&!slashedProtocol[c])){for(var h,p,f=-1,d=0;d<hostEndingChars.length;d++){-1!==(m=s.indexOf(hostEndingChars[d]))&&(-1===f||m<f)&&(f=m)}-1!==(p=-1===f?s.lastIndexOf("@"):s.lastIndexOf("@",f))&&(h=s.slice(0,p),s=s.slice(p+1),this.auth=decodeURIComponent(h)),f=-1;for(d=0;d<nonHostChars.length;d++){var m;-1!==(m=s.indexOf(nonHostChars[d]))&&(-1===f||m<f)&&(f=m)}-1===f&&(f=s.length),this.host=s.slice(0,f),s=s.slice(f),this.parseHost(),this.hostname=this.hostname||"";var _="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!_)for(var g=this.hostname.split(/\./),y=(d=0,g.length);d<y;d++){var v=g[d];if(v&&!v.match(hostnamePartPattern)){for(var b="",w=0,E=v.length;w<E;w++)v.charCodeAt(w)>127?b+="x":b+=v[w];if(!b.match(hostnamePartPattern)){var x=g.slice(0,d),C=g.slice(d+1),S=v.match(hostnamePartStart);S&&(x.push(S[1]),C.unshift(S[2])),C.length&&(s="/"+C.join(".")+s),this.hostname=x.join(".");break}}}this.hostname.length>hostnameMaxLen?this.hostname="":this.hostname=this.hostname.toLowerCase(),_||(this.hostname=_$punycode_31.toASCII(this.hostname));var k=this.port?":"+this.port:"",T=this.hostname||"";this.host=T+k,this.href+=this.host,_&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!unsafeProtocol[l])for(d=0,y=autoEscape.length;d<y;d++){var $=autoEscape[d];if(-1!==s.indexOf($)){var D=encodeURIComponent($);D===$&&(D=escape($)),s=s.split($).join(D)}}var R=s.indexOf("#");-1!==R&&(this.hash=s.substr(R),s=s.slice(0,R));var O=s.indexOf("?");if(-1!==O?(this.search=s.substr(O),this.query=s.substr(O+1),e&&(this.query=_$querystringEs3_39.parse(this.query)),s=s.slice(0,O)):e&&(this.search="",this.query={}),s&&(this.pathname=s),slashedProtocol[l]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){k=this.pathname||"";var M=this.search||"";this.path=k+M}return this.href=this.format(),this},Url.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",n=this.pathname||"",r=this.hash||"",i=!1,o="";this.host?i=t+this.host:this.hostname&&(i=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&_$util_88.isObject(this.query)&&Object.keys(this.query).length&&(o=_$querystringEs3_39.stringify(this.query));var s=this.search||o&&"?"+o||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||slashedProtocol[e])&&!1!==i?(i="//"+(i||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):i||(i=""),r&&"#"!==r.charAt(0)&&(r="#"+r),s&&"?"!==s.charAt(0)&&(s="?"+s),e+i+(n=n.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(s=s.replace("#","%23"))+r},Url.prototype.resolve=function(t){return this.resolveObject(urlParse(t,!1,!0)).format()},Url.prototype.resolveObject=function(t){if(_$util_88.isString(t)){var e=new Url;e.parse(t,!1,!0),t=e}for(var n=new Url,r=Object.keys(this),i=0;i<r.length;i++){var o=r[i];n[o]=this[o]}if(n.hash=t.hash,""===t.href)return n.href=n.format(),n;if(t.slashes&&!t.protocol){for(var s=Object.keys(t),a=0;a<s.length;a++){var c=s[a];"protocol"!==c&&(n[c]=t[c])}return slashedProtocol[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(t.protocol&&t.protocol!==n.protocol){if(!slashedProtocol[t.protocol]){for(var l=Object.keys(t),u=0;u<l.length;u++){var h=l[u];n[h]=t[h]}return n.href=n.format(),n}if(n.protocol=t.protocol,t.host||hostlessProtocol[t.protocol])n.pathname=t.pathname;else{for(var p=(t.pathname||"").split("/");p.length&&!(t.host=p.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),n.pathname=p.join("/")}if(n.search=t.search,n.query=t.query,n.host=t.host||"",n.auth=t.auth,n.hostname=t.hostname||t.host,n.port=t.port,n.pathname||n.search){var f=n.pathname||"",d=n.search||"";n.path=f+d}return n.slashes=n.slashes||t.slashes,n.href=n.format(),n}var m=n.pathname&&"/"===n.pathname.charAt(0),_=t.host||t.pathname&&"/"===t.pathname.charAt(0),g=_||m||n.host&&t.pathname,y=g,v=n.pathname&&n.pathname.split("/")||[],b=(p=t.pathname&&t.pathname.split("/")||[],n.protocol&&!slashedProtocol[n.protocol]);if(b&&(n.hostname="",n.port=null,n.host&&(""===v[0]?v[0]=n.host:v.unshift(n.host)),n.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===p[0]?p[0]=t.host:p.unshift(t.host)),t.host=null),g=g&&(""===p[0]||""===v[0])),_)n.host=t.host||""===t.host?t.host:n.host,n.hostname=t.hostname||""===t.hostname?t.hostname:n.hostname,n.search=t.search,n.query=t.query,v=p;else if(p.length)v||(v=[]),v.pop(),v=v.concat(p),n.search=t.search,n.query=t.query;else if(!_$util_88.isNullOrUndefined(t.search)){if(b)n.hostname=n.host=v.shift(),(S=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=S.shift(),n.host=n.hostname=S.shift());return n.search=t.search,n.query=t.query,_$util_88.isNull(n.pathname)&&_$util_88.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!v.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var w=v.slice(-1)[0],E=(n.host||t.host||v.length>1)&&("."===w||".."===w)||""===w,x=0,C=v.length;C>=0;C--)"."===(w=v[C])?v.splice(C,1):".."===w?(v.splice(C,1),x++):x&&(v.splice(C,1),x--);if(!g&&!y)for(;x--;x)v.unshift("..");!g||""===v[0]||v[0]&&"/"===v[0].charAt(0)||v.unshift(""),E&&"/"!==v.join("/").substr(-1)&&v.push("");var S,k=""===v[0]||v[0]&&"/"===v[0].charAt(0);b&&(n.hostname=n.host=k?"":v.length?v.shift():"",(S=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=S.shift(),n.host=n.hostname=S.shift()));return(g=g||n.host&&v.length)&&!k&&v.unshift(""),v.length?n.pathname=v.join("/"):(n.pathname=null,n.path=null),_$util_88.isNull(n.pathname)&&_$util_88.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=t.auth||n.auth,n.slashes=n.slashes||t.slashes,n.href=n.format(),n},Url.prototype.parseHost=function(){var t=this.host,e=portPattern.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)};var _$router_84={render:render,isTransitional:isTransitional,mapRoute:mapRoute};function isTransitional(t){return t.hasOwnProperty("from")&&t.hasOwnProperty("to")}function mapRoute(t,e){var n=~(r=e.url.indexOf("?"))?e.url.slice(r):"",r=0;return t.replace(/\/(?:(?:\:([^?\/:*(]+)(?:\([^)]+\))?)|\*)(\?)?/g,function(t,n,i){var o=n?e[n]:e[r++];return i&&null==o?"":"/"+encodeURIComponent(o)})+n}function render(t,e,n){var r=new RenderReq(t.app.page,t.routes,e,n);r.routeTransitional(0,function(){r.page=t.page(),r.routeQueue(0,function(){r.cancel()})})}function RenderReq(t,e,n,r){this.page=t,this.options=n,this.e=r,this.setUrl(n.url.replace(/#.*/,""));var i=_$url_87.parse(this.url).query;this.query=i?_$lib_33.parse(i):{},this.method=n.method,this.body=n.body||{},this.setPrevious(n.previous),this.transitional=e.transitional[this.method],this.queue=e.queue[this.method],this.app=e.app}RenderReq.prototype.cancel=function(){var t=this.options;this.e||t.noNavigate||(t.form?(t.form.setAttribute("data-router-ignore",""),t.form.submit()):window.location.assign(t.url))},RenderReq.prototype.setUrl=function(t){this.url=t,this.path=t.replace(/\?.*/,"")},RenderReq.prototype.setPrevious=function(t){this.previous=t,this.previousPath=t&&t.replace(/\?.*/,"")},RenderReq.prototype.routeTransitional=function(t,e){var n;for(t||(t=0);n=this.transitional[t++];){if(n.to.match(this.path)&&n.from.match(this.previousPath)){var r=this,i=this.routeParams(n.to);return void this.onMatch(n.to,i,function(n){if(n)return r.cancel();r.routeTransitional(t,e)},o)}function o(){}}e()},RenderReq.prototype.routeQueue=function(t,e){var n;for(t||(t=0);n=this.queue[t++];)if(n.match(this.path)){var r=this,i=this.routeParams(n);return void this.onMatch(n,i,function(n){if(n)return r.cancel();r.routeQueue(t,e)})}e()},RenderReq.prototype.onMatch=function(t,e,n,r){if(!this.page)return n();this.e&&(this.e.preventDefault(),this.e=null),this.page.params=e,t.isTransitional?this.app.onRoute(t.callbacks,this.page,n,r):this.app.onRoute(t.callbacks,this.page,n)},RenderReq.prototype.routeParams=function(t){var e=t.params,n=e.slice();for(var r in e)n[r]=e[r];return n.previous=this.previous,n.url=this.url,n.body=this.body,n.query=this.query,n.method=this.method,n};var parseUrl=_$url_87.parse,resolveUrl=_$url_87.resolve,currentPath=window.location.pathname+window.location.search;window.history.replaceState&&window.history.replaceState({$render:!0,$method:"get"},null,window.location.href);var _$History_82=History;function History(t,e){this.app=t,this.routes=e,window.history.pushState?addListeners(this):(this.push=function(t){window.location.assign(t)},this.replace=function(t){window.location.replace(t)})}function routePath(t){var e=parseUrl(t);return e&&e.protocol===window.location.protocol&&e.host===window.location.host&&e.pathname+(e.search||"")}function renderOptions(t,e){if(t&&"submit"===t.type){for(var n,r=t.target,i=r.elements,o=[],s=0,a=i.length;s<a;s++){var c=(n=i[s]).name;if(c){var l=n.value;if(o.push(encodeURIComponent(c)+"="+encodeURIComponent(l)),"_method"===c){var u=l.toLowerCase();"delete"===u&&(u="del")}}}if(o=o.join("&"),"post"===r.method.toLowerCase())var h=u||"post",p=_$lib_33.parse(o);else h="get",e+="?"+o}else h="get";return{method:h,url:e,previous:window.location.pathname+window.location.search,body:p,form:r,link:t&&t._tracksLink}}function addListeners(t){document.addEventListener("click",function(e){var n=e.target;if(!e.metaKey&&1===e.which&&!e.defaultPrevented)for(;n;){var r=n.href;if(r){if(n.hasAttribute&&n.hasAttribute("data-router-ignore"))return;if(n.target&&"_self"!==n.target)return;var i=r.indexOf("#");if(~i&&r.slice(0,i)===window.location.href.replace(/#.*/,""))return;return e._tracksLink=n,void t.push(r,!0,null,e)}n=n.parentNode}},!0),document.addEventListener("submit",function(e){var n=e.target;if(!e.defaultPrevented&&"form"===n.tagName.toLowerCase()&&!("multipart/form-data"===n.enctype||n.hasAttribute&&n.hasAttribute("data-router-ignore"))){var r=n.action||window.location.href;t.push(r,!0,null,e)}},!1),window.addEventListener("popstate",function(e){if(t.app.page){var n=currentPath,r=e.state,i={previous:n,url:currentPath=window.location.pathname+window.location.search};if(r){if(!r.$render)return;return i.method=r.$method,_$router_84.render(t,i)}var o,s,a=window.location.href,c=a.indexOf("#");~c&&currentPath!==n&&(i.method="get",_$router_84.render(t,i),s=a.slice(c+1),(o=document.getElementById(s)||document.getElementsByName(s)[0])&&o.scrollIntoView())}},!0)}History.prototype.push=function(t,e,n,r){this._update("pushState",t,e,n,r)},History.prototype.replace=function(t,e,n,r){this._update("replaceState",t,e,n,r)},History.prototype.refresh=function(){var t=routePath(window.location.href);_$router_84.render(this,{url:t,method:"get"})},History.prototype.back=function(){window.history.back()},History.prototype.forward=function(){window.history.forward()},History.prototype.go=function(t){window.history.go(t)},History.prototype._update=function(t,e,n,r,i){var o=routePath(resolveUrl(window.location.href,e));if(o){null==n&&(n=!0),null==r&&(r={});var s=renderOptions(i,o);r.$render=!0,r.$method=s.method,window.history[t](r,null,s.url),currentPath=window.location.pathname+window.location.search,n&&_$router_84.render(this,s,i)}},History.prototype.page=function(){var t=this.app.createPage(),e=this;return t.redirect=function(t){if("back"===t)return e.back();"home"===t&&(t="\\"),e.replace(t,!0)},t};var _$browser_83={},__router_83=_$browser_83=_$router_84;function setup(t){var e={queue:{},transitional:{},app:t};t.history=new _$History_82(t,e),["get","post","put","del","enter","exit"].forEach(function(n){var r=e.queue[n]=[],i=e.transitional[n]=[];t[n]=function(e,o){if(Array.isArray(e))return e.forEach(function(e){t[n](e,o)}),t;if(__router_83.isTransitional(e)){var s=e.from,a=e.to,c=e.forward||o&&o.forward||o,l=e.back||o&&o.back,u=new _$Route_85(n,s,l),h=new _$Route_85(n,a,c);return u.isTransitional=!0,h.isTransitional=!0,i.push({from:u,to:h}),l&&i.push({from:h,to:u}),t}return r.push(new _$Route_85(n,e,o)),t}})}__router_83.setup=setup;var _$contexts_7={};function __noop_7(){}function ContextMeta(){this.addBinding=__noop_7,this.removeBinding=__noop_7,this.removeNode=__noop_7,this.addItemContext=__noop_7,this.removeItemContext=__noop_7,this.views=null,this.idNamespace="",this.idCount=0,this.pending=[],this.pauseCount=0}function __Context_7(t,e,n,r,i){this.meta=t,this.controller=e,this.parent=n,this.unbound=r,this.expression=i,this.alias=i&&i.meta&&i.meta.as,this.keyAlias=i&&i.meta&&i.meta.keyAs,this.item=null,this.view=null,this.attributes=null,this.hooks=null,this.initHooks=null,this.closure=null,this._id=null}_$contexts_7.ContextMeta=ContextMeta,_$contexts_7.Context=__Context_7,__Context_7.prototype.id=function(){var t=++this.meta.idCount;return this.meta.idNamespace+"_"+t.toString(36)},__Context_7.prototype.addBinding=function(t){if(!t.itemFor){var e=t.template.expression;(e?e.isUnbound(this):this.unbound)||e&&e.meta&&"with"===e.meta.blockType||this.meta.addBinding(t)}},__Context_7.prototype.removeBinding=function(t){this.meta.removeBinding(t)},__Context_7.prototype.removeNode=function(t){this.meta.removeNode(t)},__Context_7.prototype.child=function(t){var e=t.meta&&t.meta.blockType,n="unbound"===e||"bound"!==e&&this.unbound;return new __Context_7(this.meta,this.controller,this,n,t)},__Context_7.prototype.componentChild=function(t){return new __Context_7(this.meta,t,this,this.unbound)},__Context_7.prototype.eachChild=function(t,e){var n=new __Context_7(this.meta,this.controller,this,this.unbound,t);return n.item=e,this.meta.addItemContext(n),n},__Context_7.prototype.viewChild=function(t,e,n,r){var i=new __Context_7(this.meta,this.controller,this,this.unbound);return i.view=t,i.attributes=e,i.hooks=n,i.initHooks=r,i},__Context_7.prototype.closureChild=function(t){var e=new __Context_7(this.meta,this.controller,this,this.unbound);return e.closure=t,e},__Context_7.prototype.forRelative=function(t){for(var e=this;e&&e.expression===t||e.view;)e=e.parent;return e},__Context_7.prototype.forAlias=function(t){for(var e=this;e;){if(e.alias===t||e.keyAlias===t)return e;e=e.parent}},__Context_7.prototype.forAttribute=function(t){for(var e=this;e;){if(e.view){var n=e.attributes;if(!n)return;if(n.hasOwnProperty(t))return e;if(!n.inherit&&!n.extend)return}e=e.parent}},__Context_7.prototype.forViewParent=function(){for(var t=this;t;){if(t.closure)return t.closure.parent;if(t.view)return t.parent;t=t.parent}},__Context_7.prototype.getView=function(){for(var t=this;t;){if(t.view)return t.view;t=t.parent}},__Context_7.prototype.get=function(){var t=this.expression?this.expression.get(this):this.controller.model.data;return null!=this.item?t&&t[this.item]:t},__Context_7.prototype.pause=function(){this.meta.pauseCount++},__Context_7.prototype.unpause=function(){--this.meta.pauseCount||this.flush()},__Context_7.prototype.flush=function(){var t=this.meta.pending,e=t.length;if(e){this.meta.pending=[];for(var n=0;n<e;n++)t[n]()}},__Context_7.prototype.queue=function(t){this.meta.pending.push(t)};var _$operatorFns_9={get:{"!U":function(t){return!t},"-U":function(t){return-t},"+U":function(t){return+t},"~U":function(t){return~t},typeofU:function(t){return typeof t},"||":function(t,e){return t||e},"&&":function(t,e){return t&&e},"|":function(t,e){return t|e},"^":function(t,e){return t^e},"&":function(t,e){return t&e},"==":function(t,e){return t==e},"!=":function(t,e){return t!=e},"===":function(t,e){return t===e},"!==":function(t,e){return t!==e},"<":function(t,e){return t<e},">":function(t,e){return t>e},"<=":function(t,e){return t<=e},">=":function(t,e){return t>=e},instanceof:function(t,e){return t instanceof e},in:function(t,e){return t in e},"<<":function(t,e){return t<<e},">>":function(t,e){return t>>e},">>>":function(t,e){return t>>>e},"+":function(t,e){return t+e},"-":function(t,e){return t-e},"*":function(t,e){return t*e},"/":function(t,e){return t/e},"%":function(t,e){return t%e},"?":function(t,e,n){return t?e:n},",":function(){return arguments[arguments.length-1]}},set:{"!U":function(t){return[!t]},"-U":function(t){return[-t]},"==":function(t,e,n){if(t)return[n]},"===":function(t,e,n){if(t)return[n]},in:function(t,e,n){return n[e]=!0,{1:n}},"+":function(t,e,n){return[t-n]},"-":function(t,e,n){return[t+n]},"*":function(t,e,n){return[t/n]},"/":function(t,e,n){return[t*n]}}},_$saddle_65={},serializeObject=_$serializeObject_66({}),BOOLEAN_PROPERTIES={checked:"checked",disabled:"disabled",readonly:"readOnly",selected:"selected"},INTEGER_PROPERTIES={colspan:"colSpan",maxlength:"maxLength",rowspan:"rowSpan",tabindex:"tabIndex"},STRING_PROPERTIES={cellpadding:"cellPadding",cellspacing:"cellSpacing",class:"className",contenteditable:"contentEditable",enctype:"encoding",for:"htmlFor",frameborder:"frameBorder",id:"id",title:"title",type:"type",usemap:"useMap",value:"value"},UPDATE_PROPERTIES={};mergeInto(BOOLEAN_PROPERTIES,UPDATE_PROPERTIES),mergeInto(INTEGER_PROPERTIES,UPDATE_PROPERTIES),mergeInto(STRING_PROPERTIES,UPDATE_PROPERTIES);var CREATE_PROPERTIES={};mergeInto(UPDATE_PROPERTIES,CREATE_PROPERTIES),CREATE_PROPERTIES.checked="defaultChecked",CREATE_PROPERTIES.value="defaultValue";var VOID_ELEMENTS={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuitem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},NAMESPACE_URIS={svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/2000/xmlns/"};function Template(t,e){this.content=t,this.source=e}function Doctype(t,e,n){this.name=t,this.publicId=e,this.systemId=n}function Text(t){this.data=t,this.escaped=escapeHtml(t)}function DynamicText(t){this.expression=t,this.unbound=!1}function attachText(t,e,n,r,i){if(!e){var o=document.createTextNode(n);return t.appendChild(o),void addNodeBinding(r,i,o)}if(3===e.nodeType){if(e.data===n)return addNodeBinding(r,i,e),e.nextSibling;var s=splitData(e,(n=normalizeLineBreaks(n)).length);if(e.data!==n)throw attachError(t,e);return addNodeBinding(r,i,e),s}if(""===n){o=document.createTextNode("");return t.insertBefore(o,e||null),addNodeBinding(r,i,o),e}throw attachError(t,e)}function Comment(t,e){this.data=t,this.hooks=e}function DynamicComment(t,e){this.expression=t,this.hooks=e}function attachComment(t,e,n,r,i){if(!e||8!==e.nodeType){var o=document.createComment(n);return t.insertBefore(o,e||null),addNodeBinding(r,i,o),e}if(e.data===n)return addNodeBinding(r,i,e),e.nextSibling;throw attachError(t,e)}function addNodeBinding(t,e,n){t.expression&&!t.unbound&&e.addBinding(new NodeBinding(t,e,n)),emitHooks(t.hooks,e,n)}function Html(t){this.data=t}function DynamicHtml(t){this.expression=t,this.ending="/"+t}function createHtmlFragment(t,e){if(t&&1===t.nodeType)return(r=document.createRange()).selectNodeContents(t),r.createContextualFragment(e);var n=document.createElement("div"),r=document.createRange();return n.innerHTML=e,r.selectNodeContents(n),r.extractContents()}function attachHtml(t,e,n){for(var r=0,i=createHtmlFragment(t,n).childNodes.length;r<i;r++){if(!e)throw attachError(t,e);e=e.nextSibling}return e}function Attribute(t,e){this.data=t,this.ns=e}function DynamicAttribute(t,e){this.expression=t,this.ns=e,this.elementNs=null}function getUnescapedValue(t,e){for(var n=t.get(e,!0);n instanceof Template;)n=n.get(e,!0);return n}function Element(t,e,n,r,i,o,s){this.tagName=t,this.attributes=e,this.content=n,this.hooks=r,this.selfClosing=i,this.notClosed=o,this.ns=s,this.endTag=getEndTag(t,i,o),this.startClose=getStartClose(i);var a=t&&t.toLowerCase();this.unescapedContent="script"===a||"style"===a,this.bindContentToValue="textarea"===a}function DynamicElement(t,e,n,r,i,o,s){this.tagName=t,this.attributes=e,this.content=n,this.hooks=r,this.selfClosing=i,this.notClosed=o,this.ns=s,this.startClose=getStartClose(i),this.unescapedContent=!1}function getStartClose(t){return t?" />":">"}function getEndTag(t,e,n){var r=t&&t.toLowerCase();return VOID_ELEMENTS[r]||e||n?"":"</"+t+">"}function getAttributeValue(t,e){var n=UPDATE_PROPERTIES[e];return n?t[n]:t.getAttribute(e)}function emitHooks(t,e,n){t&&e.queue(function(){for(var r=0,i=t.length;r<i;r++)t[r].emit(e,n)})}function Block(t,e){this.expression=t,this.ending="/"+t,this.content=e}function ConditionalBlock(t,e){this.expressions=t,this.beginning=t.join("; "),this.ending="/"+this.beginning,this.contents=e}function EachBlock(t,e,n){this.expression=t,this.ending="/"+t,this.content=e,this.elseContent=n}function indexStartNode(t,e){for(var n=t.start,r=0;n=n.nextSibling;){if(n===t.end)return n;if(n.$bindItemStart&&n.$bindItemStart.itemFor===t.start){if(e===r)return n;r++}}}function updateRange(t,e,n,r,i,o,s){e?(e.start=r,e.end=i,e.condition=s,setNodeBounds(e,r,o)):t.addBinding(new RangeBinding(n,t,r,i,o,s))}function setNodeBounds(t,e,n){setNodeProperty(e,n?"$bindItemStart":"$bindStart",t)}function appendContent(t,e,n){for(var r=0,i=e.length;r<i;r++)e[r].appendTo(t,n)}function attachContent(t,e,n,r){for(var i=0,o=n.length;i<o;i++){for(;e&&e.hasAttribute&&e.hasAttribute("data-no-attach");)e=e.nextSibling;e=n[i].attachTo(t,e,r)}return e}function contentHtml(t,e,n){for(var r="",i=0,o=t.length;i<o;i++)r+=t[i].get(e,n);return r}function replaceRange(t,e,n,r,i,o){var s=e.parentNode;if(e.$bindItemStart&&r.firstChild&&(setNodeProperty(r.firstChild,"$bindItemStart",e.$bindItemStart),e.$bindItemStart.start=r.firstChild),e===n)return s.replaceChild(r,e),void emitRemoved(t,e,i);for(var a,c=o?e.nextSibling:e;c;){if(a=c.nextSibling,emitRemoved(t,c,i),o&&c===n){a=n;break}if(s.removeChild(c),c===n)break;c=a}s.insertBefore(r,a||null)}function emitRemoved(t,e,n){t.removeNode(e),emitRemovedBinding(t,n,e,"$bindNode"),emitRemovedBinding(t,n,e,"$bindStart"),emitRemovedBinding(t,n,e,"$bindItemStart");var r=e.$bindAttributes;if(r)for(var i in e.$bindAttributes=null,r)t.removeBinding(r[i]);for(e=e.firstChild;e;e=e.nextSibling)emitRemoved(t,e,n)}function emitRemovedBinding(t,e,n,r){var i=n[r];i&&(n[r]=null,i!==e&&t.removeBinding(i))}function attachError(t,e){return"undefined"!=typeof console&&console.error("Attach failed for",e,"within",t),new Error("Attaching bindings failed, because HTML structure does not match client rendering.")}function Binding(){this.meta=null}function NodeBinding(t,e,n){this.template=t,this.context=e,this.node=n,this.meta=null,setNodeProperty(n,"$bindNode",this)}function AttributeBindingsMap(){}function AttributeBinding(t,e,n,r){this.template=t,this.context=e,this.element=n,this.name=r,this.meta=null,(n.$bindAttributes||(n.$bindAttributes=new AttributeBindingsMap))[r]=this}function RangeBinding(t,e,n,r,i,o){this.template=t,this.context=e,this.start=n,this.end=r,this.itemFor=i,this.condition=o,this.meta=null,setNodeBounds(this,n,i)}function __noop_65(){}function mergeInto(t,e){for(var n in t)e[n]=t[n]}function escapeHtml(t){return(t+="").replace(/[&<]/g,function(t){return"&"===t?"&amp;":"&lt;"})}function escapeAttribute(t){return(t+="").replace(/[&"]/g,function(t){return"&"===t?"&amp;":"&quot;"})}function equalConditions(t,e){return t===e||t instanceof Template&&t.equals(e)}function splitData(t,e){var n=t.cloneNode(!1);return n.deleteData(0,e),t.deleteData(e,t.length-e),t.parentNode.insertBefore(n,t.nextSibling||null),n}function setNodeProperty(t,e,n){return t[e]=n}function normalizeLineBreaks(t){return t}_$saddle_65.CREATE_PROPERTIES=CREATE_PROPERTIES,_$saddle_65.BOOLEAN_PROPERTIES=BOOLEAN_PROPERTIES,_$saddle_65.INTEGER_PROPERTIES=INTEGER_PROPERTIES,_$saddle_65.STRING_PROPERTIES=STRING_PROPERTIES,_$saddle_65.UPDATE_PROPERTIES=UPDATE_PROPERTIES,_$saddle_65.VOID_ELEMENTS=VOID_ELEMENTS,_$saddle_65.NAMESPACE_URIS=NAMESPACE_URIS,_$saddle_65.Template=Template,_$saddle_65.Doctype=Doctype,_$saddle_65.Text=Text,_$saddle_65.DynamicText=DynamicText,_$saddle_65.Comment=Comment,_$saddle_65.DynamicComment=DynamicComment,_$saddle_65.Html=Html,_$saddle_65.DynamicHtml=DynamicHtml,_$saddle_65.Element=Element,_$saddle_65.DynamicElement=DynamicElement,_$saddle_65.Block=Block,_$saddle_65.ConditionalBlock=ConditionalBlock,_$saddle_65.EachBlock=EachBlock,_$saddle_65.Attribute=Attribute,_$saddle_65.DynamicAttribute=DynamicAttribute,_$saddle_65.Binding=Binding,_$saddle_65.NodeBinding=NodeBinding,_$saddle_65.AttributeBinding=AttributeBinding,_$saddle_65.RangeBinding=RangeBinding,Template.prototype.toString=function(){return this.source},Template.prototype.get=function(t,e){return contentHtml(this.content,t,e)},Template.prototype.getFragment=function(t,e){var n=document.createDocumentFragment();return this.appendTo(n,t,e),n},Template.prototype.appendTo=function(t,e){e.pause(),appendContent(t,this.content,e),e.unpause()},Template.prototype.attachTo=function(t,e,n){n.pause();e=attachContent(t,e,this.content,n);return n.unpause(),e},Template.prototype.update=function(){},Template.prototype.stringify=function(t){return null==t?"":t+""},Template.prototype.equals=function(t){return this===t},Template.prototype.module="templates",Template.prototype.type="Template",Template.prototype.serialize=function(){return serializeObject.instance(this,this.content,this.source)},Doctype.prototype=Object.create(Template.prototype),Doctype.prototype.constructor=Doctype,Doctype.prototype.get=function(){var t=this.publicId?' PUBLIC "'+this.publicId+'"':"",e=this.systemId?this.publicId?' "'+this.systemId+'"':' SYSTEM "'+this.systemId+'"':"";return"<!DOCTYPE "+this.name+t+e+">"},Doctype.prototype.appendTo=function(){},Doctype.prototype.attachTo=function(t,e){if(!e||10!==e.nodeType)throw attachError(t,e);return e.nextSibling},Doctype.prototype.type="Doctype",Doctype.prototype.serialize=function(){return serializeObject.instance(this,this.name,this.publicId,this.systemId)},Text.prototype=Object.create(Template.prototype),Text.prototype.constructor=Text,Text.prototype.get=function(t,e){return e?this.data:this.escaped},Text.prototype.appendTo=function(t){var e=document.createTextNode(this.data);t.appendChild(e)},Text.prototype.attachTo=function(t,e){return attachText(t,e,this.data,this)},Text.prototype.type="Text",Text.prototype.serialize=function(){return serializeObject.instance(this,this.data)},DynamicText.prototype=Object.create(Template.prototype),DynamicText.prototype.constructor=DynamicText,DynamicText.prototype.get=function(t,e){var n=this.expression.get(t);if(n instanceof Template){do{n=n.get(t,e)}while(n instanceof Template);return n}var r=this.stringify(n);return e?r:escapeHtml(r)},DynamicText.prototype.appendTo=function(t,e,n){var r=this.expression.get(e);if(r instanceof Template){var i=document.createComment(this.expression),o=document.createComment("/"+this.expression),s=this.getCondition(e);return t.appendChild(i),r.appendTo(t,e),t.appendChild(o),void updateRange(e,n,this,i,o,null,s)}var a=this.stringify(r),c=document.createTextNode(a);t.appendChild(c),addNodeBinding(this,e,c)},DynamicText.prototype.attachTo=function(t,e,n){var r=this.expression.get(n);if(r instanceof Template){var i=document.createComment(this.expression),o=document.createComment("/"+this.expression),s=this.getCondition(n);return t.insertBefore(i,e||null),e=r.attachTo(t,e,n),t.insertBefore(o,e||null),updateRange(n,null,this,i,o,null,s),e}return attachText(t,e,this.stringify(r),this,n)},DynamicText.prototype.update=function(t,e){if(e instanceof RangeBinding)this._blockUpdate(t,e);else{var n=this.expression.get(t);if(n instanceof Template){var r=e.node;if(!r.parentNode)return;replaceRange(t,r,r,this.getFragment(t),e)}else e.node.data=this.stringify(n)}},DynamicText.prototype.getCondition=function(t){return this.expression.get(t)},DynamicText.prototype.type="DynamicText",DynamicText.prototype.serialize=function(){return serializeObject.instance(this,this.expression)},Comment.prototype=Object.create(Template.prototype),Comment.prototype.constructor=Comment,Comment.prototype.get=function(){return"\x3c!--"+this.data+"--\x3e"},Comment.prototype.appendTo=function(t,e){var n=document.createComment(this.data);t.appendChild(n),emitHooks(this.hooks,e,n)},Comment.prototype.attachTo=function(t,e,n){return attachComment(t,e,this.data,this,n)},Comment.prototype.type="Comment",Comment.prototype.serialize=function(){return serializeObject.instance(this,this.data,this.hooks)},DynamicComment.prototype=Object.create(Template.prototype),DynamicComment.prototype.constructor=DynamicComment,DynamicComment.prototype.get=function(t){var e=getUnescapedValue(this.expression,t);return"\x3c!--"+this.stringify(e)+"--\x3e"},DynamicComment.prototype.appendTo=function(t,e){var n=getUnescapedValue(this.expression,e),r=this.stringify(n),i=document.createComment(r);t.appendChild(i),addNodeBinding(this,e,i)},DynamicComment.prototype.attachTo=function(t,e,n){var r=getUnescapedValue(this.expression,n);return attachComment(t,e,this.stringify(r),this,n)},DynamicComment.prototype.update=function(t,e){var n=getUnescapedValue(this.expression,t);e.node.data=this.stringify(n)},DynamicComment.prototype.type="DynamicComment",DynamicComment.prototype.serialize=function(){return serializeObject.instance(this,this.expression,this.hooks)},Html.prototype=Object.create(Template.prototype),Html.prototype.constructor=Html,Html.prototype.get=function(){return this.data},Html.prototype.appendTo=function(t){var e=createHtmlFragment(t,this.data);t.appendChild(e)},Html.prototype.attachTo=function(t,e){return attachHtml(t,e,this.data)},Html.prototype.type="Html",Html.prototype.serialize=function(){return serializeObject.instance(this,this.data)},DynamicHtml.prototype=Object.create(Template.prototype),DynamicHtml.prototype.constructor=DynamicHtml,DynamicHtml.prototype.get=function(t){var e=getUnescapedValue(this.expression,t);return this.stringify(e)},DynamicHtml.prototype.appendTo=function(t,e,n){var r=document.createComment(this.expression),i=document.createComment(this.ending),o=getUnescapedValue(this.expression,e),s=createHtmlFragment(t,this.stringify(o));t.appendChild(r),t.appendChild(s),t.appendChild(i),updateRange(e,n,this,r,i)},DynamicHtml.prototype.attachTo=function(t,e,n){var r=document.createComment(this.expression),i=document.createComment(this.ending),o=getUnescapedValue(this.expression,n),s=this.stringify(o);return t.insertBefore(r,e||null),e=attachHtml(t,e,s),t.insertBefore(i,e||null),updateRange(n,null,this,r,i),e},DynamicHtml.prototype.update=function(t,e){var n=e.start.parentNode;if(n){var r=e.start,i=e.end,o=getUnescapedValue(this.expression,t);replaceRange(t,r,i,createHtmlFragment(n,this.stringify(o)),e,!0)}},DynamicHtml.prototype.type="DynamicHtml",DynamicHtml.prototype.serialize=function(){return serializeObject.instance(this,this.expression)},Attribute.prototype=Object.create(Template.prototype),Attribute.prototype.constructor=Attribute,Attribute.prototype.get=Attribute.prototype.getBound=function(t){return this.data},Attribute.prototype.type="Attribute",Attribute.prototype.serialize=function(){return serializeObject.instance(this,this.data,this.ns)},DynamicAttribute.prototype=Object.create(Attribute.prototype),DynamicAttribute.prototype.constructor=DynamicAttribute,DynamicAttribute.prototype.get=function(t){return getUnescapedValue(this.expression,t)},DynamicAttribute.prototype.getBound=function(t,e,n,r){return this.elementNs=r,t.addBinding(new AttributeBinding(this,t,e,n)),getUnescapedValue(this.expression,t)},DynamicAttribute.prototype.update=function(t,e){var n=getUnescapedValue(this.expression,t),r=e.element,i=!this.elementNs&&UPDATE_PROPERTIES[e.name];if(i){var o=STRING_PROPERTIES[e.name]?this.stringify(n):n;if(r[i]===o)return;r[i]=o}else!1!==n&&null!=n?(!0===n&&(n=e.name),this.ns?r.setAttributeNS(this.ns,e.name,n):r.setAttribute(e.name,n)):this.ns?r.removeAttributeNS(this.ns,e.name):r.removeAttribute(e.name)},DynamicAttribute.prototype.type="DynamicAttribute",DynamicAttribute.prototype.serialize=function(){return serializeObject.instance(this,this.expression,this.ns)},Element.prototype=Object.create(Template.prototype),Element.prototype.constructor=Element,Element.prototype.getTagName=function(){return this.tagName},Element.prototype.getEndTag=function(){return this.endTag},Element.prototype.get=function(t){var e=this.getTagName(t),n=this.getEndTag(e),r=[e];for(var i in this.attributes){var o=this.attributes[i].get(t);!0===o?r.push(i):!1!==o&&null!=o&&r.push(i+'="'+escapeAttribute(o)+'"')}var s="<"+r.join(" ")+this.startClose;return this.content?s+contentHtml(this.content,t,this.unescapedContent)+n:s+n},Element.prototype.appendTo=function(t,e){var n=this.getTagName(e),r=this.ns?document.createElementNS(this.ns,n):document.createElement(n);for(var i in this.attributes){var o=this.attributes[i],s=o.getBound(e,r,i,this.ns);if(!1!==s&&null!=s){var a=!this.ns&&CREATE_PROPERTIES[i];a?r[a]=s:(!0===s&&(s=i),o.ns?r.setAttributeNS(o.ns,i,s):r.setAttribute(i,s))}}this.content&&(this._bindContent(e,r),appendContent(r,this.content,e)),t.appendChild(r),emitHooks(this.hooks,e,r)},Element.prototype.attachTo=function(t,e,n){var r=this.getTagName(n);if(!e||1!==e.nodeType||e.tagName.toLowerCase()!==r.toLowerCase())throw attachError(t,e);for(var i in this.attributes)this.attributes[i].getBound(n,e,i,this.ns);return this.content&&(this._bindContent(n,e),attachContent(e,e.firstChild,this.content,n)),emitHooks(this.hooks,n,e),e.nextSibling},Element.prototype._bindContent=function(t,e){var n=this.bindContentToValue&&1===this.content.length&&this.content[0];if(n instanceof DynamicText){n.unbound=!0;var r=new DynamicAttribute(n.expression);t.addBinding(new AttributeBinding(r,t,e,"value"))}},Element.prototype.type="Element",Element.prototype.serialize=function(){return serializeObject.instance(this,this.tagName,this.attributes,this.content,this.hooks,this.selfClosing,this.notClosed,this.ns)},DynamicElement.prototype=Object.create(Element.prototype),DynamicElement.prototype.constructor=DynamicElement,DynamicElement.prototype.getTagName=function(t){return getUnescapedValue(this.tagName,t)},DynamicElement.prototype.getEndTag=function(t){return getEndTag(t,this.selfClosing,this.notClosed)},DynamicElement.prototype.type="DynamicElement",Block.prototype=Object.create(Template.prototype),Block.prototype.constructor=Block,Block.prototype.get=function(t,e){var n=t.child(this.expression);return contentHtml(this.content,n,e)},Block.prototype.appendTo=function(t,e,n){var r=e.child(this.expression),i=document.createComment(this.expression),o=document.createComment(this.ending),s=this.getCondition(e);t.appendChild(i),appendContent(t,this.content,r),t.appendChild(o),updateRange(e,n,this,i,o,null,s)},Block.prototype.attachTo=function(t,e,n){var r=n.child(this.expression),i=document.createComment(this.expression),o=document.createComment(this.ending),s=this.getCondition(n);return t.insertBefore(i,e||null),e=attachContent(t,e,this.content,r),t.insertBefore(o,e||null),updateRange(n,null,this,i,o,null,s),e},Block.prototype.type="Block",Block.prototype.serialize=function(){return serializeObject.instance(this,this.expression,this.content)},Block.prototype.update=function(t,e){if(e.start.parentNode){var n=this.getCondition(t);if(!equalConditions(n,e.condition))e.condition=n,replaceRange(t,e.start,e.end,this.getFragment(t,e),e)}},Block.prototype.getCondition=function(t){var e=this.expression.get(t);return"object"==typeof e?NaN:e},DynamicText.prototype._blockUpdate=Block.prototype.update,ConditionalBlock.prototype=Object.create(Block.prototype),ConditionalBlock.prototype.constructor=ConditionalBlock,ConditionalBlock.prototype.get=function(t,e){var n=this.getCondition(t);if(null==n)return"";var r=this.expressions[n],i=t.child(r);return contentHtml(this.contents[n],i,e)},ConditionalBlock.prototype.appendTo=function(t,e,n){var r=document.createComment(this.beginning),i=document.createComment(this.ending);t.appendChild(r);var o=this.getCondition(e);if(null!=o){var s=this.expressions[o],a=e.child(s);appendContent(t,this.contents[o],a)}t.appendChild(i),updateRange(e,n,this,r,i,null,o)},ConditionalBlock.prototype.attachTo=function(t,e,n){var r=document.createComment(this.beginning),i=document.createComment(this.ending);t.insertBefore(r,e||null);var o=this.getCondition(n);if(null!=o){var s=this.expressions[o],a=n.child(s);e=attachContent(t,e,this.contents[o],a)}return t.insertBefore(i,e||null),updateRange(n,null,this,r,i,null,o),e},ConditionalBlock.prototype.type="ConditionalBlock",ConditionalBlock.prototype.serialize=function(){return serializeObject.instance(this,this.expressions,this.contents)},ConditionalBlock.prototype.update=function(t,e){if(e.start.parentNode){var n=this.getCondition(t);if(!equalConditions(n,e.condition))e.condition=n,replaceRange(t,e.start,e.end,this.getFragment(t,e),e)}},ConditionalBlock.prototype.getCondition=function(t){for(var e=0,n=this.expressions.length;e<n;e++)if(this.expressions[e].truthy(t))return e},EachBlock.prototype=Object.create(Block.prototype),EachBlock.prototype.constructor=EachBlock,EachBlock.prototype.get=function(t,e){var n=this.expression.get(t);if(n&&n.length){for(var r="",i=0,o=n.length;i<o;i++){var s=t.eachChild(this.expression,i);r+=contentHtml(this.content,s,e)}return r}return this.elseContent?contentHtml(this.elseContent,t,e):""},EachBlock.prototype.appendTo=function(t,e,n){var r=this.expression.get(e),i=document.createComment(this.expression),o=document.createComment(this.ending);if(t.appendChild(i),r&&r.length)for(var s=0,a=r.length;s<a;s++){var c=e.eachChild(this.expression,s);this.appendItemTo(t,c,i)}else this.elseContent&&appendContent(t,this.elseContent,e);t.appendChild(o),updateRange(e,n,this,i,o)},EachBlock.prototype.appendItemTo=function(t,e,n,r){var i,o,s=t.lastChild;appendContent(t,this.content,e),s===t.lastChild?(i=o=document.createComment("empty"),t.appendChild(i)):(i=s&&s.nextSibling||t.firstChild,o=t.lastChild),updateRange(e,r,this,i,o,n)},EachBlock.prototype.attachTo=function(t,e,n){var r=this.expression.get(n),i=document.createComment(this.expression),o=document.createComment(this.ending);if(t.insertBefore(i,e||null),r&&r.length)for(var s=0,a=r.length;s<a;s++){var c=n.eachChild(this.expression,s);e=this.attachItemTo(t,e,c,i)}else this.elseContent&&(e=attachContent(t,e,this.elseContent,n));return t.insertBefore(o,e||null),updateRange(n,null,this,i,o),e},EachBlock.prototype.attachItemTo=function(t,e,n,r){var i,o,s=e&&e.previousSibling,a=attachContent(t,e,this.content,n);return a===e?(i=o=document.createComment("empty"),t.insertBefore(i,e||null)):(i=s&&s.nextSibling||t.firstChild,o=a&&a.previousSibling||t.lastChild),updateRange(n,null,this,i,o,r),a},EachBlock.prototype.update=function(t,e){if(e.start.parentNode){var n=e.start,r=e.end;if(e.itemFor){var i=document.createDocumentFragment();this.appendItemTo(i,t,e.itemFor,e)}else i=this.getFragment(t,e);replaceRange(t,n,r,i,e)}},EachBlock.prototype.insert=function(t,e,n,r){var i=e.start.parentNode;if(i){if(0===n&&this.expression.get(t).length===r)return this.update(t,e);for(var o=indexStartNode(e,n),s=document.createDocumentFragment(),a=n,c=n+r;a<c;a++){var l=t.eachChild(this.expression,a);this.appendItemTo(s,l,e.start)}i.insertBefore(s,o||null)}},EachBlock.prototype.remove=function(t,e,n,r){var i=e.start.parentNode;if(i){if(0===n&&0===this.expression.get(t).length)return this.update(t,e);for(var o=indexStartNode(e,n),s=0;o;){if(o===e.end)return;if(o.$bindItemStart&&o.$bindItemStart.itemFor===e.start&&r===s++)return;var a=o.nextSibling;i.removeChild(o),emitRemoved(t,o,e),o=a}}},EachBlock.prototype.move=function(t,e,n,r,i){var o=e.start.parentNode;if(o){for(var s=indexStartNode(e,n),a=document.createDocumentFragment(),c=0;s&&s!==e.end&&(!s.$bindItemStart||s.$bindItemStart.itemFor!==e.start||i!==c++);){var l=s.nextSibling;a.appendChild(s),s=l}s=indexStartNode(e,r),o.insertBefore(a,s||null)}},EachBlock.prototype.type="EachBlock",EachBlock.prototype.serialize=function(){return serializeObject.instance(this,this.expression,this.content,this.elseContent)},Binding.prototype.type="Binding",Binding.prototype.update=function(){this.context.pause(),this.template.update(this.context,this),this.context.unpause()},Binding.prototype.insert=function(){this.update()},Binding.prototype.remove=function(){this.update()},Binding.prototype.move=function(){this.update()},NodeBinding.prototype=Object.create(Binding.prototype),NodeBinding.prototype.constructor=NodeBinding,NodeBinding.prototype.type="NodeBinding",AttributeBinding.prototype=Object.create(Binding.prototype),AttributeBinding.prototype.constructor=AttributeBinding,AttributeBinding.prototype.type="AttributeBinding",RangeBinding.prototype=Object.create(Binding.prototype),RangeBinding.prototype.constructor=RangeBinding,RangeBinding.prototype.type="RangeBinding",RangeBinding.prototype.insert=function(t,e){this.context.pause(),this.template.insert?this.template.insert(this.context,this,t,e):this.template.update(this.context,this),this.context.unpause()},RangeBinding.prototype.remove=function(t,e){this.context.pause(),this.template.remove?this.template.remove(this.context,this,t,e):this.template.update(this.context,this),this.context.unpause()},RangeBinding.prototype.move=function(t,e,n){this.context.pause(),this.template.move?this.template.move(this.context,this,t,e,n):this.template.update(this.context,this),this.context.unpause()},Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),function(){if("undefined"!=typeof document){var t=document.createElement("div");t.innerHTML="\r\n<br>\n";var e=t.firstChild.data.length,n=t.lastChild.data.length;1===e&&1===n?normalizeLineBreaks=function(t){return t.replace(/\r\n/g,"\n")}:2===e&&2===n&&(normalizeLineBreaks=function(t){return t.replace(/(^|[^\r])(\n+)/g,function(t,e,n){for(var r=n.length;r--;)e+="\r\n";return e})});var r=document.createElement("input");r.defaultValue="x","x"!==r.value&&(CREATE_PROPERTIES.value="value");try{document.createTextNode("").$try=0}catch(t){setNodeProperty=function(t,e,n){if(3===t.nodeType){var r=t.previousSibling;return r&&r.$bindProxy===t||((r=document.createComment("proxy")).$bindProxy=t,t.parentNode.insertBefore(r,t||null)),r[e]=n}return t[e]=n}}}}();var _$util_12={concat:function(t,e){return t?e?t.concat(e):t:e},hasKeys:function(t){if(!t)return!1;for(var e in t)return!0;return!1},traverseAndCreate:function(t,e){var n=e.length;if(!n)return t;for(var r=0;r<n;r++){var i=e[r];t=t[i]||(t[i]={})}return t}},_$expressions_8={};(function(t){var e=_$serializeObject_66({}),n=_$templates_11({}),r=n.Template,i=_$util_12.concat;function o(t,e){if(!t)return e;for(var n=0,r=t.length;n<r;n++){if(null==e)return e;e=e[t[n]]}return e}function s(t){return Array.isArray(t)?t.length>0:!!t}function a(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];e[n]="object"==typeof r?r.item:r}return e}function c(t,e){return"object"!=typeof t?t:t instanceof r?l(t,e):Array.isArray(t)?function(t,e){for(var n=0;n<t.length;n++)if(u(t[n]))return h(t,e);return t}(t,e):function(t,e){return u(t)?function(t,e){var n={};for(var r in t)n[r]=c(t[r],e);return n}(t,e):t}(t,e)}function l(t,e){for(var n=1e3;t instanceof r;){if(--n<0)throw new Error("Maximum template render passes exceeded");t=t.get(e,!0)}return t}function u(t){if(!t)return!1;if(t.constructor!==Object)return!1;for(var e in t)if(t[e]instanceof r)return!0;return!1}function h(t,e){for(var n=new Array(t.length),r=0;r<t.length;r++)n[r]=c(t[r],e);return n}function p(t,e,n,r,i,o,s,a){this.source=t,this.blockType=e,this.isEnd=n,this.as=r,this.keyAs=i,this.unescaped=o,this.bindType=s,this.valueType=a}function f(t){this.meta=t}function d(t,e){this.value=t,this.meta=e}function m(t,e){this.segments=t,this.meta=e}function _(t,e){this.segments=t,this.meta=e}function g(t,e,n){this.alias=t,this.segments=e,this.meta=n}function y(t,e,n){this.attribute=t,this.segments=e,this.meta=n}function v(t,e,n,r){this.before=t,this.inside=e,this.afterSegments=n,this.meta=r}function b(t,e){if(!(t instanceof r))throw new Error("DeferRenderExpression requires a Template argument");this.template=t,this.meta=e}function w(t,e,n){this.items=t,this.afterSegments=e,this.meta=n}function E(t,e,n){this.properties=t,this.afterSegments=e,this.meta=n}function x(t,e,n,r){this.segments=t,this.args=e,this.afterSegments=n,this.meta=r;var i=t&&t.slice();this.lastSegment=i&&i.pop(),this.parentSegments=i&&i.length?i:null}function C(t,e,n,r){x.call(this,t,e,n,r)}function S(t,e,n,r){this.name=t,this.args=e,this.afterSegments=n,this.meta=r,this.getFn=_$operatorFns_9.get[t],this.setFn=_$operatorFns_9.set[t]}function k(t,e,n){this.args=t,this.afterSegments=e,this.meta=n}function T(t,e){this.expression=t,this.meta=e}function $(t,e){this.expression=t,this.meta=e}function D(t,e,n){if(t instanceof f||t instanceof r)return t.dependencies(e,n)}function R(t,e,n){var r=e.resolve(n);return r?t?(t.push(r),t):[r]:t}function O(t,e,n){if(!e.segments.length)return t;var r=e.resolve(n);return r?t?(t.pop(),t.push(r),t):[r]:t}_$expressions_8.lookup=o,_$expressions_8.templateTruthy=s,_$expressions_8.pathSegments=a,_$expressions_8.renderValue=c,_$expressions_8.renderTemplate=l,_$expressions_8.ExpressionMeta=p,_$expressions_8.Expression=f,_$expressions_8.LiteralExpression=d,_$expressions_8.PathExpression=m,_$expressions_8.RelativePathExpression=_,_$expressions_8.AliasPathExpression=g,_$expressions_8.AttributePathExpression=y,_$expressions_8.BracketsExpression=v,_$expressions_8.DeferRenderExpression=b,_$expressions_8.ArrayExpression=w,_$expressions_8.ObjectExpression=E,_$expressions_8.FnExpression=x,_$expressions_8.OperatorExpression=S,_$expressions_8.NewExpression=C,_$expressions_8.SequenceExpression=k,_$expressions_8.ViewParentExpression=T,_$expressions_8.ScopedModelExpression=$,p.prototype.module="expressions",p.prototype.type="ExpressionMeta",p.prototype.serialize=function(){return e.instance(this,this.source,this.blockType,this.isEnd,this.as,this.keyAs,this.unescaped,this.bindType,this.valueType)},f.prototype.module="expressions",f.prototype.type="Expression",f.prototype.serialize=function(){return e.instance(this,this.meta)},f.prototype.toString=function(){return this.meta&&this.meta.source},f.prototype.truthy=function(t){var e=this.meta.blockType;if("else"===e)return!0;var n=s(this.get(t,!0));return"unless"===e?!n:n},f.prototype.get=function(){},f.prototype.resolve=function(){},f.prototype.dependencies=function(){},f.prototype.pathSegments=function(t){var e=this.resolve(t);return e&&a(e)},f.prototype.set=function(t,e){var n=this.pathSegments(t);if(!n)throw new Error("Expression does not support setting");t.controller.model._set(n,e)},f.prototype._resolvePatch=function(t,e){return t&&t.expression===this&&null!=t.item?e.concat(t):e},f.prototype.isUnbound=function(t){var e=this.meta&&this.meta.bindType;return"unbound"===e||"bound"!==e&&t.unbound},f.prototype._lookupAndContextifyValue=function(t,e){return this.segments&&this.segments.length&&(t=l(t,e),t=o(this.segments,t)),t instanceof r&&!(t instanceof n.ContextClosure)&&(t=new n.ContextClosure(t,e)),t},d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.prototype.type="LiteralExpression",d.prototype.serialize=function(){return e.instance(this,this.value,this.meta)},d.prototype.get=function(){return this.value},m.prototype=Object.create(f.prototype),m.prototype.constructor=m,m.prototype.type="PathExpression",m.prototype.serialize=function(){return e.instance(this,this.segments,this.meta)},m.prototype.get=function(t){if(t.controller)return o(this.segments,t.controller.model.data)},m.prototype.resolve=function(t){if(t.controller){var e=i(t.controller._scope,this.segments);return this._resolvePatch(t,e)}},m.prototype.dependencies=function(t,e){if(t.controller)return R(D(o(this.segments,t.controller.model.data),t,e),this,t)},_.prototype=Object.create(f.prototype),_.prototype.constructor=_,_.prototype.type="RelativePathExpression",_.prototype.serialize=function(){return e.instance(this,this.segments,this.meta)},_.prototype.get=function(t){var e=t.forRelative(this),n=e.get();return this._lookupAndContextifyValue(n,e)},_.prototype.resolve=function(t){var e=t.forRelative(this),n=e.expression?e.expression.resolve(e):[];if(n){var r=n.concat(this.segments);return this._resolvePatch(t,r)}},_.prototype.dependencies=function(t,e){var n=t.forRelative(this);return O(n.expression&&n.expression.dependencies(n,e),this,t)},g.prototype=Object.create(f.prototype),g.prototype.constructor=g,g.prototype.type="AliasPathExpression",g.prototype.serialize=function(){return e.instance(this,this.alias,this.segments,this.meta)},g.prototype.get=function(t){var e=t.forAlias(this.alias);if(e){if(e.keyAlias===this.alias)return e.item;var n=e.get();return this._lookupAndContextifyValue(n,e)}},g.prototype.resolve=function(t){var e=t.forAlias(this.alias);if(e&&e.keyAlias!==this.alias){var n=e.expression.resolve(e);if(n){var r=n.concat(this.segments);return this._resolvePatch(t,r)}}},g.prototype.dependencies=function(t,e){var n=t.forAlias(this.alias);if(n){if(n.keyAlias===this.alias){var r=n.expression.resolve(n.parent);if(!r)return;return[r]}return O(n.expression.dependencies(n,e),this,t)}},y.prototype=Object.create(f.prototype),y.prototype.constructor=y,y.prototype.type="AttributePathExpression",y.prototype.serialize=function(){return e.instance(this,this.attribute,this.segments,this.meta)},y.prototype.get=function(t){var e=t.forAttribute(this.attribute);if(e){var n=e.attributes[this.attribute];return n instanceof f&&(n=n.get(e)),this._lookupAndContextifyValue(n,e)}},y.prototype.resolve=function(t){var e=t.forAttribute(this.attribute);if(e){var n,i=e.attributes[this.attribute];if((i instanceof f||i instanceof r)&&(n=i.resolve(e)),n){var o=n.concat(this.segments);return this._resolvePatch(t,o)}}},y.prototype.dependencies=function(t,e){var n=t.forAttribute(this.attribute);if(n)return O(D(n.attributes[this.attribute],n,e),this,t)},v.prototype=Object.create(f.prototype),v.prototype.constructor=v,v.prototype.type="BracketsExpression",v.prototype.serialize=function(){return e.instance(this,this.before,this.inside,this.afterSegments,this.meta)},v.prototype.get=function(t){var e=this.inside.get(t);if(null!=e){var n=this.before.get(t);if(n){var r=n[e];return this.afterSegments?o(this.afterSegments,r):r}}},v.prototype.resolve=function(t){var e=this.inside.get(t);if(null!=e){var n=this.before.resolve(t);if(n){var r=this.afterSegments?n.concat(e,this.afterSegments):n.concat(e);return this._resolvePatch(t,r)}}},v.prototype.dependencies=function(t,e){var n=this.before.dependencies(t,e);n&&n.pop();var r=this.inside.dependencies(t,e);return R(i(n,r),this,t)},b.prototype=Object.create(f.prototype),b.prototype.constructor=b,b.prototype.type="DeferRenderExpression",b.prototype.serialize=function(){return e.instance(this,this.template,this.meta)},b.prototype.get=function(t){return new n.ContextClosure(this.template,t)},w.prototype=Object.create(f.prototype),w.prototype.constructor=w,w.prototype.type="ArrayExpression",w.prototype.serialize=function(){return e.instance(this,this.items,this.afterSegments,this.meta)},w.prototype.get=function(t){for(var e=new Array(this.items.length),n=0;n<this.items.length;n++){var r=this.items[n].get(t);e[n]=r}return this.afterSegments?o(this.afterSegments,e):e},w.prototype.dependencies=function(t,e){if(this.items){for(var n,r=0;r<this.items.length;r++){var o=this.items[r].dependencies(t,e);n=i(n,o)}return n}},E.prototype=Object.create(f.prototype),E.prototype.constructor=E,E.prototype.type="ObjectExpression",E.prototype.serialize=function(){return e.instance(this,this.properties,this.afterSegments,this.meta)},E.prototype.get=function(t){var e={};for(var n in this.properties){var r=this.properties[n].get(t);e[n]=r}return this.afterSegments?o(this.afterSegments,e):e},E.prototype.dependencies=function(t,e){if(this.properties){var n;for(var r in this.properties){var o=this.properties[r].dependencies(t,e);n=i(n,o)}return n}},x.prototype=Object.create(f.prototype),x.prototype.constructor=x,x.prototype.type="FnExpression",x.prototype.serialize=function(){return e.instance(this,this.segments,this.args,this.afterSegments,this.meta)},x.prototype.get=function(t){var e=this.apply(t);return this.afterSegments?o(this.afterSegments,e):e},x.prototype.apply=function(t,e){if(t.controller){var n=this._lookupParent(t),r=n[this.lastSegment],i=r.get||r;return this._applyFn(i,t,e,n)}},x.prototype._lookupParent=function(e){var n=e.controller,r=this.parentSegments,i=r?o(r,n):n;if(i&&i[this.lastSegment])return i;var s=n.page;if(n!==s&&(i=r?o(r,s):s)&&i[this.lastSegment])return i;if((i=r?o(r,t):t)&&i[this.lastSegment])return i;throw new Error("Function not found for: "+this.segments.join("."))},x.prototype._getInputs=function(t){for(var e=[],n=0,r=this.args.length;n<r;n++){var i=this.args[n].get(t);e.push(c(i,t))}return e},x.prototype._applyFn=function(t,e,n,r){if(!this.args)return n?t.apply(r,n):t.call(r);var i=this._getInputs(e);if(n)for(var o=0,s=n.length;o<s;o++)i.push(n[o]);return t.apply(r,i)},x.prototype.dependencies=function(t,e){var n=[];if(!this.args)return n;for(var r=0,i=this.args.length;r<i;r++){var o=this.args[r].dependencies(t,e);if(o&&!(o.length<1)){for(var s=o.length-1,a=0;a<s;a++)n.push(o[a]);var c=o[s];"*"!==c[c.length-1]&&(c=c.concat("*")),n.push(c)}}return n},x.prototype.set=function(t,e){for(var n,r,i=t.controller;i&&!(n=(r=this.parentSegments?o(this.parentSegments,i):i)&&r[this.lastSegment]);)i=i.parent;var s=n&&n.set;if(!s)throw new Error("No setter function for: "+this.segments.join("."));var a=this._getInputs(t);a.unshift(e);var c=s.apply(r,a);for(var l in c)this.args[l].set(t,c[l])},C.prototype=Object.create(x.prototype),C.prototype.constructor=C,C.prototype.type="NewExpression",C.prototype._applyFn=function(t,e){if(!this.args)return new t;var n=this._getInputs(e);return n.unshift(null),new(t.bind.apply(t,n))},S.prototype=Object.create(x.prototype),S.prototype.constructor=S,S.prototype.type="OperatorExpression",S.prototype.serialize=function(){return e.instance(this,this.name,this.args,this.afterSegments,this.meta)},S.prototype.apply=function(t){var e=this._getInputs(t);return this.getFn.apply(null,e)},S.prototype.set=function(t,e){var n=this._getInputs(t);n.unshift(e);var r=this.setFn.apply(null,n);for(var i in r)this.args[i].set(t,r[i])},k.prototype=Object.create(S.prototype),k.prototype.constructor=k,k.prototype.type="SequenceExpression",k.prototype.serialize=function(){return e.instance(this,this.args,this.afterSegments,this.meta)},k.prototype.name=",",k.prototype.getFn=_$operatorFns_9.get[","],k.prototype.resolve=function(t){return this.args[this.args.length-1].resolve(t)},k.prototype.dependencies=function(t,e){for(var n=[],r=0,i=this.args.length;r<i;r++)for(var o=this.args[r].dependencies(t,e),s=0,a=o.length;s<a;s++)n.push(o[s]);return n},T.prototype=Object.create(f.prototype),T.prototype.constructor=T,T.prototype.type="ViewParentExpression",T.prototype.serialize=function(){return e.instance(this,this.expression,this.meta)},T.prototype.get=function(t){var e=t.forViewParent();return this.expression.get(e)},T.prototype.resolve=function(t){var e=t.forViewParent();return this.expression.resolve(e)},T.prototype.dependencies=function(t,e){var n=t.forViewParent();return this.expression.dependencies(n,e)},T.prototype.pathSegments=function(t){var e=t.forViewParent();return this.expression.pathSegments(e)},T.prototype.set=function(t,e){var n=t.forViewParent();return this.expression.set(n,e)},$.prototype=Object.create(f.prototype),$.prototype.constructor=$,$.prototype.type="ScopedModelExpression",$.prototype.serialize=function(){return e.instance(this,this.expression,this.meta)},$.prototype.get=function(t){var e=this.pathSegments(t);if(e)return t.controller.model.scope(e.join("."))},$.prototype.resolve=function(t){return this.expression.resolve(t)},$.prototype.dependencies=function(t,e){return this.expression.dependencies(t,e)},$.prototype.pathSegments=function(t){return this.expression.pathSegments(t)},$.prototype.set=function(t,e){return this.expression.set(t,e)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var _$derbyTemplates_6={};_$derbyTemplates_6.contexts=_$contexts_7,_$derbyTemplates_6.expressions=_$expressions_8,_$derbyTemplates_6.operatorFns=_$operatorFns_9,_$derbyTemplates_6.options=_$options_10({}),_$derbyTemplates_6.templates=_$templates_11({});var _$Dom_16=Dom;function Dom(t){this.controller=t,this._listeners=null}function DomListener(t,e,n,r){this.type=t,this.target=e,this.listener=n,this.useCapture=!!r}function DestroyListener(t,e){DomListener.call(this,"destroy",t,e)}Dom.prototype._initListeners=function(){var t=this;return this.controller.on("destroy",function(){var e=t._listeners;if(e){for(var n=e.length;n--;)e[n].remove();t._listeners=null}}),this._listeners=[]},Dom.prototype._listenerIndex=function(t){var e=this._listeners;if(!e)return-1;for(var n=e.length;n--;)if(e[n].equals(t))return n;return-1},Dom.prototype.addListener=function(t,e,n,r){"function"==typeof e&&(r=n,n=e,e=document);var i="destroy"===t?new DestroyListener(e,n):new DomListener(t,e,n,r);-1===this._listenerIndex(i)&&(this._listeners||this._initListeners()).push(i);i.add()},Dom.prototype.on=Dom.prototype.addListener,Dom.prototype.once=function(t,e,n,r){"function"==typeof e&&(r=n,n=e,e=document),this.addListener(t,e,function o(){i.removeListener(t,e,o,r);return n.apply(this,arguments)},r);var i=this},Dom.prototype.removeListener=function(t,e,n,r){"function"==typeof e&&(r=n,n=e,e=document);var i=new DomListener(t,e,n,r);i.remove();var o=this._listenerIndex(i);o>-1&&this._listeners.splice(o,1)},DomListener.prototype.equals=function(t){return this.listener===t.listener&&this.target===t.target&&this.type===t.type&&this.useCapture===t.useCapture},DomListener.prototype.add=function(){this.target.addEventListener(this.type,this.listener,this.useCapture)},DomListener.prototype.remove=function(){this.target.removeEventListener(this.type,this.listener,this.useCapture)},DestroyListener.prototype=new DomListener,DestroyListener.prototype.add=function(){var t=this.target.$destroyListeners||(this.target.$destroyListeners=[]);-1===t.indexOf(this.listener)&&t.push(this.listener)},DestroyListener.prototype.remove=function(){var t=this.target.$destroyListeners;if(t){var e=t.indexOf(this.listener);-1!==e&&t.splice(e,1)}};var __EventEmitter_14=_$EventEmitter_23.EventEmitter,_$Controller_14=Controller;function Controller(t,e,n){__EventEmitter_14.call(this),this.dom=new _$Dom_16(this),this.app=t,this.page=e,this.model=n,n.data.$controller=this}_$util_64.mergeInto(Controller.prototype,__EventEmitter_14.prototype),Controller.prototype.emitCancellable=function(){var t=!1;var e=Array.prototype.slice.call(arguments);return e.push(function(){t=!0}),this.emit.apply(this,e),t},Controller.prototype.emitDelayable=function(){var t=Array.prototype.slice.call(arguments),e=t.pop(),n=!1;return t.push(function(){return n=!0,e}),this.emit.apply(this,t),n||e(),n};var _$components_19={},__templates_19=_$derbyTemplates_6.templates,expressions=_$derbyTemplates_6.expressions,slice=[].slice;function Component(t,e){var n=t.controller,r=t.id(),i=["$components",r],o=n.model.root.eventContext(r);o._at=i.join("."),e.id=r,o._set(i,e),o.data=e,_$Controller_14.call(this,n.app,n.page,o),this.parent=n,this.context=t.componentChild(this),this.id=r,this._scope=i,this.page._components[r]=this,this.isDestroyed=!1}function ComponentAttribute(t,e,n){this.expression=t,this.model=e,this.key=n}function ComponentAttributeBinding(t,e,n,r){this.template=new ComponentAttribute(t,e,n),this.context=r,this.condition=t.get(r)}function setModelAttributes(t,e){var n=t.parent.attributes;if(n)for(var r in n){setModelAttribute(t,e,r,n[r])}}function setModelAttribute(t,e,n,r){if(r instanceof expressions.Expression){var i=r.pathSegments(t);if(i)e.root.ref(e._at+"."+n,i.join("."),{updateIndices:!0});else{var o=new ComponentAttributeBinding(r,e,n,t);t.addBinding(o),e.set(n,o.condition)}}else if(r instanceof __templates_19.Template){var s=new __templates_19.ContextClosure(r,t);e.set(n,s)}else e.set(n,r)}function createFactory(t){return t.singleton||t.prototype.singleton?new SingletonComponentFactory(t):new ComponentFactory(t)}function emitInitHooks(t,e){if(t.initHooks)for(var n=0,r=t.initHooks.length;n<r;n++)t.initHooks[n].emit(t,e)}function ComponentModelData(){this.id=null,this.$controller=null}function ComponentFactory(t){this.constructor=t}function __noop_19(){}function SingletonComponentFactory(t){this.constructor=t,this.component=null,t.prototype.destroy=__noop_19}function isBasePrototype(t){return t===Object.prototype||t===Function.prototype||null===t}function getRootPrototype(t){for(;;){var e=Object.getPrototypeOf(t);if(isBasePrototype(e))return t;t=e}}_$components_19.Component=Component,_$components_19.ComponentAttribute=ComponentAttribute,_$components_19.ComponentAttributeBinding=ComponentAttributeBinding,_$components_19.ComponentFactory=ComponentFactory,_$components_19.SingletonComponentFactory=SingletonComponentFactory,_$components_19.createFactory=createFactory,_$components_19.extendComponent=extendComponent,_$util_64.mergeInto(Component.prototype,_$Controller_14.prototype),Component.prototype.destroy=function(){this.emit("destroy"),this.model.removeContextListeners(),this.model.destroy(),delete this.page._components[this.id];var t=this.page._eventModel.object.$components;t&&delete t.object[this.id],this.isDestroyed=!0},Component.prototype.bind=function(t){var e=this;return this.on("destroy",function(){e=null,t=null}),function(){if(t)return t.apply(e,arguments)}},Component.prototype.throttle=function(t,e){var n=this;if(this.on("destroy",function(){n=null,t=null}),null==e||"number"==typeof e){var r,i=e||0,o=function(){var e=s;s=null,r=+new Date,t&&e&&t.apply(n,e)};return function(){var t=!s;if(s=slice.call(arguments),t){var e=+new Date,n=Math.max(r+i-e,0);setTimeout(o,n)}}}if("function"==typeof e){var s;o=function(){var e=s;s=null,t&&e&&t.apply(n,e)};return function(){var t=!s;s=slice.call(arguments),t&&e(o)}}throw new Error("Second argument must be a delay function or number")},Component.prototype.debounce=function(t,e){if("number"!=typeof(e=e||0))throw new Error("Second argument must be a number");var n,r,i=this;this.on("destroy",function(){i=null,t=null});var o=function(){var e=n;n=null,r=null,t&&e&&t.apply(i,e)};return function(){n=slice.call(arguments),r&&clearTimeout(r),r=setTimeout(o,e)}},Component.prototype.debounceAsync=function(t,e){var n=1!==t.length;if("number"!=typeof(e=e||0))throw new Error("Second argument must be a number");var r=this;this.on("destroy",function(){r=null,t=null});var i,o,s=!1;function a(){var e=i;i=null,o=null,t&&e?(s=!0,e.push(a),t.apply(r,e)):s=!1}return function(){i=n?slice.call(arguments):[],o&&clearTimeout(o),s||(o=setTimeout(a,e))}},Component.prototype.get=function(t,e){return this.getView(t).get(this.context,e)},Component.prototype.getFragment=function(t){return this.getView(t).getFragment(this.context)},Component.prototype.getView=function(t){var e=this.context.getView();return t?this.app.views.find(t,e.namespace):e},Component.prototype.getAttribute=function(t){var e=this.context.forAttribute(t);if(e){var n=e.attributes[t];return n instanceof expressions.Expression&&(n=n.get(e)),expressions.renderValue(n,this.context)}},Component.prototype.setAttribute=function(t,e){this.context.parent.attributes[t]=e},Component.prototype.setNullAttribute=function(t,e){var n=this.context.parent.attributes;null==n[t]&&(n[t]=e)},ComponentAttribute.prototype.update=function(t,e){var n=this.expression.get(t);e.condition=n,this.model.setDiff(this.key,n)},ComponentAttributeBinding.prototype=Object.create(__templates_19.Binding.prototype),ComponentAttributeBinding.prototype.constructor=ComponentAttributeBinding,ComponentFactory.prototype.init=function(t){var e=new(this.constructor.DataConstructor||ComponentModelData),n=new this.constructor(t,e);return n.context||Component.call(n,t,e),setModelAttributes(n.context,n.model),emitInitHooks(t,n),n.emit("init",n),n.init&&n.init(n.model),n.context},ComponentFactory.prototype.create=function(t){var e=t.controller;e.emit("create",e),e.create&&e.create(e.model,e.dom)},SingletonComponentFactory.prototype.isSingleton=!0,SingletonComponentFactory.prototype.init=function(t){return this.component||(this.component=new this.constructor),t.componentChild(this.component)},SingletonComponentFactory.prototype.create=__noop_19;var _extendComponent=Object.setPrototypeOf&&Object.getPrototypeOf?function(t){var e=getRootPrototype(t.prototype);e!==Component.prototype&&Object.setPrototypeOf(e,Component.prototype)}:function(t){var e=t.prototype;t.prototype=Object.create(Component.prototype),t.prototype.constructor=t,_$util_64.mergeInto(t.prototype,e)};function extendComponent(t){t.prototype instanceof Component||_extendComponent(t)}var __expressions_21=_$derbyTemplates_6.expressions,_$EventModel_21=EventModel,nextId=1;function ModelRef(t,e,n,r){this.id=nextId++,this.model=t,this.segments=n,this.item=e,this.outside=r,this.result=r.child(e).refChild(this)}function RefOutMap(){}function RefChildrenMap(){}function BindingsMap(){}function ItemContextsMap(){}function EventModelsMap(){}function EventModel(){this.id=nextId++,this.object=null,this.array=null,this.arrayByReference=null,this.refOut=null,this.refChildren=null,this.bindings=null,this.itemContexts=null}function __hasKeys_21(t){for(var e in t)return!0;return!1}function childSetWildcard(t){t._set()}ModelRef.prototype.update=function(){var t=__expressions_21.pathSegments(this.segments),e=__expressions_21.lookup(t,this.model.data);if(this.item!==e){delete this.outside.child(this.item).refChildren[this.id],this.item=e;var n=this.outside.child(this.item);n.refChildren||(n.refChildren=new RefChildrenMap),n.refChildren[this.id]=this.result,this.result.update()}},EventModel.prototype.refChild=function(t){this.refChildren||(this.refChildren=new RefChildrenMap);var e=t.id;return this.refChildren[e]||(this.refChildren[e]=new EventModel),this.refChildren[e]},EventModel.prototype.arrayLookup=function(t,e,n){var r=__expressions_21.pathSegments(n),i=__expressions_21.lookup(r,t.data),o=this.at(n),s=this.at(e);o.refOut||(o.refOut=new RefOutMap);var a=o.refOut[s.id];return null==a&&(a=new ModelRef(t,i,n,s),o.refOut[s.id]=a),a},EventModel.prototype.child=function(t){var e;if("string"==typeof t)this.object||(this.object={}),e=this.object;else if("number"==typeof t)this.array||(this.array=[]),e=this.array;else{if(t instanceof ModelRef)return t.result;this.arrayByReference||(this.arrayByReference=[]),e=this.arrayByReference,t=t.item}return e[t]||(e[t]=new EventModel)},EventModel.prototype.at=function(t){if(null==t)return this;for(var e=this,n=0;n<t.length;n++)e=e.child(t[n]);return e},EventModel.prototype.isEmpty=function(){if(__hasKeys_21(this.dependancies))return!1;if(__hasKeys_21(this.itemContexts))return!1;if(this.object){if(__hasKeys_21(this.object))return!1;this.object=null}if(this.arrayByReference){for(var t=0;t<this.arrayByReference.length;t++)if(null!=this.arrayByReference[t])return!1;this.arrayByReference=null}if(this.array){for(t=0;t<this.array.length;t++)if(null!=this.array[t])return!1;this.array=null}return!0},EventModel.prototype._addItemContext=function(t){t._id||(t._id=nextId++),this.itemContexts||(this.itemContexts=new ItemContextsMap),this.itemContexts[t._id]=t},EventModel.prototype._removeItemContext=function(t){this.itemContexts&&delete this.itemContexts[t._id]},EventModel.prototype._addBinding=function(t){var e=this.bindings||(this.bindings=new BindingsMap);t.eventModels||(t.eventModels=new EventModelsMap),e[t.id]=t,t.eventModels[this.id]=this},EventModel.prototype.addBinding=function(t,e){this.at(t)._addBinding(e)},EventModel.prototype.addItemContext=function(t,e){this.at(t)._addItemContext(e)},EventModel.prototype.removeBinding=function(t){if(t.eventModels){for(var e in t.eventModels){var n=t.eventModels[e];n.bindings&&delete n.bindings[t.id]}t.eventModels=null}},EventModel.prototype._each=function(t,e,n){if(this.refChildren)for(var r in this.refChildren){var i=this.refChildren[r];i&&i._each(t,e,n)}if(t.length!==e){var o,s=t[e];"string"==typeof s?(o=this.object&&this.object[s])&&o._each(t,e+1,n):((o=this.array&&this.array[s])&&o._each(t,e+1,n),(o=this.arrayByReference&&this.arrayByReference[s])&&o._each(t,e+1,n))}else n(this)},EventModel.prototype.localUpdate=function(t,e){if(this.bindings)for(var n in this.bindings){var r=this.bindings[n];r&&r.update(t,e)}if(this.refOut)for(var n in this.refOut){var i=this.refOut[n];i&&i.update()}},EventModel.prototype.update=function(t,e){if(this.localUpdate(t,e),this.object)for(var n in this.object){(i=this.object[n])&&i.update()}if(this.array)for(var r=0;r<this.array.length;r++){(i=this.array[r])&&i.update()}if(this.arrayByReference)for(r=0;r<this.arrayByReference.length;r++){var i;(i=this.arrayByReference[r])&&i.update()}},EventModel.prototype._updateChildItemContexts=function(t,e){if(this.arrayByReference){null==t&&(t=0),null==e&&(e=this.arrayByReference.length);for(var n=t;n<e;n++){var r=this.arrayByReference[n]&&this.arrayByReference[n].itemContexts;if(r)for(var i in r)r[i].item=n}}},EventModel.prototype._updateArray=function(t,e){if(this.array){null==t&&(t=0),null==e&&(e=this.array.length);for(var n=t;n<e;n++){var r=this.array[n];r&&r.update()}}},EventModel.prototype._updateObject=function(){if(this.object)for(var t in this.object){var e=this.object[t];e&&e.update()}},EventModel.prototype._set=function(t,e){this.update(t,e)},EventModel.prototype._insert=function(t,e){if(this._updateArray(t),this.arrayByReference&&this.arrayByReference.length>t){for(var n=0;n<e;n++)this.arrayByReference.splice(t,0,null);this._updateChildItemContexts(t+e)}if(this.bindings)for(var r in this.bindings){var i=this.bindings[r];i&&i.insert(t,e)}this._updateObject()},EventModel.prototype._remove=function(t,e){if(this._updateArray(t),this.arrayByReference&&(this.arrayByReference.splice(t,e),this._updateChildItemContexts(t)),this.bindings)for(var n in this.bindings){var r=this.bindings[n];r&&r.remove(t,e)}this._updateObject()},EventModel.prototype._move=function(t,e,n){var r,i;t<e?(r=t,i=e+n):(r=e,i=t+n),this._updateArray(r,i);var o=this.arrayByReference;if(o&&o.length>r){var s=o.splice(t,n);o.splice.apply(o,[e,0].concat(s)),this._updateChildItemContexts(r,i)}if(this.bindings)for(var a in this.bindings){var c=this.bindings[a];c&&c.move(t,e,n)}this._updateObject()},EventModel.prototype.mutate=function(t,e){this._each(t,0,e);for(var n=0,r=t.length;n++<r;){var i=t.slice(0,n);i.push("*"),this._each(i,0,childSetWildcard)}},EventModel.prototype.set=function(t,e,n){this.mutate(t,function(t){t._set(e,n)})},EventModel.prototype.insert=function(t,e,n){this.mutate(t,function(t){t._insert(e,n)})},EventModel.prototype.remove=function(t,e,n){this.mutate(t,function(t){t._remove(e,n)})},EventModel.prototype.move=function(t,e,n,r){this.mutate(t,function(t){t._move(e,n,r)})};var _$textDiff_22={};function onStringInsert(t,e,n,r){e||(e=""),replaceText(t,e.slice(0,n)+r+e.slice(n),function(t){return n<t?t+r.length:t})}function onStringRemove(t,e,n,r){e||(e=""),replaceText(t,e.slice(0,n)+e.slice(n+r),function(t){return n<t?t-Math.min(r,t-n):t})}function replaceText(t,e,n){var r=n(t.selectionStart),i=n(t.selectionEnd),o=t.scrollTop;t.value=e,t.scrollTop!==o&&(t.scrollTop=o),document.activeElement===t&&(t.selectionStart=r,t.selectionEnd=i)}function onTextInput(t,e,n){var r=t._get(e)||"";if(r!==n){for(var i=0;r.charAt(i)===n.charAt(i);)i++;for(var o=0;r.charAt(r.length-1-o)===n.charAt(n.length-1-o)&&o+i<r.length&&o+i<n.length;)o++;if(r.length!==i+o){var s=r.length-i-o;t._stringRemove(e,i,s)}if(n.length!==i+o){var a=n.slice(i,n.length-o);t._stringInsert(e,i,a)}}}_$textDiff_22.onStringInsert=onStringInsert,_$textDiff_22.onStringRemove=onStringRemove,_$textDiff_22.onTextInput=onTextInput;var contexts=_$derbyTemplates_6.contexts,__expressions_17=_$derbyTemplates_6.expressions,__templates_17=_$derbyTemplates_6.templates,__DependencyOptions_17=_$derbyTemplates_6.options.DependencyOptions,documentListeners=_$documentListeners_20({}),_$Page_17=Page;function Page(t,e){_$Controller_14.call(this,t,this,e),this.params=null,this.init&&this.init(e),this.context=this._createContext(),this._eventModel=null,this._removeModelListeners=null,this._components={},this._addListeners()}function useLegacyListeners(t){var e=!0,n=t.on("changeImmediate",function(r,i){t.removeListener("changeImmediate",n),e=Array.isArray(i)});return t.set("$derby.testEvent",!0),e}function addDependencies(t,e,n){new BindingWrapper(t,e,n).updateDependencies()}_$util_64.mergeInto(Page.prototype,_$Controller_14.prototype),Page.prototype.$bodyClass=function(t){if(t){for(var e=[],n=t.split(":"),r=0,i=n.length;r<i;r++){var o=n.slice(0,r+1).join("-");e.push(o)}return e.join(" ")}},Page.prototype.$preventDefault=function(t){t.preventDefault()},Page.prototype.$stopPropagation=function(t){t.stopPropagation()},Page.prototype._setRenderParams=function(t){this.model.set("$render.ns",t),this.model.set("$render.params",this.params),this.model.set("$render.url",this.params&&this.params.url),this.model.set("$render.query",this.params&&this.params.query)},Page.prototype._setRenderPrefix=function(t){var e=t?t+":":"";this.model.set("$render.prefix",e)},Page.prototype.get=function(t,e,n){return this._setRenderPrefix(e),this.getView(t,e).get(this.context,n)},Page.prototype.getFragment=function(t,e){return this._setRenderPrefix(e),this.getView(t,e).getFragment(this.context)},Page.prototype.getView=function(t,e){return this.app.views.find(t,e)},Page.prototype.render=function(t){this.app.emit("render",this),this.context.pause(),this._setRenderParams(t);var e=this.getFragment("TitleElement",t),n=this.getFragment("BodyElement",t),r=document.getElementsByTagName("title")[0];r.parentNode.replaceChild(e,r),document.body.parentNode.replaceChild(n,document.body),this.context.unpause(),this.create&&this.create(this.model,this.dom),this.app.emit("routeDone",this,"render")},Page.prototype.attach=function(){this.context.pause();var t=this.model.get("$render.ns"),e=this.getView("TitleElement",t),n=this.getView("BodyElement",t),r=document.getElementsByTagName("title")[0];e.attachTo(r.parentNode,r,this.context),n.attachTo(document.body.parentNode,document.body,this.context),this.context.unpause(),this.create&&this.create(this.model,this.dom)},Page.prototype._createContext=function(){var t=new contexts.ContextMeta;t.views=this.app&&this.app.views;var e=new contexts.Context(t,this);return e.expression=new __expressions_17.PathExpression([]),e.alias="#root",e},Page.prototype._addListeners=function(){var t=this._eventModel=new _$EventModel_21;this._addModelListeners(t),this._addContextListeners(t)},Page.prototype.destroy=function(){for(var t in this.emit("destroy"),this._removeModelListeners(),this._components){this._components[t].destroy()}var e=this.model.silent();e.destroy("_page"),e.destroy("$components"),e.unloadAll&&e.unloadAll()},Page.prototype._addModelListeners=function(t){var e=this.model;if(e){if(useLegacyListeners(e))return this._addModelListenersLegacy(t);var n=e.on("changeImmediate",function(e,n){e=_$util_64.castSegments(e.slice()),t.set(e,n.previous,n.pass)}),r=e.on("loadImmediate",function(e){e=_$util_64.castSegments(e.slice()),t.set(e)}),i=e.on("unloadImmediate",function(e,n){e=_$util_64.castSegments(e.slice()),t.set(e,n.previous)}),o=e.on("insertImmediate",function(e,n){e=_$util_64.castSegments(e.slice()),t.insert(e,n.index,n.values.length)}),s=e.on("removeImmediate",function(e,n){e=_$util_64.castSegments(e.slice()),t.remove(e,n.index,n.values.length)}),a=e.on("moveImmediate",function(e,n){e=_$util_64.castSegments(e.slice()),t.move(e,n.from,n.to,n.howMany)});this._removeModelListeners=function(){e.removeListener("changeImmediate",n),e.removeListener("loadImmediate",r),e.removeListener("unloadImmediate",i),e.removeListener("insertImmediate",o),e.removeListener("removeImmediate",s),e.removeListener("moveImmediate",a)}}},Page.prototype._addModelListenersLegacy=function(t){var e=this.model;if(e){var n=e.on("changeImmediate",function(e,n){var r=n[1],i=n[2];e=_$util_64.castSegments(e.slice()),t.set(e,r,i)}),r=e.on("loadImmediate",function(e){e=_$util_64.castSegments(e.slice()),t.set(e)}),i=e.on("unloadImmediate",function(e){e=_$util_64.castSegments(e.slice()),t.set(e)}),o=e.on("insertImmediate",function(e,n){var r=n[0],i=n[1];e=_$util_64.castSegments(e.slice()),t.insert(e,r,i.length)}),s=e.on("removeImmediate",function(e,n){var r=n[0],i=n[1];e=_$util_64.castSegments(e.slice()),t.remove(e,r,i.length)}),a=e.on("moveImmediate",function(e,n){var r=n[0],i=n[1],o=n[2];e=_$util_64.castSegments(e.slice()),t.move(e,r,i,o)});this._removeModelListeners=function(){e.removeListener("changeImmediate",n),e.removeListener("loadImmediate",r),e.removeListener("unloadImmediate",i),e.removeListener("insertImmediate",o),e.removeListener("removeImmediate",s),e.removeListener("moveImmediate",a)}}},Page.prototype._addContextListeners=function(t){this.context.meta.addBinding=function(e){patchTextBinding(e);var n=e.template.expressions;if(n)for(var r=0,i=n.length;r<i;r++)addDependencies(t,n[r],e);else{var o=e.template.expression;addDependencies(t,o,e)}},this.context.meta.removeBinding=function(e){var n=e.meta;if(!n)return;for(var r=n.length;r--;)t.removeBinding(n[r])},this.context.meta.removeNode=function(t){var e=t.$component;e&&e.destroy();var n=t.$destroyListeners;if(n)for(var r=0;r<n.length;r++)n[r]()},this.context.meta.addItemContext=function(e){var n=e.expression.resolve(e);t.addItemContext(n,e)},this.context.meta.removeItemContext=function(t){}};var __nextId_17=1;function BindingWrapper(t,e,n){this.eventModel=t,this.expression=e,this.binding=n,this.id=__nextId_17++,this.eventModels=null,this.dependencies=null,this.ignoreTemplateDependency=n instanceof _$components_19.ComponentAttributeBinding||n.template instanceof __templates_17.DynamicText&&n instanceof __templates_17.RangeBinding,n.meta?n.meta.push(this):n.meta=[this]}function equalDependencies(t,e){var n=t?t.length:-1;if(n!==(e?e.length:-1))return!1;for(var r=0;r<n;r++){var i=t[r],o=e[r],s=i?i.length:-1,a=o?o.length:-1;if(s!==a)return!1;for(var c=0;c<a;c++)if(i[c]!==o[c])return!1}return!0}function patchTextBinding(t){t instanceof __templates_17.AttributeBinding&&"value"===t.name&&("INPUT"===t.element.tagName||"TEXTAREA"===t.element.tagName)&&documentListeners.inputSupportsSelection(t.element)&&t.template.expression.resolve(t.context)&&(t.update=textInputUpdate)}function textInputUpdate(t,e){textUpdate(this,this.element,t,e)}function textUpdate(t,e,n,r){if(r){if(r.$event&&r.$event.target===e)return;if(r.$stringInsert)return _$textDiff_22.onStringInsert(e,n,r.$stringInsert.index,r.$stringInsert.text);if(r.$stringRemove)return _$textDiff_22.onStringRemove(e,n,r.$stringRemove.index,r.$stringRemove.howMany)}t.template.update(t.context,t)}BindingWrapper.prototype.updateDependencies=function(){var t;this.ignoreTemplateDependency&&this.binding.condition instanceof __templates_17.Template&&(t=new __DependencyOptions_17).setIgnoreTemplate(this.binding.condition);var e=this.expression.dependencies(this.binding.context,t);if(this.dependencies){if(equalDependencies(this.dependencies,e))return;this.eventModel.removeBinding(this)}if(e){this.dependencies=e;for(var n=0,r=e.length;n<r;n++){var i=e[n];i&&this.eventModel.addBinding(i,this)}}},BindingWrapper.prototype.update=function(t,e){this.binding.update(t,e),this.updateDependencies()},BindingWrapper.prototype.insert=function(t,e){this.binding.insert(t,e),this.updateDependencies()},BindingWrapper.prototype.remove=function(t,e){this.binding.remove(t,e),this.updateDependencies()},BindingWrapper.prototype.move=function(t,e,n){this.binding.move(t,e,n),this.updateDependencies()};var _$_views_18=function(t,e){var n=t.expressions,r=t.templates;e.deserialize([[function(){return this.template=new r.Template([new r.Element("title",void 0,[new r.Block(new r.Template([new r.DynamicText(new n.PathExpression(["$render","prefix"],new n.ExpressionMeta("$render.prefix"))),new r.Text("Title")],"{{$render.prefix}}Title"),[new r.DynamicViewInstance(new r.Template([new r.DynamicText(new n.PathExpression(["$render","prefix"],new n.ExpressionMeta("$render.prefix"))),new r.Text("Title")],"{{$render.prefix}}Title"),{})])],void 0,!1)])},"TitleElement"],[function(){return this.template=new r.Template([new r.Element("body",{class:new r.DynamicAttribute(new n.FnExpression(["$bodyClass"],[new n.PathExpression(["$render","ns"])],void 0,new n.ExpressionMeta("$bodyClass($render.ns)")))},[new r.Block(new r.Template([new r.DynamicText(new n.PathExpression(["$render","prefix"],new n.ExpressionMeta("$render.prefix"))),new r.Text("Body")],"{{$render.prefix}}Body"),[new r.DynamicViewInstance(new r.Template([new r.DynamicText(new n.PathExpression(["$render","prefix"],new n.ExpressionMeta("$render.prefix"))),new r.Text("Body")],"{{$render.prefix}}Body"),{})])],void 0,!1,!0)])},"BodyElement"],[function(){return this.template=new r.Template([new r.Text("Derby App")])},"Title"],[function(){return this.template=new r.Template([new r.ViewInstance("d-codemirror:includes",{})])},"Head"],[function(){return this.template=new r.Template([new r.Element("div",{class:new r.Attribute("editor")},[new r.ViewInstance("d-codemirror",{text:new n.ViewParentExpression(new n.PathExpression(["codemirror","text"],new n.ExpressionMeta("codemirror.text"))),options:{tabSize:2,mode:"markdown"}})],void 0,!1),new r.Element("div",{class:new r.Attribute("preview")},[new r.DynamicHtml(new n.FnExpression(["markdownHtml"],[new n.PathExpression(["codemirror","text"])],void 0,new n.ExpressionMeta("unescaped markdownHtml(codemirror.text)",void 0,void 0,void 0,void 0,!0)))],void 0,!1)])},"Body"],[function(){return this.template=new r.Template([])},"Tail"],[function(){return this.template=new r.Template([new r.Marker("d-codemirror:index"),new r.Element("textarea",void 0,[new r.DynamicText(new n.PathExpression(["text"],new n.ExpressionMeta("text")))],[new r.AsProperty(["textarea"])],!1)])},"d-codemirror:index"],[function(){return this.template=new r.Template([new r.Block(new n.OperatorExpression("||",[new n.AttributePathExpression("static",[]),new n.LiteralExpression("/codemirror")],void 0,new n.ExpressionMeta("with @static || '/codemirror' as #static","with",void 0,"#static")),[new r.Element("link",{rel:new r.Attribute("stylesheet"),href:new r.DynamicAttribute(new r.Template([new r.DynamicText(new n.AliasPathExpression("#static",[],new n.ExpressionMeta("#static"))),new r.Text("/lib/codemirror.css")],"{{#static}}/lib/codemirror.css"))},null,void 0,!1),new r.Element("script",{src:new r.DynamicAttribute(new r.Template([new r.DynamicText(new n.AliasPathExpression("#static",[],new n.ExpressionMeta("#static"))),new r.Text("/lib/codemirror.js")],"{{#static}}/lib/codemirror.js"))},[],void 0,!1),new r.Element("script",void 0,[new r.Text("CodeMirror.modeURL = '"),new r.DynamicText(new n.AliasPathExpression("#static",[],new n.ExpressionMeta("#static"))),new r.Text("/mode/%N/%N.js';")],void 0,!1),new r.Element("script",{src:new r.DynamicAttribute(new r.Template([new r.DynamicText(new n.AliasPathExpression("#static",[],new n.ExpressionMeta("#static"))),new r.Text("/addon/mode/loadmode.js")],"{{#static}}/addon/mode/loadmode.js"))},[],void 0,!1)])])},"d-codemirror:includes"]])},path=_$pathBrowserify_29({}),__EventEmitter_13=_$EventEmitter_23.EventEmitter,__templates_13=_$derbyTemplates_6.templates,_$App_13=App;function App(t,e,n,r){__EventEmitter_13.call(this),this.derby=t,this.name=e,this.filename=n,this.scriptHash="6a3e56342cd1b52b76094611351eda4f",this.bundledAt=1580856689466,this.Page=createAppPage(t),this.proto=this.Page.prototype,this.views=new __templates_13.Views,this.tracksRoutes=_$browser_83.setup(this),this.model=null,this.page=null,this._pendingComponentMap={},this._init(r)}function createAppPage(t){var e=t&&t.Page||_$Page_17;function n(){e.apply(this,arguments)}return n.prototype=Object.create(e.prototype),n}_$util_64.mergeInto(App.prototype,__EventEmitter_13.prototype),App.prototype._init=function(){this._waitForAttach=!0,this._cancelAttach=!1,this.model=new this.derby.Model,_$_views_18(_$derbyTemplates_6,this.views),this._contentReady()},App.prototype._finishInit=function(){var t=this._getScript(),e=JSON.parse(t.nextSibling.innerHTML);this.model.createConnection(e),this.emit("model",this.model),_$util_64.isProduction="production"===e.nodeEnv,_$util_64.isProduction||this._autoRefresh(),this.model.unbundle(e);var n=this.createPage();if(n.params=this.model.get("$render.params"),this.emit("ready",n),this._waitForAttach=!1,this._cancelAttach)this.history.refresh();else{if(_$util_64.isProduction)try{n.attach()}catch(t){this.history.refresh(),console.warn("attachment error",t.stack)}else n.attach();this.emit("load",n)}},App.prototype._contentReady=function(){var t=!1,e=this;function n(){document.addEventListener?document.removeEventListener("DOMContentLoaded",n,!1):document.detachEvent("onreadystatechange",n),r()}function r(){if(!t){if(!document.body)return setTimeout(r,0);t=!0,setTimeout(function(){e._finishInit()},0)}}if("loading"!==document.readyState)return r();if(document.addEventListener)document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1);else if(document.attachEvent){var i;document.attachEvent("onreadystatechange",n),window.attachEvent("onload",n);try{i=null==window.frameElement}catch(t){}document.documentElement.doScroll&&i&&function e(){if(!t){try{document.documentElement.doScroll("left")}catch(t){return void setTimeout(e,0)}r()}}()}},App.prototype._getScript=function(){return document.querySelector("script[data-derby-app]")},App.prototype.use=_$util_64.use,App.prototype.serverUse=_$util_64.serverUse,App.prototype.loadViews=function(){},App.prototype.loadStyles=function(){},App.prototype.addViews=function(){throw new Error("Parsing not available. Registering a view from source should not be used in application code. Instead, specify a filename with view.file.")},App.prototype.component=function(t,e,n){if("function"==typeof t&&(e=t,t=null),"function"!=typeof e)throw new Error("Missing component constructor argument");var r,i,o,s,a=e.view;a&&"object"==typeof a?(r=a.is,i=a.file,o=a.source,s=a.dependencies):(r=e.is||e.prototype.name,i=e.view||e.prototype.view);var c=t||r||i&&path.basename(i,".html");if(!c)throw new Error("No view specified for component");if(i&&o)throw new Error("Component may not specify both a view file and source");var l=c.replace(/:index$/,""),u=this.views.nameMap[l];if((u&&u.componentFactory?u.componentFactory.constructor:this._pendingComponentMap[l])!==e){if(n&&u&&!u.fromSerialized)throw new Error('Dependencies cannot override existing views. Already registered "'+c+'"');if(this._pendingComponentMap[l]=e,s)for(var h=0;h<s.length;h++){var p=s[h];Array.isArray(p)?this.component(p[0],p[1],!0):this.component(null,p,!0)}var f;if(i?(this.loadViews(i,c),f=this.views.find(c)):o?(this.addViews(o,c),f=this.views.find(c)):f=t?this.views.find(c):this.views.register(c,""),!f){var d=this.views.findErrorMessage(c);throw new Error(d)}return _$components_19.extendComponent(e),f.componentFactory=_$components_19.createFactory(e),delete this._pendingComponentMap[l],this}},App.prototype.createPage=function(){this.page&&(this.emit("destroyPage",this.page),this.page.destroy());var t=new this.Page(this,this.model);return this.page=t,t},App.prototype.onRoute=function(t,e,n,r){if(this._waitForAttach)this._cancelAttach=!0;else if(this.emit("route",e),e.model.set("$render.params",e.params),e.model.set("$render.url",e.params.url),e.model.set("$render.query",e.params.query),r){var i=this;t.call(e,e,e.model,e.params,n,function(){i.emit("routeDone",e,"transition"),r()})}else t.call(e,e,e.model,e.params,n)},App.prototype._autoRefresh=function(){var t=this,e=this.model.connection;e.on("connected",function(){e.send({derby:"app",name:t.name,hash:t.scriptHash})}),e.on("receive",function(e){if(e.data.derby){var n=e.data;e.data=null,t._handleMessage(n.derby,n)}})},App.prototype._handleMessage=function(t,e){if("refreshViews"===t){new Function("return "+e.views)()(_$derbyTemplates_6,this.views);var n=this.model.get("$render.ns");this.page.render(n)}else if("refreshStyles"===t){var r=document.querySelector('style[data-filename="'+e.filename+'"]');r&&(r.innerHTML=e.css)}else"reload"===t&&this.model.whenNothingPending(function(){window.location=window.location})};var _$Derby_15=Derby;function Derby(){}Derby.prototype=Object.create(_$lib_racer),Derby.prototype.constructor=Derby,Derby.prototype.App=_$App_13,Derby.prototype.Page=_$Page_17,Derby.prototype.Component=_$components_19.Component,Derby.prototype.createApp=function(t,e,n){return new this.App(this,t,e,n)},_$lib_racer.util.isServer||_$documentListeners_20({}).add(document);var _$derby_derby={exports:{}},serverRequire=_$lib_racer.util.serverRequire,__Derby_derby=serverRequire(_$derby_derby,"./lib/DerbyForServer")||_$Derby_15;_$derby_derby.exports=new __Derby_derby,_$derby_derby=_$derby_derby.exports;var _$derbyDebug_5=function(t){t.on("ready",function(e){window.MODEL=e.model,window.APP=t,t.findComponent=findComponent,t.componentCommand=componentCommand,t.derby.Model.prototype.logEvents=logEvents})};function findComponent(t,e){null==e&&(e=0);for(var n,r=document.createTreeWalker(document,128,null,!1);n=r.nextNode();)if(n.data===t){if(0===e)return n.$component;e--}}function componentCommand(t){for(var e,n=0,r=document.createTreeWalker(document,128,null,!1);e=r.nextNode();){if(e===t)return"(component = APP.findComponent('"+e.data+"',"+n+"))";e.data===t.data&&n++}}function logEvents(t){null==t&&(t=""),this.on("all",t+"**",console.log.bind(console))}var _$CM_4={};(function(t){function e(){}if(_$CM_4=e,e.prototype.view=t,require&&require.resolve){var n=_$pathBrowserify_29({}),r=require.resolve("codemirror");e.root=n.resolve(r,"../../")}e.prototype.init=function(){var t=this.model;t.setNull("options",{}),t.setNull("debounce",150)},e.prototype.create=function(){var t,e=this.model,n=this,r=this.getAttribute("options"),i=this.cm=CodeMirror.fromTextArea(this.textarea,r);if(r.mode){var o=r.mode;if(/\//.test(r.mode)){var s=CodeMirror.findModeByMIME(r.mode);s&&(o=s.mode)}CodeMirror.autoLoadMode(i,o)}e.on("change","text",function(t,e,r){if(!r.editing){var o=r.$stringInsert,s=r.$stringRemove;if(o&&o.text)n.supress=!0,i.replaceRange(o.text,i.posFromIndex(o.index)),n.supress=!1,n.check();else if(s&&s.howMany){n.supress=!0;var a=i.posFromIndex(s.index),c=i.posFromIndex(s.howMany);i.replaceRange("",a,c),n.supress=!1}else{var l=n.cm.getCursor();n.supress=!0,n.cm.setValue(t),n.supress=!1,n.cm.setCursor(l)}}}),i.on("change",function(r,i){n.supress||(t&&(clearTimeout(t),t=null),t=setTimeout(function(){var t=r.getValue();n.model.pass({editing:!0}).setDiff("text",t)},e.get("debounce")))})},e.prototype.check=function(){var t=this;setTimeout(function(){var e=t.cm.getValue(),n=t.model.get("text")||"",r=t.cm.getCursor();e!=n&&(t.supress=!0,t.cm.setValue(n),t.supress=!1,t.cm.setCursor(r))},0)}}).call(this,"/node_modules/d-codemirror");var _$codemirror_1={exports:{}};return function(t,e){"use strict";var n=_$codemirror_1.exports=_$derby_derby.createApp("codemirror",t);n.use(_$derbyDebug_5),n.serverUse(_$codemirror_1,"derby-stylus"),n.loadViews(e),n.loadStyles(e),n.component(_$CM_4),n.get("/",function(t,e){var n=e.at("codemirror.text");n.subscribe(function(){n.createNull("# Hello world"),t.render()})});var r=new _$showdown_81.Converter;n.proto.markdownHtml=function(t){return r.makeHtml(t)}}.call(this,"/codemirror/index.js","/codemirror"),_$codemirror_1=_$codemirror_1.exports,exposedRequire.m.racer=_$lib_racer,exposedRequire.m.derby=_$derby_derby,exposedRequire}("function"==typeof require?require:void 0);
//# sourceMappingURL=/derby/codemirror-6a3e56342cd1b52b76094611351eda4f.map.json