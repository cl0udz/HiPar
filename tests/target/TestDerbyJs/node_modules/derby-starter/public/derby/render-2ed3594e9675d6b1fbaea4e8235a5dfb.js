require=function(require){var exposedRequire=function t(e,n){return t.m.hasOwnProperty(e)?t.m[e]:"function"!=typeof require||n?"function"==typeof t.r?t.r(e,1):void 0:require(e,1)};exposedRequire.m={},exposedRequire.r=require;var createModuleFactory=function(t){var e;return function(n){return e||t(e={exports:{},parent:n},e.exports),e.exports}},_$documentListeners_24=createModuleFactory(function(t,e){function n(t){var e=t.type;return"text"===e||"textarea"===e||"search"===e||"url"===e||"tel"===e||"password"===e}function r(t){var e=t.type;return"number"===e||"range"===e&&!t.multiple}e.add=function(t){t.addEventListener("input",o,!0),t.addEventListener("change",s,!0),parseFloat(window.navigator.appVersion.split("MSIE ")[1])<=9&&t.addEventListener("selectionchange",function(t){document.activeElement&&o({target:document.activeElement})},!0);var e=document.createElement("input");if(e.type="number",e.value="7",e.valueAsNumber!=e.valueAsNumber){var n=i;i=function(t){return"number"===t.type?r(t)?parseFloat(t.value):t.value:n.apply(this,arguments)}}},e.inputSupportsSelection=n;var i=function(t){return r(t)?t.valueAsNumber:t.value};function o(t){var e=t.target;"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName||u(t,e)}function s(t){var e=t.target;"INPUT"===e.tagName?(a(e,"checked"),u(t,e)):"SELECT"===e.tagName?function t(e){for(var n=e.firstChild;n;n=n.nextSibling)"OPTION"===n.tagName?a(n,"selected"):n.hasChildNodes()&&t(n)}(e):"TEXTAREA"===e.tagName&&u(t,e)}function a(t,e){var n=t.$bindAttributes&&t.$bindAttributes[e];if(n&&!n.isUnbound()){var r=t[e];n.template.expression.set(n.context,r)}}function u(t,e){var r=e.$bindAttributes&&e.$bindAttributes.value;if(r&&!r.isUnbound())if(n(e)){var o={$event:t};!function(t,e,n){var r=t.template.expression,i=r.pathSegments(t.context);if(i){var o=t.context.controller.model.pass(n);_$textDiff_27.onTextInput(o,i,e)}else r.set&&r.set(t.context,e)}(r,e.value,o)}else{var s=i(e);r.template.expression.set(r.context,s)}}}),_$templates_15=createModuleFactory(function(t,e){var n=_$serializeObject_75({}),r=_$options_14({}).DependencyOptions,i=_$util_16.concat,o=_$util_16.hasKeys,s=_$util_16.traverseAndCreate;function a(t,e,n,r){for(var i=0;i<e.length;i++)t=u(t,e[i],n,r);return t}function u(t,e,n,r){var o=c(e,n,r);return i(t,o)}function c(t,e,n){return t.dependencies(e,n)}!function(){for(var t in _$saddle_74)e[t]=_$saddle_74[t]}(),e.Marker=h,e.View=d,e.ViewInstance=m,e.DynamicViewInstance=v,e.ViewParent=g,e.ContextClosure=y,e.Views=b,e.MarkupHook=x,e.ElementOn=E,e.ComponentOn=w,e.AsProperty=S,e.AsObject=C,e.AsObjectComponent=M,e.AsArray=T,e.AsArrayComponent=A,e.emptyTemplate=new _$saddle_74.Template([]),_$saddle_74.Template.prototype.isUnbound=function(t){return t.unbound},_$saddle_74.Binding.prototype.isUnbound=function(){return this.template.expression.isUnbound(this.context)},_$saddle_74.Template.prototype.resolve=function(){},_$saddle_74.Template.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e))return a(null,this.content,t,e)},_$saddle_74.Doctype.prototype.dependencies=function(){},_$saddle_74.Text.prototype.dependencies=function(){},_$saddle_74.DynamicText.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e))return c(this.expression,t,e)},_$saddle_74.Comment.prototype.dependencies=function(){},_$saddle_74.DynamicComment.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e))return c(this.expression,t,e)},_$saddle_74.Html.prototype.dependencies=function(){},_$saddle_74.DynamicHtml.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e))return c(this.expression,t,e)},_$saddle_74.Element.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e)){var n=function(t,e,n,r){for(var i in e)t=u(t,e[i],n,r);return t}(null,this.attributes,t,e);return this.content?a(n,this.content,t,e):n}},_$saddle_74.DynamicElement.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e))return u(_$saddle_74.Element.prototype.dependencies(t,e),this.tagName,t,e)},_$saddle_74.Block.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e)){var n=this.expression.meta&&"on"===this.expression.meta.blockType?c(this.expression,t,e):null,i=t.child(this.expression);return a(n,this.content,i,e)}},_$saddle_74.ConditionalBlock.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e)){var n=this.getCondition(t);if(null==n)return c(this.expressions[0],t,e);var i=function(t,e,n,r,i){for(var o=0;o<=i;o++)t=u(t,e[o],n,r);return t}(null,this.expressions,t,e,n),o=this.expressions[n];return a(i,this.contents[n],t.child(o),e)}},_$saddle_74.EachBlock.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e)){var n=c(this.expression,t,e),i=this.expression.get(t);if(i&&i.length)for(var o=0;o<i.length;o++){var s=t.eachChild(this.expression,o);n=a(n,this.content,s,e)}else this.elseContent&&(n=a(n,this.elseContent,t,e));return n}},_$saddle_74.Attribute.prototype.dependencies=function(){},_$saddle_74.DynamicAttribute.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e))return c(this.expression,t,e)};var l=[{emit:function(t,e){e.$component=t.controller,t.controller.markerNode=e}}];function h(t){_$saddle_74.Comment.call(this,t,l)}function p(t){for(var e=t.split(/\s+/),n=0,r=e.length;n<r;n++)this[e[n]]=!0}function f(t){for(var e=t.split(/\s+/),n=0,r=e.length;n<r;n++){var i=e[n].split("/");this[i[0]]=i[1]||i[0]}}function d(t,e,n,r){this.views=t,this.name=e,this.source=n,this.options=r;var i=(this.name||"").split(":"),o=i.pop();this.namespace=i.join(":"),this.registeredName="index"===o?this.namespace:this.name,this.attributesMap=r&&r.attributes&&new p(r.attributes),this.arraysMap=r&&r.arrays&&new f(r.arrays),this.unminified=r&&(r.unminified||""===r.unminified),this.string=r&&(r.string||""===r.string),this.literal=r&&(r.literal||""===r.literal),this.template=null,this.componentFactory=null,this.fromSerialized=!1}function m(t,e,n,r){this.name=t,this.attributes=e,this.hooks=n,this.initHooks=r,this.view=null}function v(t,e,n,r){this.nameExpression=t,this.attributes=e,this.hooks=n,this.initHooks=r}function g(t){this.template=t}function y(t,e){this.template=t,this.context=e}function _(){}function b(){this.nameMap=new _,this.tagMap=new _,this.elementMap=this.tagMap}function x(){}function E(t,e){this.name=t,this.expression=e}function w(t,e){this.name=t,this.expression=e}function S(t){this.segments=t,this.lastSegment=t.pop()}function C(t,e){S.call(this,t),this.keyExpression=e}function M(t,e){C.call(this,t,e)}function T(t){S.call(this,t)}function A(t){T.call(this,t)}h.prototype=Object.create(_$saddle_74.Comment.prototype),h.prototype.constructor=h,h.prototype.type="Marker",h.prototype.serialize=function(){return n.instance(this,this.data)},h.prototype.get=function(){return""},d.prototype=Object.create(_$saddle_74.Template.prototype),d.prototype.constructor=d,d.prototype.type="View",d.prototype.serialize=function(){return null},d.prototype._isComponent=function(t){return!!this.componentFactory&&(!t.attributes||!t.attributes.extend)},d.prototype._initComponent=function(t){return this._isComponent(t)?this.componentFactory.init(t):t},d.prototype._queueCreate=function(t,e){if(this._isComponent(t)){var n=this.componentFactory;if(t.queue(function(){n.create(e)}),!t.hooks)return;t.queue(function(){for(var n=0,r=t.hooks.length;n<r;n++)t.hooks[n].emit(t,e.controller)})}},d.prototype.get=function(t,e){var n=this._initComponent(t);return(this.template||this.parse()).get(n,e)},d.prototype.getFragment=function(t,e){var n=this._initComponent(t),r=(this.template||this.parse()).getFragment(n,e);return this._queueCreate(t,n),r},d.prototype.appendTo=function(t,e){var n=this._initComponent(e);(this.template||this.parse()).appendTo(t,n),this._queueCreate(e,n)},d.prototype.attachTo=function(t,e,n){var r=this._initComponent(n);e=(this.template||this.parse()).attachTo(t,e,r);return this._queueCreate(n,r),e},d.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e)){var n=this.template||this.parse(),i=this._isComponent(t)?t.componentChild(null):t;return n.dependencies(i,e)}},d.prototype.parse=function(){if(this._parse(),this.componentFactory){var t=new h(this.name);this.template.content.unshift(t)}return this.template},d.prototype._parse=function(){throw new Error("View parsing not available")},m.prototype=Object.create(_$saddle_74.Template.prototype),m.prototype.constructor=m,m.prototype.type="ViewInstance",m.prototype.serialize=function(){return n.instance(this,this.name,this.attributes,this.hooks,this.initHooks)},m.prototype.get=function(t,e){var n=this._find(t),r=t.viewChild(n,this.attributes,this.hooks,this.initHooks);return n.get(r,e)},m.prototype.getFragment=function(t,e){var n=this._find(t),r=t.viewChild(n,this.attributes,this.hooks,this.initHooks);return n.getFragment(r,e)},m.prototype.appendTo=function(t,e){var n=this._find(e),r=e.viewChild(n,this.attributes,this.hooks,this.initHooks);n.appendTo(t,r)},m.prototype.attachTo=function(t,e,n){var r=this._find(n),i=n.viewChild(r,this.attributes,this.hooks,this.initHooks);return r.attachTo(t,e,i)},m.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e)){var n=this._find(t),i=t.viewChild(n,this.attributes,this.hooks,this.initHooks);return n.dependencies(i,e)}},m.prototype._find=function(t){if(this.view)return this.view;var e=t.getView(),n=e&&e.namespace;if(this.view=t.meta.views.find(this.name,n),!this.view){var r=t.meta.views.findErrorMessage(this.name,e);throw new Error(r)}return this.view},v.prototype=Object.create(m.prototype),v.prototype.constructor=v,v.prototype.type="DynamicViewInstance",v.prototype.serialize=function(){return n.instance(this,this.nameExpression,this.attributes,this.hooks,this.initHooks)},v.prototype._find=function(t){var n=this.nameExpression.get(t),r=t.getView(),i=r&&r.namespace;return n&&t.meta.views.find(n,i)||e.emptyTemplate},v.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e)){var n=this.nameExpression.dependencies(t),o=m.prototype.dependencies.call(this,t,e);return i(n,o)}},g.prototype=Object.create(_$saddle_74.Template.prototype),g.prototype.constructor=g,g.prototype.type="ViewParent",g.prototype.serialize=function(){return n.instance(this,this.template)},g.prototype.get=function(t,e){var n=t.forViewParent();return this.template.get(n,e)},g.prototype.getFragment=function(t,e){var n=t.forViewParent();return this.template.getFragment(n,e)},g.prototype.appendTo=function(t,e){var n=e.forViewParent();this.template.appendTo(t,n)},g.prototype.attachTo=function(t,e,n){var r=n.forViewParent();return this.template.attachTo(t,e,r)},g.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this,e)){var n=t.forViewParent();return this.template.dependencies(n,e)}},y.prototype=Object.create(_$saddle_74.Template.prototype),y.prototype.constructor=y,y.prototype.serialize=function(){throw new Error("ContextClosure cannot be serialized")},y.prototype.get=function(t,e){var n=t.closureChild(this.context);return this.template.get(n,e)},y.prototype.getFragment=function(t,e){var n=t.closureChild(this.context);return this.template.getFragment(n,e)},y.prototype.appendTo=function(t,e){var n=e.closureChild(this.context);this.template.appendTo(t,n)},y.prototype.attachTo=function(t,e,n){var r=n.closureChild(this.context);return this.template.attachTo(t,e,r)},y.prototype.dependencies=function(t,e){if(!r.shouldIgnoreTemplate(this.template,e)){var n=t.closureChild(this.context);return this.template.dependencies(n,e)}},y.prototype.equals=function(t){return t instanceof y&&this.context===t.context&&this.template.equals(t.template)},b.prototype.find=function(t,e){var n=this.nameMap;if(s=n[e?e+":"+t:t])return s;var r=t.split(":"),i=r.length;for(e&&(r=e.split(":").concat(r));i>0;){for(var o=r.slice();o.length>i;){var s;if(o.splice(-1-i,1),s=n[o.join(":")])return s}i--}},b.prototype.register=function(t,e,n){var r=t.replace(/:index$/,""),i=this.nameMap[r];if(i){var o=i.componentFactory;d.call(i,this,t,e,n),i.componentFactory=o}else i=new d(this,t,e,n);this.nameMap[r]=i;var s=n&&(n.tag||n.element);return s&&(this.tagMap[s]=i),i},b.prototype.deserialize=function(t){for(var e=0;e<t.length;e++){var n=t[e],r=n[0],i=n[1],o=n[2],s=n[3],a=this.register(i,o,s);a.parse=r,a.fromSerialized=!0}},b.prototype.serialize=function(t){var r=t&&t.server,i=t&&t.minify,s=[];for(var a in this.nameMap){var u=this.nameMap[a],c=u.template||u.parse();if(!r&&u.options){if(u.options.serverOnly)continue;u.options.server&&(c=e.emptyTemplate)}s.push("[function(){return this.template="+c.serialize()+"},"+n.args([u.name,i?null:u.source,o(u.options)?u.options:null])+"]")}return"function(derbyTemplates, views){var expressions = derbyTemplates.expressions,templates = derbyTemplates.templates;views.deserialize(["+s.join(",")+"])}"},b.prototype.findErrorMessage=function(t,e){var n=Object.keys(this.nameMap),r='Cannot find view "'+t+'" in'+[""].concat(n).join("\n  ")+"\n";return e&&(r+='\nWithin template "'+e.name+'":\n'+e.source),r},x.prototype.module=_$saddle_74.Template.prototype.module,E.prototype=Object.create(x.prototype),E.prototype.constructor=E,E.prototype.type="ElementOn",E.prototype.serialize=function(){return n.instance(this,this.name,this.expression)},E.prototype.emit=function(t,e){var n=this;if("create"===this.name)this.apply(t,e);else if("destroy"===this.name){(e.$destroyListeners||(e.$destroyListeners=[])).push(function(){n.apply(t,e)})}else e.addEventListener(this.name,function(r){return n.apply(t,e,r)},!1)},E.prototype.apply=function(t,e,n){var r=t.controller.model.data;r.$event=n,r.$element=e;var i=this.expression.apply(t);return delete r.$event,delete r.$element,i},w.prototype=Object.create(x.prototype),w.prototype.constructor=w,w.prototype.type="ComponentOn",w.prototype.serialize=function(){return n.instance(this,this.name,this.expression)},w.prototype.emit=function(t,e){var n=this.expression;e.on(this.name,function(){var e=arguments.length&&Array.prototype.slice.call(arguments);return n.apply(t,e)})},S.prototype=Object.create(x.prototype),S.prototype.constructor=S,S.prototype.type="AsProperty",S.prototype.serialize=function(){var t=this.segments.concat(this.lastSegment);return n.instance(this,t)},S.prototype.emit=function(t,e){s(t.controller,this.segments)[this.lastSegment]=e},C.prototype=Object.create(S.prototype),C.prototype.constructor=C,C.prototype.type="AsObject",C.prototype.serialize=function(){var t=this.segments.concat(this.lastSegment);return n.instance(this,t,this.keyExpression)},C.prototype.emit=function(t,e){var n=s(t.controller,this.segments),r=n[this.lastSegment]||(n[this.lastSegment]={}),i=this.keyExpression.get(t);r[i]=e,this.addListeners(e,r,i)},C.prototype.addListeners=function(t,e,n){this.addDestroyListener(t,function(){delete e[n]})},C.prototype.addDestroyListener=function(t,e){(t.$destroyListeners||(t.$destroyListeners=[])).push(e)},M.prototype=Object.create(C.prototype),M.prototype.constructor=M,M.prototype.type="AsObjectComponent",M.prototype.addDestroyListener=function(t,e){t.on("destroy",e)},T.prototype=Object.create(S.prototype),T.prototype.constructor=T,T.prototype.type="AsArray",T.prototype.emit=function(t,e){for(var n=s(t.controller,this.segments),r=n[this.lastSegment]||(n[this.lastSegment]=[]),i=r.length;i--;){var o=r[i];if(o===e)return;if(4&this.comparePosition(e,o))return r.splice(i+1,0,e),void this.addListeners(e,r)}r.unshift(e),this.addListeners(e,r)},T.prototype.addListeners=function(t,e){this.addDestroyListener(t,function(){var n=e.indexOf(t);-1!==n&&e.splice(n,1)})},T.prototype.comparePosition=function(t,e){return e.compareDocumentPosition(t)},T.prototype.addDestroyListener=C.prototype.addDestroyListener,A.prototype=Object.create(T.prototype),A.prototype.constructor=A,A.prototype.type="AsArrayComponent",A.prototype.comparePosition=function(t,e){return e.markerNode.compareDocumentPosition(t.markerNode)},A.prototype.addDestroyListener=M.prototype.addDestroyListener}),_$options_14=createModuleFactory(function(t,e){var n=_$templates_15({});function r(t){this.setIgnoreTemplate(t&&t.ignoreTemplate)}e.DependencyOptions=r,r.shouldIgnoreTemplate=function(t,e){return!!e&&e.ignoreTemplate===t},r.prototype.setIgnoreTemplate=function(t){for(;t instanceof n.ContextClosure;)t=t.template;this.ignoreTemplate=t}}),_$serializeObject_75=createModuleFactory(function(t,e){function n(t){for(var e=[],n=t.length;n--;){var i=r(t[n]);e.unshift(i)}for(n=e.length;n--;){if("void 0"!==(i=e[n])&&"null"!==i)break;e.pop()}return e.join(", ")}function r(t){if(t&&t.serialize)return t.serialize();if(void 0===t)return"void 0";if(null===t)return"null";if("string"==typeof t)return i(t);if("number"==typeof t||"boolean"==typeof t)return t+"";if(Array.isArray(t)){for(var e=[],n=0;n<t.length;n++){var o=r(t[n]);e.push(o)}return"["+e.join(", ")+"]"}if("object"==typeof t){e=[];for(var s in t){o=r(t[s]);e.push(i(s)+": "+o)}return"{"+e.join(", ")+"}"}}function i(t){return"'"+t.replace(/['\r\n\\]/g,function(t){return"'"===t?"\\'":"\r"===t?"\\r":"\n"===t?"\\n":"\\"===t?"\\\\":""})+"'"}e.instance=function(t){var e=Array.prototype.slice.call(arguments,1);return"new "+t.module+"."+t.type+"("+n(e)+")"},e.args=n,e.value=r}),_$pathBrowserify_38=createModuleFactory(function(t,e){(function(t){function n(t,e){for(var n=0,r=t.length-1;r>=0;r--){var i=t[r];"."===i?t.splice(r,1):".."===i?(t.splice(r,1),n++):n&&(t.splice(r,1),n--)}if(e)for(;n--;n)t.unshift("..");return t}function r(t,e){if(t.filter)return t.filter(e);for(var n=[],r=0;r<t.length;r++)e(t[r],r,t)&&n.push(t[r]);return n}e.resolve=function(){for(var e="",i=!1,o=arguments.length-1;o>=-1&&!i;o--){var s=o>=0?arguments[o]:t.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(e=s+"/"+e,i="/"===s.charAt(0))}return(i?"/":"")+(e=n(r(e.split("/"),function(t){return!!t}),!i).join("/"))||"."},e.normalize=function(t){var o=e.isAbsolute(t),s="/"===i(t,-1);return(t=n(r(t.split("/"),function(t){return!!t}),!o).join("/"))||o||(t="."),t&&s&&(t+="/"),(o?"/":"")+t},e.isAbsolute=function(t){return"/"===t.charAt(0)},e.join=function(){var t=Array.prototype.slice.call(arguments,0);return e.normalize(r(t,function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},e.relative=function(t,n){function r(t){for(var e=0;e<t.length&&""===t[e];e++);for(var n=t.length-1;n>=0&&""===t[n];n--);return e>n?[]:t.slice(e,n-e+1)}t=e.resolve(t).substr(1),n=e.resolve(n).substr(1);for(var i=r(t.split("/")),o=r(n.split("/")),s=Math.min(i.length,o.length),a=s,u=0;u<s;u++)if(i[u]!==o[u]){a=u;break}var c=[];for(u=a;u<i.length;u++)c.push("..");return(c=c.concat(o.slice(a))).join("/")},e.sep="/",e.delimiter=":",e.dirname=function(t){if("string"!=typeof t&&(t+=""),0===t.length)return".";for(var e=t.charCodeAt(0),n=47===e,r=-1,i=!0,o=t.length-1;o>=1;--o)if(47===(e=t.charCodeAt(o))){if(!i){r=o;break}}else i=!1;return-1===r?n?"/":".":n&&1===r?"/":t.slice(0,r)},e.basename=function(t,e){var n=function(t){"string"!=typeof t&&(t+="");var e,n=0,r=-1,i=!0;for(e=t.length-1;e>=0;--e)if(47===t.charCodeAt(e)){if(!i){n=e+1;break}}else-1===r&&(i=!1,r=e+1);return-1===r?"":t.slice(n,r)}(t);return e&&n.substr(-1*e.length)===e&&(n=n.substr(0,n.length-e.length)),n},e.extname=function(t){"string"!=typeof t&&(t+="");for(var e=-1,n=0,r=-1,i=!0,o=0,s=t.length-1;s>=0;--s){var a=t.charCodeAt(s);if(47!==a)-1===r&&(i=!1,r=s+1),46===a?-1===e?e=s:1!==o&&(o=1):-1!==e&&(o=-1);else if(!i){n=s+1;break}}return-1===e||-1===r||0===o||1===o&&e===r-1&&e===n+1?"":t.slice(e,r)};var i="b"==="ab".substr(-1)?function(t,e,n){return t.substr(e,n)}:function(t,e,n){return e<0&&(e=t.length+e),t.substr(e,n)}}).call(this,_$browser_39)}),objectCreate=Object.create||objectCreatePolyfill,objectKeys=Object.keys||objectKeysPolyfill,bind=Function.prototype.bind||functionBindPolyfill;function EventEmitter(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=objectCreate(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}var _$EventEmitter_30=EventEmitter;EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0;var defaultMaxListeners=10,hasDefineProperty;try{var o={};Object.defineProperty&&Object.defineProperty(o,"x",{value:0}),hasDefineProperty=0===o.x}catch(t){hasDefineProperty=!1}function $getMaxListeners(t){return void 0===t._maxListeners?EventEmitter.defaultMaxListeners:t._maxListeners}function emitNone(t,e,n){if(e)t.call(n);else for(var r=t.length,i=arrayClone(t,r),o=0;o<r;++o)i[o].call(n)}function emitOne(t,e,n,r){if(e)t.call(n,r);else for(var i=t.length,o=arrayClone(t,i),s=0;s<i;++s)o[s].call(n,r)}function emitTwo(t,e,n,r,i){if(e)t.call(n,r,i);else for(var o=t.length,s=arrayClone(t,o),a=0;a<o;++a)s[a].call(n,r,i)}function emitThree(t,e,n,r,i,o){if(e)t.call(n,r,i,o);else for(var s=t.length,a=arrayClone(t,s),u=0;u<s;++u)a[u].call(n,r,i,o)}function emitMany(t,e,n,r){if(e)t.apply(n,r);else for(var i=t.length,o=arrayClone(t,i),s=0;s<i;++s)o[s].apply(n,r)}function _addListener(t,e,n,r){var i,o,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=t._events)?(o.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),s=o[e]):(o=t._events=objectCreate(null),t._eventsCount=0),s){if("function"==typeof s?s=o[e]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),!s.warned&&(i=$getMaxListeners(t))&&i>0&&s.length>i){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+' "'+String(e)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=s.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",a.name,a.message)}}else s=o[e]=n,++t._eventsCount;return t}function onceWrapper(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var t=new Array(arguments.length),e=0;e<t.length;++e)t[e]=arguments[e];this.listener.apply(this.target,t)}}function _onceWrap(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=bind.call(onceWrapper,r);return i.listener=n,r.wrapFn=i,i}function _listeners(t,e,n){var r=t._events;if(!r)return[];var i=r[e];return i?"function"==typeof i?n?[i.listener||i]:[i]:n?unwrapListeners(i):arrayClone(i,i.length):[]}function listenerCount(t){var e=this._events;if(e){var n=e[t];if("function"==typeof n)return 1;if(n)return n.length}return 0}function spliceOne(t,e){for(var n=e,r=n+1,i=t.length;r<i;n+=1,r+=1)t[n]=t[r];t.pop()}function arrayClone(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function unwrapListeners(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function objectCreatePolyfill(t){var e=function(){};return e.prototype=t,new e}function objectKeysPolyfill(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return n}function functionBindPolyfill(t){var e=this;return function(){return e.apply(t,arguments)}}hasDefineProperty?Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(t){if("number"!=typeof t||t<0||t!=t)throw new TypeError('"defaultMaxListeners" must be a positive number');defaultMaxListeners=t}}):EventEmitter.defaultMaxListeners=defaultMaxListeners,EventEmitter.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},EventEmitter.prototype.getMaxListeners=function(){return $getMaxListeners(this)},EventEmitter.prototype.emit=function(t){var e,n,r,i,o,s,a="error"===t;if(s=this._events)a=a&&null==s.error;else if(!a)return!1;if(a){if(arguments.length>1&&(e=arguments[1]),e instanceof Error)throw e;var u=new Error('Unhandled "error" event. ('+e+")");throw u.context=e,u}if(!(n=s[t]))return!1;var c="function"==typeof n;switch(r=arguments.length){case 1:emitNone(n,c,this);break;case 2:emitOne(n,c,this,arguments[1]);break;case 3:emitTwo(n,c,this,arguments[1],arguments[2]);break;case 4:emitThree(n,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];emitMany(n,c,this,i)}return!0},EventEmitter.prototype.addListener=function(t,e){return _addListener(this,t,e,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function(t,e){return _addListener(this,t,e,!0)},EventEmitter.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,_onceWrap(this,t,e)),this},EventEmitter.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,_onceWrap(this,t,e)),this},EventEmitter.prototype.removeListener=function(t,e){var n,r,i,o,s;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=objectCreate(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===e||n[o].listener===e){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():spliceOne(n,i),1===n.length&&(r[t]=n[0]),r.removeListener&&this.emit("removeListener",t,s||e)}return this},EventEmitter.prototype.removeAllListeners=function(t){var e,n,r;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=objectCreate(null),this._eventsCount=0):n[t]&&(0==--this._eventsCount?this._events=objectCreate(null):delete n[t]),this;if(0===arguments.length){var i,o=objectKeys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=objectCreate(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},EventEmitter.prototype.listeners=function(t){return _listeners(this,t,!0)},EventEmitter.prototype.rawListeners=function(t){return _listeners(this,t,!1)},EventEmitter.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):listenerCount.call(t,e)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var _$rng_97={};(function(t){var e,n=t.crypto||t.msCrypto;if(n&&n.getRandomValues){var r=new Uint8Array(16);e=function(){return n.getRandomValues(r),r}}if(!e){var i=new Array(16);e=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),i[e]=t>>>((3&e)<<3)&255;return i}}_$rng_97=e}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});for(var _byteToHex=[],_hexToByte={},i=0;i<256;i++)_byteToHex[i]=(i+256).toString(16).substr(1),_hexToByte[_byteToHex[i]]=i;function parse(t,e,n){var r=e&&n||0,i=0;for(e=e||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,function(t){i<16&&(e[r+i++]=_hexToByte[t])});i<16;)e[r+i++]=0;return e}function unparse(t,e){var n=e||0,r=_byteToHex;return r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]}var _seedBytes=_$rng_97(),_nodeId=[1|_seedBytes[0],_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]],_clockseq=16383&(_seedBytes[6]<<8|_seedBytes[7]),_lastMSecs=0,_lastNSecs=0;function v1(t,e,n){var r=e&&n||0,i=e||[],o=void 0!==(t=t||{}).clockseq?t.clockseq:_clockseq,s=void 0!==t.msecs?t.msecs:(new Date).getTime(),a=void 0!==t.nsecs?t.nsecs:_lastNSecs+1,u=s-_lastMSecs+(a-_lastNSecs)/1e4;if(u<0&&void 0===t.clockseq&&(o=o+1&16383),(u<0||s>_lastMSecs)&&void 0===t.nsecs&&(a=0),a>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_lastMSecs=s,_lastNSecs=a,_clockseq=o;var c=(1e4*(268435455&(s+=122192928e5))+a)%4294967296;i[r++]=c>>>24&255,i[r++]=c>>>16&255,i[r++]=c>>>8&255,i[r++]=255&c;var l=s/4294967296*1e4&268435455;i[r++]=l>>>8&255,i[r++]=255&l,i[r++]=l>>>24&15|16,i[r++]=l>>>16&255,i[r++]=o>>>8|128,i[r++]=255&o;for(var h=t.node||_nodeId,p=0;p<6;p++)i[r+p]=h[p];return e||unparse(i)}function v4(t,e,n){var r=e&&n||0;"string"==typeof t&&(e="binary"==t?new Array(16):null,t=null);var i=(t=t||{}).random||(t.rng||_$rng_97)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,e)for(var o=0;o<16;o++)e[r+o]=i[o];return e||unparse(i)}var uuid=v4;uuid.v1=v1,uuid.v4=v4,uuid.parse=parse,uuid.unparse=unparse;var _$uuid_98=uuid;Model.INITS=[];var _$Model_54=Model;function Model(t){this.root=this;var e=Model.INITS;t||(t={}),this.debug=t.debug||{};for(var n=0;n<e.length;n++)e[n](this,t)}function ChildModel(t){this.root=t.root,this._events=t._events,this._maxListeners=t._maxListeners,this._context=t._context,this._at=t._at,this._pass=t._pass,this._silent=t._silent,this._eventContext=t._eventContext,this._preventCompose=t._preventCompose}Model.prototype.id=function(){return _$uuid_98.v4()},Model.prototype._child=function(){return new ChildModel(this)},Model.ChildModel=ChildModel,ChildModel.prototype=new Model;var isArray=Array.isArray,keyList=Object.keys,hasProp=Object.prototype.hasOwnProperty,_$equal_31=function t(e,n){if(e===n)return!0;if(e&&n&&"object"==typeof e&&"object"==typeof n){var r,i,o,s=isArray(e),a=isArray(n);if(s&&a){if((i=e.length)!=n.length)return!1;for(r=i;0!=r--;)if(!t(e[r],n[r]))return!1;return!0}if(s!=a)return!1;var u=e instanceof Date,c=n instanceof Date;if(u!=c)return!1;if(u&&c)return e.getTime()==n.getTime();var l=e instanceof RegExp,h=n instanceof RegExp;if(l!=h)return!1;if(l&&h)return e.toString()==n.toString();var p=keyList(e);if((i=p.length)!==keyList(n).length)return!1;for(r=i;0!=r--;)if(!hasProp.call(n,p[r]))return!1;for(r=i;0!=r--;)if(!t(e[o=p[r]],n[o]))return!1;return!0}return e!=e&&n!=n},_$browser_39={},process=_$browser_39={},cachedSetTimeout,cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(t){if(cachedSetTimeout===setTimeout)return setTimeout(t,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(t,0);try{return cachedSetTimeout(t,0)}catch(e){try{return cachedSetTimeout.call(null,t,0)}catch(e){return cachedSetTimeout.call(this,t,0)}}}function runClearTimeout(t){if(cachedClearTimeout===clearTimeout)return clearTimeout(t);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(t);try{return cachedClearTimeout(t)}catch(e){try{return cachedClearTimeout.call(null,t)}catch(e){return cachedClearTimeout.call(this,t)}}}!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(t){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(t){cachedClearTimeout=defaultClearTimeout}}();var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var t=runTimeout(cleanUpNextTick);draining=!0;for(var e=queue.length;e;){for(currentQueue=queue,queue=[];++queueIndex<e;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,e=queue.length}currentQueue=null,draining=!1,runClearTimeout(t)}}function Item(t,e){this.fun=t,this.array=e}function noop(){}process.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];queue.push(new Item(t,e)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(t){return[]},process.binding=function(t){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(t){throw new Error("process.chdir is not supported")},process.umask=function(){return 0};var _$util_73={};(function(t){var e="browser"!==t.title;function n(t){this.cb=t,this.isDone=!1,this.count=0}function r(t){var e=new t.constructor;for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function i(t){return t!=t}function o(t){return/^[0-9]+$/.test(t)}function s(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}_$util_73.isServer=e,_$util_73.asyncGroup=function(t){var e=new n(t);return function(){return e.add()}},_$util_73.castSegments=function(t){for(var e=t.length;e--;){var n=t[e];"string"==typeof n&&o(n)&&(t[e]=+n)}return t},_$util_73.contains=function(t,e){for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0},_$util_73.copy=function(t){if(t instanceof Date)return new Date(t);if("object"==typeof t)return null===t?null:Array.isArray(t)?t.slice():r(t);return t},_$util_73.copyObject=r,_$util_73.deepCopy=function t(e){if(e instanceof Date)return new Date(e);if("object"==typeof e){if(null===e)return null;if(Array.isArray(e)){for(var n=[],r=e.length;r--;)n[r]=t(e[r]);return n}var i=new e.constructor;for(var o in e)e.hasOwnProperty(o)&&(i[o]=t(e[o]));return i}return e},_$util_73.deepEqual=_$equal_31,_$util_73.equal=function(t,e){return t===e||i(t)&&i(e)},_$util_73.equalsNaN=i,_$util_73.isArrayIndex=o,_$util_73.lookup=function(t,e){if(!t)return e;for(var n=0,r=t.length;n<r;n++){if(null==e)return e;e=e[t[n]]}return e},_$util_73.mergeInto=function(t,e){for(var n in e)t[n]=e[n];return t},_$util_73.mayImpact=s,_$util_73.mayImpactAny=function(t,e){for(var n=0,r=t.length;n<r;n++)if(s(t[n],e))return!0;return!1},_$util_73.serverRequire=function(t,n){if(!e)return;return t.require(n)},_$util_73.serverUse=function(t,n,r){if(!e)return this;var i=t.require(n);return this.use(i,r)},_$util_73.use=function(t,e){var n=this._plugins||(this._plugins=[]);-1===n.indexOf(t)&&(n.push(t),t(this,e));return this},n.prototype.add=function(){this.count++;var t=this;return function(e){if(t.count--,!t.isDone)return e?(t.isDone=!0,void t.cb(e)):void(t.count>0||(t.isDone=!0,t.cb()))}}}).call(this,_$browser_39);var _$unbundle_71={};_$Model_54.prototype.unbundle=function(t){for(var e in this.connection&&this.connection.startBulk(),this._initQueries(t.queries),t.collections){var n=t.collections[e];for(var r in n)this.getOrCreateDoc(e,r,n[r])}for(var i in t.contexts){var o=t.contexts[i],s=this.context(i);for(var e in o.fetchedDocs){n=o.fetchedDocs[e];for(var r in n)for(var a=n[r];a--;)s._context.fetchDoc(e,r),this._fetchedDocs.increment(e,r)}for(var e in o.subscribedDocs){n=o.subscribedDocs[e];for(var r in n)for(a=n[r];a--;)s.subscribeDoc(e,r)}for(var e in o.createdDocs){n=o.createdDocs[e];for(var r in n)s._context.createDoc(e,r)}}this.connection&&this.connection.endBulk();for(var u=0;u<t.refs.length;u++){var c=t.refs[u];this.ref(c[0],c[1])}for(u=0;u<t.refLists.length;u++){c=t.refLists[u];this.refList(c[0],c[1],c[2],c[3])}for(u=0;u<t.fns.length;u++){c=t.fns[u];this.start.apply(this,c)}for(u=0;u<t.filters.length;u++){c=t.filters[u];this._filters.add(c[1],c[2],c[3],c[4],c[5]).ref(c[0])}};var _$events_61={},__EventEmitter_61=_$EventEmitter_30.EventEmitter;function patternContained(t,e,n){var r=n.patternSegments;if(!r)return!1;if(t===n.pattern||"**"===t)return!0;var i=e.length;if(i>r.length)return!1;for(var o=0;o<i;o++)if(e[o]!==r[o])return!1;return!0}function Passed(t,e){for(var n in t)this[n]=t[n];for(var n in e)this[n]=e[n]}function eventListener(t,e,n,r,i){var o,s,a;if(i?(o=n,s=r,a=i):r?(a=r,t.isPath(n)?o=n:s=n):a=n,s&&s.useEventObjects)var u=!0;if(o){var c=t.path(o);return u?modelEventListener(e,c,a,t._eventContext):modelEventListenerLegacy(c,a,t._eventContext)}var l=t.path();return l?u?modelEventListener(e,l,a,t._eventContext):modelEventListenerLegacy(l,a,t._eventContext):a}function modelEventListenerLegacy(t,e,n){var r=_$util_73.castSegments(t.split(".")),i=testPatternFn(t,r);function o(t,n){var r=i(t);if(r){var o=r.length?r.concat(n):n;return e.apply(null,o),!0}}return o.pattern=t,o.patternSegments=r,o.eventContext=n,o}function modelEventListener(t,e,n,r){var i=_$util_73.castSegments(e.split(".")),o=testPatternFn(e,i),s=getEventFactory(t);function a(t,e){var r=o(t);if(r){var i=s(e);return n(i,r),!0}}return a.pattern=e,a.patternSegments=i,a.eventContext=r,a}function getEventFactory(t){switch(t){case"change":return function(t){return new ChangeEvent(t)};case"insert":return function(t){return new InsertEvent(t)};case"remove":return function(t){return new RemoveEvent(t)};case"move":return function(t){return new MoveEvent(t)};case"load":return function(t){return new LoadEvent(t)};case"unload":return function(t){return new UnloadEvent(t)};case"all":return function(t){return getEventFactory(t[0])(t.slice(1))};default:throw new Error("Unknown event: "+t)}}function ChangeEvent(t){this.value=t[0],this.previous=t[1],this.passed=t[2]}function InsertEvent(t){this.index=t[0],this.values=t[1],this.passed=t[2]}function RemoveEvent(t){this.index=t[0],this.removed=t[1],this.passed=t[2]}function MoveEvent(t){this.from=t[0],this.to=t[1],this.howMany=t[2],this.passed=t[3]}function LoadEvent(t){this.document=t[0],this.passed=t[1]}function UnloadEvent(t){this.previousDocument=t[0],this.passed=t[1]}function testPatternFn(t,e){if("**"===t)return function(t){return[t.join(".")]};var n=stripRestWildcard(e);return function(t){var r=e.length;if(!(r>t.length)&&(r===t.length||n)){for(var i=[],o=0;o<r;o++){var s=e[o],a=t[o];if("*"!==s&&"**"!==s){if(s!==a)return}else i.push(a)}if(n){var u=t.slice(o).join(".");i.push(u)}return i}}}function stripRestWildcard(t){var e=t.length-1,n=t[e];if("**"===n)return t.pop(),!0;if("string"!=typeof n)return!1;var r=/^([^\*]+)\*\*$/.exec(n);return!!r&&(t[e]=r[1],!0)}_$Model_54.MUTATOR_EVENTS={change:!0,insert:!0,remove:!0,move:!0,load:!0,unload:!0},_$Model_54.INITS.push(function(t){__EventEmitter_61.call(this),t.setMaxListeners(0),t.root._defaultCallback=function(e){e&&t._emitError(e)},t.root._mutatorEventQueue=null,t.root._pass=new Passed({},{}),t.root._silent=null,t.root._eventContext=null}),_$util_73.mergeInto(_$Model_54.prototype,__EventEmitter_61.prototype),_$Model_54.prototype.wrapCallback=function(t){if(!t)return this.root._defaultCallback;var e=this;return function(){try{return t.apply(this,arguments)}catch(t){e._emitError(t)}}},_$Model_54.prototype._emitError=function(t,e){var n=t.message?t.message:"string"==typeof t?t:"Unknown model error";if(e&&(n+=" "+e),t.data)try{n+=" "+JSON.stringify(t.data)}catch(t){}t instanceof Error?t.message=n:t=new Error(n),this.emit("error",t)},_$Model_54.prototype._emit=__EventEmitter_61.prototype.emit,_$Model_54.prototype.emit=function(t){if("error"===t)return this._emit.apply(this,arguments);if(_$Model_54.MUTATOR_EVENTS[t]){if(this._silent)return this;var e=arguments[1],n=arguments[2];if(this._emit(t+"Immediate",e,n),this.root._mutatorEventQueue)return this.root._mutatorEventQueue.push([t,e,n]),this;for(this.root._mutatorEventQueue=[],this._emit(t,e,n),this._emit("all",e,[t].concat(n));this.root._mutatorEventQueue.length;){var r=this.root._mutatorEventQueue.shift();t=r[0],e=r[1],n=r[2],this._emit(t,e,n),this._emit("all",e,[t].concat(n))}return this.root._mutatorEventQueue=null,this}return this._emit.apply(this,arguments)},_$Model_54.prototype._on=__EventEmitter_61.prototype.on,_$Model_54.prototype.addListener=_$Model_54.prototype.on=function(t,e,n,r){var i=eventListener(this,t,e,n,r);return this._on(t,i),i},_$Model_54.prototype.once=function(t,e,n,r){var i=eventListener(this,t,e,n,r);function o(){i.apply(null,arguments)&&this.removeListener(t,o)}return this._on(t,o),o},_$Model_54.prototype._removeAllListeners=__EventEmitter_61.prototype.removeAllListeners,_$Model_54.prototype.removeAllListeners=function(t,e){if(!t){for(var n in this._events)this.removeAllListeners(n,e);return this}var r=this.path(e);if(!r)return 0===arguments.length?this._removeAllListeners():this._removeAllListeners(t);for(var i=this.listeners(t),o=r.split("."),s=i.length;s--;){var a=i[s];patternContained(r,o,a)&&this.removeListener(t,a)}return this},_$Model_54.prototype.pass=function(t,e){var n=this._child();return n._pass=e?new Passed(t,this._pass):new Passed(this._pass,t),n},_$Model_54.prototype.silent=function(t){var e=this._child();return e._silent=null==t||t,e},_$Model_54.prototype.eventContext=function(t){var e=this._child();return e._eventContext=t,e},_$Model_54.prototype.removeContextListeners=function(t){for(var e in 0===arguments.length&&(t=this._eventContext),this._events)for(var n=this.listeners(e),r=n.length;r--;){var i=n[r];i.eventContext===t&&this.removeListener(e,i)}return this},ChangeEvent.prototype.type="change",InsertEvent.prototype.type="insert",RemoveEvent.prototype.type="remove",MoveEvent.prototype.type="move",LoadEvent.prototype.type="load",UnloadEvent.prototype.type="unload";var _$paths_66={};function createScoped(t,e){var n=t._child();return n._at=e,n}_$paths_66.mixin={},_$Model_54.prototype._splitPath=function(t){var e=this.path(t);return e&&e.split(".")||[]},_$Model_54.prototype.path=function(t){return null==t||""===t?this._at?this._at:"":"string"==typeof t||"number"==typeof t?this._at?this._at+"."+t:""+t:"function"==typeof t.path?t.path():void 0},_$Model_54.prototype.isPath=function(t){return null!=this.path(t)},_$Model_54.prototype.scope=function(t){if(arguments.length>1)for(var e=1;e<arguments.length;e++)t=t+"."+arguments[e];return createScoped(this,t)},_$Model_54.prototype.at=function(t){if(arguments.length>1)for(var e=1;e<arguments.length;e++)t=t+"."+arguments[e];return createScoped(this,this.path(t))},_$Model_54.prototype.parent=function(t){null==t&&(t=1);var e=this._splitPath(),n=Math.max(0,e.length-t),r=e.slice(0,n).join(".");return this.scope(r)},_$Model_54.prototype.leaf=function(t){t||(t=this.path());var e=t.lastIndexOf(".");return t.slice(e+1)};var _$Doc_52=Doc;function Doc(t,e,n){this.collectionName=e,this.id=n,this.collectionData=t&&t.data[e]}Doc.prototype.path=function(t){var e=this.collectionName+"."+this.id;return t&&t.length&&(e+="."+t.join(".")),e},Doc.prototype._errorMessage=function(t,e,n){return t+" at "+this.path(e)+": "+JSON.stringify(n,null,2)};var _$LocalDoc_53=LocalDoc;function LocalDoc(t,e,n,r){_$Doc_52.call(this,t,e,n),this.data=r,this._updateCollectionData()}function nodeCreateArray(t,e){return t=t[e]||(t[e]=[])}LocalDoc.prototype=new _$Doc_52,LocalDoc.prototype._updateCollectionData=function(){this.collectionData[this.id]=this.data},LocalDoc.prototype.create=function(t,e){if(void 0!==this.data){var n=this._errorMessage("create on local document with data",null,this.data);return e(new Error(n))}this.data=t,this._updateCollectionData(),e()},LocalDoc.prototype.set=function(t,e,n){return this._apply(t,function(t,n){var r=t[n];return t[n]=e,r},n)},LocalDoc.prototype.del=function(t,e){var n=this.get(t);if(void 0!==n)return this._apply(t,function(t,e){return delete t[e],n},e);e()},LocalDoc.prototype.increment=function(t,e,n){var r=this;return this._validatedApply(t,function(e){if("number"!=typeof e&&null!=e)return new TypeError(r._errorMessage("increment on non-number",t,e))},function(t,n){var r=(t[n]||0)+e;return t[n]=r,r},n)},LocalDoc.prototype.push=function(t,e,n){return this._arrayApply(t,function(t){return t.push(e)},n)},LocalDoc.prototype.unshift=function(t,e,n){return this._arrayApply(t,function(t){return t.unshift(e)},n)},LocalDoc.prototype.insert=function(t,e,n,r){return this._arrayApply(t,function(t){return t.splice.apply(t,[e,0].concat(n)),t.length},r)},LocalDoc.prototype.pop=function(t,e){return this._arrayApply(t,function(t){return t.pop()},e)},LocalDoc.prototype.shift=function(t,e){return this._arrayApply(t,function(t){return t.shift()},e)},LocalDoc.prototype.remove=function(t,e,n,r){return this._arrayApply(t,function(t){return t.splice(e,n)},r)},LocalDoc.prototype.move=function(t,e,n,r,i){return this._arrayApply(t,function(t){var i=t.splice(e,r);return t.splice.apply(t,[n,0].concat(i)),i},i)},LocalDoc.prototype.stringInsert=function(t,e,n,r){var i=this;return this._validatedApply(t,function(e){if("string"!=typeof e&&null!=e)return new TypeError(i._errorMessage("stringInsert on non-string",t,e))},function(t,r){var i=t[r];return null==i?(t[r]=n,i):(t[r]=i.slice(0,e)+n+i.slice(e),i)},r)},LocalDoc.prototype.stringRemove=function(t,e,n,r){var i=this;return this._validatedApply(t,function(e){if("string"!=typeof e&&null!=e)return new TypeError(i._errorMessage("stringRemove on non-string",t,e))},function(t,r){var i=t[r];return null==i?i:(e<0&&(e+=i.length),t[r]=i.slice(0,e)+i.slice(e+n),i)},r)},LocalDoc.prototype.get=function(t){return _$util_73.lookup(t,this.data)},LocalDoc.prototype._createImplied=function(t,e){for(var n=this,r="data",i=0,o=t[i++];null!=o;)n=n[r]||(n[r]=/^\d+$/.test(o)?[]:{}),r=o,o=t[i++];return e(n,r)},LocalDoc.prototype._apply=function(t,e,n){var r=this._createImplied(t,e);return this._updateCollectionData(),n(),r},LocalDoc.prototype._validatedApply=function(t,e,n,r){var i=this._createImplied(t,function(t,i){var o=e(t[i]);return o?r(o):n(t,i)});return this._updateCollectionData(),r(),i},LocalDoc.prototype._arrayApply=function(t,e,n){var r=this._createImplied(t,nodeCreateArray);if(!Array.isArray(r)){var i=this._errorMessage(e.name+" on non-array",t,r);return n(new TypeError(i))}var o=e(r);return this._updateCollectionData(),n(),o};var _$collections_57={};function CollectionMap(){}function ModelData(){}function DocMap(){}function CollectionData(){}function Collection(t,e,n){this.model=t,this.name=e,this.Doc=n,this.docs=new DocMap,this.data=t.data[e]=new CollectionData}function noKeys(t){for(var e in t)return!1;return!0}_$Model_54.INITS.push(function(t){t.root.collections=new CollectionMap,t.root.data=new ModelData}),_$Model_54.prototype.getCollection=function(t){return this.root.collections[t]},_$Model_54.prototype.getDoc=function(t,e){var n=this.root.collections[t];return n&&n.docs[e]},_$Model_54.prototype.get=function(t){var e=this._splitPath(t);return this._get(e)},_$Model_54.prototype._get=function(t){return _$util_73.lookup(t,this.root.data)},_$Model_54.prototype.getCopy=function(t){var e=this._splitPath(t);return this._getCopy(e)},_$Model_54.prototype._getCopy=function(t){var e=this._get(t);return _$util_73.copy(e)},_$Model_54.prototype.getDeepCopy=function(t){var e=this._splitPath(t);return this._getDeepCopy(e)},_$Model_54.prototype._getDeepCopy=function(t){var e=this._get(t);return _$util_73.deepCopy(e)},_$Model_54.prototype.getOrCreateCollection=function(t){var e=this.root.collections[t];if(e)return e;var n=this._getDocConstructor(t);return e=new Collection(this.root,t,n),this.root.collections[t]=e,e},_$Model_54.prototype._getDocConstructor=function(){return _$LocalDoc_53},_$Model_54.prototype.getOrCreateDoc=function(t,e,n){var r=this.getOrCreateCollection(t);return r.docs[e]||r.add(e,n)},_$Model_54.prototype.destroy=function(t){var e=this._splitPath(t),n=this.silent();if(n.removeAllListeners(null,t),n._removeAllRefs(e),n._stopAll(e),n._removeAllFilters(e),0===e.length){this.root.collections=new CollectionMap;var r=this.root.data;for(var i in r)delete r[i]}else if(1===e.length){var o=this.getCollection(e[0]);o&&o.destroy()}else n._del(e)},Collection.prototype.add=function(t,e){var n=new this.Doc(this.model,this.name,t,e,this);return this.docs[t]=n,n},Collection.prototype.destroy=function(){delete this.model.collections[this.name],delete this.model.data[this.name]},Collection.prototype.remove=function(t){delete this.docs[t],delete this.data[t],noKeys(this.docs)&&this.destroy()},Collection.prototype.get=function(){return this.data};var _$mutators_65={};_$Model_54.prototype._mutate=function(t,e,n){n=this.wrapCallback(n);var r=t[0],i=t[1];if(!r||!i){var o=e.name+" must be performed under a collection and document id. Invalid path: "+t.join(".");return n(new Error(o))}var s=this.getOrCreateDoc(r,i),a=t.slice(2);if(this._preventCompose&&s.shareDoc){var u=s.shareDoc.preventCompose;s.shareDoc.preventCompose=!0;var c=e(s,a,n);return s.shareDoc.preventCompose=u,c}return e(s,a,n)},_$Model_54.prototype.set=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._set(r,e,n)},_$Model_54.prototype._set=function(t,e,n){t=this._dereference(t);var r=this;return this._mutate(t,function(n,i,o){var s=n.set(i,e,o);return 0===i.length&&(e=n.get(i)),r.emit("change",t,[e,s,r._pass]),s},n)},_$Model_54.prototype.setNull=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._setNull(r,e,n)},_$Model_54.prototype._setNull=function(t,e,n){t=this._dereference(t);var r=this;return this._mutate(t,function(n,i,o){var s=n.get(i);return null!=s?(o(),s):(n.set(i,e,o),r.emit("change",t,[e,s,r._pass]),e)},n)},_$Model_54.prototype.setEach=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._setEach(r,e,n)},_$Model_54.prototype._setEach=function(t,e,n){t=this._dereference(t);var r=_$util_73.asyncGroup(this.wrapCallback(n));for(var i in e){var o=e[i];this._set(t.concat(i),o,r())}},_$Model_54.prototype.create=function(){var t,e,n;0===arguments.length?e={}:1===arguments.length?"function"==typeof arguments[0]?(e={},n=arguments[0]):e=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._create(r,e,n)},_$Model_54.prototype._create=function(t,e,n){if(2!==(t=this._dereference(t)).length){var r="create may only be used on a document path. Invalid path: "+t.join(".");return(n=this.wrapCallback(n))(new Error(r))}var i=this;this._mutate(t,function(n,r,o){n.create(e,o),e=n.get(),i.emit("change",t,[e,void 0,i._pass])},n)},_$Model_54.prototype.createNull=function(){var t,e,n;0===arguments.length?e={}:1===arguments.length?"function"==typeof arguments[0]?(e={},n=arguments[0]):e=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._createNull(r,e,n)},_$Model_54.prototype._createNull=function(t,e,n){t=this._dereference(t);var r=this.getDoc(t[0],t[1]);r&&null!=r.get()||this._create(t,e,n)},_$Model_54.prototype.add=function(){var t,e,n;0===arguments.length?e={}:1===arguments.length?"function"==typeof arguments[0]?(e={},n=arguments[0]):e=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._add(r,e,n)},_$Model_54.prototype._add=function(t,e,n){if("object"!=typeof e){var r="add requires an object value. Invalid value: "+e;return(n=this.wrapCallback(n))(new Error(r))}var i=e.id||this.id();e.id=i,t=this._dereference(t.concat(i));var o=this;return this._mutate(t,function(n,r,i){var s;r.length?s=n.set(r,e,i):(n.create(e,i),e=n.get()),o.emit("change",t,[e,s,o._pass])},n),i},_$Model_54.prototype.del=function(){var t,e;1===arguments.length?"function"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:(t=arguments[0],e=arguments[1]);var n=this._splitPath(t);return this._del(n,e)},_$Model_54.prototype._del=function(t,e){t=this._dereference(t);var n=this;return this._mutate(t,function(e,r,i){var o=e.del(r,i);if(2===t.length){var s=t[0],a=t[1];n.root.collections[s].remove(a)}return n.emit("change",t,[void 0,o,n._pass]),o},e)},_$Model_54.prototype.increment=function(){var t,e,n;1===arguments.length?"function"==typeof arguments[0]?n=arguments[0]:"number"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(n=arguments[1],"number"==typeof arguments[0]?e=arguments[0]:t=arguments[0]):(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._increment(r,e,n)},_$Model_54.prototype._increment=function(t,e,n){t=this._dereference(t),null==e&&(e=1);var r=this;return this._mutate(t,function(n,i,o){var s=n.increment(i,e,o),a=s-e;return r.emit("change",t,[s,a,r._pass]),s},n)},_$Model_54.prototype.push=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._push(r,e,n)},_$Model_54.prototype._push=function(t,e,n){t=this._dereference(t,!0);var r=this;return this._mutate(t,function(n,i,o){var s=n.push(i,e,o);return r.emit("insert",t,[s-1,[e],r._pass]),s},n)},_$Model_54.prototype.unshift=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._unshift(r,e,n)},_$Model_54.prototype._unshift=function(t,e,n){t=this._dereference(t,!0);var r=this;return this._mutate(t,function(n,i,o){var s=n.unshift(i,e,o);return r.emit("insert",t,[0,[e],r._pass]),s},n)},_$Model_54.prototype.insert=function(){var t,e,n,r;if(arguments.length<2)throw new Error("Not enough arguments for insert");2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?(t=arguments[0],e=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]);var i=this._splitPath(t);return this._insert(i,+e,n,r)},_$Model_54.prototype._insert=function(t,e,n,r){t=this._dereference(t,!0);var i=this;return this._mutate(t,function(r,o,s){var a=Array.isArray(n)?n:[n],u=r.insert(o,e,a,s);return i.emit("insert",t,[e,a,i._pass]),u},r)},_$Model_54.prototype.pop=function(){var t,e;1===arguments.length?"function"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:(t=arguments[0],e=arguments[1]);var n=this._splitPath(t);return this._pop(n,e)},_$Model_54.prototype._pop=function(t,e){t=this._dereference(t,!0);var n=this;return this._mutate(t,function(e,r,i){var o=e.get(r),s=o&&o.length;if(s){var a=e.pop(r,i);return n.emit("remove",t,[s-1,[a],n._pass]),a}i()},e)},_$Model_54.prototype.shift=function(){var t,e;1===arguments.length?"function"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:(t=arguments[0],e=arguments[1]);var n=this._splitPath(t);return this._shift(n,e)},_$Model_54.prototype._shift=function(t,e){t=this._dereference(t,!0);var n=this;return this._mutate(t,function(e,r,i){var o=e.get(r);if(o&&o.length){var s=e.shift(r,i);return n.emit("remove",t,[0,[s],n._pass]),s}i()},e)},_$Model_54.prototype.remove=function(){var t,e,n,r;arguments.length<2?e=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(r=arguments[1],"number"==typeof arguments[0]?e=arguments[0]:t=arguments[0]):"number"==typeof arguments[0]?(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(r=arguments[2],"number"==typeof arguments[0]?(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1])):(t=arguments[0],e=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]);var i=this._splitPath(t);return null==e&&(e=i.pop()),this._remove(i,+e,n,r)},_$Model_54.prototype._remove=function(t,e,n,r){t=this._dereference(t,!0),null==n&&(n=1);var i=this;return this._mutate(t,function(r,o,s){var a=r.remove(o,e,n,s);return i.emit("remove",t,[e,a,i._pass]),a},r)},_$Model_54.prototype.move=function(){var t,e,n,r,i;if(arguments.length<2)throw new Error("Not enough arguments for move");2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(e=arguments[0],n=arguments[1],i=arguments[2]):"number"==typeof arguments[0]?(e=arguments[0],n=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2]):4===arguments.length?"function"==typeof arguments[3]?(i=arguments[3],"number"==typeof arguments[0]?(e=arguments[0],n=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2])):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3],i=arguments[4]);var o=this._splitPath(t);return this._move(o,e,n,r,i)},_$Model_54.prototype._move=function(t,e,n,r,i){t=this._dereference(t,!0),null==r&&(r=1);var o=this;return this._mutate(t,function(i,s,a){if(n=+n,(e=+e)<0||n<0){var u=i.get(s).length;e<0&&(e+=u),n<0&&(n+=u)}var c=i.move(s,e,n,r,a);return o.emit("move",t,[e,n,c.length,o._pass]),c},i)},_$Model_54.prototype.stringInsert=function(){var t,e,n,r;if(arguments.length<2)throw new Error("Not enough arguments for stringInsert");2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(e=arguments[0],n=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]);var i=this._splitPath(t);return this._stringInsert(i,e,n,r)},_$Model_54.prototype._stringInsert=function(t,e,n,r){t=this._dereference(t);var i=this;return this._mutate(t,function(r,o,s){var a=r.stringInsert(o,e,n,s),u=r.get(o),c=i.pass({$stringInsert:{index:e,text:n}})._pass;i.emit("change",t,[u,a,c])},r)},_$Model_54.prototype.stringRemove=function(){var t,e,n,r;if(arguments.length<2)throw new Error("Not enough arguments for stringRemove");2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(e=arguments[0],n=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]);var i=this._splitPath(t);return this._stringRemove(i,e,n,r)},_$Model_54.prototype._stringRemove=function(t,e,n,r){t=this._dereference(t);var i=this;return this._mutate(t,function(r,o,s){var a=r.stringRemove(o,e,n,s),u=r.get(o),c=i.pass({$stringRemove:{index:e,howMany:n}})._pass;i.emit("change",t,[u,a,c])},r)},_$Model_54.prototype.subtypeSubmit=function(){var t,e,n,r;if(arguments.length<2)throw new Error("Not enough arguments for subtypeSubmit");2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(e=arguments[0],n=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]);var i=this._splitPath(t);return this._subtypeSubmit(i,e,n,r)},_$Model_54.prototype._subtypeSubmit=function(t,e,n,r){t=this._dereference(t);var i=this;return this._mutate(t,function(r,o,s){var a=r.subtypeSubmit(o,e,n,s),u=r.get(o),c=i.pass({$subtype:{type:e,op:n}})._pass;return i.emit("change",t,[u,void 0,c]),a},r)};var _$arrayDiff_1=arrayDiff;function InsertDiff(t,e){this.index=t,this.values=e}function RemoveDiff(t,e){this.index=t,this.howMany=e}function MoveDiff(t,e,n){this.from=t,this.to=e,this.howMany=n}function strictEqual(t,e){return t===e}function arrayDiff(t,e,n){n||(n=strictEqual);for(var r=t.length,i=e.length,o=[],s={},a={},u=0;u<r;u++)for(var c=t[u],l=0;l<i;l++)if(!a[l]&&n(c,e[l])){var h=u,p=l,f=0;do{s[u++]=a[l++]=!0,f++}while(u<r&&l<i&&n(t[u],e[l])&&!a[l]);o.push(new MoveDiff(h,p,f)),u--;break}var d=[];for(u=0;u<r;)if(s[u])u++;else{var m=u;for(f=0;u<r&&!s[u++];)f++;d.push(new RemoveDiff(m,f))}var v=[];for(l=0;l<i;)if(a[l])l++;else{for(m=l,f=0;l<i&&!a[l++];)f++;var g=e.slice(m,m+f);v.push(new InsertDiff(m,g))}var y,_,b=v.length,x=d.length,E=o.length,w=0;for(y=0;y<x;y++){var S=d[y];for(S.index-=w,w+=S.howMany,_=0;_<E;_++){(A=o[_]).from>=S.index&&(A.from-=S.howMany)}}for(y=b;y--;){var C=v[y];f=C.values.length;for(_=E;_--;){(A=o[_]).to>=C.index&&(A.to-=f)}}for(y=E;y-- >1;){if((A=o[y]).to!==A.from)for(_=y;_--;){var M=o[_];M.to>=A.to&&(M.to-=A.howMany),M.to>=A.from&&(M.to+=A.howMany)}}var T=[];for(y=0;y<E;y++){var A;if((A=o[y]).to!==A.from)for(T.push(A),_=y+1;_<E;_++){var $=o[_];$.from>=A.from&&($.from-=A.howMany),$.from>=A.to&&($.from+=A.howMany)}}return d.concat(T,v)}arrayDiff.InsertDiff=InsertDiff,arrayDiff.RemoveDiff=RemoveDiff,arrayDiff.MoveDiff=MoveDiff,InsertDiff.prototype.type="insert",InsertDiff.prototype.toJSON=function(){return{type:this.type,index:this.index,values:this.values}},RemoveDiff.prototype.type="remove",RemoveDiff.prototype.toJSON=function(){return{type:this.type,index:this.index,howMany:this.howMany}},MoveDiff.prototype.type="move",MoveDiff.prototype.toJSON=function(){return{type:this.type,from:this.from,to:this.to,howMany:this.howMany}};var _$setDiff_69={};function diffDeep(t,e,n,r,i){if("object"==typeof n&&n&&"object"==typeof r&&r)if(Array.isArray(n)&&Array.isArray(r)){var o=_$arrayDiff_1(n,r,_$util_73.deepEqual);if(!o.length)return;if(2===o.length&&o[0].index===o[1].index&&o[0]instanceof _$arrayDiff_1.RemoveDiff&&1===o[0].howMany&&o[1]instanceof _$arrayDiff_1.InsertDiff&&1===o[1].values.length){var s=o[0].index;return void diffDeep(t,u=e.concat(s),n[s],r[s],i)}t._applyArrayDiff(e,o,i())}else{for(var a in n)if(!(a in r)){var u=e.concat(a);t._del(u,i())}for(var a in r){if(!_$util_73.deepEqual(n[a],r[a]))diffDeep(t,u=e.concat(a),n[a],r[a],i)}}else t._setDiff(e,r,i())}_$Model_54.prototype.setDiff=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._setDiff(r,e,n)},_$Model_54.prototype._setDiff=function(t,e,n){t=this._dereference(t);var r=this;return this._mutate(t,function(n,i,o){var s=n.get(i);return _$util_73.equal(s,e)?(o(),s):(n.set(i,e,o),r.emit("change",t,[e,s,r._pass]),s)},n)},_$Model_54.prototype.setDiffDeep=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._setDiffDeep(r,e,n)},_$Model_54.prototype._setDiffDeep=function(t,e,n){var r=this._get(t);n=this.wrapCallback(n);var i=_$util_73.asyncGroup(n),o=i();diffDeep(this,t,r,e,i),o()},_$Model_54.prototype.setArrayDiff=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._setArrayDiff(r,e,n)},_$Model_54.prototype.setArrayDiffDeep=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._setArrayDiffDeep(r,e,n)},_$Model_54.prototype._setArrayDiffDeep=function(t,e,n){return this._setArrayDiff(t,e,n,_$util_73.deepEqual)},_$Model_54.prototype._setArrayDiff=function(t,e,n,r){var i=this._get(t);if(i===e)return this.wrapCallback(n)();if(Array.isArray(i)&&Array.isArray(e)){var o=_$arrayDiff_1(i,e,r);this._applyArrayDiff(t,o,n)}else this._set(t,e,n)},_$Model_54.prototype._applyArrayDiff=function(t,e,n){if(!e.length)return this.wrapCallback(n)();t=this._dereference(t);var r=this;return this._mutate(t,function(n,i,o){for(var s=_$util_73.asyncGroup(o),a=0,u=e.length;a<u;a++){var c=e[a];if(c instanceof _$arrayDiff_1.InsertDiff)n.insert(i,c.index,c.values,s()),r.emit("insert",t,[c.index,c.values,r._pass]);else if(c instanceof _$arrayDiff_1.RemoveDiff){var l=n.remove(i,c.index,c.howMany,s());r.emit("remove",t,[c.index,l,r._pass])}else if(c instanceof _$arrayDiff_1.MoveDiff){var h=n.move(i,c.from,c.to,c.howMany,s());r.emit("move",t,[c.from,c.to,h.length,r._pass])}}},n)};var _$emitter_83={},__EventEmitter_83=_$EventEmitter_30.EventEmitter;function mixin(t){for(var e in __EventEmitter_83.prototype)t.prototype[e]=__EventEmitter_83.prototype[e]}_$emitter_83.EventEmitter=__EventEmitter_83,_$emitter_83.mixin=mixin;var SUPPORTED_METHODS=["info","warn","error"];function Logger(){var t={};SUPPORTED_METHODS.forEach(function(e){t[e]=console[e].bind(console)}),this.setMethods(t)}var _$Logger_86=Logger;Logger.prototype.setMethods=function(t){t=t||{};var e=this;SUPPORTED_METHODS.forEach(function(n){"function"==typeof t[n]&&(e[n]=t[n])})};var logger=new _$Logger_86,_$logger_85=logger;function ShareDBError(t,e){this.code=t,this.message=e||"",Error.captureStackTrace?Error.captureStackTrace(this,ShareDBError):this.stack=(new Error).stack}ShareDBError.prototype=Object.create(Error.prototype),ShareDBError.prototype.constructor=ShareDBError,ShareDBError.prototype.name="ShareDBError",ShareDBError.CODES={ERR_APPLY_OP_VERSION_DOES_NOT_MATCH_SNAPSHOT:"ERR_APPLY_OP_VERSION_DOES_NOT_MATCH_SNAPSHOT",ERR_APPLY_SNAPSHOT_NOT_PROVIDED:"ERR_APPLY_SNAPSHOT_NOT_PROVIDED",ERR_CLIENT_ID_BADLY_FORMED:"ERR_CLIENT_ID_BADLY_FORMED",ERR_CONNECTION_STATE_TRANSITION_INVALID:"ERR_CONNECTION_STATE_TRANSITION_INVALID",ERR_DATABASE_ADAPTER_NOT_FOUND:"ERR_DATABASE_ADAPTER_NOT_FOUND",ERR_DATABASE_DOES_NOT_SUPPORT_SUBSCRIBE:"ERR_DATABASE_DOES_NOT_SUPPORT_SUBSCRIBE",ERR_DATABASE_METHOD_NOT_IMPLEMENTED:"ERR_DATABASE_METHOD_NOT_IMPLEMENTED",ERR_DEFAULT_TYPE_MISMATCH:"ERR_DEFAULT_TYPE_MISMATCH",ERR_DOC_MISSING_VERSION:"ERR_DOC_MISSING_VERSION",ERR_DOC_ALREADY_CREATED:"ERR_DOC_ALREADY_CREATED",ERR_DOC_DOES_NOT_EXIST:"ERR_DOC_DOES_NOT_EXIST",ERR_DOC_TYPE_NOT_RECOGNIZED:"ERR_DOC_TYPE_NOT_RECOGNIZED",ERR_DOC_WAS_DELETED:"ERR_DOC_WAS_DELETED",ERR_INFLIGHT_OP_MISSING:"ERR_INFLIGHT_OP_MISSING",ERR_INGESTED_SNAPSHOT_HAS_NO_VERSION:"ERR_INGESTED_SNAPSHOT_HAS_NO_VERSION",ERR_MAX_SUBMIT_RETRIES_EXCEEDED:"ERR_MAX_SUBMIT_RETRIES_EXCEEDED",ERR_MESSAGE_BADLY_FORMED:"ERR_MESSAGE_BADLY_FORMED",ERR_MILESTONE_ARGUMENT_INVALID:"ERR_MILESTONE_ARGUMENT_INVALID",ERR_OP_ALREADY_SUBMITTED:"ERR_OP_ALREADY_SUBMITTED",ERR_OP_NOT_ALLOWED_IN_PROJECTION:"ERR_OP_NOT_ALLOWED_IN_PROJECTION",ERR_OP_SUBMIT_REJECTED:"ERR_OP_SUBMIT_REJECTED",ERR_OP_VERSION_MISMATCH_AFTER_TRANSFORM:"ERR_OP_VERSION_MISMATCH_AFTER_TRANSFORM",ERR_OP_VERSION_MISMATCH_DURING_TRANSFORM:"ERR_OP_VERSION_MISMATCH_DURING_TRANSFORM",ERR_OP_VERSION_NEWER_THAN_CURRENT_SNAPSHOT:"ERR_OP_VERSION_NEWER_THAN_CURRENT_SNAPSHOT",ERR_OT_OP_BADLY_FORMED:"ERR_OT_OP_BADLY_FORMED",ERR_OT_OP_NOT_PROVIDED:"ERR_OT_OP_NOT_PROVIDED",ERR_PROTOCOL_VERSION_NOT_SUPPORTED:"ERR_PROTOCOL_VERSION_NOT_SUPPORTED",ERR_QUERY_EMITTER_LISTENER_NOT_ASSIGNED:"ERR_QUERY_EMITTER_LISTENER_NOT_ASSIGNED",ERR_SNAPSHOT_READ_SILENT_REJECTION:"ERR_SNAPSHOT_READ_SILENT_REJECTION",ERR_SNAPSHOT_READS_REJECTED:"ERR_SNAPSHOT_READS_REJECTED",ERR_SUBMIT_TRANSFORM_OPS_NOT_FOUND:"ERR_SUBMIT_TRANSFORM_OPS_NOT_FOUND",ERR_TYPE_CANNOT_BE_PROJECTED:"ERR_TYPE_CANNOT_BE_PROJECTED",ERR_UNKNOWN_ERROR:"ERR_UNKNOWN_ERROR"};var _$ShareDBError_84=ShareDBError,_$bootstrapTransform_34=bootstrapTransform;function bootstrapTransform(t,e,n,r){var i=t.transformX=function(t,o){n(t),n(o);for(var s,a,u,c=[],l=0;l<o.length;l++){for(var h=o[l],p=[],f=0;f<t.length;){var d=[];if(s=t[f],u=d,e(p,s,a=h,"left"),e(u,a,s,"right"),f++,1!==d.length){if(0===d.length){for(var m=f;m<t.length;m++)r(p,t[m]);h=null;break}for(var v=i(t.slice(f),d),g=0;g<v[0].length;g++)r(p,v[0][g]);for(var y=0;y<v[1].length;y++)r(c,v[1][y]);h=null;break}h=d[0]}null!=h&&r(c,h),t=p}return[t,c]};t.transform=function(t,n,r){if("left"!==r&&"right"!==r)throw new Error("type must be 'left' or 'right'");return 0===n.length?t:1===t.length&&1===n.length?e([],t[0],n[0],r):"left"===r?i(t,n)[0]:i(n,t)[1]}}var _$text0_37={},text=_$text0_37={name:"text0",uri:"http://sharejs.org/types/textv0",create:function(t){if(null!=t&&"string"!=typeof t)throw new Error("Initial data must be a string");return t||""}},strInject=function(t,e,n){return t.slice(0,e)+n+t.slice(e)},checkValidComponent=function(t){if("number"!=typeof t.p)throw new Error("component missing position field");if("string"==typeof t.i==("string"==typeof t.d))throw new Error("component needs an i or d field");if(t.p<0)throw new Error("position cannot be negative")},checkValidOp=function(t){for(var e=0;e<t.length;e++)checkValidComponent(t[e])};text.apply=function(t,e){var n;checkValidOp(e);for(var r=0;r<e.length;r++){var i=e[r];if(null!=i.i)t=strInject(t,i.p,i.i);else{if(n=t.slice(i.p,i.p+i.d.length),i.d!==n)throw new Error("Delete component '"+i.d+"' does not match deleted text '"+n+"'");t=t.slice(0,i.p)+t.slice(i.p+i.d.length)}}return t};var append=text._append=function(t,e){if(""!==e.i&&""!==e.d)if(0===t.length)t.push(e);else{var n=t[t.length-1];null!=n.i&&null!=e.i&&n.p<=e.p&&e.p<=n.p+n.i.length?t[t.length-1]={i:strInject(n.i,e.p-n.p,e.i),p:n.p}:null!=n.d&&null!=e.d&&e.p<=n.p&&n.p<=e.p+e.d.length?t[t.length-1]={d:strInject(e.d,n.p-e.p,n.d),p:e.p}:t.push(e)}};text.compose=function(t,e){checkValidOp(t),checkValidOp(e);for(var n=t.slice(),r=0;r<e.length;r++)append(n,e[r]);return n},text.normalize=function(t){var e=[];null==t.i&&null==t.p||(t=[t]);for(var n=0;n<t.length;n++){var r=t[n];null==r.p&&(r.p=0),append(e,r)}return e};var transformPosition=function(t,e,n){return null!=e.i?e.p<t||e.p===t&&n?t+e.i.length:t:t<=e.p?t:t<=e.p+e.d.length?e.p:t-e.d.length};text.transformCursor=function(t,e,n){for(var r="right"===n,i=0;i<e.length;i++)t=transformPosition(t,e[i],r);return t};var transformComponent=text._tc=function(t,e,n,r){if(checkValidComponent(e),checkValidComponent(n),null!=e.i)append(t,{i:e.i,p:transformPosition(e.p,n,"right"===r)});else if(null!=n.i){var i=e.d;e.p<n.p&&(append(t,{d:i.slice(0,n.p-e.p),p:e.p}),i=i.slice(n.p-e.p)),""!==i&&append(t,{d:i,p:e.p+n.i.length})}else if(e.p>=n.p+n.d.length)append(t,{d:e.d,p:e.p-n.d.length});else if(e.p+e.d.length<=n.p)append(t,e);else{var o={d:"",p:e.p};e.p<n.p&&(o.d=e.d.slice(0,n.p-e.p)),e.p+e.d.length>n.p+n.d.length&&(o.d+=e.d.slice(n.p+n.d.length-e.p));var s=Math.max(e.p,n.p),a=Math.min(e.p+e.d.length,n.p+n.d.length);if(e.d.slice(s-e.p,a-e.p)!==n.d.slice(s-n.p,a-n.p))throw new Error("Delete ops delete different text in the same region of the document");""!==o.d&&(o.p=transformPosition(o.p,n),append(t,o))}return t},invertComponent=function(t){return null!=t.i?{d:t.i,p:t.p}:{i:t.d,p:t.p}};text.invert=function(t){t=t.slice().reverse();for(var e=0;e<t.length;e++)t[e]=invertComponent(t[e]);return t},_$bootstrapTransform_34(text,transformComponent,checkValidOp,append);var __isArray_36=function(t){return"[object Array]"==Object.prototype.toString.call(t)},isObject=function(t){return!!t&&t.constructor===Object},clone=function(t){return JSON.parse(JSON.stringify(t))},json={name:"json0",uri:"http://sharejs.org/types/JSONv0"},subtypes={};function convertFromText(t){t.t="text0";var e={p:t.p.pop()};null!=t.si&&(e.i=t.si),null!=t.sd&&(e.d=t.sd),t.o=[e]}function convertToText(t){t.p.push(t.o[0].p),null!=t.o[0].i&&(t.si=t.o[0].i),null!=t.o[0].d&&(t.sd=t.o[0].d),delete t.t,delete t.o}json.registerSubtype=function(t){subtypes[t.name]=t},json.create=function(t){return void 0===t?null:clone(t)},json.invertComponent=function(t){var e={p:t.p};return t.t&&subtypes[t.t]&&(e.t=t.t,e.o=subtypes[t.t].invert(t.o)),void 0!==t.si&&(e.sd=t.si),void 0!==t.sd&&(e.si=t.sd),void 0!==t.oi&&(e.od=t.oi),void 0!==t.od&&(e.oi=t.od),void 0!==t.li&&(e.ld=t.li),void 0!==t.ld&&(e.li=t.ld),void 0!==t.na&&(e.na=-t.na),void 0!==t.lm&&(e.lm=t.p[t.p.length-1],e.p=t.p.slice(0,t.p.length-1).concat([t.lm])),e},json.invert=function(t){for(var e=t.slice().reverse(),n=[],r=0;r<e.length;r++)n.push(json.invertComponent(e[r]));return n},json.checkValidOp=function(t){for(var e=0;e<t.length;e++)if(!__isArray_36(t[e].p))throw new Error("Missing path")},json.checkList=function(t){if(!__isArray_36(t))throw new Error("Referenced element not a list")},json.checkObj=function(t){if(!isObject(t))throw new Error("Referenced element not an object (it was "+JSON.stringify(t)+")")},json.apply=function(t,e){json.checkValidOp(e),e=clone(e);for(var n={data:t},r=0;r<e.length;r++){var i=e[r];null==i.si&&null==i.sd||convertFromText(i);for(var o=null,s=n,a="data",u=0;u<i.p.length;u++){var c=i.p[u];if(o=s,a,s=s[a],a=c,null==o)throw new Error("Path invalid")}if(i.t&&void 0!==i.o&&subtypes[i.t])s[a]=subtypes[i.t].apply(s[a],i.o);else if(void 0!==i.na){if("number"!=typeof s[a])throw new Error("Referenced element not a number");s[a]+=i.na}else if(void 0!==i.li&&void 0!==i.ld)json.checkList(s),s[a]=i.li;else if(void 0!==i.li)json.checkList(s),s.splice(a,0,i.li);else if(void 0!==i.ld)json.checkList(s),s.splice(a,1);else if(void 0!==i.lm){if(json.checkList(s),i.lm!=a){var l=s[a];s.splice(a,1),s.splice(i.lm,0,l)}}else if(void 0!==i.oi)json.checkObj(s),s[a]=i.oi;else{if(void 0===i.od)throw new Error("invalid / missing instruction in op");json.checkObj(s),delete s[a]}}return n.data},json.shatter=function(t){for(var e=[],n=0;n<t.length;n++)e.push([t[n]]);return e},json.incrementalApply=function(t,e,n){for(var r=0;r<e.length;r++){var i=[e[r]];n(i,t=json.apply(t,i))}return t};var pathMatches=json.pathMatches=function(t,e,n){if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(t[r]!==e[r]&&(!n||r!==t.length-1))return!1;return!0};json.append=function(t,e){if(e=clone(e),0!==t.length){var n=t[t.length-1];if(null==e.si&&null==e.sd||null==n.si&&null==n.sd||(convertFromText(e),convertFromText(n)),pathMatches(e.p,n.p))if(e.t&&n.t&&e.t===n.t&&subtypes[e.t]){if(n.o=subtypes[e.t].compose(n.o,e.o),null!=e.si||null!=e.sd){for(var r=e.p,i=0;i<n.o.length-1;i++)e.o=[n.o.pop()],e.p=r.slice(),convertToText(e),t.push(e);convertToText(n)}}else null!=n.na&&null!=e.na?t[t.length-1]={p:n.p,na:n.na+e.na}:void 0!==n.li&&void 0===e.li&&e.ld===n.li?void 0!==n.ld?delete n.li:t.pop():void 0!==n.od&&void 0===n.oi&&void 0!==e.oi&&void 0===e.od?n.oi=e.oi:void 0!==n.oi&&void 0!==e.od?void 0!==e.oi?n.oi=e.oi:void 0!==n.od?delete n.oi:t.pop():void 0!==e.lm&&e.p[e.p.length-1]===e.lm||t.push(e);else null==e.si&&null==e.sd||null==n.si&&null==n.sd||(convertToText(e),convertToText(n)),t.push(e)}else t.push(e)},json.compose=function(t,e){json.checkValidOp(t),json.checkValidOp(e);for(var n=clone(t),r=0;r<e.length;r++)json.append(n,e[r]);return n},json.normalize=function(t){var e=[];t=__isArray_36(t)?t:[t];for(var n=0;n<t.length;n++){var r=t[n];null==r.p&&(r.p=[]),json.append(e,r)}return e},json.commonLengthForOps=function(t,e){var n=t.p.length,r=e.p.length;if((null!=t.na||t.t)&&n++,(null!=e.na||e.t)&&r++,0===n)return-1;if(0===r)return null;n--,r--;for(var i=0;i<n;i++){var o=t.p[i];if(i>=r||o!==e.p[i])return null}return n},json.canOpAffectPath=function(t,e){return null!=json.commonLengthForOps({p:e},t)},json.transformComponent=function(t,e,n,r){e=clone(e);var i=json.commonLengthForOps(n,e),o=json.commonLengthForOps(e,n),s=e.p.length,a=n.p.length;if((null!=e.na||e.t)&&s++,(null!=n.na||n.t)&&a++,null!=o&&a>s&&e.p[o]==n.p[o])if(void 0!==e.ld)(c=clone(n)).p=c.p.slice(s),e.ld=json.apply(clone(e.ld),[c]);else if(void 0!==e.od){(c=clone(n)).p=c.p.slice(s),e.od=json.apply(clone(e.od),[c])}if(null!=i){var u=s==a,c=n;if(null==e.si&&null==e.sd||null==n.si&&null==n.sd||(convertFromText(e),convertFromText(c=clone(n))),c.t&&subtypes[c.t]){if(e.t&&e.t===c.t){var l=subtypes[e.t].transform(e.o,c.o,r);if(null!=e.si||null!=e.sd)for(var h=e.p,p=0;p<l.length;p++)e.o=[l[p]],e.p=h.slice(),convertToText(e),json.append(t,e);else(!__isArray_36(l)||l.length>0)&&(e.o=l,json.append(t,e));return t}}else if(void 0!==n.na);else if(void 0!==n.li&&void 0!==n.ld){if(n.p[i]===e.p[i]){if(!u)return t;if(void 0!==e.ld){if(void 0===e.li||"left"!==r)return t;e.ld=clone(n.li)}}}else if(void 0!==n.li)void 0!==e.li&&void 0===e.ld&&u&&e.p[i]===n.p[i]?"right"===r&&e.p[i]++:n.p[i]<=e.p[i]&&e.p[i]++,void 0!==e.lm&&u&&n.p[i]<=e.lm&&e.lm++;else if(void 0!==n.ld){if(void 0!==e.lm&&u){if(n.p[i]===e.p[i])return t;h=n.p[i];var f=e.p[i];(h<(d=e.lm)||h===d&&f<d)&&e.lm--}if(n.p[i]<e.p[i])e.p[i]--;else if(n.p[i]===e.p[i]){if(a<s)return t;if(void 0!==e.ld){if(void 0===e.li)return t;delete e.ld}}}else if(void 0!==n.lm)if(void 0!==e.lm&&s===a){f=e.p[i];var d=e.lm,m=n.p[i],v=n.lm;if(m!==v)if(f===m){if("left"!==r)return t;e.p[i]=v,f===d&&(e.lm=v)}else f>m&&e.p[i]--,f>v?e.p[i]++:f===v&&m>v&&(e.p[i]++,f===d&&e.lm++),d>m?e.lm--:d===m&&d>f&&e.lm--,d>v?e.lm++:d===v&&(v>m&&d>f||v<m&&d<f?"right"===r&&e.lm++:d>f?e.lm++:d===m&&e.lm--)}else if(void 0!==e.li&&void 0===e.ld&&u){f=n.p[i],d=n.lm;(h=e.p[i])>f&&e.p[i]--,h>d&&e.p[i]++}else{f=n.p[i],d=n.lm;(h=e.p[i])===f?e.p[i]=d:(h>f&&e.p[i]--,h>d?e.p[i]++:h===d&&f>d&&e.p[i]++)}else if(void 0!==n.oi&&void 0!==n.od){if(e.p[i]===n.p[i]){if(void 0===e.oi||!u)return t;if("right"===r)return t;e.od=n.oi}}else if(void 0!==n.oi){if(void 0!==e.oi&&e.p[i]===n.p[i]){if("left"!==r)return t;json.append(t,{p:e.p,od:n.oi})}}else if(void 0!==n.od&&e.p[i]==n.p[i]){if(!u)return t;if(void 0===e.oi)return t;delete e.od}}return json.append(t,e),t},_$bootstrapTransform_34(json,json.transformComponent,json.checkValidOp,json.append),json.registerSubtype(_$text0_37);var _$json_36=json,_$lib_35={type:_$json_36},_$types_88={};_$types_88.defaultType=_$lib_35.type,_$types_88.map={},_$types_88.register=function(t){t.name&&(_$types_88.map[t.name]=t),t.uri&&(_$types_88.map[t.uri]=t)},_$types_88.register(_$types_88.defaultType);var _$Doc_77={};(function(t){var e=_$ShareDBError_84.CODES;function n(t,e,n){_$emitter_83.EventEmitter.call(this),this.connection=t,this.collection=e,this.id=n,this.version=null,this.type=null,this.data=void 0,this.inflightFetch=[],this.inflightSubscribe=[],this.inflightUnsubscribe=[],this.pendingFetch=[],this.subscribed=!1,this.wantSubscribe=!1,this.inflightOp=null,this.pendingOps=[],this.type=null,this.applyStack=null,this.preventCompose=!1}function r(t,e,n){if(e){var r=t.pop();t.push(function(t){r&&r(t),n&&n(t)})}else t.push(n)}function i(t,n){if(t.del)return delete(r=n).op,delete r.create,void delete r.del;var r;if(n.del)return new _$ShareDBError_84(e.ERR_DOC_WAS_DELETED,"Document was deleted");if(n.create)return new _$ShareDBError_84(e.ERR_DOC_ALREADY_CREATED,"Document already created");if(n.op){if(t.create)return new _$ShareDBError_84(e.ERR_DOC_ALREADY_CREATED,"Document already created");if(t.type.transformX){var i=t.type.transformX(t.op,n.op);t.op=i[0],n.op=i[1]}else{var o=t.type.transform(t.op,n.op,"left"),s=t.type.transform(n.op,t.op,"right");t.op=o,n.op=s}}}function o(t,e){for(var n=!1,r=0;r<t.length;r++){var i=t[r];i&&(i(e),n=!0)}return n}_$Doc_77=n,_$emitter_83.mixin(n),n.prototype.destroy=function(t){var e=this;e.whenNothingPending(function(){e.wantSubscribe?e.unsubscribe(function(n){if(n)return t?t(n):e.emit("error",n);e.connection._destroyDoc(e),t&&t()}):(e.connection._destroyDoc(e),t&&t())})},n.prototype._setType=function(t){if("string"==typeof t&&(t=_$types_88.map[t]),t)this.type=t;else{if(null!==t){var n=new _$ShareDBError_84(e.ERR_DOC_TYPE_NOT_RECOGNIZED,"Missing type "+t);return this.emit("error",n)}this.type=t,this.data=void 0}},n.prototype.ingestSnapshot=function(t,n){if(!t)return n&&n();if("number"!=typeof t.v){var r=new _$ShareDBError_84(e.ERR_INGESTED_SNAPSHOT_HAS_NO_VERSION,"Missing version in ingested snapshot. "+this.collection+"."+this.id);return n?n(r):this.emit("error",r)}if(this.type||this.hasWritePending()){if(null==this.version){if(this.hasWritePending())return n&&this.once("no write pending",n);r=new _$ShareDBError_84(e.ERR_DOC_MISSING_VERSION,"Cannot ingest snapshot in doc with null version. "+this.collection+"."+this.id);return n?n(r):this.emit("error",r)}return t.v>this.version?this.fetch(n):n&&n()}if(this.version>t.v)return n&&n();this.version=t.v;var i=void 0===t.type?_$types_88.defaultType:t.type;this._setType(i),this.data=this.type&&this.type.deserialize?this.type.deserialize(t.data):t.data,this.emit("load"),n&&n()},n.prototype.whenNothingPending=function(e){var n=this;t.nextTick(function(){n.hasPending()?n.once("nothing pending",e):e()})},n.prototype.hasPending=function(){return!!(this.inflightOp||this.pendingOps.length||this.inflightFetch.length||this.inflightSubscribe.length||this.inflightUnsubscribe.length||this.pendingFetch.length)},n.prototype.hasWritePending=function(){return!(!this.inflightOp&&!this.pendingOps.length)},n.prototype._emitNothingPending=function(){this.hasWritePending()||(this.emit("no write pending"),this.hasPending()||this.emit("nothing pending"))},n.prototype._emitResponseError=function(t,n){return t&&t.code===e.ERR_SNAPSHOT_READ_SILENT_REJECTION?(this.wantSubscribe=!1,n&&n(),void this._emitNothingPending()):n?(n(t),void this._emitNothingPending()):(this._emitNothingPending(),void this.emit("error",t))},n.prototype._handleFetch=function(t,e){var n=this.inflightFetch.shift();if(t)return this._emitResponseError(t,n);this.ingestSnapshot(e,n),this._emitNothingPending()},n.prototype._handleSubscribe=function(t,e){var n=this.inflightSubscribe.shift();if(t)return this._emitResponseError(t,n);this.wantSubscribe&&(this.subscribed=!0),this.ingestSnapshot(e,n),this._emitNothingPending()},n.prototype._handleUnsubscribe=function(t){var e=this.inflightUnsubscribe.shift();if(t)return this._emitResponseError(t,e);e&&e(),this._emitNothingPending()},n.prototype._handleOp=function(t,n){if(t)return this.inflightOp?(t.code===e.ERR_OP_SUBMIT_REJECTED&&(t=null),this._rollback(t)):this.emit("error",t);if(this.inflightOp&&n.src===this.inflightOp.src&&n.seq===this.inflightOp.seq)this._opAcknowledged(n);else if(null==this.version||n.v>this.version)this.fetch();else if(!(n.v<this.version)){if(this.inflightOp)if(o=i(this.inflightOp,n))return this._hardRollback(o);for(var r=0;r<this.pendingOps.length;r++){var o;if(o=i(this.pendingOps[r],n))return this._hardRollback(o)}this.version++;try{this._otApply(n,!1)}catch(t){return this._hardRollback(t)}}},n.prototype._onConnectionStateChanged=function(){if(this.connection.canSend)this.flush(),this._resubscribe();else if(this.inflightOp&&(this.pendingOps.unshift(this.inflightOp),this.inflightOp=null),this.subscribed=!1,(this.inflightFetch.length||this.inflightSubscribe.length)&&(this.pendingFetch=this.pendingFetch.concat(this.inflightFetch,this.inflightSubscribe),this.inflightFetch.length=0,this.inflightSubscribe.length=0),this.inflightUnsubscribe.length){var t=this.inflightUnsubscribe;this.inflightUnsubscribe=[],o(t)}},n.prototype._resubscribe=function(){var t=this.pendingFetch;if(this.pendingFetch=[],this.wantSubscribe)return t.length?void this.subscribe(function(e){o(t,e)}):void this.subscribe();t.length&&this.fetch(function(e){o(t,e)})},n.prototype.fetch=function(t){if(this.connection.canSend){var e=this.connection.sendFetch(this);r(this.inflightFetch,e,t)}else this.pendingFetch.push(t)},n.prototype.subscribe=function(t){if(this.wantSubscribe=!0,this.connection.canSend){var e=this.connection.sendSubscribe(this);r(this.inflightSubscribe,e,t)}else this.pendingFetch.push(t)},n.prototype.unsubscribe=function(e){if(this.wantSubscribe=!1,this.subscribed=!1,this.connection.canSend){var n=this.connection.sendUnsubscribe(this);r(this.inflightUnsubscribe,n,e)}else e&&t.nextTick(e)},n.prototype.flush=function(){this.connection.canSend&&!this.inflightOp&&!this.paused&&this.pendingOps.length&&this._sendOp()},n.prototype._otApply=function(t,n){if(t.op){if(!this.type)throw new _$ShareDBError_84(e.ERR_DOC_DOES_NOT_EXIST,"Cannot apply op to uncreated document. "+this.collection+"."+this.id);if(!n&&this.type===_$types_88.defaultType&&t.op.length>1){this.applyStack||(this.applyStack=[]);for(var r=this.applyStack.length,o=0;o<t.op.length;o++){for(var s={op:[t.op[o]]},a=r;a<this.applyStack.length;a++){var u=i(this.applyStack[a],s);if(u)return this._hardRollback(u)}this.emit("before op",s.op,n),this.data=this.type.apply(this.data,s.op),this.emit("op",s.op,n)}return void this._popApplyStack(r)}return this.emit("before op",t.op,n),this.data=this.type.apply(this.data,t.op),void this.emit("op",t.op,n)}if(t.create)return this._setType(t.create.type),this.data=this.type.deserialize?this.type.createDeserialized?this.type.createDeserialized(t.create.data):this.type.deserialize(this.type.create(t.create.data)):this.type.create(t.create.data),void this.emit("create",n);if(t.del){var c=this.data;return this._setType(null),void this.emit("del",c,n)}},n.prototype._sendOp=function(){var t=this.connection.id;if(t){this.inflightOp||(this.inflightOp=this.pendingOps.shift());var n=this.inflightOp;if(!n){var r=new _$ShareDBError_84(e.ERR_INFLIGHT_OP_MISSING,"No op to send on call to _sendOp");return this.emit("error",r)}n.sentAt=Date.now(),n.retries=null==n.retries?0:n.retries+1,null==n.seq&&(n.seq=this.connection.seq++),this.connection.sendOp(this,n),null==n.src&&(n.src=t)}},n.prototype._submit=function(n,r,i){if(r||(r=!0),n.op){if(!this.type){var o=new _$ShareDBError_84(e.ERR_DOC_DOES_NOT_EXIST,"Cannot submit op. Document has not been created. "+this.collection+"."+this.id);return i?i(o):this.emit("error",o)}this.type.normalize&&(n.op=this.type.normalize(n.op))}try{this._pushOp(n,i),this._otApply(n,r)}catch(t){return this._hardRollback(t)}var s=this;t.nextTick(function(){s.flush()})},n.prototype._pushOp=function(t,e){if(this.applyStack)this.applyStack.push(t);else{var n=this._tryCompose(t);if(n)return void n.callbacks.push(e)}t.type=this.type,t.callbacks=[e],this.pendingOps.push(t)},n.prototype._popApplyStack=function(t){if(t>0)this.applyStack.length=t;else{var e=this.applyStack[0];if(this.applyStack=null,e)if(-1!==(r=this.pendingOps.indexOf(e)))for(var n=this.pendingOps.splice(r),r=0;r<n.length;r++){e=n[r];var i=this._tryCompose(e);i?i.callbacks=i.callbacks.concat(e.callbacks):this.pendingOps.push(e)}}},n.prototype._tryCompose=function(t){if(!this.preventCompose){var e=this.pendingOps[this.pendingOps.length-1];if(e&&!e.sentAt)return e.create&&t.op?(e.create.data=this.type.apply(e.create.data,t.op),e):e.op&&t.op&&this.type.compose?(e.op=this.type.compose(e.op,t.op),e):void 0}},n.prototype.submitOp=function(t,e,n){"function"==typeof e&&(n=e,e=null);var r={op:t},i=e&&e.source;this._submit(r,i,n)},n.prototype.create=function(t,n,r,i){if("function"==typeof n?(i=n,r=null,n=null):"function"==typeof r&&(i=r,r=null),n||(n=_$types_88.defaultType.uri),this.type){var o=new _$ShareDBError_84(e.ERR_DOC_ALREADY_CREATED,"Document already exists");return i?i(o):this.emit("error",o)}var s={create:{type:n,data:t}},a=r&&r.source;this._submit(s,a,i)},n.prototype.del=function(t,n){if("function"==typeof t&&(n=t,t=null),!this.type){var r=new _$ShareDBError_84(e.ERR_DOC_DOES_NOT_EXIST,"Document does not exist");return n?n(r):this.emit("error",r)}var i=t&&t.source;this._submit({del:!0},i,n)},n.prototype.pause=function(){this.paused=!0},n.prototype.resume=function(){this.paused=!1,this.flush()},n.prototype._opAcknowledged=function(t){if(this.inflightOp.create)this.version=t.v;else if(t.v!==this.version)return _$logger_85.warn("Invalid version from server. Expected: "+this.version+" Received: "+t.v,t),this.fetch();this.version++,this._clearInflightOp()},n.prototype._rollback=function(t){var e=this.inflightOp;if(e.op&&e.type.invert){e.op=e.type.invert(e.op);for(var n=0;n<this.pendingOps.length;n++){var r=i(this.pendingOps[n],e);if(r)return this._hardRollback(r)}try{this._otApply(e,!1)}catch(t){return this._hardRollback(t)}this._clearInflightOp(t)}else this._hardRollback(t)},n.prototype._hardRollback=function(t){var e=[];this.inflightOp&&e.push(this.inflightOp),e=e.concat(this.pendingOps),this._setType(null),this.version=null,this.inflightOp=null,this.pendingOps=[];var n=this;this.fetch(function(){for(var r=!!e.length,i=0;i<e.length;i++)r=o(e[i].callbacks,t)&&r;if(t&&!r)return n.emit("error",t)})},n.prototype._clearInflightOp=function(t){var e=this.inflightOp;this.inflightOp=null;var n=o(e.callbacks,t);if(this.flush(),this._emitNothingPending(),t&&!n)return this.emit("error",t)}}).call(this,_$browser_39);var _$Query_79={};(function(t){function e(t,e,n,r,i,o,s){_$emitter_83.EventEmitter.call(this),this.action=t,this.connection=e,this.id=n,this.collection=r,this.query=i,this.results=null,o&&o.results&&(this.results=o.results,delete o.results),this.extra=void 0,this.options=o,this.callback=s,this.ready=!1,this.sent=!1}_$Query_79=e,_$emitter_83.mixin(e),e.prototype.hasPending=function(){return!this.ready},e.prototype.send=function(){if(this.connection.canSend){var t={a:this.action,id:this.id,c:this.collection,q:this.query};if(this.options&&(t.o=this.options),this.results){for(var e=[],n=0;n<this.results.length;n++){var r=this.results[n];e.push([r.id,r.version])}t.r=e}this.connection.send(t),this.sent=!0}},e.prototype.destroy=function(e){this.connection.canSend&&"qs"===this.action&&this.connection.send({a:"qu",id:this.id}),this.connection._destroyQuery(this),e&&t.nextTick(e)},e.prototype._onConnectionStateChanged=function(){this.connection.canSend&&!this.sent?this.send():this.sent=!1},e.prototype._handleFetch=function(t,e,n){this.connection._destroyQuery(this),this._handleResponse(t,e,n)},e.prototype._handleSubscribe=function(t,e,n){this._handleResponse(t,e,n)},e.prototype._handleResponse=function(t,e,n){var r=this.callback;if(this.callback=null,t)return this._finishResponse(t,r);if(!e)return this._finishResponse(null,r);var i=this,o=1,s=function(t){if(t)return i._finishResponse(t,r);--o||i._finishResponse(null,r)};if(Array.isArray(e))o+=e.length,this.results=this._ingestSnapshots(e,s),this.extra=n;else for(var a in e){o++;var u=e[a];this.connection.get(u.c||this.collection,a).ingestSnapshot(u,s)}s()},e.prototype._ingestSnapshots=function(t,e){for(var n=[],r=0;r<t.length;r++){var i=t[r],o=this.connection.get(i.c||this.collection,i.d);o.ingestSnapshot(i,e),n.push(o)}return n},e.prototype._finishResponse=function(t,e){if(this.emit("ready"),this.ready=!0,t)return this.connection._destroyQuery(this),e?e(t):this.emit("error",t);e&&e(null,this.results,this.extra)},e.prototype._handleError=function(t){this.emit("error",t)},e.prototype._handleDiff=function(t){for(var e=0;e<t.length;e++){"insert"===(n=t[e]).type&&(n.values=this._ingestSnapshots(n.values))}for(e=0;e<t.length;e++){var n;switch((n=t[e]).type){case"insert":var r=n.values;Array.prototype.splice.apply(this.results,[n.index,0].concat(r)),this.emit("insert",r,n.index);break;case"remove":var i=n.howMany||1,o=this.results.splice(n.index,i);this.emit("remove",o,n.index);break;case"move":i=n.howMany||1;var s=this.results.splice(n.from,i);Array.prototype.splice.apply(this.results,[n.to,0].concat(s)),this.emit("move",s,n.from,n.to)}}this.emit("changed",this.results)},e.prototype._handleExtra=function(t){this.extra=t,this.emit("extra",t)}}).call(this,_$browser_39);var _$Snapshot_87=Snapshot;function Snapshot(t,e,n,r,i){this.id=t,this.v=e,this.type=n,this.data=r,this.m=i}var _$SnapshotRequest_80=SnapshotRequest;function SnapshotRequest(t,e,n,r,i){if(_$emitter_83.EventEmitter.call(this),"function"!=typeof i)throw new Error("Callback is required for SnapshotRequest");this.requestId=e,this.connection=t,this.id=r,this.collection=n,this.callback=i,this.sent=!1}_$emitter_83.mixin(SnapshotRequest),SnapshotRequest.prototype.send=function(){this.connection.canSend&&(this.connection.send(this._message()),this.sent=!0)},SnapshotRequest.prototype._onConnectionStateChanged=function(){this.connection.canSend?this.sent||this.send():this.sent=!1},SnapshotRequest.prototype._handleResponse=function(t,e){if(this.emit("ready"),t)return this.callback(t);var n=e.meta?e.meta:null,r=new _$Snapshot_87(this.id,e.v,e.type,e.data,n);this.callback(null,r)};var _$util_89={};function doNothing(){}_$util_89.doNothing=doNothing,_$util_89.hasKeys=function(t){for(var e in t)return!0;return!1},_$util_89.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},_$util_89.isValidVersion=function(t){return null===t||_$util_89.isInteger(t)&&t>=0},_$util_89.isValidTimestamp=function(t){return _$util_89.isValidVersion(t)};var _$SnapshotVersionRequest_82=SnapshotVersionRequest;function SnapshotVersionRequest(t,e,n,r,i,o){if(_$SnapshotRequest_80.call(this,t,e,n,r,o),!_$util_89.isValidVersion(i))throw new Error("Snapshot version must be a positive integer or null");this.version=i}SnapshotVersionRequest.prototype=Object.create(_$SnapshotRequest_80.prototype),SnapshotVersionRequest.prototype._message=function(){return{a:"nf",id:this.requestId,c:this.collection,d:this.id,v:this.version}};var _$SnapshotTimestampRequest_81=SnapshotTimestampRequest;function SnapshotTimestampRequest(t,e,n,r,i,o){if(_$SnapshotRequest_80.call(this,t,e,n,r,o),!_$util_89.isValidTimestamp(i))throw new Error("Snapshot timestamp must be a positive integer or null");this.timestamp=i}SnapshotTimestampRequest.prototype=Object.create(_$SnapshotRequest_80.prototype),SnapshotTimestampRequest.prototype._message=function(){return{a:"nt",id:this.requestId,c:this.collection,d:this.id,ts:this.timestamp}};var _$Connection_76={};(function(t){var e=_$ShareDBError_84.CODES;function n(t){return 0===t.readyState||1===t.readyState?"connecting":"disconnected"}function r(t){_$emitter_83.EventEmitter.call(this),this.collections={},this.nextQueryId=1,this.nextSnapshotRequestId=1,this.queries={},this._snapshotRequests={},this.seq=1,this.id=null,this.agent=null,this.debug=!1,this.state=n(t),this.bindToSocket(t)}function i(t,e){var n=new Error(t.message);return n.code=t.code,e&&(n.data=e),n}function o(t){return t.hasPending()}function s(t){return t.hasWritePending()}_$Connection_76=r,_$emitter_83.mixin(r),r.prototype.bindToSocket=function(e){this.socket&&(this.socket.close(),this.socket.onmessage=null,this.socket.onopen=null,this.socket.onerror=null,this.socket.onclose=null),this.socket=e;var r=n(e);this._setState(r),this.canSend=!1;var i=this;e.onmessage=function(e){try{var n="string"==typeof e.data?JSON.parse(e.data):e.data}catch(t){return void _$logger_85.warn("Failed to parse message",e)}i.debug&&_$logger_85.info("RECV",JSON.stringify(n));var r={data:n};if(i.emit("receive",r),r.data)try{i.handleMessage(r.data)}catch(e){t.nextTick(function(){i.emit("error",e)})}},e.onopen=function(){i._setState("connecting")},e.onerror=function(t){i.emit("connection error",t)},e.onclose=function(t){"closed"===t||"Closed"===t?i._setState("closed",t):"stopped"===t||"Stopped by server"===t?i._setState("stopped",t):i._setState("disconnected",t)}},r.prototype.handleMessage=function(t){var n=null;switch(t.error&&(n=i(t.error,t),delete t.error),t.a){case"init":return 1!==t.protocol?(n=new _$ShareDBError_84(e.ERR_PROTOCOL_VERSION_NOT_SUPPORTED,"Unsupported protocol version: "+t.protocol),this.emit("error",n)):_$types_88.map[t.type]!==_$types_88.defaultType?(n=new _$ShareDBError_84(e.ERR_DEFAULT_TYPE_MISMATCH,t.type+" does not match the server default type"),this.emit("error",n)):"string"!=typeof t.id?(n=new _$ShareDBError_84(e.ERR_CLIENT_ID_BADLY_FORMED,"Client id must be a string"),this.emit("error",n)):(this.id=t.id,void this._setState("connected"));case"qf":return void((r=this.queries[t.id])&&r._handleFetch(n,t.data,t.extra));case"qs":return void((r=this.queries[t.id])&&r._handleSubscribe(n,t.data,t.extra));case"qu":return;case"q":var r;if(!(r=this.queries[t.id]))return;return n?r._handleError(n):(t.diff&&r._handleDiff(t.diff),void(t.hasOwnProperty("extra")&&r._handleExtra(t.extra)));case"bf":return this._handleBulkMessage(n,t,"_handleFetch");case"bs":return this._handleBulkMessage(n,t,"_handleSubscribe");case"bu":return this._handleBulkMessage(n,t,"_handleUnsubscribe");case"nf":case"nt":return this._handleSnapshotFetch(n,t);case"f":return void((o=this.getExisting(t.c,t.d))&&o._handleFetch(n,t.data));case"s":return void((o=this.getExisting(t.c,t.d))&&o._handleSubscribe(n,t.data));case"u":return void((o=this.getExisting(t.c,t.d))&&o._handleUnsubscribe(n));case"op":var o;return void((o=this.getExisting(t.c,t.d))&&o._handleOp(n,t));default:_$logger_85.warn("Ignoring unrecognized message",t)}},r.prototype._handleBulkMessage=function(t,e,n){if(e.data)for(var r in e.data){var o=e.data[r];(a=this.getExisting(e.c,r))&&(t?a[n](t):o.error?a[n](i(o.error)):a[n](null,o))}else if(Array.isArray(e.b))for(var s=0;s<e.b.length;s++){r=e.b[s];(a=this.getExisting(e.c,r))&&a[n](t)}else if(e.b)for(var r in e.b){var a;(a=this.getExisting(e.c,r))&&a[n](t)}else _$logger_85.error("Invalid bulk message",e)},r.prototype._reset=function(){this.seq=1,this.id=null,this.agent=null},r.prototype._setState=function(t,n){if(this.state!==t){if("connecting"===t&&"disconnected"!==this.state&&"stopped"!==this.state&&"closed"!==this.state||"connected"===t&&"connecting"!==this.state){var r=new _$ShareDBError_84(e.ERR_CONNECTION_STATE_TRANSITION_INVALID,"Cannot transition directly from "+this.state+" to "+t);return this.emit("error",r)}for(var i in this.state=t,this.canSend="connected"===t,"disconnected"!==t&&"stopped"!==t&&"closed"!==t||this._reset(),this.startBulk(),this.queries){this.queries[i]._onConnectionStateChanged()}for(var o in this.collections){var s=this.collections[o];for(var i in s)s[i]._onConnectionStateChanged()}for(var i in this._snapshotRequests){this._snapshotRequests[i]._onConnectionStateChanged()}this.endBulk(),this.emit(t,n),this.emit("state",t,n)}},r.prototype.startBulk=function(){this.bulk||(this.bulk={})},r.prototype.endBulk=function(){if(this.bulk)for(var t in this.bulk){var e=this.bulk[t];this._sendBulk("f",t,e.f),this._sendBulk("s",t,e.s),this._sendBulk("u",t,e.u)}this.bulk=null},r.prototype._sendBulk=function(t,e,n){if(n){var r,i=[],o={},s=0;for(var a in n){var u=n[a];null==u?i.push(a):(o[a]=u,r=a,s++)}if(1===i.length){a=i[0];this.send({a:t,c:e,d:a})}else i.length&&this.send({a:"b"+t,c:e,b:i});if(1===s){var c=o[r];this.send({a:t,c:e,d:r,v:c})}else s&&this.send({a:"b"+t,c:e,b:o})}},r.prototype._sendAction=function(t,e,n){if(this._addDoc(e),this.bulk){var r=this.bulk[e.collection]||(this.bulk[e.collection]={}),i=r[t]||(r[t]={}),o=i.hasOwnProperty(e.id);return i[e.id]=n,o}var s={a:t,c:e.collection,d:e.id,v:n};this.send(s)},r.prototype.sendFetch=function(t){return this._sendAction("f",t,t.version)},r.prototype.sendSubscribe=function(t){return this._sendAction("s",t,t.version)},r.prototype.sendUnsubscribe=function(t){return this._sendAction("u",t)},r.prototype.sendOp=function(t,e){this._addDoc(t);var n={a:"op",c:t.collection,d:t.id,v:t.version,src:e.src,seq:e.seq};e.op&&(n.op=e.op),e.create&&(n.create=e.create),e.del&&(n.del=e.del),this.send(n)},r.prototype.send=function(t){this.debug&&_$logger_85.info("SEND",JSON.stringify(t)),this.emit("send",t),this.socket.send(JSON.stringify(t))},r.prototype.close=function(){this.socket.close()},r.prototype.getExisting=function(t,e){if(this.collections[t])return this.collections[t][e]},r.prototype.get=function(t,e){var n=this.collections[t]||(this.collections[t]={}),r=n[e];return r||(r=n[e]=new _$Doc_77(this,t,e),this.emit("doc",r)),r},r.prototype._destroyDoc=function(t){var e=this.collections[t.collection];e&&(delete e[t.id],_$util_89.hasKeys(e)||delete this.collections[t.collection])},r.prototype._addDoc=function(t){var e=this.collections[t.collection];e||(e=this.collections[t.collection]={}),e[t.id]!==t&&(e[t.id]=t)},r.prototype._createQuery=function(t,e,n,r,i){var o=this.nextQueryId++,s=new _$Query_79(t,this,o,e,n,r,i);return this.queries[o]=s,s.send(),s},r.prototype._destroyQuery=function(t){delete this.queries[t.id]},r.prototype.createFetchQuery=function(t,e,n,r){return this._createQuery("qf",t,e,n,r)},r.prototype.createSubscribeQuery=function(t,e,n,r){return this._createQuery("qs",t,e,n,r)},r.prototype.hasPending=function(){return!!(this._firstDoc(o)||this._firstQuery(o)||this._firstSnapshotRequest())},r.prototype.hasWritePending=function(){return!!this._firstDoc(s)},r.prototype.whenNothingPending=function(e){var n=this._firstDoc(o);if(n)n.once("nothing pending",this._nothingPendingRetry(e));else{var r=this._firstQuery(o);if(r)r.once("ready",this._nothingPendingRetry(e));else{var i=this._firstSnapshotRequest();i?i.once("ready",this._nothingPendingRetry(e)):t.nextTick(e)}}},r.prototype._nothingPendingRetry=function(e){var n=this;return function(){t.nextTick(function(){n.whenNothingPending(e)})}},r.prototype._firstDoc=function(t){for(var e in this.collections){var n=this.collections[e];for(var r in n){var i=n[r];if(t(i))return i}}},r.prototype._firstQuery=function(t){for(var e in this.queries){var n=this.queries[e];if(t(n))return n}},r.prototype._firstSnapshotRequest=function(){for(var t in this._snapshotRequests)return this._snapshotRequests[t]},r.prototype.fetchSnapshot=function(t,e,n,r){"function"==typeof n&&(r=n,n=null);var i=this.nextSnapshotRequestId++,o=new _$SnapshotVersionRequest_82(this,i,t,e,n,r);this._snapshotRequests[o.requestId]=o,o.send()},r.prototype.fetchSnapshotByTimestamp=function(t,e,n,r){"function"==typeof n&&(r=n,n=null);var i=this.nextSnapshotRequestId++,o=new _$SnapshotTimestampRequest_81(this,i,t,e,n,r);this._snapshotRequests[o.requestId]=o,o.send()},r.prototype._handleSnapshotFetch=function(t,e){var n=this._snapshotRequests[e.id];n&&(delete this._snapshotRequests[e.id],n._handleResponse(t,e))}}).call(this,_$browser_39);var _$client_78={};_$client_78.Connection=_$Connection_76,_$client_78.Doc=_$Doc_77,_$client_78.Error=_$ShareDBError_84,_$client_78.Query=_$Query_79,_$client_78.types=_$types_88,_$client_78.logger=_$logger_85;var _$RemoteDoc_56=RemoteDoc;function RemoteDoc(t,e,n,r,i){i&&(i.docs[n]=this),_$Doc_52.call(this,t,e,n),this.model=t.pass({$remote:!0}),this.debugMutations=t.root.debug.remoteMutations,this.shareDoc=t.root.connection.get(e,n),this.shareDoc.ingestSnapshot(r),this._initShareDoc()}function createInsertOp(t,e,n){if(!Array.isArray(n))return[new ListInsertOp(t,e,n)];for(var r=[],i=0,o=n.length;i<o;i++)r.push(new ListInsertOp(t,e++,n[i]));return r}function ImpliedOp(t,e){this.op=t,this.value=e}function ObjectReplaceOp(t,e,n){this.p=_$util_73.castSegments(t),this.od=e,this.oi=void 0===n?null:n}function ObjectInsertOp(t,e){this.p=_$util_73.castSegments(t),this.oi=void 0===e?null:e}function ObjectDeleteOp(t,e){this.p=_$util_73.castSegments(t),this.od=void 0===e?null:e}function ListReplaceOp(t,e,n,r){this.p=_$util_73.castSegments(t.concat(e)),this.ld=n,this.li=void 0===r?null:r}function ListInsertOp(t,e,n){this.p=_$util_73.castSegments(t.concat(e)),this.li=void 0===n?null:n}function ListRemoveOp(t,e,n){this.p=_$util_73.castSegments(t.concat(e)),this.ld=void 0===n?null:n}function ListMoveOp(t,e,n){this.p=_$util_73.castSegments(t.concat(e)),this.lm=n}function StringInsertOp(t,e,n){this.p=_$util_73.castSegments(t.concat(e)),this.si=n}function StringRemoveOp(t,e,n){this.p=_$util_73.castSegments(t.concat(e)),this.sd=n}function IncrementOp(t,e){this.p=_$util_73.castSegments(t),this.na=e}function SubtypeOp(t,e,n){this.p=_$util_73.castSegments(t),this.t=e,this.o=n}function defined(t){return void 0!==t}RemoteDoc.prototype=new _$Doc_52,RemoteDoc.prototype._initShareDoc=function(){var t=this,e=this.model,n=this.collectionName,r=this.id,i=this.shareDoc;e.root.debug.disableSubmit&&(i.submitOp=function(){},i.create=function(){},i.del=function(){}),i.on("op",function(e,n){n||(t._updateCollectionData(),t._onOp(e))}),i.on("del",function(i,o){o||(delete t.collectionData[r],e.emit("change",[n,r],[void 0,i,e._pass]))}),i.on("create",function(o){if(!o){t._updateCollectionData();var s=i.data;e.emit("change",[n,r],[s,void 0,e._pass])}}),i.on("error",function(t){e._emitError(t,n+"."+r)}),i.on("load",function(){t._updateCollectionData();var o=i.data;void 0!==o&&e.emit("load",[n,r],[o,e._pass])}),this._updateCollectionData()},RemoteDoc.prototype._updateCollectionData=function(){var t=this.shareDoc.data;"object"!=typeof t||Array.isArray(t)||null===t||(t.id=this.id),this.collectionData[this.id]=t},RemoteDoc.prototype.create=function(t,e){this.debugMutations&&console.log("RemoteDoc create",this.path(),t);var n=_$util_73.deepCopy(t);n&&delete n.id,this.shareDoc.create(n,e),this.shareDoc.data=t,this._updateCollectionData(),this.model._context.createDoc(this.collectionName,this.id)},RemoteDoc.prototype.set=function(t,e,n){this.debugMutations&&console.log("RemoteDoc set",this.path(t),e);var r=this._createImplied(t),i=t[t.length-1];if(r instanceof ImpliedOp)return r.value[i]=e,this.shareDoc.submitOp(r.op,n),void this._updateCollectionData();var o=_$util_73.isArrayIndex(i)?[new ListReplaceOp(t.slice(0,-1),i,r,e)]:[new ObjectReplaceOp(t,r,e)];return this.shareDoc.submitOp(o,n),this._updateCollectionData(),r},RemoteDoc.prototype.del=function(t,e){if(this.debugMutations&&console.log("RemoteDoc del",this.path(t)),0===t.length){var n=this.get();return this.shareDoc.del(e),delete this.collectionData[this.id],n}if(void 0!==(n=this.get(t))){var r=[new ObjectDeleteOp(t,n)];return this.shareDoc.submitOp(r,e),this._updateCollectionData(),n}e()},RemoteDoc.prototype.increment=function(t,e,n){this.debugMutations&&console.log("RemoteDoc increment",this.path(t),e);var r=this._createImplied(t);if(r instanceof ImpliedOp){var i=t[t.length-1];return r.value[i]=e,this.shareDoc.submitOp(r.op,n),this._updateCollectionData(),e}if(null==r){i=t[t.length-1];var o=_$util_73.isArrayIndex(i)?[new ListInsertOp(t.slice(0,-1),i,e)]:[new ObjectInsertOp(t,e)];return this.shareDoc.submitOp(o,n),this._updateCollectionData(),e}o=[new IncrementOp(t,e)];return this.shareDoc.submitOp(o,n),this._updateCollectionData(),r+e},RemoteDoc.prototype.push=function(t,e,n){this.debugMutations&&console.log("RemoteDoc push",this.path(t),e);var r=this.shareDoc;return this._arrayApply(t,function(n,i){var o=[new ListInsertOp(t,n.length,e)];return r.submitOp(o,i),n.length},n)},RemoteDoc.prototype.unshift=function(t,e,n){this.debugMutations&&console.log("RemoteDoc unshift",this.path(t),e);var r=this.shareDoc;return this._arrayApply(t,function(n,i){var o=[new ListInsertOp(t,0,e)];return r.submitOp(o,i),n.length},n)},RemoteDoc.prototype.insert=function(t,e,n,r){this.debugMutations&&console.log("RemoteDoc insert",this.path(t),e,n);var i=this.shareDoc;return this._arrayApply(t,function(r,o){var s=createInsertOp(t,e,n);return i.submitOp(s,o),r.length},r)},RemoteDoc.prototype.pop=function(t,e){this.debugMutations&&console.log("RemoteDoc pop",this.path(t));var n=this.shareDoc;return this._arrayApply(t,function(e,r){var i=e.length-1,o=e[i],s=[new ListRemoveOp(t,i,o)];return n.submitOp(s,r),o},e)},RemoteDoc.prototype.shift=function(t,e){this.debugMutations&&console.log("RemoteDoc shift",this.path(t));var n=this.shareDoc;return this._arrayApply(t,function(e,r){var i=e[0],o=[new ListRemoveOp(t,0,i)];return n.submitOp(o,r),i},e)},RemoteDoc.prototype.remove=function(t,e,n,r){this.debugMutations&&console.log("RemoteDoc remove",this.path(t),e,n);var i=this.shareDoc;return this._arrayApply(t,function(r,o){for(var s=r.slice(e,e+n),a=[],u=0,c=s.length;u<c;u++)a.push(new ListRemoveOp(t,e,s[u]));return i.submitOp(a,o),s},r)},RemoteDoc.prototype.move=function(t,e,n,r,i){this.debugMutations&&console.log("RemoteDoc move",this.path(t),e,n,r);var o=this.shareDoc;return this._arrayApply(t,function(i,s){for(var a=i.slice(e,e+r),u=[],c=0;c<r;c++)u.push(new ListMoveOp(t,e<n?e:e+r-1,e<n?n+r-1:n));return o.submitOp(u,s),a},i)},RemoteDoc.prototype.stringInsert=function(t,e,n,r){this.debugMutations&&console.log("RemoteDoc stringInsert",this.path(t),e,n);var i=this._createImplied(t);if(i instanceof ImpliedOp){var o=t[t.length-1];return i.value[o]=n,this.shareDoc.submitOp(i.op,r),void this._updateCollectionData()}if(null==i){o=t[t.length-1];var s=_$util_73.isArrayIndex(o)?[new ListInsertOp(t.slice(0,-1),o,n)]:[new ObjectInsertOp(t,n)];return this.shareDoc.submitOp(s,r),this._updateCollectionData(),i}s=[new StringInsertOp(t,e,n)];return this.shareDoc.submitOp(s,r),this._updateCollectionData(),i},RemoteDoc.prototype.stringRemove=function(t,e,n,r){this.debugMutations&&console.log("RemoteDoc stringRemove",this.path(t),e,n);var i=this._createImplied(t);if(!(i instanceof ImpliedOp)){if(null==i)return i;var o=[new StringRemoveOp(t,e,i.slice(e,e+n))];return this.shareDoc.submitOp(o,r),this._updateCollectionData(),i}},RemoteDoc.prototype.subtypeSubmit=function(t,e,n,r){this.debugMutations&&console.log("RemoteDoc subtypeSubmit",this.path(t),e,n);var i=this._createImplied(t);i instanceof ImpliedOp&&(this.shareDoc.submitOp(i.op),i=void 0);var o=new SubtypeOp(t,e,n);return this.shareDoc.submitOp(o,r),this._updateCollectionData(),i},RemoteDoc.prototype.get=function(t){return _$util_73.lookup(t,this.shareDoc.data)},RemoteDoc.prototype._createImplied=function(t){if(!this.shareDoc.type)throw new Error("Mutation on uncreated remote document");for(var e,n,r=this.shareDoc,i="data",o=r[i],s=0,a=t[s++];null!=a;)o||(e?n=n[i]=_$util_73.isArrayIndex(a)?[]:{}:(n=_$util_73.isArrayIndex(a)?[]:{},e=Array.isArray(r)?i>=r.length?new ListInsertOp(t.slice(0,s-2),i,n):new ListReplaceOp(t.slice(0,s-2),i,o,n):new ObjectInsertOp(t.slice(0,s-1),n)),o=n),o=(r=o)[i=a],a=t[s++];return e?new ImpliedOp(e,n):o},RemoteDoc.prototype._arrayApply=function(t,e,n){var r=this._createImplied(t);if(r instanceof ImpliedOp&&(this.shareDoc.submitOp(r.op),r=this.get(t)),null==r){var i=t[t.length-1],o=_$util_73.isArrayIndex(i)?[new ListInsertOp(t.slice(0,-1),i,[])]:[new ObjectInsertOp(t,[])];this.shareDoc.submitOp(o),r=this.get(t)}if(!Array.isArray(r)){var s=this._errorMessage(e.name+" on non-array",t,r);return n(new TypeError(s))}var a=e(r,n);return this._updateCollectionData(),a},RemoteDoc.prototype._onOp=function(t){var e;if(1!==t.length){if(0===t.length)return;try{t=JSON.stringify(t)}catch(t){}throw new Error("Received op with multiple components from ShareDB "+t)}e=t[0];var n=[this.collectionName,this.id].concat(e.p),r=this.model;if(defined(e.oi)||defined(e.od)){var i=e.oi,o=e.od;r.emit("change",n,[i,o,r._pass])}else if(defined(e.li)&&defined(e.ld)){i=e.li,o=e.ld;r.emit("change",n,[i,o,r._pass])}else if(defined(e.li)){var s=n[n.length-1],a=[e.li];r.emit("insert",n.slice(0,-1),[s,a,r._pass])}else if(defined(e.ld)){s=n[n.length-1];var u=[e.ld];r.emit("remove",n.slice(0,-1),[s,u,r._pass])}else if(defined(e.lm)){var c=n[n.length-1],l=e.lm,h=1;r.emit("move",n.slice(0,-1),[c,l,h,r._pass])}else if(defined(e.si)){s=n[n.length-1];var p=e.si;n=n.slice(0,-1);o=(i=r._get(n)).slice(0,s)+i.slice(s+p.length);var f=r.pass({$stringInsert:{index:s,text:p}})._pass;r.emit("change",n,[i,o,f])}else if(defined(e.sd)){s=n[n.length-1],h=(p=e.sd).length;n=n.slice(0,-1);o=(i=r._get(n)).slice(0,s)+p+i.slice(s),f=r.pass({$stringRemove:{index:s,howMany:h}})._pass;r.emit("change",n,[i,o,f])}else if(defined(e.na)){o=(i=this.get(e.p))-e.na;r.emit("change",n,[i,o,r._pass])}else if(defined(e.t)){i=this.get(e.p),o=void 0;var d=e.t;t=e.o,f=r.pass({$subtype:{type:d,op:t}})._pass;r.emit("change",n,[i,o,f])}};var _$connection_58={},Connection=_$client_78.Connection;_$Model_54.INITS.push(function(t){t.root._preventCompose=!1}),_$Model_54.prototype.preventCompose=function(){var t=this._child();return t._preventCompose=!0,t},_$Model_54.prototype.allowCompose=function(){var t=this._child();return t._preventCompose=!1,t},_$Model_54.prototype.createConnection=function(t){this.root.socket=this._createSocket(t);var e=this;this.root.connection=new Connection(this.root.socket),this.root.connection.on("state",function(t,n){e._setDiff(["$connection","state"],t),e._setDiff(["$connection","reason"],n)}),this._set(["$connection","state"],"connected"),this._finishCreateConnection()},_$Model_54.prototype._finishCreateConnection=function(){var t=this;this.root.connection.on("error",function(e){t._emitError(e)}),this.root.connection.on("doc",function(e){t.getOrCreateDoc(e.collection,e.id)})},_$Model_54.prototype.connect=function(){this.root.socket.open()},_$Model_54.prototype.disconnect=function(){this.root.socket.close()},_$Model_54.prototype.reconnect=function(){this.disconnect(),this.connect()},_$Model_54.prototype.close=function(t){t=this.wrapCallback(t);var e=this;this.whenNothingPending(function(){e.root.socket.close(),t()})},_$Model_54.prototype.getAgent=function(){return this.root.connection.agent},_$Model_54.prototype._isLocal=function(t){var e=t.charAt(0);return"_"===e||"$"===e},_$Model_54.prototype._getDocConstructor=function(t){return this._isLocal(t)?_$LocalDoc_53:_$RemoteDoc_56},_$Model_54.prototype.hasPending=function(){return this.root.connection.hasPending()},_$Model_54.prototype.hasWritePending=function(){return this.root.connection.hasWritePending()},_$Model_54.prototype.whenNothingPending=function(t){return this.root.connection.whenNothingPending(t)};var _$Query_55={};(function(t){var e=_$client_78.types.defaultType;function n(){this.map={},this.collections={}}function r(t,e,n,r){this.model=t.pass({$query:this}),this.collectionName=e,this.expression=n,this.options=r,this.hash=i(e,n,r),this.segments=["$queries",this.hash],this.idsSegments=["$queries",this.hash,"ids"],this.extraSegments=["$queries",this.hash,"extra"],this._pendingSubscribeCallbacks=[],this.subscribeCount=0,this.fetchCount=0,this.created=!1,this.shareQuery=null,this.idMap={}}function i(t,e,n){var r=[t,e,n];return JSON.stringify(r).replace(/\./g,"|")}function o(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];e.push(r.id)}return e}_$Query_55=r,_$Model_54.INITS.push(function(t){t.root._queries=new n}),_$Model_54.prototype.query=function(t,e,n){return"string"==typeof n&&(n={db:n}),this._getOrCreateQuery(t,e,n,r)},_$Model_54.prototype._getOrCreateQuery=function(t,e,n,r){e=this.sanitizeQuery(e);var i=this.root._queries.get(t,e,n);return i||(i=new r(this,t,e,n),this.root._queries.add(i),i)},_$Model_54.prototype.sanitizeQuery=function(t){if(t&&"object"==typeof t)for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];void 0===n?t[e]=null:this.sanitizeQuery(n)}return t},_$Model_54.prototype._initQueries=function(t){for(var e=this.root._queries,n=0;n<t.length;n++){var i=t[n],o=i[0],s=i[1],a=i[2],u=i[3]||[],c=i[4],l=i[5],h=this.root._queries.get(s,a,c);h||(h=new r(this,s,a,c),e.add(h)),h._setExtra(l);for(var p=[],f=0;f<u.length;f++){var d=u[f];if("string"!=typeof d){var m=d[0],v=d[1],g=d[2]||m.id,y=d[3];p.push(g);var _={data:m,v:v,type:y};this.getOrCreateDoc(s,g,_)}else p.push(d)}h._addMapIds(p),this._set(h.idsSegments,p);for(var b=0;b<o.length;b++){var x=o[b],E=x[0]||0,w=x[1]||0,S=x[2];for(S&&h.model.setContext(S);E--;)h.subscribe();for(h.fetchCount+=w;w--;)h.model._context.fetchQuery(h)}}},n.prototype.add=function(t){this.map[t.hash]=t,(this.collections[t.collectionName]||(this.collections[t.collectionName]={}))[t.hash]=t},n.prototype.remove=function(t){delete this.map[t.hash];var e=this.collections[t.collectionName];if(e){for(var n in delete e[t.hash],e)return;delete this.collections[t.collectionName]}},n.prototype.get=function(t,e,n){var r=i(t,e,n);return this.map[r]},n.prototype.toJSON=function(){var t=[];for(var e in this.map){var n=this.map[e];(n.subscribeCount||n.fetchCount)&&t.push(n.serialize())}return t},r.prototype.create=function(){this.created=!0,this.model.root._queries.add(this)},r.prototype.destroy=function(){var t=this.getIds();this.created=!1,this.shareQuery&&(this.shareQuery.destroy(),this.shareQuery=null),this.model.root._queries.remove(this),this.idMap={},this.model._del(this.segments),this._maybeUnloadDocs(t)},r.prototype.fetch=function(t){t=this.model.wrapCallback(t),this.model._context.fetchQuery(this),this.fetchCount++,this.created||this.create();var e=this;return this.model.root.connection.createFetchQuery(this.collectionName,this.expression,this.options,function(n,r,i){if(n)return t(n);e._setExtra(i),e._setResults(r),t()}),this},r.prototype.subscribe=function(e){if(e=this.model.wrapCallback(e),this.model._context.subscribeQuery(this),this.subscribeCount++){var n=this;return t.nextTick(function(){n.model._get(n.segments)?e():n._pendingSubscribeCallbacks.push(e)}),this}this.created||this.create();var r=this.options?_$util_73.copy(this.options):{};return r.results=this._getShareResults(),this.model.root.fetchOnly?this._shareFetchedSubscribe(r,e):this._shareSubscribe(r,e),this},r.prototype._subscribeCb=function(t){var e=this;return function(n,r,i){if(n)return e._flushSubscribeCallbacks(n,t);e._setExtra(i),e._setResults(r),e._flushSubscribeCallbacks(null,t)}},r.prototype._shareFetchedSubscribe=function(t,e){this.model.root.connection.createFetchQuery(this.collectionName,this.expression,t,this._subscribeCb(e))},r.prototype._shareSubscribe=function(t,e){var n=this;this.shareQuery&&this.shareQuery.destroy(),this.shareQuery=this.model.root.connection.createSubscribeQuery(this.collectionName,this.expression,t,this._subscribeCb(e)),this.shareQuery.on("insert",function(t,e){var r=o(t);n._addMapIds(r),n.model._insert(n.idsSegments,e,r)}),this.shareQuery.on("remove",function(t,e){var r=o(t);n._removeMapIds(r),n.model._remove(n.idsSegments,e,t.length)}),this.shareQuery.on("move",function(t,e,r){n.model._move(n.idsSegments,e,r,t.length)}),this.shareQuery.on("extra",function(t){n.model._setDiffDeep(n.extraSegments,t)}),this.shareQuery.on("error",function(t){n.model._emitError(t,n.hash)})},r.prototype._removeMapIds=function(t){for(var e=t.length;e--;){var n=t[e];this.idMap[n]>1?this.idMap[n]--:delete this.idMap[n]}if(this.model.root.unloadDelay){var r=this;setTimeout(function(){r._maybeUnloadDocs(t)},this.model.root.unloadDelay)}else this._maybeUnloadDocs(t)},r.prototype._addMapIds=function(t){for(var e=t.length;e--;){var n=t[e];this.idMap[n]=(this.idMap[n]||0)+1}},r.prototype._diffMapIds=function(t){for(var e=[],n=[],r={},i=t.length;i--;){r[o=t[i]]=!0,this.idMap[o]||e.push(o)}for(var o in this.idMap)r[o]||n.push(o);e.length&&this._addMapIds(e),n.length&&this._removeMapIds(n)},r.prototype._setExtra=function(t){void 0!==t&&this.model._setDiffDeep(this.extraSegments,t)},r.prototype._setResults=function(t){var e=o(t);this._setResultIds(e)},r.prototype._setResultIds=function(t){this._diffMapIds(t),this.model._setArrayDiff(this.idsSegments,t)},r.prototype._maybeUnloadDocs=function(t){for(var e=0;e<t.length;e++){var n=t[e];this.model._maybeUnloadDoc(this.collectionName,n)}},r.prototype._flushSubscribeCallbacks=function(t,e){var n;for(e(t);n=this._pendingSubscribeCallbacks.shift();)n(t)},r.prototype.unfetch=function(t){if(t=this.model.wrapCallback(t),this.model._context.unfetchQuery(this),!this.fetchCount)return t(),this;var e=this;function n(){var n=--e.fetchCount;if(n)return t(null,n);e.subscribeCount||e.destroy(),t(null,0)}return this.model.root.unloadDelay?setTimeout(n,this.model.root.unloadDelay):n(),this},r.prototype.unsubscribe=function(t){if(t=this.model.wrapCallback(t),this.model._context.unsubscribeQuery(this),!this.subscribeCount)return t(),this;var e=this;function n(){var n=--e.subscribeCount;if(n)return t(null,n);e.shareQuery&&(e.shareQuery.destroy(),e.shareQuery=null),function(n){if(n)return t(n);e.fetchCount||e.destroy();t(null,0)}()}return this.model.root.unloadDelay?setTimeout(n,this.model.root.unloadDelay):n(),this},r.prototype._getShareResults=function(){var t=this.model._get(this.idsSegments);if(t){var e=this.model.getCollection(this.collectionName);if(e){for(var n=[],r=0;r<t.length;r++){var i=t[r],o=e.docs[i];n.push(o&&o.shareDoc)}return n}}},r.prototype.get=function(){var t=[],e=this.model._get(this.segments);if(!e)return console.warn("You must fetch or subscribe to a query before getting its results."),t;var n=e.ids;if(!n)return t;for(var r=this.model.getCollection(this.collectionName),i=0,o=n.length;i<o;i++){var s=n[i],a=r&&r.docs[s];t.push(a&&a.get())}return t},r.prototype.getIds=function(){return this.model._get(this.idsSegments)||[]},r.prototype.getExtra=function(){return this.model._get(this.extraSegments)},r.prototype.ref=function(t){var e=this.idsSegments.join(".");return this.model.refList(t,this.collectionName,e)},r.prototype.refIds=function(t){var e=this.idsSegments.join(".");return this.model.root.ref(t,e)},r.prototype.refExtra=function(t,e){var n=this.extraSegments.join(".");return e&&(n+="."+e),this.model.root.ref(t,n)},r.prototype.serialize=function(){var t,n=this.getIds(),r=this.model.getCollection(this.collectionName);if(r){t=[];for(var i=0;i<n.length;i++){var o=n[i],s=r.docs[o];if(s){delete r.docs[o];var a=s.shareDoc.data,u=[a,s.shareDoc.version];a&&a.id===o||(u[2]=o),s.shareDoc.type!==e&&(u[3]=s.shareDoc.type&&s.shareDoc.type.name),t.push(u)}else t.push(o)}}var c=[],l=this.model.root._contexts;for(var h in l){var p=l[h],f=p.subscribedQueries[this.hash]||0,d=p.fetchedQueries[this.hash]||0;(f||d)&&("root"!==h?c.push([f,d,h]):d?c.push([f,d]):c.push([f]))}for(var m=[c,this.collectionName,this.expression,t,this.options,this.getExtra()];null==m[m.length-1];)m.pop();return m}}).call(this,_$browser_39);var _$CollectionCounter_51=CollectionCounter;function CollectionCounter(){this.reset()}CollectionCounter.prototype.reset=function(){this.collections={}},CollectionCounter.prototype.get=function(t,e){var n=this.collections[t];return n&&n[e]},CollectionCounter.prototype.increment=function(t,e){var n=this.collections[t]||(this.collections[t]={}),r=(n[e]||0)+1;return n[e]=r,r},CollectionCounter.prototype.decrement=function(t,e){var n=this.collections[t],r=n&&n[e];if(null!=r){if(r>1)return r--,n[e]=r,r;for(var i in delete n[e],n)return 0;return delete this.collections[t],0}},CollectionCounter.prototype.toJSON=function(){for(var t in this.collections)return this.collections};var _$subscriptions_70={};(function(t){_$Model_54.INITS.push(function(t,e){t.root.fetchOnly=e.fetchOnly,t.root.unloadDelay=e.unloadDelay||_$util_73.isServer?0:1e3,t.root._fetchedDocs=new _$CollectionCounter_51,t.root._subscribedDocs=new _$CollectionCounter_51}),_$Model_54.prototype.fetch=function(){return this._forSubscribable(arguments,"fetch"),this},_$Model_54.prototype.unfetch=function(){return this._forSubscribable(arguments,"unfetch"),this},_$Model_54.prototype.subscribe=function(){return this._forSubscribable(arguments,"subscribe"),this},_$Model_54.prototype.unsubscribe=function(){return this._forSubscribable(arguments,"unsubscribe"),this},_$Model_54.prototype._forSubscribable=function(e,n){var r,i;if(e.length)if("function"==typeof e[0])r=[null],i=e[0];else if(Array.isArray(e[0]))r=e[0],i=e[1];else{"function"==typeof(r=Array.prototype.slice.call(e))[r.length-1]&&(i=r.pop())}else r=[null];var o=_$util_73.asyncGroup(this.wrapCallback(i)),s=o(),a=n+"Doc";this.root.connection.startBulk();for(var u=0;u<r.length;u++){var c=r[u];if(c instanceof _$Query_55)c[n](o());else{var l=this._dereference(this._splitPath(c));if(2===l.length)this[a](l[0],l[1],o());else{var h="Cannot "+n+" to path: "+l.join(".");o()(new Error(h))}}}this.root.connection.endBulk(),t.nextTick(s)},_$Model_54.prototype.fetchDoc=function(t,e,n){n=this.wrapCallback(n),this._context.fetchDoc(t,e),this.root._fetchedDocs.increment(t,e),this.getOrCreateDoc(t,e).shareDoc.fetch(n)},_$Model_54.prototype.subscribeDoc=function(t,e,n){n=this.wrapCallback(n),this._context.subscribeDoc(t,e),this.root._subscribedDocs.increment(t,e);var r=this.getOrCreateDoc(t,e);if(r.shareDoc.subscribed)return n();this.root.fetchOnly?r.shareDoc.fetch(n):r.shareDoc.subscribe(n)},_$Model_54.prototype.unfetchDoc=function(t,e,n){if(n=this.wrapCallback(n),this._context.unfetchDoc(t,e),!this.root._fetchedDocs.get(t,e))return n();var r=this;function i(){var i=r.root._fetchedDocs.decrement(t,e);if(i)return n(null,i);r._maybeUnloadDoc(t,e),n(null,0)}this.root.unloadDelay?setTimeout(i,this.root.unloadDelay):i()},_$Model_54.prototype.unsubscribeDoc=function(t,e,n){if(n=this.wrapCallback(n),this._context.unsubscribeDoc(t,e),!this.root._subscribedDocs.get(t,e))return n();var r=this;function i(){var i=r.root._subscribedDocs.decrement(t,e);if(i)return n(null,i);if(r.root.fetchOnly)o();else{var s=r.getDoc(t,e),a=s&&s.shareDoc;if(!a)return o();a.unsubscribe(o)}}function o(i){if(r._maybeUnloadDoc(t,e),i)return n(i);n(null,0)}this.root.unloadDelay?setTimeout(i,this.root.unloadDelay):i()},_$Model_54.prototype._maybeUnloadDoc=function(t,e){var n=this.getDoc(t,e);if(n&&!(this._hasDocReferences(t,e)||n.shareDoc&&n.shareDoc.hasPending())){var r=n.get();this.root.collections[t].remove(e),n.shareDoc&&n.shareDoc.destroy(),this.emit("unload",[t,e],[r,this._pass])}},_$Model_54.prototype._hasDocReferences=function(t,e){var n=this.root._queries.collections[t];if(n)for(var r in n){var i=n[r];if((i.subscribeCount||i.fetchCount)&&i.idMap[e]>0)return!0}return!(!this.root._fetchedDocs.get(t,e)&&!this.root._subscribedDocs.get(t,e))}}).call(this,_$browser_39);var _$contexts_59={};function Contexts(){}function FetchedQueries(){}function SubscribedQueries(){}function Context(t,e){this.model=t,this.id=e,this.fetchedDocs=new _$CollectionCounter_51,this.subscribedDocs=new _$CollectionCounter_51,this.createdDocs=new _$CollectionCounter_51,this.fetchedQueries=new FetchedQueries,this.subscribedQueries=new SubscribedQueries}function mapIncrement(t,e){t[e]=(t[e]||0)+1}function mapDecrement(t,e){t[e]&&t[e]--,t[e]||delete t[e]}_$Model_54.INITS.push(function(t){t.root._contexts=new Contexts,t.root.setContext("root")}),_$Model_54.prototype.context=function(t){var e=this._child();return e.setContext(t),e},_$Model_54.prototype.setContext=function(t){this._context=this.getOrCreateContext(t)},_$Model_54.prototype.getOrCreateContext=function(t){return this.root._contexts[t]||(this.root._contexts[t]=new Context(this,t))},_$Model_54.prototype.unload=function(t){var e=t?this.root._contexts[t]:this._context;e&&e.unload()},_$Model_54.prototype.unloadAll=function(){var t=this.root._contexts;for(var e in t)t[e].unload()},Context.prototype.toJSON=function(){var t=this.fetchedDocs.toJSON(),e=this.subscribedDocs.toJSON(),n=this.createdDocs.toJSON();if(t||e||n)return{fetchedDocs:t,subscribedDocs:e,createdDocs:n}},Context.prototype.fetchDoc=function(t,e){this.fetchedDocs.increment(t,e)},Context.prototype.subscribeDoc=function(t,e){this.subscribedDocs.increment(t,e)},Context.prototype.unfetchDoc=function(t,e){this.fetchedDocs.decrement(t,e)},Context.prototype.unsubscribeDoc=function(t,e){this.subscribedDocs.decrement(t,e)},Context.prototype.createDoc=function(t,e){this.createdDocs.increment(t,e)},Context.prototype.fetchQuery=function(t){mapIncrement(this.fetchedQueries,t.hash)},Context.prototype.subscribeQuery=function(t){mapIncrement(this.subscribedQueries,t.hash)},Context.prototype.unfetchQuery=function(t){mapDecrement(this.fetchedQueries,t.hash)},Context.prototype.unsubscribeQuery=function(t){mapDecrement(this.subscribedQueries,t.hash)},Context.prototype.unload=function(){var t=this.model;for(var e in this.fetchedQueries){if(r=t.root._queries.map[e])for(var n=this.fetchedQueries[e];n--;)r.unfetch()}for(var e in this.subscribedQueries){var r;if(r=t.root._queries.map[e])for(n=this.subscribedQueries[e];n--;)r.unsubscribe()}for(var i in this.fetchedDocs.collections){var o=this.fetchedDocs.collections[i];for(var s in o)for(n=o[s];n--;)t.unfetchDoc(i,s)}for(var i in this.subscribedDocs.collections){o=this.subscribedDocs.collections[i];for(var s in o)for(n=o[s];n--;)t.unsubscribeDoc(i,s)}for(var i in this.createdDocs.collections){o=this.createdDocs.collections[i];for(var s in o)t._maybeUnloadDoc(i,s)}this.createdDocs.reset()};var _$defaultFns_60={},defaultFns=_$defaultFns_60=new DefaultFns;function DefaultFns(){}function FnPair(t,e){this.get=t,this.set=e}function getReverse(t){return t&&t.slice().reverse()}function setReverse(t){return{0:getReverse(t)}}function asc(t,e){return t<e?-1:t>e?1:0}function desc(t,e){return t>e?-1:t<e?1:0}defaultFns.reverse=new FnPair(getReverse,setReverse),defaultFns.asc=asc,defaultFns.desc=desc;var _$fn_63={};(function(t){function e(){}function n(t,e,n){var r,i,o,s,a,u=e.pop();"string"==typeof u?i=u:r=u,n&&(o=t.path(e.shift())),u=e[e.length-1],Array.isArray(u)||t.isPath(u)||(s=e.pop());for(var c=(a=1===e.length&&Array.isArray(e[0])?e[0]:e).length;c--;)a[c]=t.path(a[c]);return{name:i,path:o,inputPaths:a,fns:r,options:s}}function r(){}function i(t){this.model=t,this.nameMap=t.root._namedFns,this.fromMap=new r}function o(t,e,n,r,i,o){if(this.model=t.pass({$fn:this}),this.name=e,this.from=n,this.inputPaths=r,this.options=o,!i)throw new TypeError("Model function not found: "+e);this.getFn=i.get||i,this.setFn=i.set,this.fromSegments=n&&n.split("."),this.inputsSegments=[];for(var s=0;s<this.inputPaths.length;s++){var a=this.inputPaths[s].split(".");this.inputsSegments.push(a)}var u=o&&o.copy||"output";this.copyInput="input"===u||"both"===u,this.copyOutput="output"===u||"both"===u,this.mode=o&&o.mode||"diffDeep",this.async=!(!o||!o.async),this.eventPending=!1}_$Model_54.INITS.push(function(t){t.root._namedFns=new e,t.root._fns=new i(t),t.on("all",function(e,n){var r=n[n.length-1],i=t.root._fns.fromMap;for(var o in i){var s=i[o];r.$fn!==s&&(_$util_73.mayImpactAny(s.inputsSegments,e)?s.onInput(r):_$util_73.mayImpact(s.fromSegments,e)&&s.onOutput(r))}})}),_$Model_54.prototype.fn=function(t,e){this.root._namedFns[t]=e},_$Model_54.prototype.evaluate=function(){var t=n(this,Array.prototype.slice.call(arguments),!1);return this.root._fns.get(t.name,t.inputPaths,t.fns,t.options)},_$Model_54.prototype.start=function(){var t=n(this,Array.prototype.slice.call(arguments),!0);return this.root._fns.start(t.name,t.path,t.inputPaths,t.fns,t.options)},_$Model_54.prototype.stop=function(t){var e=this.path(t);this._stop(e)},_$Model_54.prototype._stop=function(t){this.root._fns.stop(t)},_$Model_54.prototype.stopAll=function(t){var e=this._splitPath(t);this._stopAll(e)},_$Model_54.prototype._stopAll=function(t){var e=this.root._fns.fromMap;for(var n in e){var r=e[n].fromSegments;_$util_73.contains(t,r)&&this._stop(n)}},i.prototype.get=function(t,e,n,r){return n||(n=this.nameMap[t]||_$defaultFns_60[t]),new o(this.model,t,null,e,n,r).get()},i.prototype.start=function(t,e,n,r,i){r||(r=this.nameMap[t]||_$defaultFns_60[t]);var s=new o(this.model,t,e,n,r,i);return this.fromMap[e]=s,s._onInput()},i.prototype.stop=function(t){var e=this.fromMap[t];return delete this.fromMap[t],e},i.prototype.toJSON=function(){var t=[];for(var e in this.fromMap){var n=this.fromMap[e];if(n.name){var r=[n.from].concat(n.inputPaths);n.options&&r.push(n.options),r.push(n.name),t.push(r)}}return t},o.prototype.apply=function(t,e){for(var n=0,r=this.inputsSegments.length;n<r;n++){var i=this.model._get(this.inputsSegments[n]);e.push(this.copyInput?_$util_73.deepCopy(i):i)}return t.apply(this.model,e)},o.prototype.get=function(){return this.apply(this.getFn,[])},o.prototype.set=function(t,e){if(this.setFn){var n=this.apply(this.setFn,[t]);if(n){var r=this.inputsSegments,i=this.model.pass(e,!0);for(var o in n){t=this.copyOutput?_$util_73.deepCopy(n[o]):n[o];this._setValue(i,r[o],t)}}}},o.prototype.onInput=function(e){if(!this.async)return this._onInput(e);if(!this.eventPending){this.eventPending=!0;var n=this;t.nextTick(function(){n._onInput(e),n.eventPending=!1})}},o.prototype._onInput=function(t){var e=this.copyOutput?_$util_73.deepCopy(this.get()):this.get();return this._setValue(this.model.pass(t,!0),this.fromSegments,e),e},o.prototype.onOutput=function(t){var e=this.model._get(this.fromSegments);return this.set(e,t)},o.prototype._setValue=function(t,e,n){"diffDeep"===this.mode?t._setDiffDeep(e,n):"arrayDeep"===this.mode?t._setArrayDiffDeep(e,n):"array"===this.mode?t._setArrayDiff(e,n):t._setDiff(e,n)}}).call(this,_$browser_39);var _$filter_62={};function parseFilterArguments(t,e){var n,r=e.pop();t.isPath(e[e.length-1])||(n=e.pop());for(var i=t.path(e.shift()),o=e.length;o--;)e[o]=t.path(e[o]);return{path:i,inputPaths:e.length?e:null,options:n,fn:r}}function FromMap(){}function Filters(t){this.model=t,this.fromMap=new FromMap}function Filter(t,e,n,r,i,o){if(this.filters=t,this.model=t.model.pass({$filter:this}),this.path=e,this.segments=e.split("."),this.filterName=null,this.sortName=null,this.bundle=!0,this.filterFn=null,this.sortFn=null,this.inputPaths=i,this.inputsSegments=null,i){this.inputsSegments=[];for(var s=0;s<this.inputPaths.length;s++){var a=this.inputPaths[s].split(".");this.inputsSegments.push(a)}}this.options=o,this.skip=o&&o.skip,this.limit=o&&o.limit,n&&this.filter(n),r&&this.sort(r),this.idsSegments=null,this.from=null,this.fromSegments=null}_$Model_54.INITS.push(function(t){t.root._filters=new Filters(t),t.on("all",function(e,n){var r=n[n.length-1],i=t.root._filters.fromMap;for(var o in i){var s=i[o];r.$filter!==s&&((_$util_73.mayImpact(s.segments,e)||s.inputsSegments&&_$util_73.mayImpactAny(s.inputsSegments,e))&&s.update(r))}})}),_$Model_54.prototype.filter=function(){var t=parseFilterArguments(this,Array.prototype.slice.call(arguments));return this.root._filters.add(t.path,t.fn,null,t.inputPaths,t.options)},_$Model_54.prototype.sort=function(){var t=parseFilterArguments(this,Array.prototype.slice.call(arguments));return this.root._filters.add(t.path,null,t.fn||"asc",t.inputPaths,t.options)},_$Model_54.prototype.removeAllFilters=function(t){var e=this._splitPath(t);this._removeAllFilters(e)},_$Model_54.prototype._removeAllFilters=function(t){var e=this.root._filters.fromMap;for(var n in e)_$util_73.contains(t,e[n].fromSegments)&&e[n].destroy()},Filters.prototype.add=function(t,e,n,r,i){return new Filter(this,t,e,n,r,i)},Filters.prototype.toJSON=function(){var t=[];for(var e in this.fromMap){var n=this.fromMap[e];if(n.bundle){var r=[e,n.path,n.filterName,n.sortName,n.inputPaths];n.options&&r.push(n.options),t.push(r)}}return t},Filter.prototype.filter=function(t){if("function"==typeof t)return this.filterFn=t,this.bundle=!1,this;if("string"==typeof t&&(this.filterName=t,this.filterFn=this.model.root._namedFns[t]||_$defaultFns_60[t],!this.filterFn))throw new TypeError("Filter function not found: "+t);return this},Filter.prototype.sort=function(t){if(t||(t="asc"),"function"==typeof t)return this.sortFn=t,this.bundle=!1,this;if("string"==typeof t&&(this.sortName=t,this.sortFn=this.model.root._namedFns[t]||_$defaultFns_60[t],!this.sortFn))throw new TypeError("Sort function not found: "+t);return this},Filter.prototype._slice=function(t){if(null==this.skip&&null==this.limit)return t;var e,n=this.skip||0;return this.limit&&(e=n+this.limit),t.slice(n,e)},Filter.prototype.getInputs=function(){if(this.inputsSegments){for(var t=[],e=0,n=this.inputsSegments.length;e<n;e++){var r=this.model._get(this.inputsSegments[e]);t.push(r)}return t}},Filter.prototype.callFilter=function(t,e,n){var r=t[e];return n?this.filterFn.apply(this.model,[r,e,t].concat(n)):this.filterFn.call(this.model,r,e,t)},Filter.prototype.ids=function(){var t=this.model._get(this.segments),e=[];if(!t)return e;if(Array.isArray(t))throw new Error("model.filter is not currently supported on arrays");if(this.filterFn){var n=this.getInputs();for(var r in t)t.hasOwnProperty(r)&&this.callFilter(t,r,n)&&e.push(r)}else e=Object.keys(t);var i=this.sortFn;return i&&e.sort(function(e,n){return i(t[e],t[n])}),this._slice(e)},Filter.prototype.get=function(){var t=this.model._get(this.segments),e=[];if(Array.isArray(t))throw new Error("model.filter is not currently supported on arrays");if(this.filterFn){var n=this.getInputs();for(var r in t)t.hasOwnProperty(r)&&this.callFilter(t,r,n)&&e.push(t[r])}else for(var r in t)t.hasOwnProperty(r)&&e.push(t[r]);return this.sortFn&&e.sort(this.sortFn),this._slice(e)},Filter.prototype.update=function(t){var e=this.ids();this.model.pass(t,!0)._setArrayDiff(this.idsSegments,e)},Filter.prototype.ref=function(t){return t=this.model.path(t),this.from=t,this.fromSegments=t.split("."),this.filters.fromMap[t]=this,this.idsSegments=["$filters",t.replace(/\./g,"|")],this.update(),this.model.refList(t,this.path,this.idsSegments.join("."))},Filter.prototype.destroy=function(){delete this.filters.fromMap[this.from],this.model._removeRef(this.idsSegments),this.model._del(this.idsSegments)};var _$refList_68={};function addListener(t,e){t.on(e+"Immediate",function(n,r){var i=r[r.length-1],o=t._refLists.fromMap;for(var s in o){var a=o[s];i.$refList!==a&&a.onMutation(e,n,r)}})}function patchFromEvent(t,e,n,r){var i=r.fromSegments.length,o=e.length,s=n[n.length-1],a=r.model.pass(s,!0);if(o!==i)if(o<i)a._setArrayDiff(r.fromSegments,r.get());else{l=e[i];var u=a._get(r.fromSegments.concat(l)),c=r.toSegmentsByItem(u);if(o>i+1)throw new Error("Mutation on descendant of refList `from` should have been dereferenced: "+e.join("."));if("change"===t)return a._set(c,u),void updateIdForValue(a,r,l,u);if("insert"===t||"remove"===t||"move"===t)throw new Error("Array mutation on child of refList `from`should have been dereferenced: "+e.join("."))}else{if("insert"===t){var l=n[0],h=setNewToValues(a,r,g=n[1]);return void a._insert(r.idsSegments,l,h)}if("remove"===t){var l=n[0],p=n[1].length;h=a._remove(r.idsSegments,l,p);if(r.deleteRemoved)for(var f=0;f<h.length;f++){var d=r.itemById(h[f]);a._del(r.toSegmentsByItem(d))}return}if("move"===t){var m=n[0],v=n[1];p=n[2];return void a._move(r.idsSegments,m,v,p)}var g;if(!(g="change"===t?n[0]:a._get(r.fromSegments)))return void a._set(r.idsSegments,[]);h=setNewToValues(a,r,g);a._set(r.idsSegments,h)}}function setNewToValues(t,e,n){for(var r=[],i=0;i<n.length;i++){var o=n[i],s=e.idByItem(o);void 0===s&&"object"==typeof o&&(s=o.id=t.id());var a=e.toSegmentsByItem(o);if(void 0===s||void 0===a)throw new Error("Unable to add item to refList: "+o);t._get(a)!==o&&t._set(a,o),r.push(s)}return r}function updateIdForValue(t,e,n,r){var i=e.idByItem(r),o=e.idsSegments.concat(n);t._set(o,i)}function patchToEvent(t,e,n,r){var i=r.toSegments.length,o=e.length,s=n[n.length-1],a=r.model.pass(s,!0);if(o===i){if("insert"===t){for(var u=n[1],c=0;c<u.length;c++){var l=u[c];if(_=r.indicesByItem(l))for(var h=0;h<_.length;h++){var p=r.fromSegments.concat(_[h]);a._set(p,l)}}return}if("remove"===t){for(var f=n[0],d=(c=f,f+(u=n[1]).length);c<d;c++){if(_=r.indicesByItem(u[c])){h=0;for(var m=_.length;h<m;h++){p=r.fromSegments.concat(_[h]);a._set(p,void 0)}}}return}if("move"===t)return}if(o<=i)a._setArrayDiff(r.fromSegments,r.get());else if(o>i+1){l=a._get(e.slice(0,i+1));if(!(_=r.indicesByItem(l)))return;var v=e.slice(i+1);for(c=0;c<_.length;c++){var g=_[c],y=r.fromSegments.concat(g,v);y=a._dereference(y,null,r),(n=n.slice())[n.length-1]=a._pass,a.emit(t,y,n)}}else if("change"!==t&&"load"!==t&&"unload"!==t){var _;l=a._get(e.slice(0,i+1));if((_=r.indicesByItem(l))&&("insert"===t||"remove"===t||"move"===t))for(c=0;c<_.length;c++){y=r.fromSegments.concat(_[c]);y=a._dereference(y,null,r),(n=n.slice())[n.length-1]=a._pass,a.emit(t,y,n)}}else{var b;"change"===t?(l=n[0],b=n[1]):"load"===t?(l=n[0],b=void 0):"unload"===t&&(l=void 0,b=n[0]);var x=r.indicesByItem(l),E=r.indicesByItem(b);if(!x&&!E)return;if(E&&!equivalentArrays(E,x))for(var c=0;c<E.length;c++){p=r.fromSegments.concat(E[c]);a._set(p,void 0)}if(x)for(c=0;c<x.length;c++){p=r.fromSegments.concat(x[c]);a._set(p,l)}}}function equivalentArrays(t,e){if(!t||!e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function patchIdsEvent(t,e,n,r){var i=r.idsSegments.length,o=e.length,s=n[n.length-1],a=r.model.pass(s,!0);if(o===i){if("insert"===t){for(var u=n[0],c=n[1],l=[],h=0;h<c.length;h++){var p=r.itemById(c[h]);l.push(p)}return void a._insert(r.fromSegments,u,l)}if("remove"===t){u=n[0];var f=n[1].length;return void a._remove(r.fromSegments,u,f)}if("move"===t){var d=n[0],m=n[1];f=n[2];return void a._move(r.fromSegments,d,m,f)}}if(o<=i)a._setArrayDiff(r.fromSegments,r.get());else{u=e[i];var v=r.idByIndex(u),g=r.itemById(v),y=r.fromSegments.concat(u);a._get(y)!==g&&a._set(y,g)}}function RefList(t,e,n,r,i){this.model=t&&t.pass({$refList:this}),this.from=e,this.to=n,this.ids=r,this.fromSegments=e&&e.split("."),this.toSegments=n&&n.split("."),this.idsSegments=r&&r.split("."),this.options=i,this.deleteRemoved=i&&i.deleteRemoved}function __FromMap_68(){}function RefLists(){this.fromMap=new __FromMap_68}_$Model_54.INITS.push(function(t){var e=t.root;for(var n in e._refLists=new RefLists,_$Model_54.MUTATOR_EVENTS)addListener(e,n)}),_$Model_54.prototype.refList=function(){var t,e,n,r;2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?this.isPath(arguments[2])?(t=arguments[0],e=arguments[1],n=arguments[2]):(e=arguments[0],n=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]);var i,o=this.path(t);if(Array.isArray(e)){i=[];for(var s=0;s<e.length;s++)i.push(this.path(e[s]))}else i=this.path(e);var a=this.path(n),u=new RefList(this.root,o,i,a,r);return this.root._refLists.remove(o),u.model._setArrayDiff(u.fromSegments,u.get()),this.root._refLists.add(u),this.scope(o)},RefList.prototype.get=function(){var t=this.model._get(this.idsSegments);if(!t)return[];for(var e=this.model._get(this.toSegments),n=[],r=0;r<t.length;r++){var i=t[r];n.push(e&&e[i])}return n},RefList.prototype.dereference=function(t,e){var n=t.slice(e+1),r=this.idByIndex(n[0]);return null==r?[]:(n[0]=r,this.toSegments.concat(n))},RefList.prototype.toSegmentsByItem=function(t){var e=this.idByItem(t);if(void 0!==e)return this.toSegments.concat(e)},RefList.prototype.idByItem=function(t){if(t&&t.id)return t.id;var e=this.model._get(this.toSegments);for(var n in e)if(t===e[n])return n},RefList.prototype.indicesByItem=function(t){var e=this.idByItem(t),n=this.model._get(this.idsSegments);if(n){for(var r,i=-1;-1!==(i=n.indexOf(e,i+1));)r?r.push(i):r=[i];return r}},RefList.prototype.itemById=function(t){return this.model._get(this.toSegments.concat(t))},RefList.prototype.idByIndex=function(t){return this.model._get(this.idsSegments.concat(t))},RefList.prototype.onMutation=function(t,e,n){_$util_73.mayImpact(this.toSegments,e)?patchToEvent(t,e,n,this):_$util_73.mayImpact(this.idsSegments,e)?patchIdsEvent(t,e,n,this):_$util_73.mayImpact(this.fromSegments,e)&&patchFromEvent(t,e,n,this)},RefLists.prototype.add=function(t){this.fromMap[t.from]=t},RefLists.prototype.remove=function(t){var e=this.fromMap[t];return delete this.fromMap[t],e},RefLists.prototype.toJSON=function(){var t=[];for(var e in this.fromMap){var n=this.fromMap[e];t.push([n.from,n.to,n.ids,n.options])}return t};var _$ref_67={};function addIndexListeners(t){function e(e,n){var r=t._refs.fromMap;for(var i in r){var o=r[i];if(o.updateIndices&&_$util_73.contains(e,o.toSegments)&&o.toSegments.length>e.length){var s=+o.toSegments[e.length],a=n(s);s!==a&&(t._refs.remove(i),o.toSegments[e.length]=""+a,o.to=o.toSegments.join("."),t._refs.add(o))}}}t.on("insertImmediate",function(t,n){var r=n[0],i=n[1].length;e(t,function(t){return r<=t?t+i:t})}),t.on("removeImmediate",function(t,n){var r=n[0],i=n[1].length;e(t,function(t){return r<=t?t-i:t})}),t.on("moveImmediate",function(t,n){var r=n[0],i=n[1],o=n[2];e(t,function(t){return r<=t&&t<r+o?t+i-r:(r<=t&&(t-=o),i<=t&&(t+=o),t)})})}function refChange(t,e,n,r){var i=n[0];if(void 0===i){var o=r.slice(),s=o.pop(),a=t._get(o);if(!(a&&s in a))return void t._del(e)}t._set(e,i)}function refLoad(t,e,n){var r=n[0];t._set(e,r)}function refUnload(t,e){t._del(e)}function refInsert(t,e,n){var r=n[0],i=n[1];t._insert(e,r,i)}function refRemove(t,e,n){var r=n[0],i=n[1].length;t._remove(e,r,i)}function refMove(t,e,n){var r=n[0],i=n[1],o=n[2];t._move(e,r,i,o)}function __addListener_67(t,e,n){t.on(e+"Immediate",function(r,i){for(var o,s=i[i.length-1],a=t._refs.toMap,u=0,c=r.length;u<c;u++){o=o?o+"."+r[u]:r[u];var l=a[o];if(l){l=l.slice();for(var h=r.slice(u+1),p=0,f=l.length;p<f;p++){var d=l[p],m=d.fromSegments.concat(h);if(t._get(m)===t._get(r))t.emit(e,m,i);else{var v=d.model.pass(s,!0);v._dereference=noopDereference,n(v,m,i,r)}}}}var g=t._refs.parentToMap;if(!(l=g[o]))return;for(var p=0,f=l.length;p<f;p++){var d=l[p],y=t._get(d.toSegments),_=t._get(d.fromSegments);if(_!==y){var v=d.model.pass(s,!0);v._dereference=noopDereference,v._set(d.fromSegments,y)}}})}function noopDereference(t){return t}function Ref(t,e,n,r){this.model=t&&t.pass({$ref:this}),this.from=e,this.to=n,this.fromSegments=e.split("."),this.toSegments=n.split("."),this.parentTos=[];for(var i=1,o=this.toSegments.length;i<o;i++){var s=this.toSegments.slice(0,i).join(".");this.parentTos.push(s)}this.updateIndices=r&&r.updateIndices}function __FromMap_67(){}function ToMap(){}function Refs(){this.fromMap=new __FromMap_67,this.toMap=new ToMap,this.parentToMap=new ToMap}function listMapAdd(t,e,n){t[e]||(t[e]=[]),t[e].push(n)}function listMapRemove(t,e,n){var r=t[e];if(r){var i=r.indexOf(n);-1!==i&&(r.splice(i,1),r.length||delete t[e])}}_$Model_54.INITS.push(function(t){var e=t.root;e._refs=new Refs,addIndexListeners(e),__addListener_67(e,"change",refChange),__addListener_67(e,"load",refLoad),__addListener_67(e,"unload",refUnload),__addListener_67(e,"insert",refInsert),__addListener_67(e,"remove",refRemove),__addListener_67(e,"move",refMove)}),_$Model_54.prototype._canRefTo=function(t){return this.isPath(t)||t&&"function"==typeof t.ref},_$Model_54.prototype.ref=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?this._canRefTo(arguments[1])?(t=arguments[0],e=arguments[1]):(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this.path(t),i=this.path(e);if(!i)return e.ref(r);var o=new Ref(this.root,r,i,n);if(o.fromSegments.length<2)throw new Error("ref must be performed under a collection and document id. Invalid path: "+r);this.root._refs.remove(r),this.root._refLists.remove(r);var s=this.get(e);return o.model._set(o.fromSegments,s),this.root._refs.add(o),this.scope(r)},_$Model_54.prototype.removeRef=function(t){var e=this._splitPath(t),n=e.join(".");this._removeRef(e,n)},_$Model_54.prototype._removeRef=function(t,e){this.root._refs.remove(e),this.root._refLists.remove(e),this._del(t)},_$Model_54.prototype.removeAllRefs=function(t){var e=this._splitPath(t);this._removeAllRefs(e)},_$Model_54.prototype._removeAllRefs=function(t){this._removeMapRefs(t,this.root._refs.fromMap),this._removeMapRefs(t,this.root._refLists.fromMap)},_$Model_54.prototype._removeMapRefs=function(t,e){for(var n in e){var r=e[n].fromSegments;_$util_73.contains(t,r)&&this._removeRef(r,n)}},_$Model_54.prototype.dereference=function(t){var e=this._splitPath(t);return this._dereference(e).join(".")},_$Model_54.prototype._dereference=function(t,e,n){if(0===t.length)return t;var r,i=this.root._refs.fromMap,o=this.root._refLists.fromMap;do{var s="";r=!1;for(var a=0,u=t.length;a<u;a++){var c=i[s=s?s+"."+t[a]:t[a]];if(c){var l=t.slice(a+1);t=c.toSegments.concat(l),r=!0;break}var h=o[s];if(h&&h!==n){if(!(a+2<u||e&&a+1<u))continue;t=h.dereference(t,a),r=!0;break}}}while(r);return 0===t.length?["$null"]:t},Refs.prototype.add=function(t){this.fromMap[t.from]=t,listMapAdd(this.toMap,t.to,t);for(var e=0,n=t.parentTos.length;e<n;e++)listMapAdd(this.parentToMap,t.parentTos[e],t)},Refs.prototype.remove=function(t){var e=this.fromMap[t];if(e){delete this.fromMap[t],listMapRemove(this.toMap,e.to,e);for(var n=0,r=e.parentTos.length;n<r;n++)listMapRemove(this.parentToMap,e.parentTos[n],e);return e}},Refs.prototype.toJSON=function(){var t=[];for(var e in this.fromMap){var n=this.fromMap[e];t.push([n.from,n.to])}return t};var _$Model_64={exports:{}};_$Model_64.exports=_$Model_54,_$util_73.serverRequire(_$Model_64,"./bundle"),_$util_73.serverRequire(_$Model_64,"./connection.server"),_$Model_64=_$Model_64.exports;var _$Racer_72={exports:{}},__EventEmitter_72=_$EventEmitter_30.EventEmitter;function Racer(){__EventEmitter_72.call(this)}_$Racer_72.exports=Racer,_$util_73.mergeInto(Racer.prototype,__EventEmitter_72.prototype),Racer.prototype.Model=_$Model_64,Racer.prototype.util=_$util_73,Racer.prototype.use=_$util_73.use,Racer.prototype.serverUse=_$util_73.serverUse,Racer.prototype.createModel=function(t){var e=new _$Model_64;return t&&(e.createConnection(t),e.unbundle(t)),e},_$util_73.serverRequire(_$Racer_72,"./Racer.server"),_$Racer_72=_$Racer_72.exports;var _$lib_racer=new _$Racer_72,_$bcsocketUncompressed_2={};!function(){var f,aa=aa||{},l=this;function ba(t){t=t.split(".");for(var e,n=l;e=t.shift();){if(null==n[e])return null;n=n[e]}return n}function ca(){}function da(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function m(t){return"array"==da(t)}function ea(t){var e=da(t);return"array"==e||"object"==e&&"number"==typeof t.length}function n(t){return"string"==typeof t}function fa(t){return"function"==da(t)}var ga="closure_uid_"+(1e9*Math.random()>>>0),ha=0;function ia(t,e,n){return t.call.apply(t.bind,arguments)}function ja(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function p(t,e,n){return(p=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ia:ja).apply(null,arguments)}var q=Date.now||function(){return+new Date};function s(t,e){function n(){}n.prototype=e.prototype,t.pa=e.prototype,t.prototype=new n,t.Hc=function(t,n,r){var i=Array.prototype.slice.call(arguments,2);return e.prototype[n].apply(t,i)}}function ka(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function la(t){return ma.test(t)?(-1!=t.indexOf("&")&&(t=t.replace(na,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(oa,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(pa,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(qa,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(ra,"&#39;")),t):t}var na=/&/g,oa=/</g,pa=/>/g,qa=/"/g,ra=/'/g,ma=/[&<>"']/,x,ua,va,wa,ya;function sa(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^q()).toString(36)}function ta(t,e){return t<e?-1:t>e?1:0}function xa(){return l.navigator?l.navigator.userAgent:null}if(wa=va=ua=x=!1,ya=xa()){var za=l.navigator;x=0==ya.lastIndexOf("Opera",0),ua=!x&&(-1!=ya.indexOf("MSIE")||-1!=ya.indexOf("Trident")),va=!x&&-1!=ya.indexOf("WebKit"),wa=!x&&!va&&!ua&&"Gecko"==za.product}var Aa=x,y=ua,Ba=wa,z=va,Da;function Ca(){var t=l.document;return t?t.documentMode:void 0}t:{var Ea="",Fa;if(Aa&&l.opera)var Ga=l.opera.version,Ea="function"==typeof Ga?Ga():Ga;else if(Ba?Fa=/rv\:([^\);]+)(\)|;)/:y?Fa=/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/:z&&(Fa=/WebKit\/(\S+)/),Fa)var Ha=Fa.exec(xa()),Ea=Ha?Ha[1]:"";if(y){var Ia=Ca();if(Ia>parseFloat(Ea)){Da=String(Ia);break t}}Da=Ea}var Ja={};function A(t){var e;if(!(e=Ja[t])){e=0;for(var n=String(Da).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),r=String(t).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"",u=RegExp("(\\d*)(\\D*)","g"),c=RegExp("(\\d*)(\\D*)","g");do{var l=u.exec(s)||["","",""],h=c.exec(a)||["","",""];if(0==l[0].length&&0==h[0].length)break;e=ta(0==l[1].length?0:parseInt(l[1],10),0==h[1].length?0:parseInt(h[1],10))||ta(0==l[2].length,0==h[2].length)||ta(l[2],h[2])}while(0==e)}e=Ja[t]=0<=e}return e}var La=l.document,Ma=La&&y?Ca()||("CSS1Compat"==La.compatMode?parseInt(Da,10):5):void 0;function Na(t){Error.captureStackTrace?Error.captureStackTrace(this,Na):this.stack=Error().stack||"",t&&(this.message=String(t))}function Oa(t,e){e.unshift(t),Na.call(this,ka.apply(null,e)),e.shift()}function Pa(t,e){throw new Oa("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}s(Na,Error),Na.prototype.name="CustomError",s(Oa,Na),Oa.prototype.name="AssertionError";var Qa=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$");function Ra(t){if(Sa){Sa=!1;var e=l.location;if(e){var n=e.href;if(n&&(n=(n=Ra(n)[3]||null)&&decodeURIComponent(n))&&n!=e.hostname)throw Sa=!0,Error()}}return t.match(Qa)}var Sa=z;function Ta(t){var e,n=[],r=0;for(e in t)n[r++]=t[e];return n}function Ua(t){var e,n=[],r=0;for(e in t)n[r++]=e;return n}var Va="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Wa(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<Va.length;o++)n=Va[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}var B=Array.prototype,Xa=B.indexOf?function(t,e,n){return B.indexOf.call(t,e,n)}:function(t,e,r){if(r=null==r?0:0>r?Math.max(0,t.length+r):r,n(t))return n(e)&&1==e.length?t.indexOf(e,r):-1;for(;r<t.length;r++)if(r in t&&t[r]===e)return r;return-1},Ya=B.forEach?function(t,e,n){B.forEach.call(t,e,n)}:function(t,e,r){for(var i=t.length,o=n(t)?t.split(""):t,s=0;s<i;s++)s in o&&e.call(r,o[s],s,t)};function Za(t){var e;t:{e=$a;for(var r=t.length,i=n(t)?t.split(""):t,o=0;o<r;o++)if(o in i&&e.call(void 0,i[o],o,t)){e=o;break t}e=-1}return 0>e?null:n(t)?t.charAt(e):t[e]}function ab(t){return B.concat.apply(B,arguments)}function bb(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function cb(t,e){this.O={},this.j=[],this.o=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t){t instanceof cb?(n=t.ca(),r=t.N()):(n=Ua(t),r=Ta(t));for(var i=0;i<n.length;i++)this.set(n[i],r[i])}}function db(t){if(t.o!=t.j.length){for(var e=0,n=0;e<t.j.length;){var r=t.j[e];C(t.O,r)&&(t.j[n++]=r),e++}t.j.length=n}if(t.o!=t.j.length){var i={};for(n=e=0;e<t.j.length;)C(i,r=t.j[e])||(t.j[n++]=r,i[r]=1),e++;t.j.length=n}}function C(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function eb(t){if("function"==typeof t.N)return t.N();if(n(t))return t.split("");if(ea(t)){for(var e=[],r=t.length,i=0;i<r;i++)e.push(t[i]);return e}return Ta(t)}function D(t,e,r){if("function"==typeof t.forEach)t.forEach(e,r);else if(ea(t)||n(t))Ya(t,e,r);else{var i;if("function"==typeof t.ca)i=t.ca();else if("function"!=typeof t.N)if(ea(t)||n(t)){i=[];for(var o=t.length,s=0;s<o;s++)i.push(s)}else i=Ua(t);else i=void 0;s=(o=eb(t)).length;for(var a=0;a<s;a++)e.call(r,o[a],i&&i[a],t)}}function E(t,e){var n;if(t instanceof E)this.D=void 0!==e?e:t.D,fb(this,t.oa),n=t.eb,F(this),this.eb=n,gb(this,t.ja),hb(this,t.Ca),ib(this,t.I),jb(this,t.R.n()),n=t.Na,F(this),this.Na=n;else if(t&&(n=Ra(String(t)))){this.D=!!e,fb(this,n[1]||"",!0);var r=n[2]||"";F(this),this.eb=r?decodeURIComponent(r):"",gb(this,n[3]||"",!0),hb(this,n[4]),ib(this,n[5]||"",!0),jb(this,n[6]||"",!0),n=n[7]||"",F(this),this.Na=n?decodeURIComponent(n):""}else this.D=!!e,this.R=new kb(null,0,this.D)}function fb(t,e,n){F(t),t.oa=n?e?decodeURIComponent(e):"":e,t.oa&&(t.oa=t.oa.replace(/:$/,""))}function gb(t,e,n){F(t),t.ja=n?e?decodeURIComponent(e):"":e}function hb(t,e){if(F(t),e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.Ca=e}else t.Ca=null}function ib(t,e,n){F(t),t.I=n?e?decodeURIComponent(e):"":e}function jb(t,e,n){F(t),e instanceof kb?(t.R=e,t.R.ub(t.D)):(n||(e=lb(e,qb)),t.R=new kb(e,0,t.D))}function G(t,e,n){F(t),t.R.set(e,n)}function rb(t,e,n){F(t),m(n)||(n=[String(n)]),sb(t.R,e,n)}function H(t){return F(t),G(t,"zx",sa()),t}function F(t){if(t.oc)throw Error("Tried to modify a read-only Uri")}function tb(t){return t instanceof E?t.n():new E(t,void 0)}function ub(t,e,n,r){var i=new E(null,void 0);return t&&fb(i,t),e&&gb(i,e),n&&hb(i,n),r&&ib(i,r),i}function lb(t,e){return n(t)?encodeURI(t).replace(e,vb):null}function vb(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}f=cb.prototype,f.N=function(){db(this);for(var t=[],e=0;e<this.j.length;e++)t.push(this.O[this.j[e]]);return t},f.ca=function(){return db(this),this.j.concat()},f.wa=function(t){return C(this.O,t)},f.remove=function(t){return!!C(this.O,t)&&(delete this.O[t],this.o--,this.j.length>2*this.o&&db(this),!0)},f.get=function(t,e){return C(this.O,t)?this.O[t]:e},f.set=function(t,e){C(this.O,t)||(this.o++,this.j.push(t)),this.O[t]=e},f.n=function(){return new cb(this)},f=E.prototype,f.oa="",f.eb="",f.ja="",f.Ca=null,f.I="",f.Na="",f.oc=!1,f.D=!1,f.toString=function(){var t=[],e=this.oa;if(e&&t.push(lb(e,mb),":"),e=this.ja){t.push("//");var n=this.eb;n&&t.push(lb(n,mb),"@"),t.push(encodeURIComponent(String(e))),null!=(e=this.Ca)&&t.push(":",String(e))}return(e=this.I)&&(this.ja&&"/"!=e.charAt(0)&&t.push("/"),t.push(lb(e,"/"==e.charAt(0)?nb:ob))),(e=this.R.toString())&&t.push("?",e),(e=this.Na)&&t.push("#",lb(e,pb)),t.join("")},f.n=function(){return new E(this)},f.ub=function(t){return this.D=t,this.R&&this.R.ub(t),this};var mb=/[#\/\?@]/g,ob=/[\#\?:]/g,nb=/[\#\?]/g,qb=/[\#\?@]/g,pb=/#/g;function kb(t,e,n){this.C=t||null,this.D=!!n}function I(t){if(!t.h&&(t.h=new cb,t.o=0,t.C))for(var e=t.C.split("&"),n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null,o=null;0<=r?(i=e[n].substring(0,r),o=e[n].substring(r+1)):i=e[n],i=J(t,i=decodeURIComponent(i.replace(/\+/g," "))),t.add(i,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}function sb(t,e,n){t.remove(e),0<n.length&&(t.C=null,t.h.set(J(t,e),bb(n)),t.o+=n.length)}function J(t,e){var n=String(e);return t.D&&(n=n.toLowerCase()),n}function wb(a){if(a=String(a),!/^\s*$/.test(a)&&/^[\],:{}\s\u2028\u2029]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r\u2028\u2029\x00-\x08\x0a-\x1f]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,"")))try{return eval("("+a+")")}catch(t){}throw Error("Invalid JSON string: "+a)}function xb(a){return eval("("+a+")")}function yb(t){var e=[];return zb(new Ab,t,e),e.join("")}function Ab(){this.Ya=void 0}function zb(t,e,n){switch(typeof e){case"string":Bb(e,n);break;case"number":n.push(isFinite(e)&&!isNaN(e)?e:"null");break;case"boolean":n.push(e);break;case"undefined":n.push("null");break;case"object":if(null==e){n.push("null");break}if(m(e)){var r=e.length;n.push("[");for(var i="",o=0;o<r;o++)n.push(i),i=e[o],zb(t,t.Ya?t.Ya.call(e,String(o),i):i,n),i=",";n.push("]");break}for(o in n.push("{"),r="",e)Object.prototype.hasOwnProperty.call(e,o)&&("function"!=typeof(i=e[o])&&(n.push(r),Bb(o,n),n.push(":"),zb(t,t.Ya?t.Ya.call(e,o,i):i,n),r=","));n.push("}");break;case"function":break;default:throw Error("Unknown type: "+typeof e)}}f=kb.prototype,f.h=null,f.o=null,f.add=function(t,e){I(this),this.C=null,t=J(this,t);var n=this.h.get(t);return n||this.h.set(t,n=[]),n.push(e),this.o++,this},f.remove=function(t){return I(this),t=J(this,t),!!this.h.wa(t)&&(this.C=null,this.o-=this.h.get(t).length,this.h.remove(t))},f.wa=function(t){return I(this),t=J(this,t),this.h.wa(t)},f.ca=function(){I(this);for(var t=this.h.N(),e=this.h.ca(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},f.N=function(t){I(this);var e=[];if(n(t))this.wa(t)&&(e=ab(e,this.h.get(J(this,t))));else{t=this.h.N();for(var r=0;r<t.length;r++)e=ab(e,t[r])}return e},f.set=function(t,e){return I(this),this.C=null,t=J(this,t),this.wa(t)&&(this.o-=this.h.get(t).length),this.h.set(t,[e]),this.o++,this},f.get=function(t,e){var n=t?this.N(t):[];return 0<n.length?String(n[0]):e},f.toString=function(){if(this.C)return this.C;if(!this.h)return"";for(var t=[],e=this.h.ca(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),o=(r=this.N(r),0);o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.C=t.join("&")},f.n=function(){var t=new kb;return t.C=this.C,this.h&&(t.h=this.h.n(),t.o=this.o),t},f.ub=function(t){t&&!this.D&&(I(this),this.C=null,D(this.h,function(t,e){var n=e.toLowerCase();e!=n&&(this.remove(e),sb(this,n,t))},this)),this.D=t};var Cb={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},Db=/\uffff/.test("￿")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g;function Bb(t,e){e.push('"',t.replace(Db,function(t){if(t in Cb)return Cb[t];var e=t.charCodeAt(0),n="\\u";return 16>e?n+="000":256>e?n+="00":4096>e&&(n+="0"),Cb[t]=n+e.toString(16)}),'"')}function Eb(t){return Fb(t||arguments.callee.caller,[])}function Fb(t,e){var n=[];if(0<=Xa(e,t))n.push("[...circular reference...]");else if(t&&50>e.length){n.push(Gb(t)+"(");for(var r=t.arguments,i=0;i<r.length;i++){var o;switch(0<i&&n.push(", "),typeof(o=r[i])){case"object":o=o?"object":"null";break;case"string":break;case"number":o=String(o);break;case"boolean":o=o?"true":"false";break;case"function":o=(o=Gb(o))?o:"[fn]";break;default:o=typeof o}40<o.length&&(o=o.substr(0,40)+"..."),n.push(o)}e.push(t),n.push(")\n");try{n.push(Fb(t.caller,e))}catch(t){n.push("[exception trying to get caller]\n")}}else t?n.push("[...long stack...]"):n.push("[end]");return n.join("")}function Gb(t){if(Hb[t])return Hb[t];if(t=String(t),!Hb[t]){var e=/function ([^\(]+)/.exec(t);Hb[t]=e?e[1]:"[Anonymous]"}return Hb[t]}var Hb={};function Ib(t,e,n,r,i){this.reset(t,e,n,r,i)}Ib.prototype.Fb=null,Ib.prototype.Eb=null;var Jb=0;function L(t){this.rc=t}function Kb(t,e){this.name=t,this.value=e}Ib.prototype.reset=function(t,e,n,r,i){"number"==typeof i||Jb++,r||q(),this.Aa=t,this.qc=e,delete this.Fb,delete this.Eb},Ib.prototype.$b=function(t){this.Aa=t},L.prototype.Sa=null,L.prototype.Aa=null,L.prototype.jb=null,L.prototype.Jb=null,Kb.prototype.toString=function(){return this.name};var Lb=new Kb("SEVERE",1e3),Mb=new Kb("WARNING",900),Nb=new Kb("INFO",800),Ob=new Kb("CONFIG",700),Pb=new Kb("FINE",500);function Qb(t){return t.Aa?t.Aa:t.Sa?Qb(t.Sa):(Pa("Root logger has no level set."),null)}f=L.prototype,f.getParent=function(){return this.Sa},f.$b=function(t){this.Aa=t},f.log=function(t,e,n){if(t.value>=Qb(this).value)for(fa(e)&&(e=e()),e="log:"+(t=this.mc(t,e,n)).qc,l.console&&(l.console.timeStamp?l.console.timeStamp(e):l.console.markTimeline&&l.console.markTimeline(e)),l.msWriteProfilerMark&&l.msWriteProfilerMark(e),e=this;e;){var r=t;if((n=e).Jb)for(var i=0,o=void 0;o=n.Jb[i];i++)o(r);e=e.getParent()}},f.mc=function(t,e,r){var i=new Ib(t,String(e),this.rc);if(r){var o;i.Fb=r;var s=arguments.callee.caller;try{var a,u=ba("window.location.href");if(n(r))a={message:r,name:"Unknown error",lineNumber:"Not available",fileName:u,stack:"Not available"};else{var c,h,p=!1;try{c=r.lineNumber||r.Ic||"Not available"}catch(t){c="Not available",p=!0}try{h=r.fileName||r.filename||r.sourceURL||l.$googDebugFname||u}catch(t){h="Not available",p=!0}a=!p&&r.lineNumber&&r.fileName&&r.stack&&r.message&&r.name?r:{message:r.message||"Not available",name:r.name||"UnknownError",lineNumber:c,fileName:h,stack:r.stack||"Not available"}}o="Message: "+la(a.message)+'\nUrl: <a href="view-source:'+a.fileName+'" target="_new">'+a.fileName+"</a>\nLine: "+a.lineNumber+"\n\nBrowser stack:\n"+la(a.stack+"-> ")+"[end]\n\nJS stack traversal:\n"+la(Eb(s)+"-> ")}catch(t){o="Exception trying to expose exception! You win, we lose. "+t}i.Eb=o}return i},f.J=function(t,e){this.log(Lb,t,e)},f.Z=function(t,e){this.log(Mb,t,e)},f.info=function(t,e){this.log(Nb,t,e)};var Rb={},Sb=null;function Tb(t){var e;if(Sb||(Sb=new L(""),Rb[""]=Sb,Sb.$b(Ob)),!(e=Rb[t])){e=new L(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=Tb(t.substr(0,n))).jb||(n.jb={}),n.jb[r]=e,e.Sa=n,Rb[t]=e}return e}function M(t,e){t&&t.log(Pb,e,void 0)}function N(){this.r=Tb("goog.net.BrowserChannel")}function Ub(t,e,n,r){t.info("XMLHTTP TEXT ("+e+"): "+Vb(t,n)+(r?" "+r:""))}function Wb(t,e,n){t.J((n||"Exception")+e)}function Vb(t,e){if(!e||e==Xb)return e;try{var n=xb(e);if(n)for(var r=0;r<n.length;r++)if(m(n[r])){var i=n[r];if(!(2>i.length)){var o=i[1];if(m(o)&&!(1>o.length)){var s=o[0];if("noop"!=s&&"stop"!=s)for(var a=1;a<o.length;a++)o[a]=""}}}return yb(n)}catch(n){return t.debug("Exception parsing expected JS array - probably was not JS"),e}}function Yb(t,e){this.P=e?xb:wb}function O(){0!=Zb&&($b[this[ga]||(this[ga]=++ha)]=this)}N.prototype.debug=function(t){this.info(t)},N.prototype.info=function(t){var e=this.r;e&&e.info(t,void 0)},N.prototype.Z=function(t){var e=this.r;e&&e.Z(t,void 0)},N.prototype.J=function(t){var e=this.r;e&&e.J(t,void 0)},Yb.prototype.parse=function(t){return this.P(t)};var Zb=0,$b={};O.prototype.mb=!1,O.prototype.Ja=function(){if(!this.mb&&(this.mb=!0,this.u(),0!=Zb)){var t=this[ga]||(this[ga]=++ha);delete $b[t]}},O.prototype.u=function(){if(this.Pb)for(;this.Pb.length;)this.Pb.shift()()};var ac="closure_listenable_"+(1e6*Math.random()|0);function bc(t){try{return!(!t||!t[ac])}catch(t){return!1}}var cc=0;function dc(t,e,n,r,i){this.fa=t,this.Ua=null,this.src=e,this.type=n,this.capture=!!r,this.Oa=i,this.key=++cc,this.na=this.Ia=!1}function ec(t){t.na=!0,t.fa=null,t.Ua=null,t.src=null,t.Oa=null}function P(t){this.src=t,this.s={},this.Ga=0}function gc(t,e){var n=e.type;if(!(n in t.s))return!1;var r,i=t.s[n],o=Xa(i,e);return(r=0<=o)&&B.splice.call(i,o,1),r&&(ec(e),0==t.s[n].length&&(delete t.s[n],t.Ga--)),r}function fc(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.na&&o.fa==e&&o.capture==!!n&&o.Oa==r)return i}return-1}P.prototype.add=function(t,e,n,r,i){var o=this.s[t];o||(o=this.s[t]=[],this.Ga++);var s=fc(o,e,r,i);return-1<s?(t=o[s],n||(t.Ia=!1)):((t=new dc(e,this.src,t,!!r,i)).Ia=n,o.push(t)),t},P.prototype.remove=function(t,e,n,r){if(!(t in this.s))return!1;var i=this.s[t];return-1<(e=fc(i,e,n,r))&&(ec(i[e]),B.splice.call(i,e,1),0==i.length&&(delete this.s[t],this.Ga--),!0)},P.prototype.Xa=function(t){var e,n=0;for(e in this.s)if(!t||e==t){for(var r=this.s[e],i=0;i<r.length;i++)++n,ec(r[i]);delete this.s[e],this.Ga--}return n},P.prototype.ya=function(t,e,n,r){var i=-1;return(t=this.s[t])&&(i=fc(t,e,n,r)),-1<i?t[i]:null};var hc=!y||y&&9<=Ma,ic=y&&!A("9");function Q(t,e){this.type=t,this.currentTarget=this.target=e}function jc(t){return jc[" "](t),t}function kc(t,e){if(Q.call(this,t?t.type:""),this.relatedTarget=this.currentTarget=this.target=null,this.charCode=this.keyCode=this.button=this.screenY=this.screenX=this.clientY=this.clientX=this.offsetY=this.offsetX=0,this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.Db=this.state=null,t){var n=this.type=t.type;this.target=t.target||t.srcElement,this.currentTarget=e;var r=t.relatedTarget;if(r){if(Ba){var i;t:{try{jc(r.nodeName),i=!0;break t}catch(t){}i=!1}i||(r=null)}}else"mouseover"==n?r=t.fromElement:"mouseout"==n&&(r=t.toElement);this.relatedTarget=r,this.offsetX=z||void 0!==t.offsetX?t.offsetX:t.layerX,this.offsetY=z||void 0!==t.offsetY?t.offsetY:t.layerY,this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0,this.button=t.button,this.keyCode=t.keyCode||0,this.charCode=t.charCode||("keypress"==n?t.keyCode:0),this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.state=t.state,this.Db=t,t.defaultPrevented&&this.preventDefault(),delete this.ga}}!z||A("528"),Ba&&A("1.9b")||y&&A("8")||Aa&&A("9.5")||z&&A("528"),Ba&&!A("8")||y&&A("9"),f=Q.prototype,f.u=function(){},f.Ja=function(){},f.ga=!1,f.defaultPrevented=!1,f.Yb=!0,f.preventDefault=function(){this.defaultPrevented=!0,this.Yb=!1},jc[" "]=ca,s(kc,Q),kc.prototype.preventDefault=function(){kc.pa.preventDefault.call(this);var t=this.Db;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,ic)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}},kc.prototype.u=function(){};var lc="closure_lm_"+(1e6*Math.random()|0),mc={},nc=0;function oc(t,e,n,r,i){if(m(e)){for(var o=0;o<e.length;o++)oc(t,e[o],n,r,i);return null}if(n=pc(n),bc(t))t=t.Ra(e,n,r,i);else{if(!e)throw Error("Invalid event type");o=!!r;var s=qc(t);s||(t[lc]=s=new P(t)),(n=s.add(e,n,!1,r,i)).Ua||(r=rc(),n.Ua=r,r.src=t,r.fa=n,t.addEventListener?t.addEventListener(e,r,o):t.attachEvent(e in mc?mc[e]:mc[e]="on"+e,r),nc++),t=n}return t}function rc(){var t=sc,e=hc?function(n){return t.call(e.src,e.fa,n)}:function(n){if(!(n=t.call(e.src,e.fa,n)))return n};return e}function tc(t,e,n,r,i){if(m(e))for(var o=0;o<e.length;o++)tc(t,e[o],n,r,i);else n=pc(n),bc(t)?t.vb(e,n,r,i):t&&(t=qc(t))&&(e=t.ya(e,n,!!r,i))&&uc(e)}function uc(t){if("number"==typeof t||!t||t.na)return!1;var e=t.src;if(bc(e))return gc(e.W,t);var n=t.type,r=t.Ua;return e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent&&e.detachEvent(n in mc?mc[n]:mc[n]="on"+n,r),nc--,(n=qc(e))?(gc(n,t),0==n.Ga&&(n.src=null,e[lc]=null)):ec(t),!0}function vc(t,e,n,r){var i=1;if((t=qc(t))&&(e=t.s[e]))for(e=bb(e),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.na&&(i&=!1!==wc(o,r))}return Boolean(i)}function wc(t,e){var n=t.fa,r=t.Oa||t.src;return t.Ia&&uc(t),n.call(r,e)}function sc(t,e){if(t.na)return!0;if(!hc){var n=e||ba("window.event"),r=new kc(n,this),i=!0;if(!(0>n.keyCode||null!=n.returnValue)){t:{var o=!1;if(0==n.keyCode)try{n.keyCode=-1;break t}catch(t){o=!0}(o||null==n.returnValue)&&(n.returnValue=!0)}for(n=[],o=r.currentTarget;o;o=o.parentNode)n.push(o);o=t.type;for(var s=n.length-1;!r.ga&&0<=s;s--)r.currentTarget=n[s],i&=vc(n[s],o,!0,r);for(s=0;!r.ga&&s<n.length;s++)r.currentTarget=n[s],i&=vc(n[s],o,!1,r)}return i}return wc(t,new kc(e,this))}function qc(t){return(t=t[lc])instanceof P?t:null}var xc="__closure_events_fn_"+(1e9*Math.random()>>>0);function pc(t){return fa(t)?t:t[xc]||(t[xc]=function(e){return t.handleEvent(e)})}function R(){O.call(this),this.W=new P(this),this.fc=this}function yc(t,e,n,r){if(!(e=t.W.s[String(e)]))return!0;e=bb(e);for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.na&&s.capture==n){var a=s.fa,u=s.Oa||s.src;s.Ia&&gc(t.W,s),i=!1!==a.call(u,r)&&i}}return i&&0!=r.Yb}function zc(t,e){R.call(this),this.ea=t||1,this.ra=e||l,this.ib=p(this.Gc,this),this.sb=q()}s(R,O),R.prototype[ac]=!0,f=R.prototype,f.tb=null,f.addEventListener=function(t,e,n,r){oc(this,t,e,n,r)},f.removeEventListener=function(t,e,n,r){tc(this,t,e,n,r)},f.dispatchEvent=function(t){var e;if(r=this.tb)for(e=[];r;r=r.tb)e.push(r);var r=this.fc,i=t.type||t;if(n(t))t=new Q(t,r);else if(t instanceof Q)t.target=t.target||r;else{var o=t;Wa(t=new Q(i,r),o)}var s;o=!0;if(e)for(var a=e.length-1;!t.ga&&0<=a;a--)o=yc(s=t.currentTarget=e[a],i,!0,t)&&o;if(t.ga||(o=yc(s=t.currentTarget=r,i,!0,t)&&o,t.ga||(o=yc(s,i,!1,t)&&o)),e)for(a=0;!t.ga&&a<e.length;a++)o=yc(s=t.currentTarget=e[a],i,!1,t)&&o;return o},f.u=function(){R.pa.u.call(this),this.W&&this.W.Xa(void 0),this.tb=null},f.Ra=function(t,e,n,r){return this.W.add(String(t),e,!1,n,r)},f.vb=function(t,e,n,r){return this.W.remove(String(t),e,n,r)},f.ya=function(t,e,n,r){return this.W.ya(String(t),e,n,r)},s(zc,R),f=zc.prototype,f.enabled=!1,f.l=null,f.setInterval=function(t){this.ea=t,this.l&&this.enabled?(this.stop(),this.start()):this.l&&this.stop()},f.Gc=function(){if(this.enabled){var t=q()-this.sb;0<t&&t<.8*this.ea?this.l=this.ra.setTimeout(this.ib,this.ea-t):(this.l&&(this.ra.clearTimeout(this.l),this.l=null),this.dispatchEvent(Ac),this.enabled&&(this.l=this.ra.setTimeout(this.ib,this.ea),this.sb=q()))}},f.start=function(){this.enabled=!0,this.l||(this.l=this.ra.setTimeout(this.ib,this.ea),this.sb=q())},f.stop=function(){this.enabled=!1,this.l&&(this.ra.clearTimeout(this.l),this.l=null)},f.u=function(){zc.pa.u.call(this),this.stop(),delete this.ra};var Ac="tick",Fc;function Bc(t,e,n){if(fa(t))n&&(t=p(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=p(t.handleEvent,t)}return 2147483647<e?-1:l.setTimeout(t,e||0)}function Cc(){}function Dc(t){var e;return(e=t.Ab)||(e={},Ec(t)&&(e[0]=!0,e[1]=!0),e=t.Ab=e),e}function Gc(){}function Hc(t){return(t=Ec(t))?new ActiveXObject(t):new XMLHttpRequest}function Ec(t){if(!t.Kb&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.Kb=r}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return t.Kb}function Ic(t){R.call(this),this.headers=new cb,this.gb=t||null,this.T=!1,this.fb=this.f=null,this.Mb=this.Qa="",this.ka=0,this.q="",this.da=this.qb=this.Pa=this.nb=!1,this.Fa=0,this.bb=null,this.Xb=Jc,this.cb=this.dc=!1}Cc.prototype.Ab=null,s(Gc,Cc),Fc=new Gc,s(Ic,R);var Jc="";Ic.prototype.r=Tb("goog.net.XhrIo");var Kc=/^https?$/i,Lc=["POST","PUT"];function Oc(t){return y&&A(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}function $a(t){return"content-type"==t.toLowerCase()}function Mc(t,e){t.T=!1,t.f&&(t.da=!0,t.f.abort(),t.da=!1),t.q=e,t.ka=5,Pc(t),Qc(t)}function Pc(t){t.nb||(t.nb=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Rc(t){if(t.T&&void 0!==aa)if(t.fb[1]&&4==T(t)&&2==Sc(t))M(t.r,S(t,"Local request error detected and ignored"));else if(t.Pa&&4==T(t))Bc(t.Qb,0,t);else if(t.dispatchEvent("readystatechange"),4==T(t)){M(t.r,S(t,"Request complete")),t.T=!1;try{var e,n,r=Sc(t);t:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:n=!0;break t;default:n=!1}if(!(e=n)){var i;if(i=0===r){if(!(s=Ra(String(t.Qa))[1]||null)&&self.location)var o=self.location.protocol,s=o.substr(0,o.length-1);i=!Kc.test(s?s.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{var a;t.ka=6;try{a=2<T(t)?t.f.statusText:""}catch(e){M(t.r,"Can not get status: "+e.message),a=""}t.q=a+" ["+Sc(t)+"]",Pc(t)}}finally{Qc(t)}}}function Qc(t,e){if(t.f){Nc(t);var n=t.f,r=t.fb[0]?ca:null;t.f=null,t.fb=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(e){(n=t.r)&&n.J("Problem encountered resetting onreadystatechange: "+e.message,void 0)}}}function Nc(t){t.f&&t.cb&&(t.f.ontimeout=null),"number"==typeof t.bb&&(l.clearTimeout(t.bb),t.bb=null)}function T(t){return t.f?t.f.readyState:0}function Sc(t){try{return 2<T(t)?t.f.status:-1}catch(e){return(t=t.r)&&t.Z("Can not get status: "+e.message,void 0),-1}}function Tc(t){try{return t.f?t.f.responseText:""}catch(e){return M(t.r,"Can not get responseText: "+e.message),""}}function S(t,e){return e+" ["+t.Mb+" "+t.Qa+" "+Sc(t)+"]"}function Uc(){this.Wb=q()}function Vc(t){O.call(this),this.e=t,this.j={}}f=Ic.prototype,f.send=function(t,e,n,r){if(this.f)throw Error("[goog.net.XhrIo] Object is active with another request="+this.Qa+"; newUri="+t);e=e?e.toUpperCase():"GET",this.Qa=t,this.q="",this.ka=0,this.Mb=e,this.nb=!1,this.T=!0,this.f=this.gb?Hc(this.gb):Hc(Fc),this.fb=this.gb?Dc(this.gb):Dc(Fc),this.f.onreadystatechange=p(this.Qb,this);try{M(this.r,S(this,"Opening Xhr")),this.qb=!0,this.f.open(e,t,!0),this.qb=!1}catch(t){return M(this.r,S(this,"Error opening Xhr: "+t.message)),void Mc(this,t)}t=n||"";var i=this.headers.n();r&&D(r,function(t,e){i.set(e,t)}),r=Za(i.ca()),n=l.FormData&&t instanceof l.FormData,!(0<=Xa(Lc,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),D(i,function(t,e){this.f.setRequestHeader(e,t)},this),this.Xb&&(this.f.responseType=this.Xb),"withCredentials"in this.f&&(this.f.withCredentials=this.dc);try{Nc(this),0<this.Fa&&(this.cb=Oc(this.f),M(this.r,S(this,"Will abort after "+this.Fa+"ms if incomplete, xhr2 "+this.cb)),this.cb?(this.f.timeout=this.Fa,this.f.ontimeout=p(this.qa,this)):this.bb=Bc(this.qa,this.Fa,this)),M(this.r,S(this,"Sending request")),this.Pa=!0,this.f.send(t),this.Pa=!1}catch(t){M(this.r,S(this,"Send error: "+t.message)),Mc(this,t)}},f.qa=function(){void 0!==aa&&this.f&&(this.q="Timed out after "+this.Fa+"ms, aborting",this.ka=8,M(this.r,S(this,this.q)),this.dispatchEvent("timeout"),this.abort(8))},f.abort=function(t){this.f&&this.T&&(M(this.r,S(this,"Aborting")),this.T=!1,this.da=!0,this.f.abort(),this.da=!1,this.ka=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Qc(this))},f.u=function(){this.f&&(this.T&&(this.T=!1,this.da=!0,this.f.abort(),this.da=!1),Qc(this,!0)),Ic.pa.u.call(this)},f.Qb=function(){this.mb||(this.qb||this.Pa||this.da?Rc(this):this.uc())},f.uc=function(){Rc(this)},f.isActive=function(){return!!this.f},f.Ib=function(){return n(this.q)?this.q:String(this.q)},new Uc,Uc.prototype.set=function(t){this.Wb=t},Uc.prototype.reset=function(){this.set(q())},Uc.prototype.get=function(){return this.Wb},s(Vc,O);var Wc=[];function Xc(t,e,n){O.call(this),this.pc=t,this.ea=e,this.e=n,this.jc=p(this.vc,this)}function Yc(t){t.l=Bc(t.jc,t.ea),t.pc.call(t.e)}function U(t,e,n,r,i){this.b=t,this.a=e,this.Y=n,this.B=r,this.Ea=i||1,this.qa=Zc,this.ob=new Vc(this),this.Ta=new zc,this.Ta.setInterval($c)}f=Vc.prototype,f.Ra=function(t,e,n,r){m(e)||(Wc[0]=e,e=Wc);for(var i=0;i<e.length;i++){var o=oc(t,e[i],n||this.handleEvent,r||!1,this.e||this);if(!o)break;this.j[o.key]=o}return this},f.vb=function(t,e,n,r,i){if(m(e))for(var o=0;o<e.length;o++)this.vb(t,e[o],n,r,i);else n=n||this.handleEvent,i=i||this.e||this,n=pc(n),r=!!r,(e=bc(t)?t.ya(e,n,r,i):t&&(t=qc(t))?t.ya(e,n,r,i):null)&&(uc(e),delete this.j[e.key]);return this},f.Xa=function(){var t,e=this.j,n=uc;for(t in e)n.call(void 0,e[t],t,e);this.j={}},f.u=function(){Vc.pa.u.call(this),this.Xa()},f.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},s(Xc,O),f=Xc.prototype,f.Za=!1,f.Vb=0,f.l=null,f.stop=function(){this.l&&(l.clearTimeout(this.l),this.l=null,this.Za=!1)},f.u=function(){Xc.pa.u.call(this),this.stop()},f.vc=function(){this.l=null,this.Za&&!this.Vb&&(this.Za=!1,Yc(this))},f=U.prototype,f.v=null,f.F=!1,f.ua=null,f.xb=null,f.Da=null,f.sa=null,f.U=null,f.w=null,f.X=null,f.k=null,f.Ha=0,f.K=null,f.ta=null,f.q=null,f.g=-1,f.Zb=!0,f.$=!1,f.ma=0,f.Va=null;var Zc=45e3,$c=250;function ad(t,e){switch(t){case 0:return"Non-200 return code ("+e+")";case 1:return"XMLHTTP failure (no data)";case 2:return"HttpConnection timeout";default:return"Unknown error"}}var bd={},dd={};function ed(){return!y||y&&10<=Ma}function fd(t,e,n){t.sa=1,t.U=H(e.n()),t.X=n,t.Cb=!0,gd(t,null)}function hd(t,e,n,r,i){t.sa=1,t.U=H(e.n()),t.X=null,t.Cb=n,i&&(t.Zb=!1),gd(t,r)}function gd(t,e){var n;if(t.Da=q(),id(t),t.w=t.U.n(),rb(t.w,"t",t.Ea),t.Ha=0,t.k=t.b.lb(t.b.$a()?e:null),0<t.ma&&(t.Va=new Xc(p(t.ec,t,t.k),t.ma)),t.ob.Ra(t.k,"readystatechange",t.Bc),t.v){n=t.v;var r,i={};for(r in n)i[r]=n[r];n=i}else n={};if(t.X?(t.ta="POST",n["Content-Type"]="application/x-www-form-urlencoded",t.k.send(t.w,t.ta,t.X,n)):(t.ta="GET",t.Zb&&!z&&(n.Connection="close"),t.k.send(t.w,t.ta,null,n)),t.b.H(jd),i=t.X)for(n="",i=i.split("&"),r=0;r<i.length;r++){if(1<(s=i[r].split("=")).length){var o=s[0],s=s[1],a=o.split("_");n=2<=a.length&&"type"==a[1]?n+(o+"=")+s+"&":n+(o+"=redacted&")}}else n=null;t.a.info("XMLHTTP REQ ("+t.B+") [attempt "+t.Ea+"]: "+t.ta+"\n"+t.w+"\n"+n)}function nd(t,e,n){for(var r=!0;!t.$&&t.Ha<n.length;){var i=qd(t,n);if(i==dd){4==e&&(t.q=4,W(),r=!1),Ub(t.a,t.B,null,"[Incomplete Response]");break}if(i==bd){t.q=4,W(),Ub(t.a,t.B,n,"[Invalid Chunk]"),r=!1;break}Ub(t.a,t.B,i,null),od(t,i)}4==e&&0==n.length&&(t.q=1,W(),r=!1),t.F=t.F&&r,r||(Ub(t.a,t.B,n,"[Invalid Chunked Response]"),V(t),pd(t))}function qd(t,e){var n=t.Ha,r=e.indexOf("\n",n);if(-1==r)return dd;if(n=Number(e.substring(n,r)),isNaN(n))return bd;if((r+=1)+n>e.length)return dd;var i=e.substr(r,n);return t.Ha=r+n,i}function rd(t,e){t.Da=q(),id(t);var n=e?window.location.hostname:"";t.w=t.U.n(),G(t.w,"DOMAIN",n),G(t.w,"t",t.Ea);try{t.K=new ActiveXObject("htmlfile")}catch(e){return t.a.J("ActiveX blocked"),V(t),t.q=7,W(),void pd(t)}var r="<html><body>";e&&(r+='<script>document.domain="'+n+'"<\/script>'),r+="</body></html>",t.K.open(),t.K.write(r),t.K.close(),t.K.parentWindow.m=p(t.yc,t),t.K.parentWindow.d=p(t.Ub,t,!0),t.K.parentWindow.rpcClose=p(t.Ub,t,!1),n=t.K.createElement("div"),t.K.parentWindow.document.body.appendChild(n),n.innerHTML='<iframe src="'+t.w+'"></iframe>',t.a.info("TRIDENT REQ ("+t.B+") [ attempt "+t.Ea+"]: GET\n"+t.w),t.b.H(jd)}function id(t){t.xb=q()+t.qa,td(t,t.qa)}function td(t,e){if(null!=t.ua)throw Error("WatchDog timer not null");t.ua=Y(p(t.zc,t),e)}function md(t){t.ua&&(l.clearTimeout(t.ua),t.ua=null)}function pd(t){t.b.Lb()||t.$||t.b.la(t)}function V(t){md(t);var e=t.Va;e&&"function"==typeof e.Ja&&e.Ja(),t.Va=null,t.Ta.stop(),t.ob.Xa(),t.k&&(e=t.k,t.k=null,e.abort(),e.Ja()),t.K&&(t.K=null)}function od(t,e){try{t.b.Rb(t,e),t.b.H(sd)}catch(e){Wb(t.a,e,"Error in httprequest callback")}}function ud(t,e,n,r,i){if((new N).debug("TestLoadImageWithRetries: "+i),0==r)n(!1);else{var o=i||0;r--,vd(t,e,function(i){i?n(!0):l.setTimeout(function(){ud(t,e,n,r,o)},o)})}}function vd(t,e,n){function r(t,e){return function(){try{i.debug("TestLoadImage: "+e),o.onload=null,o.onerror=null,o.onabort=null,o.ontimeout=null,l.clearTimeout(s),n(t)}catch(t){Wb(i,t)}}}var i=new N;i.debug("TestLoadImage: loading "+t);var o=new Image,s=null;o.onload=r(!0,"loaded"),o.onerror=r(!1,"error"),o.onabort=r(!1,"abort"),o.ontimeout=r(!1,"timeout"),s=l.setTimeout(function(){o.ontimeout&&o.ontimeout()},e),o.src=t}function wd(t,e){this.b=t,this.a=e,this.P=new Yb(0,!0)}function yd(t){var e=Ad(t.b,t.va,"/mail/images/cleardot.gif");H(e),ud(e.toString(),5e3,p(t.kc,t),3,2e3),t.H(jd)}function zd(t){t.a.debug("TestConnection: starting stage 2");var e=t.b.Dc;if(null!=e)t.a.debug("Buffered"),W(),e?(W(),Bd(t.b,t,!1)):(W(),Bd(t.b,t,!0));else if(t.A=new U(t,t.a,void 0,void 0,void 0),t.A.S(t.v),e=Cd(t.b,t.L,t.I),W(),ed())rb(e,"TYPE","xmlhttp"),hd(t.A,e,!1,t.L,!1);else{rb(e,"TYPE","html");var n=t.A;t=Boolean(t.L),n.sa=3,n.U=H(e.n()),rd(n,t)}}function Ed(t,e,n){this.Bb=t||null,this.c=Fd,this.t=[],this.Q=[],this.a=new N,this.P=new Yb(0,!0),this.Gb=e||null,this.Dc=null!=n?n:null}function Gd(t,e){this.Ob=t,this.map=e}f=U.prototype,f.S=function(t){this.v=t},f.setTimeout=function(t){this.qa=t},f.bc=function(t){this.ma=t},f.Bc=function(t){t=t.target;var e=this.Va;e&&3==T(t)?(this.a.debug("Throttling readystatechange."),e.l||e.Vb?e.Za=!0:Yc(e)):this.ec(t)},f.ec=function(t){try{if(t==this.k)t:{var e=T(this.k),n=this.k.ka,r=Sc(this.k);if(!ed()||z&&!A("420+")){if(4>e)break t}else if(3>e||3==e&&!Aa&&!Tc(this.k))break t;this.$||4!=e||7==n||(8==n||0>=r?this.b.H(kd):this.b.H(ld)),md(this);var i=Sc(this.k);this.g=i;var o=Tc(this.k);o||this.a.debug("No response text for uri "+this.w+" status "+i),this.F=200==i,this.a.info("XMLHTTP RESP ("+this.B+") [ attempt "+this.Ea+"]: "+this.ta+"\n"+this.w+"\n"+e+" "+i),this.F?(4==e&&V(this),this.Cb?(nd(this,e,o),Aa&&this.F&&3==e&&(this.ob.Ra(this.Ta,Ac,this.Ac),this.Ta.start())):(Ub(this.a,this.B,o,null),od(this,o)),this.F&&!this.$&&(4==e?this.b.la(this):(this.F=!1,id(this)))):(400==i&&0<o.indexOf("Unknown SID")?(this.q=3,W(),this.a.Z("XMLHTTP Unknown SID ("+this.B+")")):(this.q=0,W(),this.a.Z("XMLHTTP Bad status "+i+" ("+this.B+")")),V(this),pd(this))}else this.a.Z("Called back with an unexpected xmlhttp")}catch(t){this.a.debug("Failed call to OnXmlHttpReadyStateChanged_"),this.k&&Tc(this.k)?Wb(this.a,t,"ResponseText: "+Tc(this.k)):Wb(this.a,t,"No response text")}},f.Ac=function(){var t=T(this.k),e=Tc(this.k);this.Ha<e.length&&(md(this),nd(this,t,e),this.F&&4!=t&&id(this))},f.yc=function(t){Y(p(this.xc,this,t),0)},f.xc=function(t){if(!this.$){var e=this.a;e.info("TRIDENT TEXT ("+this.B+"): "+Vb(e,t)),md(this),od(this,t),id(this)}},f.Ub=function(t){Y(p(this.wc,this,t),0)},f.wc=function(t){this.$||(this.a.info("TRIDENT TEXT ("+this.B+"): "+t?"success":"failure"),V(this),this.F=t,this.b.la(this),this.b.H(sd))},f.nc=function(){md(this),this.b.la(this)},f.cancel=function(){this.$=!0,V(this)},f.zc=function(){this.ua=null;var t=q();0<=t-this.xb?(this.F&&this.a.J("Received watchdog timeout even though request loaded successfully"),this.a.info("TIMEOUT: "+this.w),2!=this.sa&&this.b.H(kd),V(this),this.q=2,W(),pd(this)):(this.a.Z("WatchDog timer called too early"),td(this,this.xb-t))},f.Ib=function(){return this.q},f=wd.prototype,f.v=null,f.A=null,f.Wa=!1,f.cc=null,f.La=null,f.rb=null,f.I=null,f.c=null,f.g=-1,f.L=null,f.va=null,f.S=function(t){this.v=t},f.ac=function(t){this.P=t},f.kb=function(t){this.I=t,t=xd(this.b,this.I),W(),this.cc=q();var e=this.b.Gb;null!=e?(this.L=this.b.correctHostPrefix(e[0]),(this.va=e[1])?(this.c=1,yd(this)):(this.c=2,zd(this))):(rb(t,"MODE","init"),this.A=new U(this,this.a,void 0,void 0,void 0),this.A.S(this.v),hd(this.A,t,!1,null,!0),this.c=0)},f.kc=function(t){if(t)this.c=2,zd(this);else{W();var e=this.b;e.a.debug("Test Connection Blocked"),e.g=e.V.g,Z(e,9)}t&&this.H(ld)},f.lb=function(t){return this.b.lb(t)},f.abort=function(){this.A&&(this.A.cancel(),this.A=null),this.g=-1},f.Lb=function(){return!1},f.Rb=function(t,e){if(this.g=t.g,0==this.c)if(this.a.debug("TestConnection: Got data for stage 1"),e){try{var n=this.P.parse(e)}catch(t){return Wb(this.a,t),void Dd(this.b,this)}this.L=this.b.correctHostPrefix(n[0]),this.va=n[1]}else this.a.debug("TestConnection: Null responseText"),Dd(this.b,this);else 2==this.c&&(this.Wa?(W(),this.rb=q()):"11111"==e?(W(),this.Wa=!0,this.La=q(),n=this.La-this.cc,(ed()||500>n)&&(this.g=200,this.A.cancel(),this.a.debug("Test connection succeeded; using streaming connection"),W(),Bd(this.b,this,!0))):(W(),this.La=this.rb=q(),this.Wa=!1))},f.la=function(){if(this.g=this.A.g,this.A.F){if(0==this.c)this.a.debug("TestConnection: request complete for initial check"),this.va?(this.c=1,yd(this)):(this.c=2,zd(this));else if(2==this.c){this.a.debug("TestConnection: request complete for stage 2");(ed()?this.Wa:!(200>this.rb-this.La))?(this.a.debug("Test connection succeeded; using streaming connection"),W(),Bd(this.b,this,!0)):(this.a.debug("Test connection failed; not using streaming"),W(),Bd(this.b,this,!1))}}else this.a.debug("TestConnection: request failed, in state "+this.c),0==this.c?W():2==this.c&&W(),Dd(this.b,this)},f.$a=function(){return this.b.$a()},f.isActive=function(){return this.b.isActive()},f.H=function(t){this.b.H(t)},f=Ed.prototype,f.v=null,f.xa=null,f.p=null,f.i=null,f.I=null,f.Ma=null,f.zb=null,f.L=null,f.hc=!0,f.Ba=0,f.sc=0,f.Ka=!1,f.e=null,f.G=null,f.M=null,f.aa=null,f.V=null,f.wb=null,f.gc=!0,f.za=-1,f.Nb=-1,f.g=-1,f.ba=0,f.ha=0,f.ic=5e3,f.Cc=1e4,f.pb=2,f.Hb=2e4,f.ma=0,f.ab=!1,f.ia=8;var Fd=1,Hd=new R;function Id(t){Q.call(this,"statevent",t)}function Jd(t,e){Q.call(this,"timingevent",t),this.size=e}s(Id,Q),s(Jd,Q);var jd=1,ld=2,kd=3,sd=4;function Kd(t){Q.call(this,"serverreachability",t)}s(Kd,Q);var Xb="y2f%",$,Yd;function Md(t){t.V&&(t.V.abort(),t.V=null),t.i&&(t.i.cancel(),t.i=null),t.M&&(l.clearTimeout(t.M),t.M=null),Pd(t),t.p&&(t.p.cancel(),t.p=null),t.G&&(l.clearTimeout(t.G),t.G=null)}function Qd(t){t.p||t.G||(t.G=Y(p(t.Tb,t),0),t.ba=0)}function Sd(t,e){var n,r;e?6<t.ia?(t.t=t.Q.concat(t.t),t.Q.length=0,n=t.Ba-1,r=Rd(t)):(n=e.B,r=e.X):(n=t.Ba++,r=Rd(t));var i=t.Ma.n();G(i,"SID",t.Y),G(i,"RID",n),G(i,"AID",t.za),Nd(t,i),(n=new U(t,t.a,t.Y,n,t.ba+1)).S(t.v),n.setTimeout(Math.round(.5*t.Hb)+Math.round(.5*t.Hb*Math.random())),t.p=n,fd(n,i,r)}function Nd(t,e){if(t.e){var n=t.e.getAdditionalParams(t);n&&D(n,function(t,n){G(e,n,t)})}}function Rd(t){var e,n=Math.min(t.t.length,1e3),r=["count="+n];6<t.ia&&0<n?(e=t.t[0].Ob,r.push("ofs="+e)):e=0;for(var i=0;i<n;i++){var o=t.t[i].Ob,s=t.t[i].map;o=6>=t.ia?i:o-e;try{D(s,function(t,e){r.push("req"+o+"_"+e+"="+encodeURIComponent(t))})}catch(e){r.push("req"+o+"_type="+encodeURIComponent("_badmap")),t.e&&t.e.badMapError(t,s)}}return t.Q=t.Q.concat(t.t.splice(0,n)),r.join("&")}function Td(t){t.i||t.M||(t.yb=1,t.M=Y(p(t.Sb,t),0),t.ha=0)}function Ud(t){return t.i||t.M?(t.a.J("Request already in progress"),!1):!(3<=t.ha)&&(t.a.debug("Going to retry GET"),t.yb++,t.M=Y(p(t.Sb,t),Vd(t,t.ha)),t.ha++,!0)}function Ld(t){if(t.e){var e=t.e.okToMakeRequest(t);if(0!=e)return t.a.debug("Handler returned error code from okToMakeRequest"),Z(t,e),!1}return!0}function Bd(t,e,n){t.a.debug("Test Connection Finished"),t.wb=t.gc&&n,t.g=e.g,t.a.debug("connectChannel_()"),t.lc(Fd,0),t.Ma=xd(t,t.I),Qd(t)}function Dd(t,e){t.a.debug("Test Connection Failed"),t.g=e.g,Z(t,2)}function Pd(t){null!=t.aa&&(l.clearTimeout(t.aa),t.aa=null)}function Vd(t,e){var n=t.ic+Math.floor(Math.random()*t.Cc);return t.isActive()||(t.a.debug("Inactive channel"),n*=2),n*e}function Z(t,e){if(t.a.info("Error code "+e),2==e||9==e){var n=null;t.e&&(n=t.e.getNetworkTestImageUri(t));var r=p(t.Fc,t);n||H(n=new E("//www.google.com/images/cleardot.gif")),vd(n.toString(),1e4,r)}else W();Wd(t,e)}function Wd(t,e){t.a.debug("HttpChannel: error - "+e),t.c=0,t.e&&t.e.channelError(t,e),Od(t),Md(t)}function Od(t){if(t.c=0,t.g=-1,t.e)if(0==t.Q.length&&0==t.t.length)t.e.channelClosed(t);else{t.a.debug("Number of undelivered maps, pending: "+t.Q.length+", outgoing: "+t.t.length);var e=bb(t.Q),n=bb(t.t);t.Q.length=0,t.t.length=0,t.e.channelClosed(t,e,n)}}function xd(t,e){var n=Ad(t,null,e);return t.a.debug("GetForwardChannelUri: "+n),n}function Cd(t,e,n){return e=Ad(t,t.$a()?e:null,n),t.a.debug("GetBackChannelUri: "+e),e}function Ad(t,e,n){if(""!=(i=tb(n)).ja)e&&gb(i,e+"."+i.ja),hb(i,i.Ca);else var r=window.location,i=ub(r.protocol,e?e+"."+r.hostname:r.hostname,r.port,n);return t.xa&&D(t.xa,function(t,e){G(i,e,t)}),G(i,"VER",t.ia),Nd(t,i),i}function Y(t,e){if(!fa(t))throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){t()},e)}function W(){Hd.dispatchEvent(new Id(Hd))}function Xd(){}f=Ed.prototype,f.kb=function(t,e,n,r,i){this.a.debug("connect()"),W(),this.I=e,this.xa=n||{},r&&void 0!==i&&(this.xa.OSID=r,this.xa.OAID=i),this.a.debug("connectTest_()"),Ld(this)&&(this.V=new wd(this,this.a),this.V.S(this.v),this.V.ac(this.P),this.V.kb(t))},f.disconnect=function(){if(this.a.debug("disconnect()"),Md(this),3==this.c){var t=this.Ba++,e=this.Ma.n();G(e,"SID",this.Y),G(e,"RID",t),G(e,"TYPE","terminate"),Nd(this,e),(t=new U(this,this.a,this.Y,t,void 0)).sa=2,t.U=H(e.n()),(e=new Image).src=t.U,e.onload=e.onerror=p(t.nc,t),t.Da=q(),id(t)}Od(this)},f.S=function(t){this.v=t},f.bc=function(t){this.ma=t},f.Lb=function(){return 0==this.c},f.ac=function(t){this.P=t},f.Tb=function(t){if(this.G=null,this.a.debug("startForwardChannel_"),Ld(this))if(this.c==Fd)if(t)this.a.J("Not supposed to retry the open");else{this.a.debug("open_()"),this.Ba=Math.floor(1e5*Math.random()),t=this.Ba++;var e=new U(this,this.a,"",t,void 0);e.S(this.v);var n=Rd(this),r=this.Ma.n();G(r,"RID",t),this.Bb&&G(r,"CVER",this.Bb),Nd(this,r),fd(e,r,n),this.p=e,this.c=2}else 3==this.c&&(t?Sd(this,t):0==this.t.length?this.a.debug("startForwardChannel_ returned: nothing to send"):this.p?this.a.J("startForwardChannel_ returned: connection already in progress"):(Sd(this),this.a.debug("startForwardChannel_ finished, sent request")))},f.Sb=function(){if(this.M=null,Ld(this)){this.a.debug("Creating new HttpRequest"),this.i=new U(this,this.a,this.Y,"rpc",this.yb),this.i.S(this.v),this.i.bc(this.ma);var t=this.zb.n();if(G(t,"RID","rpc"),G(t,"SID",this.Y),G(t,"CI",this.wb?"0":"1"),G(t,"AID",this.za),Nd(this,t),ed())G(t,"TYPE","xmlhttp"),hd(this.i,t,!0,this.L,!1);else{G(t,"TYPE","html");var e=this.i,n=Boolean(this.L);e.sa=3,e.U=H(t.n()),rd(e,n)}this.a.debug("New Request created")}},f.Rb=function(t,e){if(0!=this.c&&(this.i==t||this.p==t))if(this.g=t.g,this.p==t&&3==this.c)if(7<this.ia){var n;try{n=this.P.parse(e)}catch(t){n=null}if(m(n)&&3==n.length)if(0==(r=n)[0])t:if(this.a.debug("Server claims our backchannel is missing."),this.M)this.a.debug("But we are currently starting the request.");else{if(this.i){if(!(this.i.Da+3e3<this.p.Da))break t;Pd(this),this.i.cancel(),this.i=null}else this.a.Z("We do not have a BackChannel established");Ud(this),W()}else this.Nb=r[1],0<(n=this.Nb-this.za)&&(r=r[2],this.a.debug(r+" bytes (in "+n+" arrays) are outstanding on the BackChannel"),37500>r&&this.wb&&0==this.ha&&!this.aa&&(this.aa=Y(p(this.tc,this),6e3)));else this.a.debug("Bad POST response data returned"),Z(this,11)}else e!=Xb&&(this.a.debug("Bad data returned - missing/invald magic cookie"),Z(this,11));else if(this.i==t&&Pd(this),!/^[\s\xa0]*$/.test(e)){n=this.P.parse(e);for(var r=this.e&&this.e.channelHandleMultipleArrays?[]:null,i=0;i<n.length;i++){var o=n[i];this.za=o[0],o=o[1],2==this.c?"c"==o[0]?(this.Y=o[1],this.L=this.correctHostPrefix(o[2]),o=o[3],this.ia=null!=o?o:6,this.c=3,this.e&&this.e.channelOpened(this),this.zb=Cd(this,this.L,this.I),Td(this)):"stop"==o[0]&&Z(this,7):3==this.c&&("stop"==o[0]?(r&&0!=r.length&&(this.e.channelHandleMultipleArrays(this,r),r.length=0),Z(this,7)):"noop"!=o[0]&&(r?r.push(o):this.e&&this.e.channelHandleArray(this,o)),this.ha=0)}r&&0!=r.length&&this.e.channelHandleMultipleArrays(this,r)}},f.correctHostPrefix=function(t){return this.hc?this.e?this.e.correctHostPrefix(t):t:null},f.tc=function(){null!=this.aa&&(this.aa=null,this.i.cancel(),this.i=null,Ud(this),W())},f.la=function(t){var e;if(this.a.debug("Request complete"),this.i==t)Pd(this),this.i=null,e=2;else{if(this.p!=t)return;this.p=null,e=1}if(this.g=t.g,0!=this.c)if(t.F)1==e?(q(),Hd.dispatchEvent(new Jd(Hd,t.X?t.X.length:0)),Qd(this),this.Q.length=0):Td(this);else{var n=t.Ib();if(3==n||7==n||0==n&&0<this.g)this.a.debug("Not retrying due to error type");else{var r;if(this.a.debug("Maybe retrying, last error: "+ad(n,this.g)),(r=1==e)&&(this.p||this.G?(this.a.J("Request already in progress"),r=!1):this.c==Fd||this.ba>=(this.Ka?0:this.pb)?r=!1:(this.a.debug("Going to retry POST"),this.G=Y(p(this.Tb,this,t),Vd(this,this.ba)),this.ba++,r=!0)),r||2==e&&Ud(this))return;this.a.debug("Exceeded max number of retries")}switch(this.a.debug("Error: HTTP request failed"),n){case 1:Z(this,5);break;case 4:Z(this,10);break;case 3:Z(this,6);break;case 7:Z(this,12);break;default:Z(this,2)}}},f.lc=function(t){if(!(0<=Xa(arguments,this.c)))throw Error("Unexpected channel state: "+this.c)},f.Fc=function(t){t?(this.a.info("Successfully pinged google.com"),W()):(this.a.info("Failed to ping google.com"),W(),Wd(this,8))},f.lb=function(t){if(t&&!this.ab)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Ic).dc=this.ab,t},f.isActive=function(){return!!this.e&&this.e.isActive(this)},f.H=function(){Hd.dispatchEvent(new Kd(Hd))},f.$a=function(){return this.ab||!ed()},f=Xd.prototype,f.channelHandleMultipleArrays=null,f.okToMakeRequest=function(){return 0},f.channelOpened=function(){},f.channelHandleArray=function(){},f.channelError=function(){},f.channelClosed=function(){},f.getAdditionalParams=function(){return{}},f.getNetworkTestImageUri=function(){return null},f.isActive=function(){return!0},f.badMapError=function(){},f.correctHostPrefix=function(t){return t},Yd={0:"Ok",4:"User is logging out",6:"Unknown session ID",7:"Stopped by server",8:"General network error",2:"Request failed",9:"Blocked by a network administrator",5:"No data from server",10:"Got bad data from the server",11:"Got a bad response from the server"},$=function(t,e){var n,r,i,o,s,a,u,c,h,p,f,d,v,g;if(!(this instanceof $))return new $(t,e);p=this,t||(t="channel"),t.match(/:\/\//)&&t.replace(/^ws/,"http"),e||(e={}),m(e||"string"==typeof e)&&(e={}),c=e.reconnectTime||3e3,n=e.extraHeaders||null,r=e.extraParams||null,null!==e.affinity&&(r||(r={}),e.affinityParam||(e.affinityParam="a"),this.affinity=e.affinity||sa(),r[e.affinityParam]=this.affinity),(v=function(t){p.readyState=p.readyState=t})(this.CLOSED),d=null,a=null!=(g=e.prev)?g.Ec:void 0,i=function(t,e,n,r,i){try{return"function"==typeof p[t]?p[t](n,r,i):void 0}catch(t){throw"undefined"!=typeof console&&null!==console&&console.error(t.stack),t}},(o=new Xd).channelOpened=function(){return a=d,v($.OPEN),i("onopen")},s=null,o.channelError=function(t,e){var n;return n=Yd[e],s=e,p.readyState!==$.CLOSED&&v($.hb),i("onerror",0,n,e)},h=null,o.channelClosed=function(t,n,r){var o;if(p.readyState!==$.CLOSED)return d=null,t=s?Yd[s]:"Closed",v($.CLOSED),e.reconnect&&7!==s&&0!==s&&(o=6===s?0:c,clearTimeout(h),h=setTimeout(u,o)),i("onclose",0,t,n,r),s=null},o.channelHandleArray=function(t,e){return i("onmessage",0,{type:"message",data:e})},u=function(){if(d)throw Error("Reconnect() called from invalid state");if(v($.CONNECTING),i("onconnecting"),clearTimeout(h),p.Ec=d=new Ed(e.appVersion,null!=a?a.Gb:void 0),e.crossDomainXhr&&(d.ab=!0),d.e=o,n&&d.S(n),s=null,e.failFast){var u=d;u.Ka=!0,u.a.info("setFailFast: true"),(u.p||u.G)&&u.ba>(u.Ka?0:u.pb)&&(u.a.info("Retry count "+u.ba+" > new maxRetries "+(u.Ka?0:u.pb)+". Fail immediately!"),u.p?(u.p.cancel(),u.la(u.p)):(l.clearTimeout(u.G),u.G=null,Z(u,2)))}return d.kb(t+"/test",t+"/bind",r,null!=a?a.Y:void 0,null!=a?a.za:void 0)},this.open=function(){if(p.readyState!==p.CLOSED)throw Error("Already open");return u()},this.close=function(){if(clearTimeout(h),s=0,p.readyState!==$.CLOSED)return v($.hb),d.disconnect()},this.sendMap=f=function(t){var e;if((e=p.readyState)!==$.hb&&e!==$.CLOSED){if(0==(e=d).c)throw Error("Invalid operation: sending map when state is closed");1e3==e.t.length&&e.a.J("Already have 1000 queued maps upon queueing "+yb(t)),e.t.push(new Gd(e.sc++,t)),2!=e.c&&3!=e.c||Qd(e)}},this.send=function(t){return f("string"==typeof t?{_S:t}:{JSON:yb(t)})},u()},$.prototype.canSendWhileConnecting=$.canSendWhileConnecting=!0,$.prototype.canSendJSON=$.canSendJSON=!0,$.prototype.CONNECTING=$.CONNECTING=$.CONNECTING=0,$.prototype.OPEN=$.OPEN=$.OPEN=1,$.prototype.CLOSING=$.CLOSING=$.hb=2,$.prototype.CLOSED=$.CLOSED=$.CLOSED=3,(null!=_$bcsocketUncompressed_2?_$bcsocketUncompressed_2:window).BCSocket=$}();var _$Socket_50=Socket,BCSocket=_$bcsocketUncompressed_2.BCSocket;function Socket(t){this._options=t,this._messageQueue=[],this._connectedOnce=!1,this._attemptNum=0,this._url=getWebSocketURL(t),supportWebSockets()&&!t.browserChannelOnly?this._createWebSocket():this._createBrowserChannel()}function getRandom(t,e){return Math.random()*(e-t)+t}function supportWebSockets(){return"WebSocket"in window&&2===window.WebSocket.CLOSING}function getWebSocketURL(t){var e;window.location&&window.location.port&&(e=":"+window.location.port);var n=t.srvPort,r=t.srvSecurePort,i=t.srvHost||window.location.hostname,o="https:"===(t.srvProtocol||window.location.protocol)?"wss:":"ws:";return"ws:"===o&&n?e=":"+n:"wss:"===o&&r&&(e=":"+r),o+"//"+i+(e||"")+t.base}Socket.prototype._createWebSocket=function(){this._type="websocket",this._socket=new WebSocket(this._url),this.open=this._createWebSocket.bind(this),this._syncState(),this._socket.onmessage=this._ws_onmessage.bind(this),this._socket.onopen=this._ws_onopen.bind(this),this._socket.onclose=this._ws_onclose.bind(this)},Socket.prototype._createBrowserChannel=function(){this._type="browserchannel",this._socket=BCSocket(this._options.base,this._options),this.open=this._createBrowserChannel.bind(this),this._syncState(),this._socket.onmessage=this._bc_onmessage.bind(this),this._socket.onopen=this._bc_onopen.bind(this),this._socket.onclose=this._bc_onclose.bind(this)},Socket.prototype._ws_onmessage=function(t){this._syncState(),t.data=JSON.parse(t.data),this.onmessage&&this.onmessage(t)},Socket.prototype._ws_onopen=function(t){this._attemptNum=0,this._connectedOnce=!0,this._syncState(),this._flushQueue(),this.onopen&&this.onopen(t)},Socket.prototype._ws_onclose=function(t){if(this._syncState(),console.log("WebSocket: connection is broken",t),this.onclose&&this.onclose(t),!this._connectedOnce)return this._createBrowserChannel();var e=this;this._options.reconnect&&!t.wasClean&&setTimeout(function(){e.readyState===e.CLOSED&&e._createWebSocket()},this._getTimeout()),this._attemptNum++},Socket.prototype._getTimeout=function(){var t=this._options.timeout+this._options.timeoutIncrement*this._attemptNum;return getRandom(t/3,t)},Socket.prototype._bc_onmessage=function(t){this._syncState(),this.onmessage&&this.onmessage(t)},Socket.prototype._bc_onopen=function(t){this._syncState(),this.onopen&&this.onopen(t)},Socket.prototype._bc_onclose=function(t){this._syncState(),this.onclose&&this.onclose(t)},Socket.prototype._flushQueue=function(){for(;0!==this._messageQueue.length;){var t=this._messageQueue.shift();this._send(t)}},Socket.prototype._send=function(t){"websocket"===this._type&&"string"!=typeof t&&(t=JSON.stringify(t)),this._socket.send(t)},Socket.prototype.send=function(t){"websocket"===this._type?this._socket.readyState===WebSocket.OPEN&&0===this._messageQueue.length?this._send(t):this._messageQueue.push(t):this._send(t)},Socket.prototype.close=function(){this._socket.close()},Socket.prototype._syncState=function(){this.readyState=this._socket.readyState},Socket.prototype.reconnect=function(){"websocket"===this._type&&this.readyState===this.CLOSED&&this._createWebSocket()},Socket.prototype.canSendWhileConnecting=!0,Socket.prototype.canSendJSON=!0,Socket.prototype.CONNECTING=0,Socket.prototype.OPEN=1,Socket.prototype.CLOSING=2,Socket.prototype.CLOSED=3;var _$browser_49={},CLIENT_OPTIONS=JSON.parse('{"base":"/channel","reconnect":true,"browserChannelOnly":false,"timeout":10000,"timeoutIncrement":10000}');_$lib_racer.Model.prototype._createSocket=function(t){return new _$Socket_50(CLIENT_OPTIONS)};var _$utils_94={},toString={}.toString;function paramsEqual(t,e){return!Object.keys(t).some(function(n){return t[n]!=e[n]})}function acceptParams(t,e){for(var n=t.split(/ *; */),r={value:n[0],quality:1,params:{},originalIndex:e},i=1;i<n.length;++i){var o=n[i].split(/ *= */);"q"==o[0]?r.quality=parseFloat(o[1]):r.params[o[0]]=o[1]}return r}_$utils_94.etag=function(t){return'"'+crc32.signed(t)+'"'},_$utils_94.locals=function(t){return function t(e){for(var n in e)t[n]=e[n];return e}},_$utils_94.isAbsolute=function(t){return"/"==t[0]||(":"==t[1]&&"\\"==t[2]||void 0)},_$utils_94.flatten=function(t,e){e=e||[];for(var n=t.length,r=0;r<n;++r)Array.isArray(t[r])?_$utils_94.flatten(t[r],e):e.push(t[r]);return e},_$utils_94.normalizeType=function(t){return~t.indexOf("/")?acceptParams(t):{value:mime.lookup(t),params:{}}},_$utils_94.normalizeTypes=function(t){for(var e=[],n=0;n<t.length;++n)e.push(_$utils_94.normalizeType(t[n]));return e},_$utils_94.acceptsArray=function(t,e){if(!e)return t[0];for(var n=_$utils_94.parseAccept(e),r=_$utils_94.normalizeTypes(t),i=n.length,o=0;o<i;++o)for(var s=0,a=t.length;s<a;++s)if(_$utils_94.accept(r[s],n[o]))return t[s]},_$utils_94.accepts=function(t,e){return"string"==typeof t&&(t=t.split(/ *, */)),_$utils_94.acceptsArray(t,e)},_$utils_94.accept=function(t,e){var n=t.value.split("/");return(n[0]==e.type||"*"==e.type)&&(n[1]==e.subtype||"*"==e.subtype)&&paramsEqual(t.params,e.params)},_$utils_94.parseAccept=function(t){return _$utils_94.parseParams(t).map(function(t){var e=t.value.split("/");return t.type=e[0],t.subtype=e[1],t})},_$utils_94.parseParams=function(t){return t.split(/ *, */).map(acceptParams).filter(function(t){return t.quality}).sort(function(t,e){return t.quality===e.quality?t.originalIndex-e.originalIndex:e.quality-t.quality})},_$utils_94.escape=function(t){return String(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},_$utils_94.pathRegexp=function(t,e,n,r){return"[object RegExp]"==toString.call(t)?t:(Array.isArray(t)&&(t="("+t.join("|")+")"),t=t.concat(r?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g,function(t,n,r,i,o,s,a){return e.push({name:i,optional:!!s}),n=n||"",(s?"":n)+"(?:"+(s?n:"")+(r||"")+(o||(r?"([^/.]+?)":"([^/]+?)"))+")"+(s||"")+(a?"(/*)?":"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),new RegExp("^"+t+"$",n?"":"i"))};var _$Route_93=Route;function Route(t,e,n,r){r=r||{},this.path=e,this.method=t,this.callbacks=n,this.regexp=_$utils_94.pathRegexp(e,this.keys=[],r.sensitive,r.strict)}Route.prototype.match=function(t){var e=this.keys,n=this.params=[],r=this.regexp.exec(t);if(!r)return!1;for(var i=1,o=r.length;i<o;++i){var s=e[i-1],a="string"==typeof r[i]?decodeURIComponent(r[i]):r[i];s?n[s.name]=a:n.push(a)}return!0};var has=Object.prototype.hasOwnProperty,__isArray_45=Array.isArray,hexTable=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),compactQueue=function(t){for(;t.length>1;){var e=t.pop(),n=e.obj[e.prop];if(__isArray_45(n)){for(var r=[],i=0;i<n.length;++i)void 0!==n[i]&&r.push(n[i]);e.obj[e.prop]=r}}},arrayToObject=function(t,e){for(var n=e&&e.plainObjects?Object.create(null):{},r=0;r<t.length;++r)void 0!==t[r]&&(n[r]=t[r]);return n},merge=function t(e,n,r){if(!n)return e;if("object"!=typeof n){if(__isArray_45(e))e.push(n);else{if(!e||"object"!=typeof e)return[e,n];(r&&(r.plainObjects||r.allowPrototypes)||!has.call(Object.prototype,n))&&(e[n]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(n);var i=e;return __isArray_45(e)&&!__isArray_45(n)&&(i=arrayToObject(e,r)),__isArray_45(e)&&__isArray_45(n)?(n.forEach(function(n,i){if(has.call(e,i)){var o=e[i];o&&"object"==typeof o&&n&&"object"==typeof n?e[i]=t(o,n,r):e.push(n)}else e[i]=n}),e):Object.keys(n).reduce(function(e,i){var o=n[i];return has.call(e,i)?e[i]=t(e[i],o,r):e[i]=o,e},i)},assign=function(t,e){return Object.keys(e).reduce(function(t,n){return t[n]=e[n],t},t)},decode=function(t,e,n){var r=t.replace(/\+/g," ");if("iso-8859-1"===n)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(t){return r}},encode=function(t,e,n){if(0===t.length)return t;var r=t;if("symbol"==typeof t?r=Symbol.prototype.toString.call(t):"string"!=typeof t&&(r=String(t)),"iso-8859-1"===n)return escape(r).replace(/%u[0-9a-f]{4}/gi,function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"});for(var i="",o=0;o<r.length;++o){var s=r.charCodeAt(o);45===s||46===s||95===s||126===s||s>=48&&s<=57||s>=65&&s<=90||s>=97&&s<=122?i+=r.charAt(o):s<128?i+=hexTable[s]:s<2048?i+=hexTable[192|s>>6]+hexTable[128|63&s]:s<55296||s>=57344?i+=hexTable[224|s>>12]+hexTable[128|s>>6&63]+hexTable[128|63&s]:(o+=1,s=65536+((1023&s)<<10|1023&r.charCodeAt(o)),i+=hexTable[240|s>>18]+hexTable[128|s>>12&63]+hexTable[128|s>>6&63]+hexTable[128|63&s])}return i},compact=function(t){for(var e=[{obj:{o:t},prop:"o"}],n=[],r=0;r<e.length;++r)for(var i=e[r],o=i.obj[i.prop],s=Object.keys(o),a=0;a<s.length;++a){var u=s[a],c=o[u];"object"==typeof c&&null!==c&&-1===n.indexOf(c)&&(e.push({obj:o,prop:u}),n.push(c))}return compactQueue(e),t},isRegExp=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},isBuffer=function(t){return!(!t||"object"!=typeof t)&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},combine=function(t,e){return[].concat(t,e)},_$utils_45={arrayToObject:arrayToObject,assign:assign,combine:combine,compact:compact,decode:decode,encode:encode,isBuffer:isBuffer,isRegExp:isRegExp,merge:merge},replace=String.prototype.replace,percentTwenties=/%20/g,Format={RFC1738:"RFC1738",RFC3986:"RFC3986"},_$formats_41=_$utils_45.assign({default:Format.RFC3986,formatters:{RFC1738:function(t){return replace.call(t,percentTwenties,"+")},RFC3986:function(t){return String(t)}}},Format),__has_44=Object.prototype.hasOwnProperty,arrayPrefixGenerators={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},__isArray_44=Array.isArray,push=Array.prototype.push,pushToArray=function(t,e){push.apply(t,__isArray_44(e)?e:[e])},toISO=Date.prototype.toISOString,defaultFormat=_$formats_41.default,defaults={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:_$utils_45.encode,encodeValuesOnly:!1,format:defaultFormat,formatter:_$formats_41.formatters[defaultFormat],indices:!1,serializeDate:function(t){return toISO.call(t)},skipNulls:!1,strictNullHandling:!1},isNonNullishPrimitive=function(t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t||"symbol"==typeof t||"bigint"==typeof t},stringify=function t(e,n,r,i,o,s,a,u,c,l,h,p,f){var d=e;if("function"==typeof a?d=a(n,d):d instanceof Date?d=l(d):"comma"===r&&__isArray_44(d)&&(d=d.join(",")),null===d){if(i)return s&&!p?s(n,defaults.encoder,f,"key"):n;d=""}if(isNonNullishPrimitive(d)||_$utils_45.isBuffer(d))return s?[h(p?n:s(n,defaults.encoder,f,"key"))+"="+h(s(d,defaults.encoder,f,"value"))]:[h(n)+"="+h(String(d))];var m,v=[];if(void 0===d)return v;if(__isArray_44(a))m=a;else{var g=Object.keys(d);m=u?g.sort(u):g}for(var y=0;y<m.length;++y){var _=m[y];o&&null===d[_]||(__isArray_44(d)?pushToArray(v,t(d[_],"function"==typeof r?r(n,_):n,r,i,o,s,a,u,c,l,h,p,f)):pushToArray(v,t(d[_],n+(c?"."+_:"["+_+"]"),r,i,o,s,a,u,c,l,h,p,f)))}return v},normalizeStringifyOptions=function(t){if(!t)return defaults;if(null!==t.encoder&&void 0!==t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||defaults.charset;if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=_$formats_41.default;if(void 0!==t.format){if(!__has_44.call(_$formats_41.formatters,t.format))throw new TypeError("Unknown format option provided.");n=t.format}var r=_$formats_41.formatters[n],i=defaults.filter;return("function"==typeof t.filter||__isArray_44(t.filter))&&(i=t.filter),{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:defaults.addQueryPrefix,allowDots:void 0===t.allowDots?defaults.allowDots:!!t.allowDots,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:defaults.charsetSentinel,delimiter:void 0===t.delimiter?defaults.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:defaults.encode,encoder:"function"==typeof t.encoder?t.encoder:defaults.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:defaults.encodeValuesOnly,filter:i,formatter:r,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:defaults.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:defaults.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:defaults.strictNullHandling}},_$stringify_44=function(t,e){var n,r=t,i=normalizeStringifyOptions(e);"function"==typeof i.filter?r=(0,i.filter)("",r):__isArray_44(i.filter)&&(n=i.filter);var o,s=[];if("object"!=typeof r||null===r)return"";o=e&&e.arrayFormat in arrayPrefixGenerators?e.arrayFormat:e&&"indices"in e?e.indices?"indices":"repeat":"indices";var a=arrayPrefixGenerators[o];n||(n=Object.keys(r)),i.sort&&n.sort(i.sort);for(var u=0;u<n.length;++u){var c=n[u];i.skipNulls&&null===r[c]||pushToArray(s,stringify(r[c],c,a,i.strictNullHandling,i.skipNulls,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.formatter,i.encodeValuesOnly,i.charset))}var l=s.join(i.delimiter),h=!0===i.addQueryPrefix?"?":"";return i.charsetSentinel&&("iso-8859-1"===i.charset?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),l.length>0?h+l:""},__has_43=Object.prototype.hasOwnProperty,__isArray_43=Array.isArray,__defaults_43={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:_$utils_45.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},interpretNumericEntities=function(t){return t.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},isoSentinel="utf8=%26%2310003%3B",charsetSentinel="utf8=%E2%9C%93",parseValues=function(t,e){var n,r={},i=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,o=e.parameterLimit===1/0?void 0:e.parameterLimit,s=i.split(e.delimiter,o),a=-1,u=e.charset;if(e.charsetSentinel)for(n=0;n<s.length;++n)0===s[n].indexOf("utf8=")&&(s[n]===charsetSentinel?u="utf-8":s[n]===isoSentinel&&(u="iso-8859-1"),a=n,n=s.length);for(n=0;n<s.length;++n)if(n!==a){var c,l,h=s[n],p=h.indexOf("]="),f=-1===p?h.indexOf("="):p+1;-1===f?(c=e.decoder(h,__defaults_43.decoder,u,"key"),l=e.strictNullHandling?null:""):(c=e.decoder(h.slice(0,f),__defaults_43.decoder,u,"key"),l=e.decoder(h.slice(f+1),__defaults_43.decoder,u,"value")),l&&e.interpretNumericEntities&&"iso-8859-1"===u&&(l=interpretNumericEntities(l)),l&&"string"==typeof l&&e.comma&&l.indexOf(",")>-1&&(l=l.split(",")),h.indexOf("[]=")>-1&&(l=__isArray_43(l)?[l]:l),__has_43.call(r,c)?r[c]=_$utils_45.combine(r[c],l):r[c]=l}return r},parseObject=function(t,e,n){for(var r=e,i=t.length-1;i>=0;--i){var o,s=t[i];if("[]"===s&&n.parseArrays)o=[].concat(r);else{o=n.plainObjects?Object.create(null):{};var a="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,u=parseInt(a,10);n.parseArrays||""!==a?!isNaN(u)&&s!==a&&String(u)===a&&u>=0&&n.parseArrays&&u<=n.arrayLimit?(o=[])[u]=r:o[a]=r:o={0:r}}r=o}return r},parseKeys=function(t,e,n){if(t){var r=n.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,i=/(\[[^[\]]*])/g,o=n.depth>0&&/(\[[^[\]]*])/.exec(r),s=o?r.slice(0,o.index):r,a=[];if(s){if(!n.plainObjects&&__has_43.call(Object.prototype,s)&&!n.allowPrototypes)return;a.push(s)}for(var u=0;n.depth>0&&null!==(o=i.exec(r))&&u<n.depth;){if(u+=1,!n.plainObjects&&__has_43.call(Object.prototype,o[1].slice(1,-1))&&!n.allowPrototypes)return;a.push(o[1])}return o&&a.push("["+r.slice(o.index)+"]"),parseObject(a,e,n)}},normalizeParseOptions=function(t){if(!t)return __defaults_43;if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new Error("The charset option must be either utf-8, iso-8859-1, or undefined");var e=void 0===t.charset?__defaults_43.charset:t.charset;return{allowDots:void 0===t.allowDots?__defaults_43.allowDots:!!t.allowDots,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:__defaults_43.allowPrototypes,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:__defaults_43.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:__defaults_43.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:__defaults_43.comma,decoder:"function"==typeof t.decoder?t.decoder:__defaults_43.decoder,delimiter:"string"==typeof t.delimiter||_$utils_45.isRegExp(t.delimiter)?t.delimiter:__defaults_43.delimiter,depth:"number"==typeof t.depth||!1===t.depth?+t.depth:__defaults_43.depth,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:__defaults_43.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:__defaults_43.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:__defaults_43.plainObjects,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:__defaults_43.strictNullHandling}},_$parse_43=function(t,e){var n=normalizeParseOptions(e);if(""===t||null==t)return n.plainObjects?Object.create(null):{};for(var r="string"==typeof t?parseValues(t,n):t,i=n.plainObjects?Object.create(null):{},o=Object.keys(r),s=0;s<o.length;++s){var a=o[s],u=parseKeys(a,r[a],n);i=_$utils_45.merge(i,u,n)}return _$utils_45.compact(i)},_$lib_42={formats:_$formats_41,parse:_$parse_43,stringify:_$stringify_44},_$punycode_40={exports:{}};(function(t){!function(e){var n="object"==typeof _$punycode_40.exports&&_$punycode_40.exports&&!_$punycode_40.exports.nodeType&&_$punycode_40.exports,r=_$punycode_40&&!_$punycode_40.nodeType&&_$punycode_40,i="object"==typeof t&&t;i.global!==i&&i.window!==i&&i.self!==i||(e=i);var o,s,a=2147483647,u=36,c=1,l=26,h=38,p=700,f=72,d=128,m="-",v=/^xn--/,g=/[^\x20-\x7E]/,y=/[\x2E\u3002\uFF0E\uFF61]/g,_={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},b=u-c,x=Math.floor,E=String.fromCharCode;function w(t){throw new RangeError(_[t])}function S(t,e){for(var n=t.length,r=[];n--;)r[n]=e(t[n]);return r}function C(t,e){var n=t.split("@"),r="";return n.length>1&&(r=n[0]+"@",t=n[1]),r+S((t=t.replace(y,".")).split("."),e).join(".")}function M(t){for(var e,n,r=[],i=0,o=t.length;i<o;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<o?56320==(64512&(n=t.charCodeAt(i++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),i--):r.push(e);return r}function T(t){return S(t,function(t){var e="";return t>65535&&(e+=E((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=E(t)}).join("")}function A(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function $(t,e,n){var r=0;for(t=n?x(t/p):t>>1,t+=x(t/e);t>b*l>>1;r+=u)t=x(t/b);return x(r+(b+1)*t/(t+h))}function k(t){var e,n,r,i,o,s,h,p,v,g,y,_=[],b=t.length,E=0,S=d,C=f;for((n=t.lastIndexOf(m))<0&&(n=0),r=0;r<n;++r)t.charCodeAt(r)>=128&&w("not-basic"),_.push(t.charCodeAt(r));for(i=n>0?n+1:0;i<b;){for(o=E,s=1,h=u;i>=b&&w("invalid-input"),((p=(y=t.charCodeAt(i++))-48<10?y-22:y-65<26?y-65:y-97<26?y-97:u)>=u||p>x((a-E)/s))&&w("overflow"),E+=p*s,!(p<(v=h<=C?c:h>=C+l?l:h-C));h+=u)s>x(a/(g=u-v))&&w("overflow"),s*=g;C=$(E-o,e=_.length+1,0==o),x(E/e)>a-S&&w("overflow"),S+=x(E/e),E%=e,_.splice(E++,0,S)}return T(_)}function D(t){var e,n,r,i,o,s,h,p,v,g,y,_,b,S,C,T=[];for(_=(t=M(t)).length,e=d,n=0,o=f,s=0;s<_;++s)(y=t[s])<128&&T.push(E(y));for(r=i=T.length,i&&T.push(m);r<_;){for(h=a,s=0;s<_;++s)(y=t[s])>=e&&y<h&&(h=y);for(h-e>x((a-n)/(b=r+1))&&w("overflow"),n+=(h-e)*b,e=h,s=0;s<_;++s)if((y=t[s])<e&&++n>a&&w("overflow"),y==e){for(p=n,v=u;!(p<(g=v<=o?c:v>=o+l?l:v-o));v+=u)C=p-g,S=u-g,T.push(E(A(g+C%S,0))),p=x(C/S);T.push(E(A(p,0))),o=$(n,b,r==i),n=0,++r}++n,++e}return T.join("")}if(o={version:"1.4.1",ucs2:{decode:M,encode:T},decode:k,encode:D,toASCII:function(t){return C(t,function(t){return g.test(t)?"xn--"+D(t):t})},toUnicode:function(t){return C(t,function(t){return v.test(t)?k(t.slice(4).toLowerCase()):t})}},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return o});else if(n&&r)if(_$punycode_40.exports==n)r.exports=o;else for(s in o)o.hasOwnProperty(s)&&(n[s]=o[s]);else e.punycode=o}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),_$punycode_40=_$punycode_40.exports;var _$util_96={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}};function hasOwnProperty(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var _$decode_46=function(t,e,n,r){e=e||"&",n=n||"=";var i={};if("string"!=typeof t||0===t.length)return i;var o=/\+/g;t=t.split(e);var s=1e3;r&&"number"==typeof r.maxKeys&&(s=r.maxKeys);var a=t.length;s>0&&a>s&&(a=s);for(var u=0;u<a;++u){var c,l,h,p,f=t[u].replace(o,"%20"),d=f.indexOf(n);d>=0?(c=f.substr(0,d),l=f.substr(d+1)):(c=f,l=""),h=decodeURIComponent(c),p=decodeURIComponent(l),hasOwnProperty(i,h)?__isArray_46(i[h])?i[h].push(p):i[h]=[i[h],p]:i[h]=p}return i},__isArray_46=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},stringifyPrimitive=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}},_$encode_47=function(t,e,n,r){return e=e||"&",n=n||"=",null===t&&(t=void 0),"object"==typeof t?map(__objectKeys_47(t),function(r){var i=encodeURIComponent(stringifyPrimitive(r))+n;return __isArray_47(t[r])?map(t[r],function(t){return i+encodeURIComponent(stringifyPrimitive(t))}).join(e):i+encodeURIComponent(stringifyPrimitive(t[r]))}).join(e):r?encodeURIComponent(stringifyPrimitive(r))+n+encodeURIComponent(stringifyPrimitive(t)):""},__isArray_47=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function map(t,e){if(t.map)return t.map(e);for(var n=[],r=0;r<t.length;r++)n.push(e(t[r],r));return n}var __objectKeys_47=Object.keys||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e},_$querystringEs3_48={};_$querystringEs3_48.decode=_$querystringEs3_48.parse=_$decode_46,_$querystringEs3_48.encode=_$querystringEs3_48.stringify=_$encode_47;var _$url_95={};function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}_$url_95.parse=urlParse,_$url_95.resolve=urlResolve,_$url_95.resolveObject=urlResolveObject,_$url_95.format=urlFormat,_$url_95.Url=Url;var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,delims=["<",">",'"',"`"," ","\r","\n","\t"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function urlParse(t,e,n){if(t&&_$util_96.isObject(t)&&t instanceof Url)return t;var r=new Url;return r.parse(t,e,n),r}function urlFormat(t){return _$util_96.isString(t)&&(t=urlParse(t)),t instanceof Url?t.format():Url.prototype.format.call(t)}function urlResolve(t,e){return urlParse(t,!1,!0).resolve(e)}function urlResolveObject(t,e){return t?urlParse(t,!1,!0).resolveObject(e):e}Url.prototype.parse=function(t,e,n){if(!_$util_96.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var r=t.indexOf("?"),i=-1!==r&&r<t.indexOf("#")?"?":"#",o=t.split(i);o[0]=o[0].replace(/\\/g,"/");var s=t=o.join(i);if(s=s.trim(),!n&&1===t.split("#").length){var a=simplePathPattern.exec(s);if(a)return this.path=s,this.href=s,this.pathname=a[1],a[2]?(this.search=a[2],this.query=e?_$querystringEs3_48.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var u=protocolPattern.exec(s);if(u){var c=(u=u[0]).toLowerCase();this.protocol=c,s=s.substr(u.length)}if(n||u||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var l="//"===s.substr(0,2);!l||u&&hostlessProtocol[u]||(s=s.substr(2),this.slashes=!0)}if(!hostlessProtocol[u]&&(l||u&&!slashedProtocol[u])){for(var h,p,f=-1,d=0;d<hostEndingChars.length;d++){-1!==(m=s.indexOf(hostEndingChars[d]))&&(-1===f||m<f)&&(f=m)}-1!==(p=-1===f?s.lastIndexOf("@"):s.lastIndexOf("@",f))&&(h=s.slice(0,p),s=s.slice(p+1),this.auth=decodeURIComponent(h)),f=-1;for(d=0;d<nonHostChars.length;d++){var m;-1!==(m=s.indexOf(nonHostChars[d]))&&(-1===f||m<f)&&(f=m)}-1===f&&(f=s.length),this.host=s.slice(0,f),s=s.slice(f),this.parseHost(),this.hostname=this.hostname||"";var v="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!v)for(var g=this.hostname.split(/\./),y=(d=0,g.length);d<y;d++){var _=g[d];if(_&&!_.match(hostnamePartPattern)){for(var b="",x=0,E=_.length;x<E;x++)_.charCodeAt(x)>127?b+="x":b+=_[x];if(!b.match(hostnamePartPattern)){var w=g.slice(0,d),S=g.slice(d+1),C=_.match(hostnamePartStart);C&&(w.push(C[1]),S.unshift(C[2])),S.length&&(s="/"+S.join(".")+s),this.hostname=w.join(".");break}}}this.hostname.length>hostnameMaxLen?this.hostname="":this.hostname=this.hostname.toLowerCase(),v||(this.hostname=_$punycode_40.toASCII(this.hostname));var M=this.port?":"+this.port:"",T=this.hostname||"";this.host=T+M,this.href+=this.host,v&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!unsafeProtocol[c])for(d=0,y=autoEscape.length;d<y;d++){var A=autoEscape[d];if(-1!==s.indexOf(A)){var $=encodeURIComponent(A);$===A&&($=escape(A)),s=s.split(A).join($)}}var k=s.indexOf("#");-1!==k&&(this.hash=s.substr(k),s=s.slice(0,k));var D=s.indexOf("?");if(-1!==D?(this.search=s.substr(D),this.query=s.substr(D+1),e&&(this.query=_$querystringEs3_48.parse(this.query)),s=s.slice(0,D)):e&&(this.search="",this.query={}),s&&(this.pathname=s),slashedProtocol[c]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){M=this.pathname||"";var R=this.search||"";this.path=M+R}return this.href=this.format(),this},Url.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",n=this.pathname||"",r=this.hash||"",i=!1,o="";this.host?i=t+this.host:this.hostname&&(i=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&_$util_96.isObject(this.query)&&Object.keys(this.query).length&&(o=_$querystringEs3_48.stringify(this.query));var s=this.search||o&&"?"+o||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||slashedProtocol[e])&&!1!==i?(i="//"+(i||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):i||(i=""),r&&"#"!==r.charAt(0)&&(r="#"+r),s&&"?"!==s.charAt(0)&&(s="?"+s),e+i+(n=n.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(s=s.replace("#","%23"))+r},Url.prototype.resolve=function(t){return this.resolveObject(urlParse(t,!1,!0)).format()},Url.prototype.resolveObject=function(t){if(_$util_96.isString(t)){var e=new Url;e.parse(t,!1,!0),t=e}for(var n=new Url,r=Object.keys(this),i=0;i<r.length;i++){var o=r[i];n[o]=this[o]}if(n.hash=t.hash,""===t.href)return n.href=n.format(),n;if(t.slashes&&!t.protocol){for(var s=Object.keys(t),a=0;a<s.length;a++){var u=s[a];"protocol"!==u&&(n[u]=t[u])}return slashedProtocol[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(t.protocol&&t.protocol!==n.protocol){if(!slashedProtocol[t.protocol]){for(var c=Object.keys(t),l=0;l<c.length;l++){var h=c[l];n[h]=t[h]}return n.href=n.format(),n}if(n.protocol=t.protocol,t.host||hostlessProtocol[t.protocol])n.pathname=t.pathname;else{for(var p=(t.pathname||"").split("/");p.length&&!(t.host=p.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),n.pathname=p.join("/")}if(n.search=t.search,n.query=t.query,n.host=t.host||"",n.auth=t.auth,n.hostname=t.hostname||t.host,n.port=t.port,n.pathname||n.search){var f=n.pathname||"",d=n.search||"";n.path=f+d}return n.slashes=n.slashes||t.slashes,n.href=n.format(),n}var m=n.pathname&&"/"===n.pathname.charAt(0),v=t.host||t.pathname&&"/"===t.pathname.charAt(0),g=v||m||n.host&&t.pathname,y=g,_=n.pathname&&n.pathname.split("/")||[],b=(p=t.pathname&&t.pathname.split("/")||[],n.protocol&&!slashedProtocol[n.protocol]);if(b&&(n.hostname="",n.port=null,n.host&&(""===_[0]?_[0]=n.host:_.unshift(n.host)),n.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===p[0]?p[0]=t.host:p.unshift(t.host)),t.host=null),g=g&&(""===p[0]||""===_[0])),v)n.host=t.host||""===t.host?t.host:n.host,n.hostname=t.hostname||""===t.hostname?t.hostname:n.hostname,n.search=t.search,n.query=t.query,_=p;else if(p.length)_||(_=[]),_.pop(),_=_.concat(p),n.search=t.search,n.query=t.query;else if(!_$util_96.isNullOrUndefined(t.search)){if(b)n.hostname=n.host=_.shift(),(C=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=C.shift(),n.host=n.hostname=C.shift());return n.search=t.search,n.query=t.query,_$util_96.isNull(n.pathname)&&_$util_96.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!_.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var x=_.slice(-1)[0],E=(n.host||t.host||_.length>1)&&("."===x||".."===x)||""===x,w=0,S=_.length;S>=0;S--)"."===(x=_[S])?_.splice(S,1):".."===x?(_.splice(S,1),w++):w&&(_.splice(S,1),w--);if(!g&&!y)for(;w--;w)_.unshift("..");!g||""===_[0]||_[0]&&"/"===_[0].charAt(0)||_.unshift(""),E&&"/"!==_.join("/").substr(-1)&&_.push("");var C,M=""===_[0]||_[0]&&"/"===_[0].charAt(0);b&&(n.hostname=n.host=M?"":_.length?_.shift():"",(C=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=C.shift(),n.host=n.hostname=C.shift()));return(g=g||n.host&&_.length)&&!M&&_.unshift(""),_.length?n.pathname=_.join("/"):(n.pathname=null,n.path=null),_$util_96.isNull(n.pathname)&&_$util_96.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=t.auth||n.auth,n.slashes=n.slashes||t.slashes,n.href=n.format(),n},Url.prototype.parseHost=function(){var t=this.host,e=portPattern.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)};var _$router_92={render:render,isTransitional:isTransitional,mapRoute:mapRoute};function isTransitional(t){return t.hasOwnProperty("from")&&t.hasOwnProperty("to")}function mapRoute(t,e){var n=~(r=e.url.indexOf("?"))?e.url.slice(r):"",r=0;return t.replace(/\/(?:(?:\:([^?\/:*(]+)(?:\([^)]+\))?)|\*)(\?)?/g,function(t,n,i){var o=n?e[n]:e[r++];return i&&null==o?"":"/"+encodeURIComponent(o)})+n}function render(t,e,n){var r=new RenderReq(t.app.page,t.routes,e,n);r.routeTransitional(0,function(){r.page=t.page(),r.routeQueue(0,function(){r.cancel()})})}function RenderReq(t,e,n,r){this.page=t,this.options=n,this.e=r,this.setUrl(n.url.replace(/#.*/,""));var i=_$url_95.parse(this.url).query;this.query=i?_$lib_42.parse(i):{},this.method=n.method,this.body=n.body||{},this.setPrevious(n.previous),this.transitional=e.transitional[this.method],this.queue=e.queue[this.method],this.app=e.app}RenderReq.prototype.cancel=function(){var t=this.options;this.e||t.noNavigate||(t.form?(t.form.setAttribute("data-router-ignore",""),t.form.submit()):window.location.assign(t.url))},RenderReq.prototype.setUrl=function(t){this.url=t,this.path=t.replace(/\?.*/,"")},RenderReq.prototype.setPrevious=function(t){this.previous=t,this.previousPath=t&&t.replace(/\?.*/,"")},RenderReq.prototype.routeTransitional=function(t,e){var n;for(t||(t=0);n=this.transitional[t++];){if(n.to.match(this.path)&&n.from.match(this.previousPath)){var r=this,i=this.routeParams(n.to);return void this.onMatch(n.to,i,function(n){if(n)return r.cancel();r.routeTransitional(t,e)},o)}function o(){}}e()},RenderReq.prototype.routeQueue=function(t,e){var n;for(t||(t=0);n=this.queue[t++];)if(n.match(this.path)){var r=this,i=this.routeParams(n);return void this.onMatch(n,i,function(n){if(n)return r.cancel();r.routeQueue(t,e)})}e()},RenderReq.prototype.onMatch=function(t,e,n,r){if(!this.page)return n();this.e&&(this.e.preventDefault(),this.e=null),this.page.params=e,t.isTransitional?this.app.onRoute(t.callbacks,this.page,n,r):this.app.onRoute(t.callbacks,this.page,n)},RenderReq.prototype.routeParams=function(t){var e=t.params,n=e.slice();for(var r in e)n[r]=e[r];return n.previous=this.previous,n.url=this.url,n.body=this.body,n.query=this.query,n.method=this.method,n};var parseUrl=_$url_95.parse,resolveUrl=_$url_95.resolve,currentPath=window.location.pathname+window.location.search;window.history.replaceState&&window.history.replaceState({$render:!0,$method:"get"},null,window.location.href);var _$History_90=History;function History(t,e){this.app=t,this.routes=e,window.history.pushState?addListeners(this):(this.push=function(t){window.location.assign(t)},this.replace=function(t){window.location.replace(t)})}function routePath(t){var e=parseUrl(t);return e&&e.protocol===window.location.protocol&&e.host===window.location.host&&e.pathname+(e.search||"")}function renderOptions(t,e){if(t&&"submit"===t.type){for(var n,r=t.target,i=r.elements,o=[],s=0,a=i.length;s<a;s++){var u=(n=i[s]).name;if(u){var c=n.value;if(o.push(encodeURIComponent(u)+"="+encodeURIComponent(c)),"_method"===u){var l=c.toLowerCase();"delete"===l&&(l="del")}}}if(o=o.join("&"),"post"===r.method.toLowerCase())var h=l||"post",p=_$lib_42.parse(o);else h="get",e+="?"+o}else h="get";return{method:h,url:e,previous:window.location.pathname+window.location.search,body:p,form:r,link:t&&t._tracksLink}}function addListeners(t){document.addEventListener("click",function(e){var n=e.target;if(!e.metaKey&&1===e.which&&!e.defaultPrevented)for(;n;){var r=n.href;if(r){if(n.hasAttribute&&n.hasAttribute("data-router-ignore"))return;if(n.target&&"_self"!==n.target)return;var i=r.indexOf("#");if(~i&&r.slice(0,i)===window.location.href.replace(/#.*/,""))return;return e._tracksLink=n,void t.push(r,!0,null,e)}n=n.parentNode}},!0),document.addEventListener("submit",function(e){var n=e.target;if(!e.defaultPrevented&&"form"===n.tagName.toLowerCase()&&!("multipart/form-data"===n.enctype||n.hasAttribute&&n.hasAttribute("data-router-ignore"))){var r=n.action||window.location.href;t.push(r,!0,null,e)}},!1),window.addEventListener("popstate",function(e){if(t.app.page){var n=currentPath,r=e.state,i={previous:n,url:currentPath=window.location.pathname+window.location.search};if(r){if(!r.$render)return;return i.method=r.$method,_$router_92.render(t,i)}var o,s,a=window.location.href,u=a.indexOf("#");~u&&currentPath!==n&&(i.method="get",_$router_92.render(t,i),s=a.slice(u+1),(o=document.getElementById(s)||document.getElementsByName(s)[0])&&o.scrollIntoView())}},!0)}History.prototype.push=function(t,e,n,r){this._update("pushState",t,e,n,r)},History.prototype.replace=function(t,e,n,r){this._update("replaceState",t,e,n,r)},History.prototype.refresh=function(){var t=routePath(window.location.href);_$router_92.render(this,{url:t,method:"get"})},History.prototype.back=function(){window.history.back()},History.prototype.forward=function(){window.history.forward()},History.prototype.go=function(t){window.history.go(t)},History.prototype._update=function(t,e,n,r,i){var o=routePath(resolveUrl(window.location.href,e));if(o){null==n&&(n=!0),null==r&&(r={});var s=renderOptions(i,o);r.$render=!0,r.$method=s.method,window.history[t](r,null,s.url),currentPath=window.location.pathname+window.location.search,n&&_$router_92.render(this,s,i)}},History.prototype.page=function(){var t=this.app.createPage(),e=this;return t.redirect=function(t){if("back"===t)return e.back();"home"===t&&(t="\\"),e.replace(t,!0)},t};var _$browser_91={},__router_91=_$browser_91=_$router_92;function setup(t){var e={queue:{},transitional:{},app:t};t.history=new _$History_90(t,e),["get","post","put","del","enter","exit"].forEach(function(n){var r=e.queue[n]=[],i=e.transitional[n]=[];t[n]=function(e,o){if(Array.isArray(e))return e.forEach(function(e){t[n](e,o)}),t;if(__router_91.isTransitional(e)){var s=e.from,a=e.to,u=e.forward||o&&o.forward||o,c=e.back||o&&o.back,l=new _$Route_93(n,s,c),h=new _$Route_93(n,a,u);return l.isTransitional=!0,h.isTransitional=!0,i.push({from:l,to:h}),c&&i.push({from:h,to:l}),t}return r.push(new _$Route_93(n,e,o)),t}})}__router_91.setup=setup;var _$contexts_11={};function __noop_11(){}function ContextMeta(){this.addBinding=__noop_11,this.removeBinding=__noop_11,this.removeNode=__noop_11,this.addItemContext=__noop_11,this.removeItemContext=__noop_11,this.views=null,this.idNamespace="",this.idCount=0,this.pending=[],this.pauseCount=0}function __Context_11(t,e,n,r,i){this.meta=t,this.controller=e,this.parent=n,this.unbound=r,this.expression=i,this.alias=i&&i.meta&&i.meta.as,this.keyAlias=i&&i.meta&&i.meta.keyAs,this.item=null,this.view=null,this.attributes=null,this.hooks=null,this.initHooks=null,this.closure=null,this._id=null}_$contexts_11.ContextMeta=ContextMeta,_$contexts_11.Context=__Context_11,__Context_11.prototype.id=function(){var t=++this.meta.idCount;return this.meta.idNamespace+"_"+t.toString(36)},__Context_11.prototype.addBinding=function(t){if(!t.itemFor){var e=t.template.expression;(e?e.isUnbound(this):this.unbound)||e&&e.meta&&"with"===e.meta.blockType||this.meta.addBinding(t)}},__Context_11.prototype.removeBinding=function(t){this.meta.removeBinding(t)},__Context_11.prototype.removeNode=function(t){this.meta.removeNode(t)},__Context_11.prototype.child=function(t){var e=t.meta&&t.meta.blockType,n="unbound"===e||"bound"!==e&&this.unbound;return new __Context_11(this.meta,this.controller,this,n,t)},__Context_11.prototype.componentChild=function(t){return new __Context_11(this.meta,t,this,this.unbound)},__Context_11.prototype.eachChild=function(t,e){var n=new __Context_11(this.meta,this.controller,this,this.unbound,t);return n.item=e,this.meta.addItemContext(n),n},__Context_11.prototype.viewChild=function(t,e,n,r){var i=new __Context_11(this.meta,this.controller,this,this.unbound);return i.view=t,i.attributes=e,i.hooks=n,i.initHooks=r,i},__Context_11.prototype.closureChild=function(t){var e=new __Context_11(this.meta,this.controller,this,this.unbound);return e.closure=t,e},__Context_11.prototype.forRelative=function(t){for(var e=this;e&&e.expression===t||e.view;)e=e.parent;return e},__Context_11.prototype.forAlias=function(t){for(var e=this;e;){if(e.alias===t||e.keyAlias===t)return e;e=e.parent}},__Context_11.prototype.forAttribute=function(t){for(var e=this;e;){if(e.view){var n=e.attributes;if(!n)return;if(n.hasOwnProperty(t))return e;if(!n.inherit&&!n.extend)return}e=e.parent}},__Context_11.prototype.forViewParent=function(){for(var t=this;t;){if(t.closure)return t.closure.parent;if(t.view)return t.parent;t=t.parent}},__Context_11.prototype.getView=function(){for(var t=this;t;){if(t.view)return t.view;t=t.parent}},__Context_11.prototype.get=function(){var t=this.expression?this.expression.get(this):this.controller.model.data;return null!=this.item?t&&t[this.item]:t},__Context_11.prototype.pause=function(){this.meta.pauseCount++},__Context_11.prototype.unpause=function(){--this.meta.pauseCount||this.flush()},__Context_11.prototype.flush=function(){var t=this.meta.pending,e=t.length;if(e){this.meta.pending=[];for(var n=0;n<e;n++)t[n]()}},__Context_11.prototype.queue=function(t){this.meta.pending.push(t)};var _$operatorFns_13={get:{"!U":function(t){return!t},"-U":function(t){return-t},"+U":function(t){return+t},"~U":function(t){return~t},typeofU:function(t){return typeof t},"||":function(t,e){return t||e},"&&":function(t,e){return t&&e},"|":function(t,e){return t|e},"^":function(t,e){return t^e},"&":function(t,e){return t&e},"==":function(t,e){return t==e},"!=":function(t,e){return t!=e},"===":function(t,e){return t===e},"!==":function(t,e){return t!==e},"<":function(t,e){return t<e},">":function(t,e){return t>e},"<=":function(t,e){return t<=e},">=":function(t,e){return t>=e},instanceof:function(t,e){return t instanceof e},in:function(t,e){return t in e},"<<":function(t,e){return t<<e},">>":function(t,e){return t>>e},">>>":function(t,e){return t>>>e},"+":function(t,e){return t+e},"-":function(t,e){return t-e},"*":function(t,e){return t*e},"/":function(t,e){return t/e},"%":function(t,e){return t%e},"?":function(t,e,n){return t?e:n},",":function(){return arguments[arguments.length-1]}},set:{"!U":function(t){return[!t]},"-U":function(t){return[-t]},"==":function(t,e,n){if(t)return[n]},"===":function(t,e,n){if(t)return[n]},in:function(t,e,n){return n[e]=!0,{1:n}},"+":function(t,e,n){return[t-n]},"-":function(t,e,n){return[t+n]},"*":function(t,e,n){return[t/n]},"/":function(t,e,n){return[t*n]}}},_$saddle_74={},serializeObject=_$serializeObject_75({}),BOOLEAN_PROPERTIES={checked:"checked",disabled:"disabled",readonly:"readOnly",selected:"selected"},INTEGER_PROPERTIES={colspan:"colSpan",maxlength:"maxLength",rowspan:"rowSpan",tabindex:"tabIndex"},STRING_PROPERTIES={cellpadding:"cellPadding",cellspacing:"cellSpacing",class:"className",contenteditable:"contentEditable",enctype:"encoding",for:"htmlFor",frameborder:"frameBorder",id:"id",title:"title",type:"type",usemap:"useMap",value:"value"},UPDATE_PROPERTIES={};mergeInto(BOOLEAN_PROPERTIES,UPDATE_PROPERTIES),mergeInto(INTEGER_PROPERTIES,UPDATE_PROPERTIES),mergeInto(STRING_PROPERTIES,UPDATE_PROPERTIES);var CREATE_PROPERTIES={};mergeInto(UPDATE_PROPERTIES,CREATE_PROPERTIES),CREATE_PROPERTIES.checked="defaultChecked",CREATE_PROPERTIES.value="defaultValue";var VOID_ELEMENTS={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuitem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},NAMESPACE_URIS={svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/2000/xmlns/"};function Template(t,e){this.content=t,this.source=e}function Doctype(t,e,n){this.name=t,this.publicId=e,this.systemId=n}function Text(t){this.data=t,this.escaped=escapeHtml(t)}function DynamicText(t){this.expression=t,this.unbound=!1}function attachText(t,e,n,r,i){if(!e){var o=document.createTextNode(n);return t.appendChild(o),void addNodeBinding(r,i,o)}if(3===e.nodeType){if(e.data===n)return addNodeBinding(r,i,e),e.nextSibling;var s=splitData(e,(n=normalizeLineBreaks(n)).length);if(e.data!==n)throw attachError(t,e);return addNodeBinding(r,i,e),s}if(""===n){o=document.createTextNode("");return t.insertBefore(o,e||null),addNodeBinding(r,i,o),e}throw attachError(t,e)}function Comment(t,e){this.data=t,this.hooks=e}function DynamicComment(t,e){this.expression=t,this.hooks=e}function attachComment(t,e,n,r,i){if(!e||8!==e.nodeType){var o=document.createComment(n);return t.insertBefore(o,e||null),addNodeBinding(r,i,o),e}if(e.data===n)return addNodeBinding(r,i,e),e.nextSibling;throw attachError(t,e)}function addNodeBinding(t,e,n){t.expression&&!t.unbound&&e.addBinding(new NodeBinding(t,e,n)),emitHooks(t.hooks,e,n)}function Html(t){this.data=t}function DynamicHtml(t){this.expression=t,this.ending="/"+t}function createHtmlFragment(t,e){if(t&&1===t.nodeType)return(r=document.createRange()).selectNodeContents(t),r.createContextualFragment(e);var n=document.createElement("div"),r=document.createRange();return n.innerHTML=e,r.selectNodeContents(n),r.extractContents()}function attachHtml(t,e,n){for(var r=0,i=createHtmlFragment(t,n).childNodes.length;r<i;r++){if(!e)throw attachError(t,e);e=e.nextSibling}return e}function Attribute(t,e){this.data=t,this.ns=e}function DynamicAttribute(t,e){this.expression=t,this.ns=e,this.elementNs=null}function getUnescapedValue(t,e){for(var n=t.get(e,!0);n instanceof Template;)n=n.get(e,!0);return n}function Element(t,e,n,r,i,o,s){this.tagName=t,this.attributes=e,this.content=n,this.hooks=r,this.selfClosing=i,this.notClosed=o,this.ns=s,this.endTag=getEndTag(t,i,o),this.startClose=getStartClose(i);var a=t&&t.toLowerCase();this.unescapedContent="script"===a||"style"===a,this.bindContentToValue="textarea"===a}function DynamicElement(t,e,n,r,i,o,s){this.tagName=t,this.attributes=e,this.content=n,this.hooks=r,this.selfClosing=i,this.notClosed=o,this.ns=s,this.startClose=getStartClose(i),this.unescapedContent=!1}function getStartClose(t){return t?" />":">"}function getEndTag(t,e,n){var r=t&&t.toLowerCase();return VOID_ELEMENTS[r]||e||n?"":"</"+t+">"}function getAttributeValue(t,e){var n=UPDATE_PROPERTIES[e];return n?t[n]:t.getAttribute(e)}function emitHooks(t,e,n){t&&e.queue(function(){for(var r=0,i=t.length;r<i;r++)t[r].emit(e,n)})}function Block(t,e){this.expression=t,this.ending="/"+t,this.content=e}function ConditionalBlock(t,e){this.expressions=t,this.beginning=t.join("; "),this.ending="/"+this.beginning,this.contents=e}function EachBlock(t,e,n){this.expression=t,this.ending="/"+t,this.content=e,this.elseContent=n}function indexStartNode(t,e){for(var n=t.start,r=0;n=n.nextSibling;){if(n===t.end)return n;if(n.$bindItemStart&&n.$bindItemStart.itemFor===t.start){if(e===r)return n;r++}}}function updateRange(t,e,n,r,i,o,s){e?(e.start=r,e.end=i,e.condition=s,setNodeBounds(e,r,o)):t.addBinding(new RangeBinding(n,t,r,i,o,s))}function setNodeBounds(t,e,n){setNodeProperty(e,n?"$bindItemStart":"$bindStart",t)}function appendContent(t,e,n){for(var r=0,i=e.length;r<i;r++)e[r].appendTo(t,n)}function attachContent(t,e,n,r){for(var i=0,o=n.length;i<o;i++){for(;e&&e.hasAttribute&&e.hasAttribute("data-no-attach");)e=e.nextSibling;e=n[i].attachTo(t,e,r)}return e}function contentHtml(t,e,n){for(var r="",i=0,o=t.length;i<o;i++)r+=t[i].get(e,n);return r}function replaceRange(t,e,n,r,i,o){var s=e.parentNode;if(e.$bindItemStart&&r.firstChild&&(setNodeProperty(r.firstChild,"$bindItemStart",e.$bindItemStart),e.$bindItemStart.start=r.firstChild),e===n)return s.replaceChild(r,e),void emitRemoved(t,e,i);for(var a,u=o?e.nextSibling:e;u;){if(a=u.nextSibling,emitRemoved(t,u,i),o&&u===n){a=n;break}if(s.removeChild(u),u===n)break;u=a}s.insertBefore(r,a||null)}function emitRemoved(t,e,n){t.removeNode(e),emitRemovedBinding(t,n,e,"$bindNode"),emitRemovedBinding(t,n,e,"$bindStart"),emitRemovedBinding(t,n,e,"$bindItemStart");var r=e.$bindAttributes;if(r)for(var i in e.$bindAttributes=null,r)t.removeBinding(r[i]);for(e=e.firstChild;e;e=e.nextSibling)emitRemoved(t,e,n)}function emitRemovedBinding(t,e,n,r){var i=n[r];i&&(n[r]=null,i!==e&&t.removeBinding(i))}function attachError(t,e){return"undefined"!=typeof console&&console.error("Attach failed for",e,"within",t),new Error("Attaching bindings failed, because HTML structure does not match client rendering.")}function Binding(){this.meta=null}function NodeBinding(t,e,n){this.template=t,this.context=e,this.node=n,this.meta=null,setNodeProperty(n,"$bindNode",this)}function AttributeBindingsMap(){}function AttributeBinding(t,e,n,r){this.template=t,this.context=e,this.element=n,this.name=r,this.meta=null,(n.$bindAttributes||(n.$bindAttributes=new AttributeBindingsMap))[r]=this}function RangeBinding(t,e,n,r,i,o){this.template=t,this.context=e,this.start=n,this.end=r,this.itemFor=i,this.condition=o,this.meta=null,setNodeBounds(this,n,i)}function __noop_74(){}function mergeInto(t,e){for(var n in t)e[n]=t[n]}function escapeHtml(t){return(t+="").replace(/[&<]/g,function(t){return"&"===t?"&amp;":"&lt;"})}function escapeAttribute(t){return(t+="").replace(/[&"]/g,function(t){return"&"===t?"&amp;":"&quot;"})}function equalConditions(t,e){return t===e||t instanceof Template&&t.equals(e)}function splitData(t,e){var n=t.cloneNode(!1);return n.deleteData(0,e),t.deleteData(e,t.length-e),t.parentNode.insertBefore(n,t.nextSibling||null),n}function setNodeProperty(t,e,n){return t[e]=n}function normalizeLineBreaks(t){return t}_$saddle_74.CREATE_PROPERTIES=CREATE_PROPERTIES,_$saddle_74.BOOLEAN_PROPERTIES=BOOLEAN_PROPERTIES,_$saddle_74.INTEGER_PROPERTIES=INTEGER_PROPERTIES,_$saddle_74.STRING_PROPERTIES=STRING_PROPERTIES,_$saddle_74.UPDATE_PROPERTIES=UPDATE_PROPERTIES,_$saddle_74.VOID_ELEMENTS=VOID_ELEMENTS,_$saddle_74.NAMESPACE_URIS=NAMESPACE_URIS,_$saddle_74.Template=Template,_$saddle_74.Doctype=Doctype,_$saddle_74.Text=Text,_$saddle_74.DynamicText=DynamicText,_$saddle_74.Comment=Comment,_$saddle_74.DynamicComment=DynamicComment,_$saddle_74.Html=Html,_$saddle_74.DynamicHtml=DynamicHtml,_$saddle_74.Element=Element,_$saddle_74.DynamicElement=DynamicElement,_$saddle_74.Block=Block,_$saddle_74.ConditionalBlock=ConditionalBlock,_$saddle_74.EachBlock=EachBlock,_$saddle_74.Attribute=Attribute,_$saddle_74.DynamicAttribute=DynamicAttribute,_$saddle_74.Binding=Binding,_$saddle_74.NodeBinding=NodeBinding,_$saddle_74.AttributeBinding=AttributeBinding,_$saddle_74.RangeBinding=RangeBinding,Template.prototype.toString=function(){return this.source},Template.prototype.get=function(t,e){return contentHtml(this.content,t,e)},Template.prototype.getFragment=function(t,e){var n=document.createDocumentFragment();return this.appendTo(n,t,e),n},Template.prototype.appendTo=function(t,e){e.pause(),appendContent(t,this.content,e),e.unpause()},Template.prototype.attachTo=function(t,e,n){n.pause();e=attachContent(t,e,this.content,n);return n.unpause(),e},Template.prototype.update=function(){},Template.prototype.stringify=function(t){return null==t?"":t+""},Template.prototype.equals=function(t){return this===t},Template.prototype.module="templates",Template.prototype.type="Template",Template.prototype.serialize=function(){return serializeObject.instance(this,this.content,this.source)},Doctype.prototype=Object.create(Template.prototype),Doctype.prototype.constructor=Doctype,Doctype.prototype.get=function(){var t=this.publicId?' PUBLIC "'+this.publicId+'"':"",e=this.systemId?this.publicId?' "'+this.systemId+'"':' SYSTEM "'+this.systemId+'"':"";return"<!DOCTYPE "+this.name+t+e+">"},Doctype.prototype.appendTo=function(){},Doctype.prototype.attachTo=function(t,e){if(!e||10!==e.nodeType)throw attachError(t,e);return e.nextSibling},Doctype.prototype.type="Doctype",Doctype.prototype.serialize=function(){return serializeObject.instance(this,this.name,this.publicId,this.systemId)},Text.prototype=Object.create(Template.prototype),Text.prototype.constructor=Text,Text.prototype.get=function(t,e){return e?this.data:this.escaped},Text.prototype.appendTo=function(t){var e=document.createTextNode(this.data);t.appendChild(e)},Text.prototype.attachTo=function(t,e){return attachText(t,e,this.data,this)},Text.prototype.type="Text",Text.prototype.serialize=function(){return serializeObject.instance(this,this.data)},DynamicText.prototype=Object.create(Template.prototype),DynamicText.prototype.constructor=DynamicText,DynamicText.prototype.get=function(t,e){var n=this.expression.get(t);if(n instanceof Template){do{n=n.get(t,e)}while(n instanceof Template);return n}var r=this.stringify(n);return e?r:escapeHtml(r)},DynamicText.prototype.appendTo=function(t,e,n){var r=this.expression.get(e);if(r instanceof Template){var i=document.createComment(this.expression),o=document.createComment("/"+this.expression),s=this.getCondition(e);return t.appendChild(i),r.appendTo(t,e),t.appendChild(o),void updateRange(e,n,this,i,o,null,s)}var a=this.stringify(r),u=document.createTextNode(a);t.appendChild(u),addNodeBinding(this,e,u)},DynamicText.prototype.attachTo=function(t,e,n){var r=this.expression.get(n);if(r instanceof Template){var i=document.createComment(this.expression),o=document.createComment("/"+this.expression),s=this.getCondition(n);return t.insertBefore(i,e||null),e=r.attachTo(t,e,n),t.insertBefore(o,e||null),updateRange(n,null,this,i,o,null,s),e}return attachText(t,e,this.stringify(r),this,n)},DynamicText.prototype.update=function(t,e){if(e instanceof RangeBinding)this._blockUpdate(t,e);else{var n=this.expression.get(t);if(n instanceof Template){var r=e.node;if(!r.parentNode)return;replaceRange(t,r,r,this.getFragment(t),e)}else e.node.data=this.stringify(n)}},DynamicText.prototype.getCondition=function(t){return this.expression.get(t)},DynamicText.prototype.type="DynamicText",DynamicText.prototype.serialize=function(){return serializeObject.instance(this,this.expression)},Comment.prototype=Object.create(Template.prototype),Comment.prototype.constructor=Comment,Comment.prototype.get=function(){return"\x3c!--"+this.data+"--\x3e"},Comment.prototype.appendTo=function(t,e){var n=document.createComment(this.data);t.appendChild(n),emitHooks(this.hooks,e,n)},Comment.prototype.attachTo=function(t,e,n){return attachComment(t,e,this.data,this,n)},Comment.prototype.type="Comment",Comment.prototype.serialize=function(){return serializeObject.instance(this,this.data,this.hooks)},DynamicComment.prototype=Object.create(Template.prototype),DynamicComment.prototype.constructor=DynamicComment,DynamicComment.prototype.get=function(t){var e=getUnescapedValue(this.expression,t);return"\x3c!--"+this.stringify(e)+"--\x3e"},DynamicComment.prototype.appendTo=function(t,e){var n=getUnescapedValue(this.expression,e),r=this.stringify(n),i=document.createComment(r);t.appendChild(i),addNodeBinding(this,e,i)},DynamicComment.prototype.attachTo=function(t,e,n){var r=getUnescapedValue(this.expression,n);return attachComment(t,e,this.stringify(r),this,n)},DynamicComment.prototype.update=function(t,e){var n=getUnescapedValue(this.expression,t);e.node.data=this.stringify(n)},DynamicComment.prototype.type="DynamicComment",DynamicComment.prototype.serialize=function(){return serializeObject.instance(this,this.expression,this.hooks)},Html.prototype=Object.create(Template.prototype),Html.prototype.constructor=Html,Html.prototype.get=function(){return this.data},Html.prototype.appendTo=function(t){var e=createHtmlFragment(t,this.data);t.appendChild(e)},Html.prototype.attachTo=function(t,e){return attachHtml(t,e,this.data)},Html.prototype.type="Html",Html.prototype.serialize=function(){return serializeObject.instance(this,this.data)},DynamicHtml.prototype=Object.create(Template.prototype),DynamicHtml.prototype.constructor=DynamicHtml,DynamicHtml.prototype.get=function(t){var e=getUnescapedValue(this.expression,t);return this.stringify(e)},DynamicHtml.prototype.appendTo=function(t,e,n){var r=document.createComment(this.expression),i=document.createComment(this.ending),o=getUnescapedValue(this.expression,e),s=createHtmlFragment(t,this.stringify(o));t.appendChild(r),t.appendChild(s),t.appendChild(i),updateRange(e,n,this,r,i)},DynamicHtml.prototype.attachTo=function(t,e,n){var r=document.createComment(this.expression),i=document.createComment(this.ending),o=getUnescapedValue(this.expression,n),s=this.stringify(o);return t.insertBefore(r,e||null),e=attachHtml(t,e,s),t.insertBefore(i,e||null),updateRange(n,null,this,r,i),e},DynamicHtml.prototype.update=function(t,e){var n=e.start.parentNode;if(n){var r=e.start,i=e.end,o=getUnescapedValue(this.expression,t);replaceRange(t,r,i,createHtmlFragment(n,this.stringify(o)),e,!0)}},DynamicHtml.prototype.type="DynamicHtml",DynamicHtml.prototype.serialize=function(){return serializeObject.instance(this,this.expression)},Attribute.prototype=Object.create(Template.prototype),Attribute.prototype.constructor=Attribute,Attribute.prototype.get=Attribute.prototype.getBound=function(t){return this.data},Attribute.prototype.type="Attribute",Attribute.prototype.serialize=function(){return serializeObject.instance(this,this.data,this.ns)},DynamicAttribute.prototype=Object.create(Attribute.prototype),DynamicAttribute.prototype.constructor=DynamicAttribute,DynamicAttribute.prototype.get=function(t){return getUnescapedValue(this.expression,t)},DynamicAttribute.prototype.getBound=function(t,e,n,r){return this.elementNs=r,t.addBinding(new AttributeBinding(this,t,e,n)),getUnescapedValue(this.expression,t)},DynamicAttribute.prototype.update=function(t,e){var n=getUnescapedValue(this.expression,t),r=e.element,i=!this.elementNs&&UPDATE_PROPERTIES[e.name];if(i){var o=STRING_PROPERTIES[e.name]?this.stringify(n):n;if(r[i]===o)return;r[i]=o}else!1!==n&&null!=n?(!0===n&&(n=e.name),this.ns?r.setAttributeNS(this.ns,e.name,n):r.setAttribute(e.name,n)):this.ns?r.removeAttributeNS(this.ns,e.name):r.removeAttribute(e.name)},DynamicAttribute.prototype.type="DynamicAttribute",DynamicAttribute.prototype.serialize=function(){return serializeObject.instance(this,this.expression,this.ns)},Element.prototype=Object.create(Template.prototype),Element.prototype.constructor=Element,Element.prototype.getTagName=function(){return this.tagName},Element.prototype.getEndTag=function(){return this.endTag},Element.prototype.get=function(t){var e=this.getTagName(t),n=this.getEndTag(e),r=[e];for(var i in this.attributes){var o=this.attributes[i].get(t);!0===o?r.push(i):!1!==o&&null!=o&&r.push(i+'="'+escapeAttribute(o)+'"')}var s="<"+r.join(" ")+this.startClose;return this.content?s+contentHtml(this.content,t,this.unescapedContent)+n:s+n},Element.prototype.appendTo=function(t,e){var n=this.getTagName(e),r=this.ns?document.createElementNS(this.ns,n):document.createElement(n);for(var i in this.attributes){var o=this.attributes[i],s=o.getBound(e,r,i,this.ns);if(!1!==s&&null!=s){var a=!this.ns&&CREATE_PROPERTIES[i];a?r[a]=s:(!0===s&&(s=i),o.ns?r.setAttributeNS(o.ns,i,s):r.setAttribute(i,s))}}this.content&&(this._bindContent(e,r),appendContent(r,this.content,e)),t.appendChild(r),emitHooks(this.hooks,e,r)},Element.prototype.attachTo=function(t,e,n){var r=this.getTagName(n);if(!e||1!==e.nodeType||e.tagName.toLowerCase()!==r.toLowerCase())throw attachError(t,e);for(var i in this.attributes)this.attributes[i].getBound(n,e,i,this.ns);return this.content&&(this._bindContent(n,e),attachContent(e,e.firstChild,this.content,n)),emitHooks(this.hooks,n,e),e.nextSibling},Element.prototype._bindContent=function(t,e){var n=this.bindContentToValue&&1===this.content.length&&this.content[0];if(n instanceof DynamicText){n.unbound=!0;var r=new DynamicAttribute(n.expression);t.addBinding(new AttributeBinding(r,t,e,"value"))}},Element.prototype.type="Element",Element.prototype.serialize=function(){return serializeObject.instance(this,this.tagName,this.attributes,this.content,this.hooks,this.selfClosing,this.notClosed,this.ns)},DynamicElement.prototype=Object.create(Element.prototype),DynamicElement.prototype.constructor=DynamicElement,DynamicElement.prototype.getTagName=function(t){return getUnescapedValue(this.tagName,t)},DynamicElement.prototype.getEndTag=function(t){return getEndTag(t,this.selfClosing,this.notClosed)},DynamicElement.prototype.type="DynamicElement",Block.prototype=Object.create(Template.prototype),Block.prototype.constructor=Block,Block.prototype.get=function(t,e){var n=t.child(this.expression);return contentHtml(this.content,n,e)},Block.prototype.appendTo=function(t,e,n){var r=e.child(this.expression),i=document.createComment(this.expression),o=document.createComment(this.ending),s=this.getCondition(e);t.appendChild(i),appendContent(t,this.content,r),t.appendChild(o),updateRange(e,n,this,i,o,null,s)},Block.prototype.attachTo=function(t,e,n){var r=n.child(this.expression),i=document.createComment(this.expression),o=document.createComment(this.ending),s=this.getCondition(n);return t.insertBefore(i,e||null),e=attachContent(t,e,this.content,r),t.insertBefore(o,e||null),updateRange(n,null,this,i,o,null,s),e},Block.prototype.type="Block",Block.prototype.serialize=function(){return serializeObject.instance(this,this.expression,this.content)},Block.prototype.update=function(t,e){if(e.start.parentNode){var n=this.getCondition(t);if(!equalConditions(n,e.condition))e.condition=n,replaceRange(t,e.start,e.end,this.getFragment(t,e),e)}},Block.prototype.getCondition=function(t){var e=this.expression.get(t);return"object"==typeof e?NaN:e},DynamicText.prototype._blockUpdate=Block.prototype.update,ConditionalBlock.prototype=Object.create(Block.prototype),ConditionalBlock.prototype.constructor=ConditionalBlock,ConditionalBlock.prototype.get=function(t,e){var n=this.getCondition(t);if(null==n)return"";var r=this.expressions[n],i=t.child(r);return contentHtml(this.contents[n],i,e)},ConditionalBlock.prototype.appendTo=function(t,e,n){var r=document.createComment(this.beginning),i=document.createComment(this.ending);t.appendChild(r);var o=this.getCondition(e);if(null!=o){var s=this.expressions[o],a=e.child(s);appendContent(t,this.contents[o],a)}t.appendChild(i),updateRange(e,n,this,r,i,null,o)},ConditionalBlock.prototype.attachTo=function(t,e,n){var r=document.createComment(this.beginning),i=document.createComment(this.ending);t.insertBefore(r,e||null);var o=this.getCondition(n);if(null!=o){var s=this.expressions[o],a=n.child(s);e=attachContent(t,e,this.contents[o],a)}return t.insertBefore(i,e||null),updateRange(n,null,this,r,i,null,o),e},ConditionalBlock.prototype.type="ConditionalBlock",ConditionalBlock.prototype.serialize=function(){return serializeObject.instance(this,this.expressions,this.contents)},ConditionalBlock.prototype.update=function(t,e){if(e.start.parentNode){var n=this.getCondition(t);if(!equalConditions(n,e.condition))e.condition=n,replaceRange(t,e.start,e.end,this.getFragment(t,e),e)}},ConditionalBlock.prototype.getCondition=function(t){for(var e=0,n=this.expressions.length;e<n;e++)if(this.expressions[e].truthy(t))return e},EachBlock.prototype=Object.create(Block.prototype),EachBlock.prototype.constructor=EachBlock,EachBlock.prototype.get=function(t,e){var n=this.expression.get(t);if(n&&n.length){for(var r="",i=0,o=n.length;i<o;i++){var s=t.eachChild(this.expression,i);r+=contentHtml(this.content,s,e)}return r}return this.elseContent?contentHtml(this.elseContent,t,e):""},EachBlock.prototype.appendTo=function(t,e,n){var r=this.expression.get(e),i=document.createComment(this.expression),o=document.createComment(this.ending);if(t.appendChild(i),r&&r.length)for(var s=0,a=r.length;s<a;s++){var u=e.eachChild(this.expression,s);this.appendItemTo(t,u,i)}else this.elseContent&&appendContent(t,this.elseContent,e);t.appendChild(o),updateRange(e,n,this,i,o)},EachBlock.prototype.appendItemTo=function(t,e,n,r){var i,o,s=t.lastChild;appendContent(t,this.content,e),s===t.lastChild?(i=o=document.createComment("empty"),t.appendChild(i)):(i=s&&s.nextSibling||t.firstChild,o=t.lastChild),updateRange(e,r,this,i,o,n)},EachBlock.prototype.attachTo=function(t,e,n){var r=this.expression.get(n),i=document.createComment(this.expression),o=document.createComment(this.ending);if(t.insertBefore(i,e||null),r&&r.length)for(var s=0,a=r.length;s<a;s++){var u=n.eachChild(this.expression,s);e=this.attachItemTo(t,e,u,i)}else this.elseContent&&(e=attachContent(t,e,this.elseContent,n));return t.insertBefore(o,e||null),updateRange(n,null,this,i,o),e},EachBlock.prototype.attachItemTo=function(t,e,n,r){var i,o,s=e&&e.previousSibling,a=attachContent(t,e,this.content,n);return a===e?(i=o=document.createComment("empty"),t.insertBefore(i,e||null)):(i=s&&s.nextSibling||t.firstChild,o=a&&a.previousSibling||t.lastChild),updateRange(n,null,this,i,o,r),a},EachBlock.prototype.update=function(t,e){if(e.start.parentNode){var n=e.start,r=e.end;if(e.itemFor){var i=document.createDocumentFragment();this.appendItemTo(i,t,e.itemFor,e)}else i=this.getFragment(t,e);replaceRange(t,n,r,i,e)}},EachBlock.prototype.insert=function(t,e,n,r){var i=e.start.parentNode;if(i){if(0===n&&this.expression.get(t).length===r)return this.update(t,e);for(var o=indexStartNode(e,n),s=document.createDocumentFragment(),a=n,u=n+r;a<u;a++){var c=t.eachChild(this.expression,a);this.appendItemTo(s,c,e.start)}i.insertBefore(s,o||null)}},EachBlock.prototype.remove=function(t,e,n,r){var i=e.start.parentNode;if(i){if(0===n&&0===this.expression.get(t).length)return this.update(t,e);for(var o=indexStartNode(e,n),s=0;o;){if(o===e.end)return;if(o.$bindItemStart&&o.$bindItemStart.itemFor===e.start&&r===s++)return;var a=o.nextSibling;i.removeChild(o),emitRemoved(t,o,e),o=a}}},EachBlock.prototype.move=function(t,e,n,r,i){var o=e.start.parentNode;if(o){for(var s=indexStartNode(e,n),a=document.createDocumentFragment(),u=0;s&&s!==e.end&&(!s.$bindItemStart||s.$bindItemStart.itemFor!==e.start||i!==u++);){var c=s.nextSibling;a.appendChild(s),s=c}s=indexStartNode(e,r),o.insertBefore(a,s||null)}},EachBlock.prototype.type="EachBlock",EachBlock.prototype.serialize=function(){return serializeObject.instance(this,this.expression,this.content,this.elseContent)},Binding.prototype.type="Binding",Binding.prototype.update=function(){this.context.pause(),this.template.update(this.context,this),this.context.unpause()},Binding.prototype.insert=function(){this.update()},Binding.prototype.remove=function(){this.update()},Binding.prototype.move=function(){this.update()},NodeBinding.prototype=Object.create(Binding.prototype),NodeBinding.prototype.constructor=NodeBinding,NodeBinding.prototype.type="NodeBinding",AttributeBinding.prototype=Object.create(Binding.prototype),AttributeBinding.prototype.constructor=AttributeBinding,AttributeBinding.prototype.type="AttributeBinding",RangeBinding.prototype=Object.create(Binding.prototype),RangeBinding.prototype.constructor=RangeBinding,RangeBinding.prototype.type="RangeBinding",RangeBinding.prototype.insert=function(t,e){this.context.pause(),this.template.insert?this.template.insert(this.context,this,t,e):this.template.update(this.context,this),this.context.unpause()},RangeBinding.prototype.remove=function(t,e){this.context.pause(),this.template.remove?this.template.remove(this.context,this,t,e):this.template.update(this.context,this),this.context.unpause()},RangeBinding.prototype.move=function(t,e,n){this.context.pause(),this.template.move?this.template.move(this.context,this,t,e,n):this.template.update(this.context,this),this.context.unpause()},Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),function(){if("undefined"!=typeof document){var t=document.createElement("div");t.innerHTML="\r\n<br>\n";var e=t.firstChild.data.length,n=t.lastChild.data.length;1===e&&1===n?normalizeLineBreaks=function(t){return t.replace(/\r\n/g,"\n")}:2===e&&2===n&&(normalizeLineBreaks=function(t){return t.replace(/(^|[^\r])(\n+)/g,function(t,e,n){for(var r=n.length;r--;)e+="\r\n";return e})});var r=document.createElement("input");r.defaultValue="x","x"!==r.value&&(CREATE_PROPERTIES.value="value");try{document.createTextNode("").$try=0}catch(t){setNodeProperty=function(t,e,n){if(3===t.nodeType){var r=t.previousSibling;return r&&r.$bindProxy===t||((r=document.createComment("proxy")).$bindProxy=t,t.parentNode.insertBefore(r,t||null)),r[e]=n}return t[e]=n}}}}();var _$util_16={concat:function(t,e){return t?e?t.concat(e):t:e},hasKeys:function(t){if(!t)return!1;for(var e in t)return!0;return!1},traverseAndCreate:function(t,e){var n=e.length;if(!n)return t;for(var r=0;r<n;r++){var i=e[r];t=t[i]||(t[i]={})}return t}},_$expressions_12={};(function(t){var e=_$serializeObject_75({}),n=_$templates_15({}),r=n.Template,i=_$util_16.concat;function o(t,e){if(!t)return e;for(var n=0,r=t.length;n<r;n++){if(null==e)return e;e=e[t[n]]}return e}function s(t){return Array.isArray(t)?t.length>0:!!t}function a(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];e[n]="object"==typeof r?r.item:r}return e}function u(t,e){return"object"!=typeof t?t:t instanceof r?c(t,e):Array.isArray(t)?function(t,e){for(var n=0;n<t.length;n++)if(l(t[n]))return h(t,e);return t}(t,e):function(t,e){return l(t)?function(t,e){var n={};for(var r in t)n[r]=u(t[r],e);return n}(t,e):t}(t,e)}function c(t,e){for(var n=1e3;t instanceof r;){if(--n<0)throw new Error("Maximum template render passes exceeded");t=t.get(e,!0)}return t}function l(t){if(!t)return!1;if(t.constructor!==Object)return!1;for(var e in t)if(t[e]instanceof r)return!0;return!1}function h(t,e){for(var n=new Array(t.length),r=0;r<t.length;r++)n[r]=u(t[r],e);return n}function p(t,e,n,r,i,o,s,a){this.source=t,this.blockType=e,this.isEnd=n,this.as=r,this.keyAs=i,this.unescaped=o,this.bindType=s,this.valueType=a}function f(t){this.meta=t}function d(t,e){this.value=t,this.meta=e}function m(t,e){this.segments=t,this.meta=e}function v(t,e){this.segments=t,this.meta=e}function g(t,e,n){this.alias=t,this.segments=e,this.meta=n}function y(t,e,n){this.attribute=t,this.segments=e,this.meta=n}function _(t,e,n,r){this.before=t,this.inside=e,this.afterSegments=n,this.meta=r}function b(t,e){if(!(t instanceof r))throw new Error("DeferRenderExpression requires a Template argument");this.template=t,this.meta=e}function x(t,e,n){this.items=t,this.afterSegments=e,this.meta=n}function E(t,e,n){this.properties=t,this.afterSegments=e,this.meta=n}function w(t,e,n,r){this.segments=t,this.args=e,this.afterSegments=n,this.meta=r;var i=t&&t.slice();this.lastSegment=i&&i.pop(),this.parentSegments=i&&i.length?i:null}function S(t,e,n,r){w.call(this,t,e,n,r)}function C(t,e,n,r){this.name=t,this.args=e,this.afterSegments=n,this.meta=r,this.getFn=_$operatorFns_13.get[t],this.setFn=_$operatorFns_13.set[t]}function M(t,e,n){this.args=t,this.afterSegments=e,this.meta=n}function T(t,e){this.expression=t,this.meta=e}function A(t,e){this.expression=t,this.meta=e}function $(t,e,n){if(t instanceof f||t instanceof r)return t.dependencies(e,n)}function k(t,e,n){var r=e.resolve(n);return r?t?(t.push(r),t):[r]:t}function D(t,e,n){if(!e.segments.length)return t;var r=e.resolve(n);return r?t?(t.pop(),t.push(r),t):[r]:t}_$expressions_12.lookup=o,_$expressions_12.templateTruthy=s,_$expressions_12.pathSegments=a,_$expressions_12.renderValue=u,_$expressions_12.renderTemplate=c,_$expressions_12.ExpressionMeta=p,_$expressions_12.Expression=f,_$expressions_12.LiteralExpression=d,_$expressions_12.PathExpression=m,_$expressions_12.RelativePathExpression=v,_$expressions_12.AliasPathExpression=g,_$expressions_12.AttributePathExpression=y,_$expressions_12.BracketsExpression=_,_$expressions_12.DeferRenderExpression=b,_$expressions_12.ArrayExpression=x,_$expressions_12.ObjectExpression=E,_$expressions_12.FnExpression=w,_$expressions_12.OperatorExpression=C,_$expressions_12.NewExpression=S,_$expressions_12.SequenceExpression=M,_$expressions_12.ViewParentExpression=T,_$expressions_12.ScopedModelExpression=A,p.prototype.module="expressions",p.prototype.type="ExpressionMeta",p.prototype.serialize=function(){return e.instance(this,this.source,this.blockType,this.isEnd,this.as,this.keyAs,this.unescaped,this.bindType,this.valueType)},f.prototype.module="expressions",f.prototype.type="Expression",f.prototype.serialize=function(){return e.instance(this,this.meta)},f.prototype.toString=function(){return this.meta&&this.meta.source},f.prototype.truthy=function(t){var e=this.meta.blockType;if("else"===e)return!0;var n=s(this.get(t,!0));return"unless"===e?!n:n},f.prototype.get=function(){},f.prototype.resolve=function(){},f.prototype.dependencies=function(){},f.prototype.pathSegments=function(t){var e=this.resolve(t);return e&&a(e)},f.prototype.set=function(t,e){var n=this.pathSegments(t);if(!n)throw new Error("Expression does not support setting");t.controller.model._set(n,e)},f.prototype._resolvePatch=function(t,e){return t&&t.expression===this&&null!=t.item?e.concat(t):e},f.prototype.isUnbound=function(t){var e=this.meta&&this.meta.bindType;return"unbound"===e||"bound"!==e&&t.unbound},f.prototype._lookupAndContextifyValue=function(t,e){return this.segments&&this.segments.length&&(t=c(t,e),t=o(this.segments,t)),t instanceof r&&!(t instanceof n.ContextClosure)&&(t=new n.ContextClosure(t,e)),t},d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.prototype.type="LiteralExpression",d.prototype.serialize=function(){return e.instance(this,this.value,this.meta)},d.prototype.get=function(){return this.value},m.prototype=Object.create(f.prototype),m.prototype.constructor=m,m.prototype.type="PathExpression",m.prototype.serialize=function(){return e.instance(this,this.segments,this.meta)},m.prototype.get=function(t){if(t.controller)return o(this.segments,t.controller.model.data)},m.prototype.resolve=function(t){if(t.controller){var e=i(t.controller._scope,this.segments);return this._resolvePatch(t,e)}},m.prototype.dependencies=function(t,e){if(t.controller)return k($(o(this.segments,t.controller.model.data),t,e),this,t)},v.prototype=Object.create(f.prototype),v.prototype.constructor=v,v.prototype.type="RelativePathExpression",v.prototype.serialize=function(){return e.instance(this,this.segments,this.meta)},v.prototype.get=function(t){var e=t.forRelative(this),n=e.get();return this._lookupAndContextifyValue(n,e)},v.prototype.resolve=function(t){var e=t.forRelative(this),n=e.expression?e.expression.resolve(e):[];if(n){var r=n.concat(this.segments);return this._resolvePatch(t,r)}},v.prototype.dependencies=function(t,e){var n=t.forRelative(this);return D(n.expression&&n.expression.dependencies(n,e),this,t)},g.prototype=Object.create(f.prototype),g.prototype.constructor=g,g.prototype.type="AliasPathExpression",g.prototype.serialize=function(){return e.instance(this,this.alias,this.segments,this.meta)},g.prototype.get=function(t){var e=t.forAlias(this.alias);if(e){if(e.keyAlias===this.alias)return e.item;var n=e.get();return this._lookupAndContextifyValue(n,e)}},g.prototype.resolve=function(t){var e=t.forAlias(this.alias);if(e&&e.keyAlias!==this.alias){var n=e.expression.resolve(e);if(n){var r=n.concat(this.segments);return this._resolvePatch(t,r)}}},g.prototype.dependencies=function(t,e){var n=t.forAlias(this.alias);if(n){if(n.keyAlias===this.alias){var r=n.expression.resolve(n.parent);if(!r)return;return[r]}return D(n.expression.dependencies(n,e),this,t)}},y.prototype=Object.create(f.prototype),y.prototype.constructor=y,y.prototype.type="AttributePathExpression",y.prototype.serialize=function(){return e.instance(this,this.attribute,this.segments,this.meta)},y.prototype.get=function(t){var e=t.forAttribute(this.attribute);if(e){var n=e.attributes[this.attribute];return n instanceof f&&(n=n.get(e)),this._lookupAndContextifyValue(n,e)}},y.prototype.resolve=function(t){var e=t.forAttribute(this.attribute);if(e){var n,i=e.attributes[this.attribute];if((i instanceof f||i instanceof r)&&(n=i.resolve(e)),n){var o=n.concat(this.segments);return this._resolvePatch(t,o)}}},y.prototype.dependencies=function(t,e){var n=t.forAttribute(this.attribute);if(n)return D($(n.attributes[this.attribute],n,e),this,t)},_.prototype=Object.create(f.prototype),_.prototype.constructor=_,_.prototype.type="BracketsExpression",_.prototype.serialize=function(){return e.instance(this,this.before,this.inside,this.afterSegments,this.meta)},_.prototype.get=function(t){var e=this.inside.get(t);if(null!=e){var n=this.before.get(t);if(n){var r=n[e];return this.afterSegments?o(this.afterSegments,r):r}}},_.prototype.resolve=function(t){var e=this.inside.get(t);if(null!=e){var n=this.before.resolve(t);if(n){var r=this.afterSegments?n.concat(e,this.afterSegments):n.concat(e);return this._resolvePatch(t,r)}}},_.prototype.dependencies=function(t,e){var n=this.before.dependencies(t,e);n&&n.pop();var r=this.inside.dependencies(t,e);return k(i(n,r),this,t)},b.prototype=Object.create(f.prototype),b.prototype.constructor=b,b.prototype.type="DeferRenderExpression",b.prototype.serialize=function(){return e.instance(this,this.template,this.meta)},b.prototype.get=function(t){return new n.ContextClosure(this.template,t)},x.prototype=Object.create(f.prototype),x.prototype.constructor=x,x.prototype.type="ArrayExpression",x.prototype.serialize=function(){return e.instance(this,this.items,this.afterSegments,this.meta)},x.prototype.get=function(t){for(var e=new Array(this.items.length),n=0;n<this.items.length;n++){var r=this.items[n].get(t);e[n]=r}return this.afterSegments?o(this.afterSegments,e):e},x.prototype.dependencies=function(t,e){if(this.items){for(var n,r=0;r<this.items.length;r++){var o=this.items[r].dependencies(t,e);n=i(n,o)}return n}},E.prototype=Object.create(f.prototype),E.prototype.constructor=E,E.prototype.type="ObjectExpression",E.prototype.serialize=function(){return e.instance(this,this.properties,this.afterSegments,this.meta)},E.prototype.get=function(t){var e={};for(var n in this.properties){var r=this.properties[n].get(t);e[n]=r}return this.afterSegments?o(this.afterSegments,e):e},E.prototype.dependencies=function(t,e){if(this.properties){var n;for(var r in this.properties){var o=this.properties[r].dependencies(t,e);n=i(n,o)}return n}},w.prototype=Object.create(f.prototype),w.prototype.constructor=w,w.prototype.type="FnExpression",w.prototype.serialize=function(){return e.instance(this,this.segments,this.args,this.afterSegments,this.meta)},w.prototype.get=function(t){var e=this.apply(t);return this.afterSegments?o(this.afterSegments,e):e},w.prototype.apply=function(t,e){if(t.controller){var n=this._lookupParent(t),r=n[this.lastSegment],i=r.get||r;return this._applyFn(i,t,e,n)}},w.prototype._lookupParent=function(e){var n=e.controller,r=this.parentSegments,i=r?o(r,n):n;if(i&&i[this.lastSegment])return i;var s=n.page;if(n!==s&&(i=r?o(r,s):s)&&i[this.lastSegment])return i;if((i=r?o(r,t):t)&&i[this.lastSegment])return i;throw new Error("Function not found for: "+this.segments.join("."))},w.prototype._getInputs=function(t){for(var e=[],n=0,r=this.args.length;n<r;n++){var i=this.args[n].get(t);e.push(u(i,t))}return e},w.prototype._applyFn=function(t,e,n,r){if(!this.args)return n?t.apply(r,n):t.call(r);var i=this._getInputs(e);if(n)for(var o=0,s=n.length;o<s;o++)i.push(n[o]);return t.apply(r,i)},w.prototype.dependencies=function(t,e){var n=[];if(!this.args)return n;for(var r=0,i=this.args.length;r<i;r++){var o=this.args[r].dependencies(t,e);if(o&&!(o.length<1)){for(var s=o.length-1,a=0;a<s;a++)n.push(o[a]);var u=o[s];"*"!==u[u.length-1]&&(u=u.concat("*")),n.push(u)}}return n},w.prototype.set=function(t,e){for(var n,r,i=t.controller;i&&!(n=(r=this.parentSegments?o(this.parentSegments,i):i)&&r[this.lastSegment]);)i=i.parent;var s=n&&n.set;if(!s)throw new Error("No setter function for: "+this.segments.join("."));var a=this._getInputs(t);a.unshift(e);var u=s.apply(r,a);for(var c in u)this.args[c].set(t,u[c])},S.prototype=Object.create(w.prototype),S.prototype.constructor=S,S.prototype.type="NewExpression",S.prototype._applyFn=function(t,e){if(!this.args)return new t;var n=this._getInputs(e);return n.unshift(null),new(t.bind.apply(t,n))},C.prototype=Object.create(w.prototype),C.prototype.constructor=C,C.prototype.type="OperatorExpression",C.prototype.serialize=function(){return e.instance(this,this.name,this.args,this.afterSegments,this.meta)},C.prototype.apply=function(t){var e=this._getInputs(t);return this.getFn.apply(null,e)},C.prototype.set=function(t,e){var n=this._getInputs(t);n.unshift(e);var r=this.setFn.apply(null,n);for(var i in r)this.args[i].set(t,r[i])},M.prototype=Object.create(C.prototype),M.prototype.constructor=M,M.prototype.type="SequenceExpression",M.prototype.serialize=function(){return e.instance(this,this.args,this.afterSegments,this.meta)},M.prototype.name=",",M.prototype.getFn=_$operatorFns_13.get[","],M.prototype.resolve=function(t){return this.args[this.args.length-1].resolve(t)},M.prototype.dependencies=function(t,e){for(var n=[],r=0,i=this.args.length;r<i;r++)for(var o=this.args[r].dependencies(t,e),s=0,a=o.length;s<a;s++)n.push(o[s]);return n},T.prototype=Object.create(f.prototype),T.prototype.constructor=T,T.prototype.type="ViewParentExpression",T.prototype.serialize=function(){return e.instance(this,this.expression,this.meta)},T.prototype.get=function(t){var e=t.forViewParent();return this.expression.get(e)},T.prototype.resolve=function(t){var e=t.forViewParent();return this.expression.resolve(e)},T.prototype.dependencies=function(t,e){var n=t.forViewParent();return this.expression.dependencies(n,e)},T.prototype.pathSegments=function(t){var e=t.forViewParent();return this.expression.pathSegments(e)},T.prototype.set=function(t,e){var n=t.forViewParent();return this.expression.set(n,e)},A.prototype=Object.create(f.prototype),A.prototype.constructor=A,A.prototype.type="ScopedModelExpression",A.prototype.serialize=function(){return e.instance(this,this.expression,this.meta)},A.prototype.get=function(t){var e=this.pathSegments(t);if(e)return t.controller.model.scope(e.join("."))},A.prototype.resolve=function(t){return this.expression.resolve(t)},A.prototype.dependencies=function(t,e){return this.expression.dependencies(t,e)},A.prototype.pathSegments=function(t){return this.expression.pathSegments(t)},A.prototype.set=function(t,e){return this.expression.set(t,e)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var _$derbyTemplates_10={};_$derbyTemplates_10.contexts=_$contexts_11,_$derbyTemplates_10.expressions=_$expressions_12,_$derbyTemplates_10.operatorFns=_$operatorFns_13,_$derbyTemplates_10.options=_$options_14({}),_$derbyTemplates_10.templates=_$templates_15({});var _$Dom_20=Dom;function Dom(t){this.controller=t,this._listeners=null}function DomListener(t,e,n,r){this.type=t,this.target=e,this.listener=n,this.useCapture=!!r}function DestroyListener(t,e){DomListener.call(this,"destroy",t,e)}Dom.prototype._initListeners=function(){var t=this;return this.controller.on("destroy",function(){var e=t._listeners;if(e){for(var n=e.length;n--;)e[n].remove();t._listeners=null}}),this._listeners=[]},Dom.prototype._listenerIndex=function(t){var e=this._listeners;if(!e)return-1;for(var n=e.length;n--;)if(e[n].equals(t))return n;return-1},Dom.prototype.addListener=function(t,e,n,r){"function"==typeof e&&(r=n,n=e,e=document);var i="destroy"===t?new DestroyListener(e,n):new DomListener(t,e,n,r);-1===this._listenerIndex(i)&&(this._listeners||this._initListeners()).push(i);i.add()},Dom.prototype.on=Dom.prototype.addListener,Dom.prototype.once=function(t,e,n,r){"function"==typeof e&&(r=n,n=e,e=document),this.addListener(t,e,function o(){i.removeListener(t,e,o,r);return n.apply(this,arguments)},r);var i=this},Dom.prototype.removeListener=function(t,e,n,r){"function"==typeof e&&(r=n,n=e,e=document);var i=new DomListener(t,e,n,r);i.remove();var o=this._listenerIndex(i);o>-1&&this._listeners.splice(o,1)},DomListener.prototype.equals=function(t){return this.listener===t.listener&&this.target===t.target&&this.type===t.type&&this.useCapture===t.useCapture},DomListener.prototype.add=function(){this.target.addEventListener(this.type,this.listener,this.useCapture)},DomListener.prototype.remove=function(){this.target.removeEventListener(this.type,this.listener,this.useCapture)},DestroyListener.prototype=new DomListener,DestroyListener.prototype.add=function(){var t=this.target.$destroyListeners||(this.target.$destroyListeners=[]);-1===t.indexOf(this.listener)&&t.push(this.listener)},DestroyListener.prototype.remove=function(){var t=this.target.$destroyListeners;if(t){var e=t.indexOf(this.listener);-1!==e&&t.splice(e,1)}};var __EventEmitter_18=_$EventEmitter_30.EventEmitter,_$Controller_18=Controller;function Controller(t,e,n){__EventEmitter_18.call(this),this.dom=new _$Dom_20(this),this.app=t,this.page=e,this.model=n,n.data.$controller=this}_$util_73.mergeInto(Controller.prototype,__EventEmitter_18.prototype),Controller.prototype.emitCancellable=function(){var t=!1;var e=Array.prototype.slice.call(arguments);return e.push(function(){t=!0}),this.emit.apply(this,e),t},Controller.prototype.emitDelayable=function(){var t=Array.prototype.slice.call(arguments),e=t.pop(),n=!1;return t.push(function(){return n=!0,e}),this.emit.apply(this,t),n||e(),n};var _$components_23={},__templates_23=_$derbyTemplates_10.templates,expressions=_$derbyTemplates_10.expressions,slice=[].slice;function Component(t,e){var n=t.controller,r=t.id(),i=["$components",r],o=n.model.root.eventContext(r);o._at=i.join("."),e.id=r,o._set(i,e),o.data=e,_$Controller_18.call(this,n.app,n.page,o),this.parent=n,this.context=t.componentChild(this),this.id=r,this._scope=i,this.page._components[r]=this,this.isDestroyed=!1}function ComponentAttribute(t,e,n){this.expression=t,this.model=e,this.key=n}function ComponentAttributeBinding(t,e,n,r){this.template=new ComponentAttribute(t,e,n),this.context=r,this.condition=t.get(r)}function setModelAttributes(t,e){var n=t.parent.attributes;if(n)for(var r in n){setModelAttribute(t,e,r,n[r])}}function setModelAttribute(t,e,n,r){if(r instanceof expressions.Expression){var i=r.pathSegments(t);if(i)e.root.ref(e._at+"."+n,i.join("."),{updateIndices:!0});else{var o=new ComponentAttributeBinding(r,e,n,t);t.addBinding(o),e.set(n,o.condition)}}else if(r instanceof __templates_23.Template){var s=new __templates_23.ContextClosure(r,t);e.set(n,s)}else e.set(n,r)}function createFactory(t){return t.singleton||t.prototype.singleton?new SingletonComponentFactory(t):new ComponentFactory(t)}function emitInitHooks(t,e){if(t.initHooks)for(var n=0,r=t.initHooks.length;n<r;n++)t.initHooks[n].emit(t,e)}function ComponentModelData(){this.id=null,this.$controller=null}function ComponentFactory(t){this.constructor=t}function __noop_23(){}function SingletonComponentFactory(t){this.constructor=t,this.component=null,t.prototype.destroy=__noop_23}function isBasePrototype(t){return t===Object.prototype||t===Function.prototype||null===t}function getRootPrototype(t){for(;;){var e=Object.getPrototypeOf(t);if(isBasePrototype(e))return t;t=e}}_$components_23.Component=Component,_$components_23.ComponentAttribute=ComponentAttribute,_$components_23.ComponentAttributeBinding=ComponentAttributeBinding,_$components_23.ComponentFactory=ComponentFactory,_$components_23.SingletonComponentFactory=SingletonComponentFactory,_$components_23.createFactory=createFactory,_$components_23.extendComponent=extendComponent,_$util_73.mergeInto(Component.prototype,_$Controller_18.prototype),Component.prototype.destroy=function(){this.emit("destroy"),this.model.removeContextListeners(),this.model.destroy(),delete this.page._components[this.id];var t=this.page._eventModel.object.$components;t&&delete t.object[this.id],this.isDestroyed=!0},Component.prototype.bind=function(t){var e=this;return this.on("destroy",function(){e=null,t=null}),function(){if(t)return t.apply(e,arguments)}},Component.prototype.throttle=function(t,e){var n=this;if(this.on("destroy",function(){n=null,t=null}),null==e||"number"==typeof e){var r,i=e||0,o=function(){var e=s;s=null,r=+new Date,t&&e&&t.apply(n,e)};return function(){var t=!s;if(s=slice.call(arguments),t){var e=+new Date,n=Math.max(r+i-e,0);setTimeout(o,n)}}}if("function"==typeof e){var s;o=function(){var e=s;s=null,t&&e&&t.apply(n,e)};return function(){var t=!s;s=slice.call(arguments),t&&e(o)}}throw new Error("Second argument must be a delay function or number")},Component.prototype.debounce=function(t,e){if("number"!=typeof(e=e||0))throw new Error("Second argument must be a number");var n,r,i=this;this.on("destroy",function(){i=null,t=null});var o=function(){var e=n;n=null,r=null,t&&e&&t.apply(i,e)};return function(){n=slice.call(arguments),r&&clearTimeout(r),r=setTimeout(o,e)}},Component.prototype.debounceAsync=function(t,e){var n=1!==t.length;if("number"!=typeof(e=e||0))throw new Error("Second argument must be a number");var r=this;this.on("destroy",function(){r=null,t=null});var i,o,s=!1;function a(){var e=i;i=null,o=null,t&&e?(s=!0,e.push(a),t.apply(r,e)):s=!1}return function(){i=n?slice.call(arguments):[],o&&clearTimeout(o),s||(o=setTimeout(a,e))}},Component.prototype.get=function(t,e){return this.getView(t).get(this.context,e)},Component.prototype.getFragment=function(t){return this.getView(t).getFragment(this.context)},Component.prototype.getView=function(t){var e=this.context.getView();return t?this.app.views.find(t,e.namespace):e},Component.prototype.getAttribute=function(t){var e=this.context.forAttribute(t);if(e){var n=e.attributes[t];return n instanceof expressions.Expression&&(n=n.get(e)),expressions.renderValue(n,this.context)}},Component.prototype.setAttribute=function(t,e){this.context.parent.attributes[t]=e},Component.prototype.setNullAttribute=function(t,e){var n=this.context.parent.attributes;null==n[t]&&(n[t]=e)},ComponentAttribute.prototype.update=function(t,e){var n=this.expression.get(t);e.condition=n,this.model.setDiff(this.key,n)},ComponentAttributeBinding.prototype=Object.create(__templates_23.Binding.prototype),ComponentAttributeBinding.prototype.constructor=ComponentAttributeBinding,ComponentFactory.prototype.init=function(t){var e=new(this.constructor.DataConstructor||ComponentModelData),n=new this.constructor(t,e);return n.context||Component.call(n,t,e),setModelAttributes(n.context,n.model),emitInitHooks(t,n),n.emit("init",n),n.init&&n.init(n.model),n.context},ComponentFactory.prototype.create=function(t){var e=t.controller;e.emit("create",e),e.create&&e.create(e.model,e.dom)},SingletonComponentFactory.prototype.isSingleton=!0,SingletonComponentFactory.prototype.init=function(t){return this.component||(this.component=new this.constructor),t.componentChild(this.component)},SingletonComponentFactory.prototype.create=__noop_23;var _extendComponent=Object.setPrototypeOf&&Object.getPrototypeOf?function(t){var e=getRootPrototype(t.prototype);e!==Component.prototype&&Object.setPrototypeOf(e,Component.prototype)}:function(t){var e=t.prototype;t.prototype=Object.create(Component.prototype),t.prototype.constructor=t,_$util_73.mergeInto(t.prototype,e)};function extendComponent(t){t.prototype instanceof Component||_extendComponent(t)}var __expressions_25=_$derbyTemplates_10.expressions,_$EventModel_25=EventModel,nextId=1;function ModelRef(t,e,n,r){this.id=nextId++,this.model=t,this.segments=n,this.item=e,this.outside=r,this.result=r.child(e).refChild(this)}function RefOutMap(){}function RefChildrenMap(){}function BindingsMap(){}function ItemContextsMap(){}function EventModelsMap(){}function EventModel(){this.id=nextId++,this.object=null,this.array=null,this.arrayByReference=null,this.refOut=null,this.refChildren=null,this.bindings=null,this.itemContexts=null}function __hasKeys_25(t){for(var e in t)return!0;return!1}function childSetWildcard(t){t._set()}ModelRef.prototype.update=function(){var t=__expressions_25.pathSegments(this.segments),e=__expressions_25.lookup(t,this.model.data);if(this.item!==e){delete this.outside.child(this.item).refChildren[this.id],this.item=e;var n=this.outside.child(this.item);n.refChildren||(n.refChildren=new RefChildrenMap),n.refChildren[this.id]=this.result,this.result.update()}},EventModel.prototype.refChild=function(t){this.refChildren||(this.refChildren=new RefChildrenMap);var e=t.id;return this.refChildren[e]||(this.refChildren[e]=new EventModel),this.refChildren[e]},EventModel.prototype.arrayLookup=function(t,e,n){var r=__expressions_25.pathSegments(n),i=__expressions_25.lookup(r,t.data),o=this.at(n),s=this.at(e);o.refOut||(o.refOut=new RefOutMap);var a=o.refOut[s.id];return null==a&&(a=new ModelRef(t,i,n,s),o.refOut[s.id]=a),a},EventModel.prototype.child=function(t){var e;if("string"==typeof t)this.object||(this.object={}),e=this.object;else if("number"==typeof t)this.array||(this.array=[]),e=this.array;else{if(t instanceof ModelRef)return t.result;this.arrayByReference||(this.arrayByReference=[]),e=this.arrayByReference,t=t.item}return e[t]||(e[t]=new EventModel)},EventModel.prototype.at=function(t){if(null==t)return this;for(var e=this,n=0;n<t.length;n++)e=e.child(t[n]);return e},EventModel.prototype.isEmpty=function(){if(__hasKeys_25(this.dependancies))return!1;if(__hasKeys_25(this.itemContexts))return!1;if(this.object){if(__hasKeys_25(this.object))return!1;this.object=null}if(this.arrayByReference){for(var t=0;t<this.arrayByReference.length;t++)if(null!=this.arrayByReference[t])return!1;this.arrayByReference=null}if(this.array){for(t=0;t<this.array.length;t++)if(null!=this.array[t])return!1;this.array=null}return!0},EventModel.prototype._addItemContext=function(t){t._id||(t._id=nextId++),this.itemContexts||(this.itemContexts=new ItemContextsMap),this.itemContexts[t._id]=t},EventModel.prototype._removeItemContext=function(t){this.itemContexts&&delete this.itemContexts[t._id]},EventModel.prototype._addBinding=function(t){var e=this.bindings||(this.bindings=new BindingsMap);t.eventModels||(t.eventModels=new EventModelsMap),e[t.id]=t,t.eventModels[this.id]=this},EventModel.prototype.addBinding=function(t,e){this.at(t)._addBinding(e)},EventModel.prototype.addItemContext=function(t,e){this.at(t)._addItemContext(e)},EventModel.prototype.removeBinding=function(t){if(t.eventModels){for(var e in t.eventModels){var n=t.eventModels[e];n.bindings&&delete n.bindings[t.id]}t.eventModels=null}},EventModel.prototype._each=function(t,e,n){if(this.refChildren)for(var r in this.refChildren){var i=this.refChildren[r];i&&i._each(t,e,n)}if(t.length!==e){var o,s=t[e];"string"==typeof s?(o=this.object&&this.object[s])&&o._each(t,e+1,n):((o=this.array&&this.array[s])&&o._each(t,e+1,n),(o=this.arrayByReference&&this.arrayByReference[s])&&o._each(t,e+1,n))}else n(this)},EventModel.prototype.localUpdate=function(t,e){if(this.bindings)for(var n in this.bindings){var r=this.bindings[n];r&&r.update(t,e)}if(this.refOut)for(var n in this.refOut){var i=this.refOut[n];i&&i.update()}},EventModel.prototype.update=function(t,e){if(this.localUpdate(t,e),this.object)for(var n in this.object){(i=this.object[n])&&i.update()}if(this.array)for(var r=0;r<this.array.length;r++){(i=this.array[r])&&i.update()}if(this.arrayByReference)for(r=0;r<this.arrayByReference.length;r++){var i;(i=this.arrayByReference[r])&&i.update()}},EventModel.prototype._updateChildItemContexts=function(t,e){if(this.arrayByReference){null==t&&(t=0),null==e&&(e=this.arrayByReference.length);for(var n=t;n<e;n++){var r=this.arrayByReference[n]&&this.arrayByReference[n].itemContexts;if(r)for(var i in r)r[i].item=n}}},EventModel.prototype._updateArray=function(t,e){if(this.array){null==t&&(t=0),null==e&&(e=this.array.length);for(var n=t;n<e;n++){var r=this.array[n];r&&r.update()}}},EventModel.prototype._updateObject=function(){if(this.object)for(var t in this.object){var e=this.object[t];e&&e.update()}},EventModel.prototype._set=function(t,e){this.update(t,e)},EventModel.prototype._insert=function(t,e){if(this._updateArray(t),this.arrayByReference&&this.arrayByReference.length>t){for(var n=0;n<e;n++)this.arrayByReference.splice(t,0,null);this._updateChildItemContexts(t+e)}if(this.bindings)for(var r in this.bindings){var i=this.bindings[r];i&&i.insert(t,e)}this._updateObject()},EventModel.prototype._remove=function(t,e){if(this._updateArray(t),this.arrayByReference&&(this.arrayByReference.splice(t,e),this._updateChildItemContexts(t)),this.bindings)for(var n in this.bindings){var r=this.bindings[n];r&&r.remove(t,e)}this._updateObject()},EventModel.prototype._move=function(t,e,n){var r,i;t<e?(r=t,i=e+n):(r=e,i=t+n),this._updateArray(r,i);var o=this.arrayByReference;if(o&&o.length>r){var s=o.splice(t,n);o.splice.apply(o,[e,0].concat(s)),this._updateChildItemContexts(r,i)}if(this.bindings)for(var a in this.bindings){var u=this.bindings[a];u&&u.move(t,e,n)}this._updateObject()},EventModel.prototype.mutate=function(t,e){this._each(t,0,e);for(var n=0,r=t.length;n++<r;){var i=t.slice(0,n);i.push("*"),this._each(i,0,childSetWildcard)}},EventModel.prototype.set=function(t,e,n){this.mutate(t,function(t){t._set(e,n)})},EventModel.prototype.insert=function(t,e,n){this.mutate(t,function(t){t._insert(e,n)})},EventModel.prototype.remove=function(t,e,n){this.mutate(t,function(t){t._remove(e,n)})},EventModel.prototype.move=function(t,e,n,r){this.mutate(t,function(t){t._move(e,n,r)})};var _$textDiff_27={};function onStringInsert(t,e,n,r){e||(e=""),replaceText(t,e.slice(0,n)+r+e.slice(n),function(t){return n<t?t+r.length:t})}function onStringRemove(t,e,n,r){e||(e=""),replaceText(t,e.slice(0,n)+e.slice(n+r),function(t){return n<t?t-Math.min(r,t-n):t})}function replaceText(t,e,n){var r=n(t.selectionStart),i=n(t.selectionEnd),o=t.scrollTop;t.value=e,t.scrollTop!==o&&(t.scrollTop=o),document.activeElement===t&&(t.selectionStart=r,t.selectionEnd=i)}function onTextInput(t,e,n){var r=t._get(e)||"";if(r!==n){for(var i=0;r.charAt(i)===n.charAt(i);)i++;for(var o=0;r.charAt(r.length-1-o)===n.charAt(n.length-1-o)&&o+i<r.length&&o+i<n.length;)o++;if(r.length!==i+o){var s=r.length-i-o;t._stringRemove(e,i,s)}if(n.length!==i+o){var a=n.slice(i,n.length-o);t._stringInsert(e,i,a)}}}_$textDiff_27.onStringInsert=onStringInsert,_$textDiff_27.onStringRemove=onStringRemove,_$textDiff_27.onTextInput=onTextInput;var contexts=_$derbyTemplates_10.contexts,__expressions_21=_$derbyTemplates_10.expressions,__templates_21=_$derbyTemplates_10.templates,__DependencyOptions_21=_$derbyTemplates_10.options.DependencyOptions,documentListeners=_$documentListeners_24({}),_$Page_21=Page;function Page(t,e){_$Controller_18.call(this,t,this,e),this.params=null,this.init&&this.init(e),this.context=this._createContext(),this._eventModel=null,this._removeModelListeners=null,this._components={},this._addListeners()}function useLegacyListeners(t){var e=!0,n=t.on("changeImmediate",function(r,i){t.removeListener("changeImmediate",n),e=Array.isArray(i)});return t.set("$derby.testEvent",!0),e}function addDependencies(t,e,n){new BindingWrapper(t,e,n).updateDependencies()}_$util_73.mergeInto(Page.prototype,_$Controller_18.prototype),Page.prototype.$bodyClass=function(t){if(t){for(var e=[],n=t.split(":"),r=0,i=n.length;r<i;r++){var o=n.slice(0,r+1).join("-");e.push(o)}return e.join(" ")}},Page.prototype.$preventDefault=function(t){t.preventDefault()},Page.prototype.$stopPropagation=function(t){t.stopPropagation()},Page.prototype._setRenderParams=function(t){this.model.set("$render.ns",t),this.model.set("$render.params",this.params),this.model.set("$render.url",this.params&&this.params.url),this.model.set("$render.query",this.params&&this.params.query)},Page.prototype._setRenderPrefix=function(t){var e=t?t+":":"";this.model.set("$render.prefix",e)},Page.prototype.get=function(t,e,n){return this._setRenderPrefix(e),this.getView(t,e).get(this.context,n)},Page.prototype.getFragment=function(t,e){return this._setRenderPrefix(e),this.getView(t,e).getFragment(this.context)},Page.prototype.getView=function(t,e){return this.app.views.find(t,e)},Page.prototype.render=function(t){this.app.emit("render",this),this.context.pause(),this._setRenderParams(t);var e=this.getFragment("TitleElement",t),n=this.getFragment("BodyElement",t),r=document.getElementsByTagName("title")[0];r.parentNode.replaceChild(e,r),document.body.parentNode.replaceChild(n,document.body),this.context.unpause(),this.create&&this.create(this.model,this.dom),this.app.emit("routeDone",this,"render")},Page.prototype.attach=function(){this.context.pause();var t=this.model.get("$render.ns"),e=this.getView("TitleElement",t),n=this.getView("BodyElement",t),r=document.getElementsByTagName("title")[0];e.attachTo(r.parentNode,r,this.context),n.attachTo(document.body.parentNode,document.body,this.context),this.context.unpause(),this.create&&this.create(this.model,this.dom)},Page.prototype._createContext=function(){var t=new contexts.ContextMeta;t.views=this.app&&this.app.views;var e=new contexts.Context(t,this);return e.expression=new __expressions_21.PathExpression([]),e.alias="#root",e},Page.prototype._addListeners=function(){var t=this._eventModel=new _$EventModel_25;this._addModelListeners(t),this._addContextListeners(t)},Page.prototype.destroy=function(){for(var t in this.emit("destroy"),this._removeModelListeners(),this._components){this._components[t].destroy()}var e=this.model.silent();e.destroy("_page"),e.destroy("$components"),e.unloadAll&&e.unloadAll()},Page.prototype._addModelListeners=function(t){var e=this.model;if(e){if(useLegacyListeners(e))return this._addModelListenersLegacy(t);var n=e.on("changeImmediate",function(e,n){e=_$util_73.castSegments(e.slice()),t.set(e,n.previous,n.pass)}),r=e.on("loadImmediate",function(e){e=_$util_73.castSegments(e.slice()),t.set(e)}),i=e.on("unloadImmediate",function(e,n){e=_$util_73.castSegments(e.slice()),t.set(e,n.previous)}),o=e.on("insertImmediate",function(e,n){e=_$util_73.castSegments(e.slice()),t.insert(e,n.index,n.values.length)}),s=e.on("removeImmediate",function(e,n){e=_$util_73.castSegments(e.slice()),t.remove(e,n.index,n.values.length)}),a=e.on("moveImmediate",function(e,n){e=_$util_73.castSegments(e.slice()),t.move(e,n.from,n.to,n.howMany)});this._removeModelListeners=function(){e.removeListener("changeImmediate",n),e.removeListener("loadImmediate",r),e.removeListener("unloadImmediate",i),e.removeListener("insertImmediate",o),e.removeListener("removeImmediate",s),e.removeListener("moveImmediate",a)}}},Page.prototype._addModelListenersLegacy=function(t){var e=this.model;if(e){var n=e.on("changeImmediate",function(e,n){var r=n[1],i=n[2];e=_$util_73.castSegments(e.slice()),t.set(e,r,i)}),r=e.on("loadImmediate",function(e){e=_$util_73.castSegments(e.slice()),t.set(e)}),i=e.on("unloadImmediate",function(e){e=_$util_73.castSegments(e.slice()),t.set(e)}),o=e.on("insertImmediate",function(e,n){var r=n[0],i=n[1];e=_$util_73.castSegments(e.slice()),t.insert(e,r,i.length)}),s=e.on("removeImmediate",function(e,n){var r=n[0],i=n[1];e=_$util_73.castSegments(e.slice()),t.remove(e,r,i.length)}),a=e.on("moveImmediate",function(e,n){var r=n[0],i=n[1],o=n[2];e=_$util_73.castSegments(e.slice()),t.move(e,r,i,o)});this._removeModelListeners=function(){e.removeListener("changeImmediate",n),e.removeListener("loadImmediate",r),e.removeListener("unloadImmediate",i),e.removeListener("insertImmediate",o),e.removeListener("removeImmediate",s),e.removeListener("moveImmediate",a)}}},Page.prototype._addContextListeners=function(t){this.context.meta.addBinding=function(e){patchTextBinding(e);var n=e.template.expressions;if(n)for(var r=0,i=n.length;r<i;r++)addDependencies(t,n[r],e);else{var o=e.template.expression;addDependencies(t,o,e)}},this.context.meta.removeBinding=function(e){var n=e.meta;if(!n)return;for(var r=n.length;r--;)t.removeBinding(n[r])},this.context.meta.removeNode=function(t){var e=t.$component;e&&e.destroy();var n=t.$destroyListeners;if(n)for(var r=0;r<n.length;r++)n[r]()},this.context.meta.addItemContext=function(e){var n=e.expression.resolve(e);t.addItemContext(n,e)},this.context.meta.removeItemContext=function(t){}};var __nextId_21=1;function BindingWrapper(t,e,n){this.eventModel=t,this.expression=e,this.binding=n,this.id=__nextId_21++,this.eventModels=null,this.dependencies=null,this.ignoreTemplateDependency=n instanceof _$components_23.ComponentAttributeBinding||n.template instanceof __templates_21.DynamicText&&n instanceof __templates_21.RangeBinding,n.meta?n.meta.push(this):n.meta=[this]}function equalDependencies(t,e){var n=t?t.length:-1;if(n!==(e?e.length:-1))return!1;for(var r=0;r<n;r++){var i=t[r],o=e[r],s=i?i.length:-1,a=o?o.length:-1;if(s!==a)return!1;for(var u=0;u<a;u++)if(i[u]!==o[u])return!1}return!0}function patchTextBinding(t){t instanceof __templates_21.AttributeBinding&&"value"===t.name&&("INPUT"===t.element.tagName||"TEXTAREA"===t.element.tagName)&&documentListeners.inputSupportsSelection(t.element)&&t.template.expression.resolve(t.context)&&(t.update=textInputUpdate)}function textInputUpdate(t,e){textUpdate(this,this.element,t,e)}function textUpdate(t,e,n,r){if(r){if(r.$event&&r.$event.target===e)return;if(r.$stringInsert)return _$textDiff_27.onStringInsert(e,n,r.$stringInsert.index,r.$stringInsert.text);if(r.$stringRemove)return _$textDiff_27.onStringRemove(e,n,r.$stringRemove.index,r.$stringRemove.howMany)}t.template.update(t.context,t)}BindingWrapper.prototype.updateDependencies=function(){var t;this.ignoreTemplateDependency&&this.binding.condition instanceof __templates_21.Template&&(t=new __DependencyOptions_21).setIgnoreTemplate(this.binding.condition);var e=this.expression.dependencies(this.binding.context,t);if(this.dependencies){if(equalDependencies(this.dependencies,e))return;this.eventModel.removeBinding(this)}if(e){this.dependencies=e;for(var n=0,r=e.length;n<r;n++){var i=e[n];i&&this.eventModel.addBinding(i,this)}}},BindingWrapper.prototype.update=function(t,e){this.binding.update(t,e),this.updateDependencies()},BindingWrapper.prototype.insert=function(t,e){this.binding.insert(t,e),this.updateDependencies()},BindingWrapper.prototype.remove=function(t,e){this.binding.remove(t,e),this.updateDependencies()},BindingWrapper.prototype.move=function(t,e,n){this.binding.move(t,e,n),this.updateDependencies()};var _$_views_22=function(t,e){var n=t.expressions,r=t.templates;e.deserialize([[function(){return this.template=new r.Template([new r.Element("title",void 0,[new r.Block(new r.Template([new r.DynamicText(new n.PathExpression(["$render","prefix"],new n.ExpressionMeta("$render.prefix"))),new r.Text("Title")],"{{$render.prefix}}Title"),[new r.DynamicViewInstance(new r.Template([new r.DynamicText(new n.PathExpression(["$render","prefix"],new n.ExpressionMeta("$render.prefix"))),new r.Text("Title")],"{{$render.prefix}}Title"),{})])],void 0,!1)])},"TitleElement"],[function(){return this.template=new r.Template([new r.Element("body",{class:new r.DynamicAttribute(new n.FnExpression(["$bodyClass"],[new n.PathExpression(["$render","ns"])],void 0,new n.ExpressionMeta("$bodyClass($render.ns)")))},[new r.Block(new r.Template([new r.DynamicText(new n.PathExpression(["$render","prefix"],new n.ExpressionMeta("$render.prefix"))),new r.Text("Body")],"{{$render.prefix}}Body"),[new r.DynamicViewInstance(new r.Template([new r.DynamicText(new n.PathExpression(["$render","prefix"],new n.ExpressionMeta("$render.prefix"))),new r.Text("Body")],"{{$render.prefix}}Body"),{})])],void 0,!1,!0)])},"BodyElement"],[function(){return this.template=new r.Template([new r.Text("Charts")])},"Title"],[function(){return this.template=new r.Template([new r.ViewInstance("d-codemirror:includes",{}),new r.Element("link",{href:new r.Attribute("//fonts.googleapis.com/css?family=Source+Sans+Pro:400,600|Roboto:400,600"),rel:new r.Attribute("stylesheet"),type:new r.Attribute("text/css")},null,void 0,!1)])},"Head"],[function(){return this.template=new r.Template([new r.ConditionalBlock([new n.OperatorExpression("===",[new n.AliasPathExpression("#root",["$render","query","view"]),new n.LiteralExpression("editor")],void 0,new n.ExpressionMeta('if #root.$render.query.view === "editor"',"if")),new n.OperatorExpression("===",[new n.AliasPathExpression("#root",["$render","query","view"]),new n.LiteralExpression("bars")],void 0,new n.ExpressionMeta('else if #root.$render.query.view === "bars"',"else if")),new n.Expression(new n.ExpressionMeta("else","else"))],[[new r.ViewInstance("editor",{html:new n.ViewParentExpression(new n.PathExpression(["_page","html"],new n.ExpressionMeta("_page.html"))),data:new n.ViewParentExpression(new n.PathExpression(["home","data"],new n.ExpressionMeta("home.data")))})],[new r.ViewInstance("bars",{})],[new r.ViewInstance("bars",{}),new r.ViewInstance("editor",{html:new n.ViewParentExpression(new n.PathExpression(["_page","html"],new n.ExpressionMeta("_page.html"))),data:new n.ViewParentExpression(new n.PathExpression(["home","data"],new n.ExpressionMeta("home.data")))})]])])},"Body"],[function(){return this.template=new r.Template([])},"Tail"],[function(){return this.template=new r.Template([new r.Element("div",{class:new r.Attribute("inputs")},[new r.Element("div",{class:new r.Attribute("add")},[new r.Element("label",void 0,[new r.Element("button",{disabled:new r.DynamicAttribute(new n.OperatorExpression(">=",[new n.PathExpression(["home","data","bars","length"]),new n.LiteralExpression(12)],void 0,new n.ExpressionMeta("home.data.bars.length >= 12"))),class:new r.Attribute("plus")},[new r.Text("+ Add a new bar")],[new r.ElementOn("click",new n.FnExpression(["page","add"],[]))],!1)],void 0,!1)],void 0,!1),new r.EachBlock(new n.PathExpression(["home","data","bars"],new n.ExpressionMeta("each home.data.bars as #bar, #i","each",void 0,"#bar","#i")),[new r.Element("div",{class:new r.Attribute("bar-control")},[new r.Element("input",{type:new r.Attribute("range"),value:new r.DynamicAttribute(new n.AliasPathExpression("#bar",["value"],new n.ExpressionMeta("#bar.value")))},null,void 0,!1),new r.Element("button",{disabled:new r.DynamicAttribute(new n.OperatorExpression("<=",[new n.PathExpression(["home","data","bars","length"]),new n.LiteralExpression(2)],void 0,new n.ExpressionMeta("home.data.bars.length <= 2")))},[new r.Text("×")],[new r.ElementOn("click",new n.FnExpression(["page","remove"],[new n.AliasPathExpression("#i",[])]))],!1)],void 0,!1)])],void 0,!1),new r.Element("div",{class:new r.Attribute("charts")},[new r.Element("div",{class:new r.Attribute("barchart")},[new r.ViewInstance("d-barchart",{data:new n.ViewParentExpression(new n.PathExpression(["home","data","bars"],new n.ExpressionMeta("home.data.bars"))),width:"350",height:"200"})],void 0,!1)],void 0,!1)])},"bars"],[function(){return this.template=new r.Template([new r.Marker("editor"),new r.Element("div",{class:new r.Attribute("renderers")},[new r.Element("div",{class:new r.Attribute("browser render")},[new r.Element("img",{src:new r.Attribute("/images/browser.png"),alt:new r.Attribute("Browser"),title:new r.Attribute("Browser")},null,void 0,!1),new r.Element("div",{class:new r.Attribute("inside")},[new r.DynamicText(new n.FnExpression(["parse"],[new n.PathExpression(["source"])],void 0,new n.ExpressionMeta("parse(source)")))],void 0,!1)],void 0,!1),new r.Element("div",{class:new r.Attribute("mobile render")},[new r.Element("img",{src:new r.Attribute("/images/iphone.png"),alt:new r.Attribute("Mobile"),title:new r.Attribute("Mobile")},null,void 0,!1),new r.Element("div",{class:new r.Attribute("inside")},[new r.DynamicText(new n.FnExpression(["parse"],[new n.PathExpression(["source"])],void 0,new n.ExpressionMeta("parse(source)")))],void 0,!1)],void 0,!1),new r.Element("div",{class:new r.Attribute("email render")},[new r.Element("img",{src:new r.Attribute("/images/email.png"),alt:new r.Attribute("Email"),title:new r.Attribute("Email")},null,void 0,!1),new r.Element("div",{class:new r.Attribute("inside")},[new r.DynamicText(new n.FnExpression(["parse"],[new n.PathExpression(["source"])],void 0,new n.ExpressionMeta("parse(source)")))],void 0,!1)],void 0,!1)],void 0,!1),new r.Element("div",{class:new r.Attribute("editor")},[new r.ViewInstance("d-codemirror",{text:new n.ViewParentExpression(new n.PathExpression(["source"],new n.ExpressionMeta("source"))),options:{tabSize:2,smartIndent:!1,lineNumbers:!0,mode:"htmlmixed"}})],void 0,!1)])},"editor"],[function(){return this.template=new r.Template([new r.Marker("d-codemirror:index"),new r.Element("textarea",void 0,[new r.DynamicText(new n.PathExpression(["text"],new n.ExpressionMeta("text")))],[new r.AsProperty(["textarea"])],!1)])},"d-codemirror:index"],[function(){return this.template=new r.Template([new r.Block(new n.OperatorExpression("||",[new n.AttributePathExpression("static",[]),new n.LiteralExpression("/codemirror")],void 0,new n.ExpressionMeta("with @static || '/codemirror' as #static","with",void 0,"#static")),[new r.Element("link",{rel:new r.Attribute("stylesheet"),href:new r.DynamicAttribute(new r.Template([new r.DynamicText(new n.AliasPathExpression("#static",[],new n.ExpressionMeta("#static"))),new r.Text("/lib/codemirror.css")],"{{#static}}/lib/codemirror.css"))},null,void 0,!1),new r.Element("script",{src:new r.DynamicAttribute(new r.Template([new r.DynamicText(new n.AliasPathExpression("#static",[],new n.ExpressionMeta("#static"))),new r.Text("/lib/codemirror.js")],"{{#static}}/lib/codemirror.js"))},[],void 0,!1),new r.Element("script",void 0,[new r.Text("CodeMirror.modeURL = '"),new r.DynamicText(new n.AliasPathExpression("#static",[],new n.ExpressionMeta("#static"))),new r.Text("/mode/%N/%N.js';")],void 0,!1),new r.Element("script",{src:new r.DynamicAttribute(new r.Template([new r.DynamicText(new n.AliasPathExpression("#static",[],new n.ExpressionMeta("#static"))),new r.Text("/addon/mode/loadmode.js")],"{{#static}}/addon/mode/loadmode.js"))},[],void 0,!1)])])},"d-codemirror:includes"],[function(){return this.template=new r.Template([new r.Marker("d-barchart:index"),new r.Element("div",{class:new r.Attribute("d-barchart")},[new r.Element("svg",{width:new r.DynamicAttribute(new n.PathExpression(["width"],new n.ExpressionMeta("width"))),height:new r.DynamicAttribute(new n.PathExpression(["height"],new n.ExpressionMeta("height")))},[new r.Element("g",{class:new r.Attribute("bars")},[new r.EachBlock(new n.PathExpression(["layout"],new n.ExpressionMeta("each layout as #d, #i","each",void 0,"#d","#i")),[new r.Element("rect",{class:new r.Attribute("bar"),x:new r.DynamicAttribute(new n.AliasPathExpression("#d",["x"],new n.ExpressionMeta("#d.x"))),y:new r.DynamicAttribute(new n.AliasPathExpression("#d",["y"],new n.ExpressionMeta("#d.y"))),width:new r.DynamicAttribute(new n.AliasPathExpression("#d",["width"],new n.ExpressionMeta("#d.width"))),height:new r.DynamicAttribute(new n.AliasPathExpression("#d",["height"],new n.ExpressionMeta("#d.height")))},[],[new r.ElementOn("click",new n.FnExpression(["clicker"],[new n.AliasPathExpression("#d",[]),new n.AliasPathExpression("#i",[]),new n.PathExpression(["$event"]),new n.PathExpression(["$element"])]))],!1,null,"http://www.w3.org/2000/svg")])],void 0,!1,null,"http://www.w3.org/2000/svg")],void 0,!1,null,"http://www.w3.org/2000/svg")],void 0,!1)])},"d-barchart:index"]])},path=_$pathBrowserify_38({}),__EventEmitter_17=_$EventEmitter_30.EventEmitter,__templates_17=_$derbyTemplates_10.templates,_$App_17=App;function App(t,e,n,r){__EventEmitter_17.call(this),this.derby=t,this.name=e,this.filename=n,this.scriptHash="2ed3594e9675d6b1fbaea4e8235a5dfb",this.bundledAt=1580856639757,this.Page=createAppPage(t),this.proto=this.Page.prototype,this.views=new __templates_17.Views,this.tracksRoutes=_$browser_91.setup(this),this.model=null,this.page=null,this._pendingComponentMap={},this._init(r)}function createAppPage(t){var e=t&&t.Page||_$Page_21;function n(){e.apply(this,arguments)}return n.prototype=Object.create(e.prototype),n}_$util_73.mergeInto(App.prototype,__EventEmitter_17.prototype),App.prototype._init=function(){this._waitForAttach=!0,this._cancelAttach=!1,this.model=new this.derby.Model,_$_views_22(_$derbyTemplates_10,this.views),this._contentReady()},App.prototype._finishInit=function(){var t=this._getScript(),e=JSON.parse(t.nextSibling.innerHTML);this.model.createConnection(e),this.emit("model",this.model),_$util_73.isProduction="production"===e.nodeEnv,_$util_73.isProduction||this._autoRefresh(),this.model.unbundle(e);var n=this.createPage();if(n.params=this.model.get("$render.params"),this.emit("ready",n),this._waitForAttach=!1,this._cancelAttach)this.history.refresh();else{if(_$util_73.isProduction)try{n.attach()}catch(t){this.history.refresh(),console.warn("attachment error",t.stack)}else n.attach();this.emit("load",n)}},App.prototype._contentReady=function(){var t=!1,e=this;function n(){document.addEventListener?document.removeEventListener("DOMContentLoaded",n,!1):document.detachEvent("onreadystatechange",n),r()}function r(){if(!t){if(!document.body)return setTimeout(r,0);t=!0,setTimeout(function(){e._finishInit()},0)}}if("loading"!==document.readyState)return r();if(document.addEventListener)document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1);else if(document.attachEvent){var i;document.attachEvent("onreadystatechange",n),window.attachEvent("onload",n);try{i=null==window.frameElement}catch(t){}document.documentElement.doScroll&&i&&function e(){if(!t){try{document.documentElement.doScroll("left")}catch(t){return void setTimeout(e,0)}r()}}()}},App.prototype._getScript=function(){return document.querySelector("script[data-derby-app]")},App.prototype.use=_$util_73.use,App.prototype.serverUse=_$util_73.serverUse,App.prototype.loadViews=function(){},App.prototype.loadStyles=function(){},App.prototype.addViews=function(){throw new Error("Parsing not available. Registering a view from source should not be used in application code. Instead, specify a filename with view.file.")},App.prototype.component=function(t,e,n){if("function"==typeof t&&(e=t,t=null),"function"!=typeof e)throw new Error("Missing component constructor argument");var r,i,o,s,a=e.view;a&&"object"==typeof a?(r=a.is,i=a.file,o=a.source,s=a.dependencies):(r=e.is||e.prototype.name,i=e.view||e.prototype.view);var u=t||r||i&&path.basename(i,".html");if(!u)throw new Error("No view specified for component");if(i&&o)throw new Error("Component may not specify both a view file and source");var c=u.replace(/:index$/,""),l=this.views.nameMap[c];if((l&&l.componentFactory?l.componentFactory.constructor:this._pendingComponentMap[c])!==e){if(n&&l&&!l.fromSerialized)throw new Error('Dependencies cannot override existing views. Already registered "'+u+'"');if(this._pendingComponentMap[c]=e,s)for(var h=0;h<s.length;h++){var p=s[h];Array.isArray(p)?this.component(p[0],p[1],!0):this.component(null,p,!0)}var f;if(i?(this.loadViews(i,u),f=this.views.find(u)):o?(this.addViews(o,u),f=this.views.find(u)):f=t?this.views.find(u):this.views.register(u,""),!f){var d=this.views.findErrorMessage(u);throw new Error(d)}return _$components_23.extendComponent(e),f.componentFactory=_$components_23.createFactory(e),delete this._pendingComponentMap[c],this}},App.prototype.createPage=function(){this.page&&(this.emit("destroyPage",this.page),this.page.destroy());var t=new this.Page(this,this.model);return this.page=t,t},App.prototype.onRoute=function(t,e,n,r){if(this._waitForAttach)this._cancelAttach=!0;else if(this.emit("route",e),e.model.set("$render.params",e.params),e.model.set("$render.url",e.params.url),e.model.set("$render.query",e.params.query),r){var i=this;t.call(e,e,e.model,e.params,n,function(){i.emit("routeDone",e,"transition"),r()})}else t.call(e,e,e.model,e.params,n)},App.prototype._autoRefresh=function(){var t=this,e=this.model.connection;e.on("connected",function(){e.send({derby:"app",name:t.name,hash:t.scriptHash})}),e.on("receive",function(e){if(e.data.derby){var n=e.data;e.data=null,t._handleMessage(n.derby,n)}})},App.prototype._handleMessage=function(t,e){if("refreshViews"===t){new Function("return "+e.views)()(_$derbyTemplates_10,this.views);var n=this.model.get("$render.ns");this.page.render(n)}else if("refreshStyles"===t){var r=document.querySelector('style[data-filename="'+e.filename+'"]');r&&(r.innerHTML=e.css)}else"reload"===t&&this.model.whenNothingPending(function(){window.location=window.location})};var _$Derby_19=Derby;function Derby(){}Derby.prototype=Object.create(_$lib_racer),Derby.prototype.constructor=Derby,Derby.prototype.App=_$App_17,Derby.prototype.Page=_$Page_21,Derby.prototype.Component=_$components_23.Component,Derby.prototype.createApp=function(t,e,n){return new this.App(this,t,e,n)},_$lib_racer.util.isServer||_$documentListeners_24({}).add(document);var _$derby_derby={exports:{}},serverRequire=_$lib_racer.util.serverRequire,__Derby_derby=serverRequire(_$derby_derby,"./lib/DerbyForServer")||_$Derby_19;_$derby_derby.exports=new __Derby_derby,_$derby_derby=_$derby_derby.exports;var startTag=/^<([^\s=\/!>]+)((?:\s+[^\s=\/>]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+)?)?)*)\s*(\/?)\s*>/,endTag=/^<\/([^\s=\/!>]+)[^>]*>/,comment=/^<!--([\s\S]*?)-->/,commentInside=/<!--[\s\S]*?-->/,other=/^<([\s\S]*?)>/,attr=/([^\s=]+)(?:\s*(=)\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+))?)?/g,rawTagsDefault=/^(style|script)$/i;function empty(){}function matchEndDefault(t){return new RegExp("</"+t,"i")}function onStartTag(t,e,n){var r={},i=e[0],o=e[1],s=e[2],a=!!e[3];return t=t.slice(i.length),s.replace(attr,function(t,e,n,i,o,s){r[e]=i||o||s||!n||""}),n(i,o,r,a,t),t}function onTag(t,e,n){var r=e[0];return n(r,e[1],t=t.slice(r.length)),t}function onText(t,e,n,r){var i;return~e?(i=t.slice(0,e),t=t.slice(e)):(i=t,t=""),i&&r(i,n,t),t}function rawEnd(t,e,n){n||(n=0);var r,i=t.search(e),o=t.match(commentInside);return o&&o.index<i?(n+=r=o.index+o[0].length,rawEnd(t=t.slice(r),e,n)):i+n}var _$parse_33=function(t,e){if(null==e&&(e={}),t)for(var n,r,i,o,s,a=e.start||empty,u=e.end||empty,c=e.text||empty,l=e.comment||empty,h=e.other||empty,p=e.matchEnd||matchEndDefault,f=e.error,d=e.rawTags||rawTagsDefault;t;){if(t===r){if(s=new Error("HTML parse error: "+t),!f)throw s;f(s)}if(r=t,"<"===t[0]){if(i=t.match(startTag)){t=onStartTag(t,i,a),o=i[1],d.test(o)&&(t=onText(t,n=rawEnd(t,p(o)),!0,c));continue}if(i=t.match(endTag)){i[1]=i[1],t=onTag(t,i,u);continue}if(i=t.match(comment)){t=onTag(t,i,l);continue}if(i=t.match(other)){t=onTag(t,i,h);continue}}n=t.indexOf("<"),t=onText(t,n,!1,c)}},_$lib_32={exports:{}},replaceEntity;if(_$lib_32.exports={parse:_$parse_33,unescapeEntities:unescapeEntities,isConditionalComment:isConditionalComment,trimLeading:trimLeading,trimText:trimText,trimTag:trimTag,minify:minify},"undefined"!=typeof document){var entityContainer=document.createElement("div");replaceEntity=function(t){return entityContainer.innerHTML=t,entityContainer.textContent||entityContainer.innerText}}else{var entities=_$lib_32.require("./entities.json");replaceEntity=function(t){var e=entities[t];if(e)return e.characters;if("#"!==t.charAt(1))throw new Error("Unrecognized character reference: "+t);var n="x"===t.charAt(2)||"X"===t.charAt(2)?parseInt(t.slice(3,-1),16):parseInt(t.slice(2,-1),10);return String.fromCharCode(n)}}function unescapeEntities(t){return t.replace(/&#?[A-Za-z0-9]+;/g,replaceEntity)}function isConditionalComment(t){return/(?:^<!--\[)|(?:\]-->$)/.test(t)}function trimLeading(t){return t?t.replace(/\r?\n\s*/g,""):""}function trimText(t){return t?t.replace(/\s*\r?\n\s*/g,""):""}function trimTag(t){return t.replace(/(?:\s*\r?\n\s*)+/g,"\n")}function minify(t){var e="",n=!0;return _$parse_33(t,{start:function(t,r,i){n=!("x-no-minify"in i),e+=trimTag(t)},end:function(t){e+=trimTag(t)},text:function(t){e+=n?trimText(t):t},comment:function(t){isConditionalComment(t)&&(e+=t)},other:function(t){e+=t}}),e}_$lib_32=_$lib_32.exports;var _$esprima_29={};!function(t,e){"use strict";"function"==typeof define&&define.amd?define(["exports"],e):e(void 0!==_$esprima_29?_$esprima_29:t.esprima={})}(this,function(t){"use strict";var e,n,r,i,o,s,a,u,c,l,h,p,f,d,m,v,g,y;function _(t,e){if(!t)throw new Error("ASSERT: "+e)}function b(t){return t>=48&&t<=57}function x(t){return"0123456789abcdefABCDEF".indexOf(t)>=0}function E(t){return"01234567".indexOf(t)>=0}function w(t){return 32===t||9===t||11===t||12===t||160===t||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)>=0}function S(t){return 10===t||13===t||8232===t||8233===t}function C(t){return 36===t||95===t||64===t||35===t||t>=65&&t<=90||t>=97&&t<=122||92===t||t>=128&&a.NonAsciiIdentifierStart.test(String.fromCharCode(t))}function M(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||92===t||t>=128&&a.NonAsciiIdentifierPart.test(String.fromCharCode(t))}function T(t,e,n,r,i){var o,s;_("number"==typeof n,"Comment must have valid position"),g.lastCommentStart>=n||(g.lastCommentStart=n,o={type:t,value:e},y.range&&(o.range=[n,r]),y.loc&&(o.loc=i),y.comments.push(o),y.attachComment&&(s={comment:o,leading:null,trailing:null,range:[n,r]},y.pendingComments.push(s)))}function A(){var t,e,n,r;for(t=h-2,e={start:{line:p,column:h-f-2}};h<d;)if(n=c.charCodeAt(h),++h,S(n))return y.comments&&(r=c.slice(t+2,h-1),e.end={line:p,column:h-f-1},T("Line",r,t,h-1,e)),13===n&&10===c.charCodeAt(h)&&++h,++p,void(f=h);y.comments&&(r=c.slice(t+2,h),e.end={line:p,column:h-f},T("Line",r,t,h,e))}function $(){var t,e,n,r;for(y.comments&&(t=h-2,e={start:{line:p,column:h-f-2}});h<d;)if(S(n=c.charCodeAt(h)))13===n&&10===c.charCodeAt(h+1)&&++h,++p,f=++h,h>=d&&U({},s.UnexpectedToken,"ILLEGAL");else if(42===n){if(47===c.charCodeAt(h+1))return++h,++h,void(y.comments&&(r=c.slice(t+2,h-2),e.end={line:p,column:h-f},T("Block",r,t,h,e)));++h}else++h;U({},s.UnexpectedToken,"ILLEGAL")}function k(){var t,e;for(e=0===h;h<d;)if(w(t=c.charCodeAt(h)))++h;else if(S(t))++h,13===t&&10===c.charCodeAt(h)&&++h,++p,f=h,e=!0;else if(47===t)if(47===(t=c.charCodeAt(h+1)))++h,++h,A(),e=!0;else{if(42!==t)break;++h,++h,$()}else if(e&&45===t){if(45!==c.charCodeAt(h+1)||62!==c.charCodeAt(h+2))break;h+=3,A()}else{if(60!==t)break;if("!--"!==c.slice(h+1,h+4))break;++h,++h,++h,++h,A()}}function D(t){var e,n,r,i=0;for(n="u"===t?4:2,e=0;e<n;++e){if(!(h<d&&x(c[h])))return"";r=c[h++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())}return String.fromCharCode(i)}function R(){var t,e;for(t=c.charCodeAt(h++),e=String.fromCharCode(t),92===t&&(117!==c.charCodeAt(h)&&U({},s.UnexpectedToken,"ILLEGAL"),++h,(t=D("u"))&&"\\"!==t&&C(t.charCodeAt(0))||U({},s.UnexpectedToken,"ILLEGAL"),e=t);h<d&&M(t=c.charCodeAt(h));)++h,e+=String.fromCharCode(t),92===t&&(e=e.substr(0,e.length-1),117!==c.charCodeAt(h)&&U({},s.UnexpectedToken,"ILLEGAL"),++h,(t=D("u"))&&"\\"!==t&&M(t.charCodeAt(0))||U({},s.UnexpectedToken,"ILLEGAL"),e+=t);return e}function O(){var t,n;return t=h,{type:1===(n=92===c.charCodeAt(h)?R():function(){var t,e;for(t=h++;h<d;){if(92===(e=c.charCodeAt(h)))return h=t,R();if(!M(e))break;++h}return c.slice(t,h)}()).length?e.Identifier:function(t){return"this"===t||"typeof"===t||"instanceof"===t||"in"===t||"new"===t}(n)?e.Keyword:"undefined"===n?e.Undefined:"null"===n?e.NullLiteral:"true"===n||"false"===n?e.BooleanLiteral:e.Identifier,value:n,lineNumber:p,lineStart:f,range:[t,h]}}function N(){var t,n,r,i,o=h,a=c.charCodeAt(h),u=c[h];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++h,y.tokenize&&(40===a?y.openParenToken=y.tokens.length:123===a&&(y.openCurlyToken=y.tokens.length)),{type:e.Punctuator,value:String.fromCharCode(a),lineNumber:p,lineStart:f,range:[o,h]};default:if(61===(t=c.charCodeAt(h+1)))switch(a){case 37:case 38:case 42:case 43:case 45:case 47:case 60:case 62:case 94:case 124:return h+=2,{type:e.Punctuator,value:String.fromCharCode(a)+String.fromCharCode(t),lineNumber:p,lineStart:f,range:[o,h]};case 33:case 61:return h+=2,61===c.charCodeAt(h)&&++h,{type:e.Punctuator,value:c.slice(o,h),lineNumber:p,lineStart:f,range:[o,h]}}}return n=c[h+1],r=c[h+2],i=c[h+3],">"===u&&">"===n&&">"===r&&"="===i?(h+=4,{type:e.Punctuator,value:">>>=",lineNumber:p,lineStart:f,range:[o,h]}):">"===u&&">"===n&&">"===r?(h+=3,{type:e.Punctuator,value:">>>",lineNumber:p,lineStart:f,range:[o,h]}):"<"===u&&"<"===n&&"="===r?(h+=3,{type:e.Punctuator,value:"<<=",lineNumber:p,lineStart:f,range:[o,h]}):">"===u&&">"===n&&"="===r?(h+=3,{type:e.Punctuator,value:">>=",lineNumber:p,lineStart:f,range:[o,h]}):u===n&&"+-<>&|".indexOf(u)>=0?(h+=2,{type:e.Punctuator,value:u+n,lineNumber:p,lineStart:f,range:[o,h]}):"<>=!+-*%&|^/".indexOf(u)>=0?(++h,{type:e.Punctuator,value:u,lineNumber:p,lineStart:f,range:[o,h]}):void U({},s.UnexpectedToken,"ILLEGAL")}function I(){var t,n,r;if(_(b((r=c[h]).charCodeAt(0))||"."===r,"Numeric literal must start with a decimal digit or a decimal point"),n=h,t="","."!==r){if(t=c[h++],r=c[h],"0"===t){if("x"===r||"X"===r)return++h,function(t){for(var n="";h<d&&x(c[h]);)n+=c[h++];return 0===n.length&&U({},s.UnexpectedToken,"ILLEGAL"),C(c.charCodeAt(h))&&U({},s.UnexpectedToken,"ILLEGAL"),{type:e.NumericLiteral,value:parseInt("0x"+n,16),lineNumber:p,lineStart:f,range:[t,h]}}(n);if(E(r))return function(t){for(var n="0"+c[h++];h<d&&E(c[h]);)n+=c[h++];return(C(c.charCodeAt(h))||b(c.charCodeAt(h)))&&U({},s.UnexpectedToken,"ILLEGAL"),{type:e.NumericLiteral,value:parseInt(n,8),octal:!0,lineNumber:p,lineStart:f,range:[t,h]}}(n);r&&b(r.charCodeAt(0))&&U({},s.UnexpectedToken,"ILLEGAL")}for(;b(c.charCodeAt(h));)t+=c[h++];r=c[h]}if("."===r){for(t+=c[h++];b(c.charCodeAt(h));)t+=c[h++];r=c[h]}if("e"===r||"E"===r)if(t+=c[h++],"+"!==(r=c[h])&&"-"!==r||(t+=c[h++]),b(c.charCodeAt(h)))for(;b(c.charCodeAt(h));)t+=c[h++];else U({},s.UnexpectedToken,"ILLEGAL");return C(c.charCodeAt(h))&&U({},s.UnexpectedToken,"ILLEGAL"),{type:e.NumericLiteral,value:parseFloat(t),lineNumber:p,lineStart:f,range:[n,h]}}function P(){var t,n,r,i,o,a,u,l=!1,m=!1;for(v=null,k(),r=h,_("/"===(n=c[h]),"Regular expression literal must start with a slash"),t=c[h++];h<d;)if(t+=n=c[h++],"\\"===n)S((n=c[h++]).charCodeAt(0))&&U({},s.UnterminatedRegExp),t+=n;else if(S(n.charCodeAt(0)))U({},s.UnterminatedRegExp);else if(l)"]"===n&&(l=!1);else{if("/"===n){m=!0;break}"["===n&&(l=!0)}for(m||U({},s.UnterminatedRegExp),i=t.substr(1,t.length-2),o="";h<d&&M((n=c[h]).charCodeAt(0));)if(++h,"\\"===n&&h<d)if("u"===(n=c[h]))if(u=++h,n=D("u"))for(o+=n,t+="\\u";u<h;++u)t+=c[u];else h=u,o+="u",t+="\\u";else t+="\\";else o+=n,t+=n;try{a=new RegExp(i,o)}catch(t){U({},s.InvalidRegExp)}return y.tokenize?{type:e.RegularExpression,value:a,lineNumber:p,lineStart:f,range:[r,h]}:{literal:t,value:a,range:[r,h]}}function L(){var t,e,n,r;return k(),t=h,e={start:{line:p,column:h-f}},n=P(),e.end={line:p,column:h-f},y.tokenize||(y.tokens.length>0&&(r=y.tokens[y.tokens.length-1]).range[0]===t&&"Punctuator"===r.type&&("/"!==r.value&&"/="!==r.value||y.tokens.pop()),y.tokens.push({type:"RegularExpression",value:n.literal,range:[t,h],loc:e})),n}function j(){var t;return k(),h>=d?{type:e.EOF,lineNumber:p,lineStart:f,range:[h,h]}:40===(t=c.charCodeAt(h))||41===t||58===t?N():39===t||34===t?function(){var t,n,r,i,o,a,u="",l=!1;for(_("'"===(t=c[h])||'"'===t,"String literal must starts with a quote"),n=h,++h;h<d;){if((r=c[h++])===t){t="";break}if("\\"===r)if((r=c[h++])&&S(r.charCodeAt(0)))++p,"\r"===r&&"\n"===c[h]&&++h;else switch(r){case"n":u+="\n";break;case"r":u+="\r";break;case"t":u+="\t";break;case"u":case"x":a=h,(o=D(r))?u+=o:(h=a,u+=r);break;case"b":u+="\b";break;case"f":u+="\f";break;case"v":u+="\v";break;default:E(r)?(0!==(i="01234567".indexOf(r))&&(l=!0),h<d&&E(c[h])&&(l=!0,i=8*i+"01234567".indexOf(c[h++]),"0123".indexOf(r)>=0&&h<d&&E(c[h])&&(i=8*i+"01234567".indexOf(c[h++]))),u+=String.fromCharCode(i)):u+=r}else{if(S(r.charCodeAt(0)))break;u+=r}}return""!==t&&U({},s.UnexpectedToken,"ILLEGAL"),{type:e.StringLiteral,value:u,octal:l,lineNumber:p,lineStart:f,range:[n,h]}}():C(t)?O():46===t?b(c.charCodeAt(h+1))?I():N():b(t)?I():y.tokenize&&47===t?function(){var t,e;if(!(t=y.tokens[y.tokens.length-1]))return L();if("Punctuator"===t.type){if(")"===t.value)return!(e=y.tokens[y.openParenToken-1])||"Keyword"!==e.type||"if"!==e.value&&"while"!==e.value&&"for"!==e.value&&"with"!==e.value?N():L();if("}"===t.value){if(y.tokens[y.openCurlyToken-3]&&"Keyword"===y.tokens[y.openCurlyToken-3].type){if(!(e=y.tokens[y.openCurlyToken-4]))return N()}else{if(!y.tokens[y.openCurlyToken-4]||"Keyword"!==y.tokens[y.openCurlyToken-4].type)return N();if(!(e=y.tokens[y.openCurlyToken-5]))return L()}return r.indexOf(e.value)>=0?N():L()}return L()}return"Keyword"===t.type?L():N()}():N()}function B(){var t,r,i,o;return k(),h,t={start:{line:p,column:h-f}},r=j(),t.end={line:p,column:h-f},r.type!==e.EOF&&(i=[r.range[0],r.range[1]],o=c.slice(r.range[0],r.range[1]),y.tokens.push({type:n[r.type],value:o,range:i,loc:t})),r}function F(){var t;return h=(t=v).range[1],p=t.lineNumber,f=t.lineStart,v=void 0!==y.tokens?B():j(),h=t.range[1],p=t.lineNumber,f=t.lineStart,t}function q(){var t,e,n;t=h,e=p,n=f,v=void 0!==y.tokens?B():j(),h=t,p=e,f=n}function U(t,e){var n,r=Array.prototype.slice.call(arguments,2),i=e.replace(/%(\d)/g,function(t,e){return _(e<r.length,"Message reference must be in range"),r[e]});throw"number"==typeof t.lineNumber?((n=new Error("Line "+t.lineNumber+": "+i)).index=t.range[0],n.lineNumber=t.lineNumber,n.column=t.range[0]-f+1):((n=new Error("Line "+p+": "+i)).index=h,n.lineNumber=p,n.column=h-f+1),n.description=i,n}function H(){try{U.apply(null,arguments)}catch(t){if(!y.errors)throw t;y.errors.push(t)}}function V(t){if(t.type===e.EOF&&U(t,s.UnexpectedEOS),t.type===e.NumericLiteral&&U(t,s.UnexpectedNumber),t.type===e.StringLiteral&&U(t,s.UnexpectedString),t.type===e.Identifier&&U(t,s.UnexpectedIdentifier),t.type===e.Keyword){if(t.value,l&&(t.value,0))return void H(t,s.StrictReservedWord);U(t,s.UnexpectedToken,t.value)}U(t,s.UnexpectedToken,t.value)}function z(t){var n=F();n.type===e.Punctuator&&n.value===t||V(n)}function Q(t){return v.type===e.Punctuator&&v.value===t}function G(t){return v.type===e.Keyword&&v.value===t}function W(t){return t.type===i.Identifier||t.type===i.MemberExpression}function Y(t,e){var n,r;return n=l,k(),m.markStart(),r=parseFunctionSourceElements(),e&&l&&(t[0].name,0)&&H(e,s.StrictParamName),l=n,m.markEnd(m.createFunctionExpression(null,t,[],r))}function X(){var t;return k(),m.markStart(),(t=F()).type===e.StringLiteral||t.type===e.NumericLiteral?(l&&t.octal&&H(t,s.StrictOctalLiteral),m.markEnd(m.createLiteral(t))):m.markEnd(m.createIdentifier(t.value))}function J(){var t,n,r,i,o;return t=v,k(),m.markStart(),t.type===e.Identifier?(r=X(),"get"!==t.value||Q(":")?"set"!==t.value||Q(":")?(z(":"),i=ut(),m.markEnd(m.createProperty("init",r,i))):(n=X(),z("("),(t=v).type!==e.Identifier?(z(")"),H(t,s.UnexpectedToken,t.value),i=Y([])):(o=[parseVariableIdentifier()],z(")"),i=Y(o,t)),m.markEnd(m.createProperty("set",n,i))):(n=X(),z("("),z(")"),i=Y([]),m.markEnd(m.createProperty("get",n,i)))):t.type!==e.EOF&&t.type!==e.Punctuator?(n=X(),z(":"),i=ut(),m.markEnd(m.createProperty("init",n,i))):void V(t)}function K(){var t,n,r;return Q("(")?function(){var t;return z("("),t=ct(),z(")"),t}():(t=v.type,m.markStart(),t===e.Identifier?r=m.createIdentifier(F().value):t===e.StringLiteral||t===e.NumericLiteral?(l&&v.octal&&H(v,s.StrictOctalLiteral),r=m.createLiteral(F())):t===e.Keyword?G("this")?(F(),r=m.createThisExpression()):G("function")&&(r=parseFunctionExpression()):t===e.BooleanLiteral?((n=F()).value="true"===n.value,r=m.createLiteral(n)):t===e.Undefined?((n=F()).value=void 0,r=m.createLiteral(n)):t===e.NullLiteral?((n=F()).value=null,r=m.createLiteral(n)):Q("[")?r=function(){var t=[];for(z("[");!Q("]");)Q(",")?(F(),t.push(null)):(t.push(ut()),Q("]")||z(","));return z("]"),m.createArrayExpression(t)}():Q("{")?r=function(){var t,e,n,r,a=[],u={},c=String;for(z("{");!Q("}");)e=(t=J()).key.type===i.Identifier?t.key.name:c(t.key.value),r="init"===t.kind?o.Data:"get"===t.kind?o.Get:o.Set,n="$"+e,Object.prototype.hasOwnProperty.call(u,n)?(u[n]===o.Data?l&&r===o.Data?H({},s.StrictDuplicateProperty):r!==o.Data&&H({},s.AccessorDataProperty):r===o.Data?H({},s.AccessorDataProperty):u[n]&r&&H({},s.AccessorGetSet),u[n]|=r):u[n]=r,a.push(t),Q("}")||z(",");return z("}"),m.createObjectExpression(a)}():(Q("/")||Q("/="))&&(r=void 0!==y.tokens?m.createLiteral(L()):m.createLiteral(P()),q()),r?m.markEnd(r):void V(F()))}function Z(){var t=[];if(z("("),!Q(")"))for(;h<d&&(t.push(ut()),!Q(")"));)z(",");return z(")"),t}function tt(){var t;return m.markStart(),function(t){return t.type===e.Identifier||t.type===e.Keyword||t.type===e.BooleanLiteral||t.type===e.Undefined||t.type===e.NullLiteral}(t=F())||V(t),m.markEnd(m.createIdentifier(t.value))}function et(){return z("."),tt()}function nt(){var t;return z("["),t=ct(),z("]"),t}function rt(){var t,n,r,i;return m.markStart(),r="new",(i=F()).type===e.Keyword&&i.value===r||V(i),t=function(){var t,e,n,r;t=ft(),e=g.allowIn,n=G("new")?rt():K(),g.allowIn=e;for(;Q(".")||Q("[");)Q("[")?(r=nt(),n=m.createMemberExpression("[",n,r)):(r=et(),n=m.createMemberExpression(".",n,r)),t&&(t.end(),t.apply(n));return n}(),n=Q("(")?Z():[],m.markEnd(m.createNewExpression(t,n))}function it(){var t,n,r,o,a,u;return m.markStart(),t=function(){var t,e,n,r,i;for(t=ft(),e=g.allowIn,g.allowIn=!0,n=G("new")?rt():K(),g.allowIn=e;Q(".")||Q("[")||Q("(");)Q("(")?(r=Z(),n=m.createCallExpression(n,r)):Q("[")?(i=nt(),n=m.createMemberExpression("[",n,i)):(i=et(),n=m.createMemberExpression(".",n,i)),t&&(t.end(),t.apply(n));return n}(),v.type===e.Punctuator&&(!Q("++")&&!Q("--")||(r=h,o=p,a=f,k(),u=p!==o,h=r,p=o,f=a,u)||(l&&t.type===i.Identifier&&(t.name,0)&&H({},s.StrictLHSPostfix),W(t)||H({},s.InvalidLHSInAssignment),n=F(),t=m.createPostfixExpression(n.value,t))),m.markEndIf(t)}function ot(){var t,n;return m.markStart(),v.type!==e.Punctuator&&v.type!==e.Keyword?n=it():Q("++")||Q("--")?(t=F(),n=ot(),l&&n.type===i.Identifier&&(n.name,0)&&H({},s.StrictLHSPrefix),W(n)||H({},s.InvalidLHSInAssignment),n=m.createUnaryExpression(t.value,n)):Q("+")||Q("-")||Q("~")||Q("!")?(t=F(),n=ot(),n=m.createUnaryExpression(t.value,n)):G("delete")||G("void")||G("typeof")?(t=F(),n=ot(),n=m.createUnaryExpression(t.value,n),l&&"delete"===n.operator&&n.argument.type===i.Identifier&&H({},s.StrictDelete)):n=it(),m.markEndIf(n)}function st(t,n){var r=0;if(t.type!==e.Punctuator&&t.type!==e.Keyword)return 0;switch(t.value){case"||":r=1;break;case"&&":r=2;break;case"|":r=3;break;case"^":r=4;break;case"&":r=5;break;case"==":case"!=":case"===":case"!==":r=6;break;case"<":case">":case"<=":case">=":case"instanceof":r=7;break;case"in":r=n?7:0;break;case"<<":case">>":case">>>":r=8;break;case"+":case"-":r=9;break;case"*":case"/":case"%":r=11}return r}function at(){var t,e,n,r;return m.markStart(),t=function(){var t,e,n,r,i,o,s,a,u,c;if(t=ft(),u=ot(),0===(i=st(r=v,g.allowIn)))return u;for(r.prec=i,F(),e=[t,ft()],o=[u,r,s=ot()];(i=st(v,g.allowIn))>0;){for(;o.length>2&&i<=o[o.length-2].prec;)s=o.pop(),a=o.pop().value,u=o.pop(),n=m.createBinaryExpression(a,u,s),e.pop(),(t=e.pop())&&(t.end(),t.apply(n)),o.push(n),e.push(t);(r=F()).prec=i,o.push(r),e.push(ft()),n=ot(),o.push(n)}for(n=o[c=o.length-1],e.pop();c>1;)n=m.createBinaryExpression(o[c-1].value,o[c-2],n),c-=2,(t=e.pop())&&(t.end(),t.apply(n));return n}(),Q("?")?(F(),e=g.allowIn,g.allowIn=!0,n=ut(),g.allowIn=e,z(":"),r=ut(),t=m.markEnd(m.createConditionalExpression(t,n,r))):m.markEnd({}),t}function ut(){var t,n,r,o,a;return t=v,m.markStart(),o=n=at(),v.type!==e.Punctuator||"="!==(a=v.value)&&"*="!==a&&"/="!==a&&"%="!==a&&"+="!==a&&"-="!==a&&"<<="!==a&&">>="!==a&&">>>="!==a&&"&="!==a&&"^="!==a&&"|="!==a||(W(n)||H({},s.InvalidLHSInAssignment),l&&n.type===i.Identifier&&(n.name,0)&&H(t,s.StrictLHSAssignment),t=F(),r=ut(),o=m.createAssignmentExpression(t.value,n,r)),m.markEndIf(o)}function ct(){var t;if(m.markStart(),t=ut(),Q(","))for(t=m.createSequenceExpression([t]);h<d&&Q(",");)F(),t.expressions.push(ut());return m.markEndIf(t)}function lt(){var t,n=ct();return 59!==c.charCodeAt(h)?(t=p,k(),p===t&&(Q(";")?F():v.type===e.EOF||Q("}")||V(v))):F(),m.createExpressionStatement(n)}function ht(){var t,e,n,r=[];for(t=0;t<y.tokens.length;++t)n={type:(e=y.tokens[t]).type,value:e.value},y.range&&(n.range=e.range),y.loc&&(n.loc=e.loc),r.push(n);y.tokens=r}function pt(){this.marker=[h,p,h-f,0,0,0]}function ft(){return y.loc||y.range?(k(),new pt):null}(n={})[(e={UndefinedLiteral:-1,BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9}).UndefinedLiteral]="Undefined",n[e.BooleanLiteral]="Boolean",n[e.EOF]="<end>",n[e.Identifier]="Identifier",n[e.Keyword]="Keyword",n[e.NullLiteral]="Null",n[e.NumericLiteral]="Numeric",n[e.Punctuator]="Punctuator",n[e.StringLiteral]="String",n[e.RegularExpression]="RegularExpression",r=["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="],i={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BinaryExpression:"BinaryExpression",CallExpression:"CallExpression",ConditionalExpression:"ConditionalExpression",ExpressionStatement:"ExpressionStatement",FunctionExpression:"FunctionExpression",Identifier:"Identifier",Literal:"Literal",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",Property:"Property",SequenceExpression:"SequenceExpression",ThisExpression:"ThisExpression",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression"},o={Data:1,Get:2,Set:4},s={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"},a={NonAsciiIdentifierStart:new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]"),NonAsciiIdentifierPart:new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮ̀-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁ҃-҇Ҋ-ԧԱ-Ֆՙա-և֑-ׇֽֿׁׂׅׄא-תװ-ײؐ-ؚؠ-٩ٮ-ۓە-ۜ۟-۪ۨ-ۼۿܐ-݊ݍ-ޱ߀-ߵߺࠀ-࠭ࡀ-࡛ࢠࢢ-ࢬࣤ-ࣾऀ-ॣ०-९ॱ-ॷॹ-ॿঁ-ঃঅ-ঌএঐও-নপ-রলশ-হ়-ৄেৈো-ৎৗড়ঢ়য়-ৣ০-ৱਁ-ਃਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹ਼ਾ-ੂੇੈੋ-੍ੑਖ਼-ੜਫ਼੦-ੵઁ-ઃઅ-ઍએ-ઑઓ-નપ-રલળવ-હ઼-ૅે-ૉો-્ૐૠ-ૣ૦-૯ଁ-ଃଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହ଼-ୄେୈୋ-୍ୖୗଡ଼ଢ଼ୟ-ୣ୦-୯ୱஂஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹா-ூெ-ைொ-்ௐௗ௦-௯ఁ-ఃఅ-ఌఎ-ఐఒ-నప-ళవ-హఽ-ౄె-ైొ-్ౕౖౘౙౠ-ౣ౦-౯ಂಃಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹ಼-ೄೆ-ೈೊ-್ೕೖೞೠ-ೣ೦-೯ೱೲംഃഅ-ഌഎ-ഐഒ-ഺഽ-ൄെ-ൈൊ-ൎൗൠ-ൣ൦-൯ൺ-ൿංඃඅ-ඖක-නඳ-රලව-ෆ්ා-ුූෘ-ෟෲෳก-ฺเ-๎๐-๙ກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ູົ-ຽເ-ໄໆ່-ໍ໐-໙ໜ-ໟༀ༘༙༠-༩༹༵༷༾-ཇཉ-ཬཱ-྄྆-ྗྙ-ྼ࿆က-၉ၐ-ႝႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚ፝-፟ᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-᜔ᜠ-᜴ᝀ-ᝓᝠ-ᝬᝮ-ᝰᝲᝳក-៓ៗៜ៝០-៩᠋-᠍᠐-᠙ᠠ-ᡷᢀ-ᢪᢰ-ᣵᤀ-ᤜᤠ-ᤫᤰ-᤻᥆-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉ᧐-᧙ᨀ-ᨛᨠ-ᩞ᩠-᩿᩼-᪉᪐-᪙ᪧᬀ-ᭋ᭐-᭙᭫-᭳ᮀ-᯳ᰀ-᰷᱀-᱉ᱍ-ᱽ᳐-᳔᳒-ᳶᴀ-ᷦ᷼-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼ‌‍‿⁀⁔ⁱⁿₐ-ₜ⃐-⃥⃜⃡-⃰ℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯ⵿-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⷠ-ⷿⸯ々-〇〡-〯〱-〵〸-〼ぁ-ゖ゙゚ゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘫꙀ-꙯ꙴ-꙽ꙿ-ꚗꚟ-꛱ꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠧꡀ-ꡳꢀ-꣄꣐-꣙꣠-ꣷꣻ꤀-꤭ꤰ-꥓ꥠ-ꥼꦀ-꧀ꧏ-꧙ꨀ-ꨶꩀ-ꩍ꩐-꩙ꩠ-ꩶꩺꩻꪀ-ꫂꫛ-ꫝꫠ-ꫯꫲ-꫶ꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯪ꯬꯭꯰-꯹가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻ︀-️︠-︦︳︴﹍-﹏ﹰ-ﹴﹶ-ﻼ０-９Ａ-Ｚ＿ａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]")},u={name:"SyntaxTree",markStart:function(){y.loc&&(g.markerStack.push(h-f),g.markerStack.push(p)),y.range&&g.markerStack.push(h)},processComment:function(t){var e,n,r,o,s;if(void 0!==t.type&&t.type!==i.Program)for(q(),e=0;e<y.pendingComments.length;++e)n=y.pendingComments[e],t.range[0]>=n.comment.range[1]&&((s=n.leading)?(r=s.range[0],o=s.range[1]-r,t.range[0]<=r&&t.range[1]-t.range[0]>=o&&(n.leading=t)):n.leading=t),t.range[1]<=n.comment.range[0]&&((s=n.trailing)?(r=s.range[0],o=s.range[1]-r,t.range[0]<=r&&t.range[1]-t.range[0]>=o&&(n.trailing=t)):n.trailing=t)},markEnd:function(t){return y.range&&(t.range=[g.markerStack.pop(),h]),y.loc&&(t.loc={start:{line:g.markerStack.pop(),column:g.markerStack.pop()},end:{line:p,column:h-f}},this.postProcess(t)),y.attachComment&&this.processComment(t),t},markEndIf:function(t){return t.range||t.loc?(y.loc&&(g.markerStack.pop(),g.markerStack.pop()),y.range&&g.markerStack.pop()):this.markEnd(t),t},postProcess:function(t){return y.source&&(t.loc.source=y.source),t},createArrayExpression:function(t){return{type:i.ArrayExpression,elements:t}},createAssignmentExpression:function(t,e,n){return{type:i.AssignmentExpression,operator:t,left:e,right:n}},createBinaryExpression:function(t,e,n){return{type:"||"===t||"&&"===t?i.LogicalExpression:i.BinaryExpression,operator:t,left:e,right:n}},createCallExpression:function(t,e){return{type:i.CallExpression,callee:t,arguments:e}},createConditionalExpression:function(t,e,n){return{type:i.ConditionalExpression,test:t,consequent:e,alternate:n}},createExpressionStatement:function(t){return{type:i.ExpressionStatement,expression:t}},createFunctionExpression:function(t,e,n,r){return{type:i.FunctionExpression,id:t,params:e,defaults:n,body:r,rest:null,generator:!1,expression:!1}},createIdentifier:function(t){return{type:i.Identifier,name:t}},createLiteral:function(t){return{type:i.Literal,value:t.value,raw:c.slice(t.range[0],t.range[1])}},createMemberExpression:function(t,e,n){return{type:i.MemberExpression,computed:"["===t,object:e,property:n}},createNewExpression:function(t,e){return{type:i.NewExpression,callee:t,arguments:e}},createObjectExpression:function(t){return{type:i.ObjectExpression,properties:t}},createPostfixExpression:function(t,e){return{type:i.UpdateExpression,operator:t,argument:e,prefix:!1}},createProperty:function(t,e,n){return{type:i.Property,key:e,value:n,kind:t}},createSequenceExpression:function(t){return{type:i.SequenceExpression,expressions:t}},createThisExpression:function(){return{type:i.ThisExpression}},createUnaryExpression:function(t,e){return"++"===t||"--"===t?{type:i.UpdateExpression,operator:t,argument:e,prefix:!0}:{type:i.UnaryExpression,operator:t,argument:e,prefix:!0}}},pt.prototype={constructor:pt,end:function(){this.marker[3]=h,this.marker[4]=p,this.marker[5]=h-f},apply:function(t){y.range&&(t.range=[this.marker[0],this.marker[3]]),y.loc&&(t.loc={start:{line:this.marker[1],column:this.marker[2]},end:{line:this.marker[4],column:this.marker[5]}},t=m.postProcess(t)),y.attachComment&&m.processComment(t)}},t.version="1.1.0-dev",t.tokenize=function(t,n){var r,i;r=String,"string"==typeof t||t instanceof String||(t=r(t)),m=u,h=0,p=(c=t).length>0?1:0,f=0,d=c.length,v=null,g={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},y={},(n=n||{}).tokens=!0,y.tokens=[],y.tokenize=!0,y.openParenToken=-1,y.openCurlyToken=-1,y.range="boolean"==typeof n.range&&n.range,y.loc="boolean"==typeof n.loc&&n.loc,"boolean"==typeof n.comment&&n.comment&&(y.comments=[]),"boolean"==typeof n.tolerant&&n.tolerant&&(y.errors=[]),d>0&&void 0===c[0]&&t instanceof String&&(c=t.valueOf());try{if(q(),v.type===e.EOF)return y.tokens;for(F();v.type!==e.EOF;)try{F()}catch(t){if(y.errors){y.errors.push(t);break}throw t}ht(),i=y.tokens,void 0!==y.comments&&(i.comments=y.comments),void 0!==y.errors&&(i.errors=y.errors)}catch(t){throw t}finally{y={}}return i},t.parse=function(t,e){var n,r;r=String,"string"==typeof t||t instanceof String||(t=r(t)),m=u,h=0,p=(c=t).length>0?1:0,f=0,d=c.length,v=null,g={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1,markerStack:[]},y={},void 0!==e&&(y.range="boolean"==typeof e.range&&e.range,y.loc="boolean"==typeof e.loc&&e.loc,y.attachComment="boolean"==typeof e.attachComment&&e.attachComment,y.loc&&null!==e.source&&void 0!==e.source&&(y.source=r(e.source)),"boolean"==typeof e.tokens&&e.tokens&&(y.tokens=[]),"boolean"==typeof e.comment&&e.comment&&(y.comments=[]),"boolean"==typeof e.tolerant&&e.tolerant&&(y.errors=[]),y.attachComment&&(y.range=!0,y.pendingComments=[],y.comments=[])),d>0&&void 0===c[0]&&t instanceof String&&(c=t.valueOf());try{k(),m.markStart(),l=!1,q(),n=m.markEnd(lt()),void 0!==y.comments&&(n.comments=y.comments),void 0!==y.tokens&&(ht(),n.tokens=y.tokens),void 0!==y.errors&&(n.errors=y.errors),y.attachComment&&function(){var t,e,n,r;for(t=0;t<y.pendingComments.length;++t)(e=y.pendingComments[t]).comment,(n=e.leading)&&(void 0===n.leadingComments&&(n.leadingComments=[]),n.leadingComments.push(e.comment)),(r=e.trailing)&&(void 0===r.trailingComments&&(r.trailingComments=[]),r.trailingComments.push(e.comment));y.pendingComments=[]}()}catch(t){throw t}finally{y={}}return n},t.Syntax=function(){var t,e={};for(t in"function"==typeof Object.create&&(e=Object.create(null)),i)i.hasOwnProperty(t)&&(e[t]=i[t]);return"function"==typeof Object.freeze&&Object.freeze(e),e}()});var __expressions_7=_$derbyTemplates_10.expressions,operatorFns=_$derbyTemplates_10.operatorFns,Syntax=_$esprima_29.Syntax,_$createPathExpression_7=createPathExpression;function createPathExpression(t){return reduce(_$esprima_29.parse(t).expression)}function reduce(t){var e=t.type;return e===Syntax.MemberExpression?reduceMemberExpression(t):e===Syntax.Identifier?reduceIdentifier(t):e===Syntax.ThisExpression?reduceThis(t):e===Syntax.CallExpression?reduceCallExpression(t):e===Syntax.Literal?reduceLiteral(t):e===Syntax.UnaryExpression?reduceUnaryExpression(t):e===Syntax.BinaryExpression||e===Syntax.LogicalExpression?reduceBinaryExpression(t):e===Syntax.ConditionalExpression?reduceConditionalExpression(t):e===Syntax.ArrayExpression?reduceArrayExpression(t):e===Syntax.ObjectExpression?reduceObjectExpression(t):e===Syntax.SequenceExpression?reduceSequenceExpression(t):e===Syntax.NewExpression?reduceNewExpression(t):void unexpected(t)}function reduceMemberExpression(t,e){if(t.computed){if(t.property.type===Syntax.Literal)return reducePath(t,t.property.value,e);var n=reduce(t.object),r=reduce(t.property);return new __expressions_7.BracketsExpression(n,r,e)}if(t.property.type===Syntax.Identifier)return reducePath(t,t.property.name);unexpected(t)}function reducePath(t,e,n){var r=[e];n&&(r=r.concat(n));for(var i=!1;t=t.object;)if(t.type===Syntax.MemberExpression){if(t.computed)return reduceMemberExpression(t,r);t.property.type===Syntax.Identifier?r.unshift(t.property.name):unexpected(t)}else if(t.type===Syntax.Identifier)r.unshift(t.name);else if(t.type===Syntax.ThisExpression)i=!0;else{if(t.type===Syntax.CallExpression)return reduceCallExpression(t,r);if(t.type===Syntax.SequenceExpression)return reduceSequenceExpression(t,r);if(t.type===Syntax.NewExpression)return reduceNewExpression(t,r);unexpected(t)}return i?new __expressions_7.RelativePathExpression(r):createSegmentsExpression(r)}function reduceIdentifier(t){return createSegmentsExpression([t.name])}function reduceThis(t){return new __expressions_7.RelativePathExpression([])}function createSegmentsExpression(t){var e=t[0],n=e.charAt&&e.charAt(0);if("#"===n){var r=e;return t.shift(),new __expressions_7.AliasPathExpression(r,t)}if("@"===n){var i=e.slice(1);return t.shift(),new __expressions_7.AttributePathExpression(i,t)}return new __expressions_7.PathExpression(t)}function reduceCallExpression(t,e){return reduceFnExpression(t,e,__expressions_7.FnExpression)}function reduceNewExpression(t,e){return reduceFnExpression(t,e,__expressions_7.NewExpression)}function reduceFnExpression(t,e,n){var r=t.arguments.map(reduce),i=t.callee;return i.type===Syntax.Identifier?"$at"===i.name?new __expressions_7.ScopedModelExpression(r[0]):new n([i.name],r,e):i.type===Syntax.MemberExpression?new n(reduceMemberExpression(i).segments,r,e):void unexpected(t)}function reduceLiteral(t){return new __expressions_7.LiteralExpression(t.value)}function reduceUnaryExpression(t){var e=t.operator+"U",n=reduce(t.argument);if(n instanceof __expressions_7.LiteralExpression){var r=operatorFns.get[e];return n.value=r(n.value),n}return new __expressions_7.OperatorExpression(e,[n])}function reduceBinaryExpression(t){var e=t.operator,n=reduce(t.left),r=reduce(t.right);if(n instanceof __expressions_7.LiteralExpression&&r instanceof __expressions_7.LiteralExpression){var i=(0,operatorFns.get[e])(n.value,r.value);return new __expressions_7.LiteralExpression(i)}return new __expressions_7.OperatorExpression(e,[n,r])}function reduceConditionalExpression(t){var e=reduce(t.test),n=reduce(t.consequent),r=reduce(t.alternate);if(e instanceof __expressions_7.LiteralExpression&&n instanceof __expressions_7.LiteralExpression&&r instanceof __expressions_7.LiteralExpression){var i=e.value?n.value:r.value;return new __expressions_7.LiteralExpression(i)}return new __expressions_7.OperatorExpression("?",[e,n,r])}function reduceArrayExpression(t){for(var e=[],n=[],r=!0,i=0;i<t.elements.length;i++){var o=reduce(t.elements[i]);n.push(o),r&&o instanceof __expressions_7.LiteralExpression?e.push(o.value):r=!1}return r?new __expressions_7.LiteralExpression(e):new __expressions_7.ArrayExpression(n)}function reduceObjectExpression(t){for(var e={},n={},r=!0,i=0;i<t.properties.length;i++){var o=t.properties[i],s=getKeyName(o.key),a=reduce(o.value);n[s]=a,r&&a instanceof __expressions_7.LiteralExpression?e[s]=a.value:r=!1}return r?new __expressions_7.LiteralExpression(e):new __expressions_7.ObjectExpression(n)}function getKeyName(t){return t.type===Syntax.Identifier?t.name:t.type===Syntax.Literal?t.value:unexpected(t)}function reduceSequenceExpression(t,e){var n=t.expressions.map(reduce);return new __expressions_7.SequenceExpression(n,e)}function unexpected(t){throw new Error("Unexpected Esprima node: "+JSON.stringify(t,null,2))}var _$markup_9={},__EventEmitter_9=_$EventEmitter_30.EventEmitter,__templates_9=_$derbyTemplates_10.templates,markup=_$markup_9=new MarkupParser;function MarkupParser(){__EventEmitter_9.call(this)}function hasListenerFor(t,e){var n=t.hooks;if(!n)return!1;for(var r=0,i=n.length;r<i;r++){var o=n[r];if(o instanceof __templates_9.ElementOn&&o.name===e)return!0}return!1}function __addListener_9(t,e,n){var r=t.hooks||(t.hooks=[]),i=_$createPathExpression_7(n);r.push(new __templates_9.ElementOn(e,i))}function __mergeInto_9(t,e){for(var n in e)t[n]=e[n];return t}__mergeInto_9(MarkupParser.prototype,__EventEmitter_9.prototype),markup.on("element:a",function(t){if(hasListenerFor(t,"click")){var e=t.attributes||(t.attributes={});e.href||(e.href=new __templates_9.Attribute("#"),__addListener_9(t,"click","$preventDefault($event)"))}}),markup.on("element:form",function(t){hasListenerFor(t,"submit")&&__addListener_9(t,"submit","$preventDefault($event)")});var _$lib_8={},__templates_8=_$derbyTemplates_10.templates,__expressions_8=_$derbyTemplates_10.expressions,parseNode;function createTemplate(t,e){for(t=escapeBraced(t),parseNode=new ParseNode(e),_$lib_32.parse(t,{start:parseHtmlStart,end:parseHtmlEnd,text:parseHtmlText,comment:parseHtmlComment,other:parseHtmlOther});parseNode.parent;){var n=(parseNode=parseNode.parent).last();if(n instanceof __templates_8.Element){if("body"===n.tagName||"html"===n.tagName){n.notClosed=!0,n.endTag="";continue}throw new Error("Missing closing HTML tag: "+n.endTag)}__unexpected_8()}return new __templates_8.Template(parseNode.content)}function createStringTemplate(t,e){return t=escapeBraced(t),parseNode=new ParseNode(e),parseText(t,parseTextLiteral,parseTextExpression,"string"),new __templates_8.Template(parseNode.content)}function parseHtmlStart(t,e,n,r){var i,o=e.toLowerCase();"view"===o||viewForTagName(o)||(i=elementHooksFromAttributes(n));var s=parseAttributes(n),a="svg"===o?__templates_8.NAMESPACE_URIS.svg:parseNode.namespaceUri,u=__templates_8.Element;if("tag"===o&&(u=__templates_8.DynamicElement,e=s.is,delete s.is),r||__templates_8.VOID_ELEMENTS[o]){var c=new u(e,s,null,i,r,null,a);parseNode.content.push(c),parseElementClose(o)}else{(parseNode=parseNode.child()).namespaceUri=a;c=new u(e,s,parseNode.content,i,r,null,a);parseNode.parent.content.push(c)}}function parseAttributes(t){var e;for(var n in t){e||(e={});var r=t[n],i=/([^:]+):[^:]/.exec(n),o=i&&__templates_8.NAMESPACE_URIS[i[1]];if(""!==r&&"string"==typeof r){if(parseNode=parseNode.child(),parseText(r,parseTextLiteral,parseTextExpression,"attribute"),1===parseNode.content.length){var s=parseNode.content[0];e[n]=s instanceof __templates_8.Text?new __templates_8.Attribute(s.data,o):s instanceof __templates_8.DynamicText?s.expression instanceof __expressions_8.LiteralExpression?new __templates_8.Attribute(s.expression.value,o):new __templates_8.DynamicAttribute(s.expression,o):new __templates_8.DynamicAttribute(s,o)}else{if(!(parseNode.content.length>1))throw new Error("Error parsing "+n+" attribute: "+r);var a=new __templates_8.Template(parseNode.content,r);e[n]=new __templates_8.DynamicAttribute(a,o)}parseNode=parseNode.parent}else e[n]=new __templates_8.Attribute(r,o)}return e}function parseHtmlEnd(t,e){var n=(parseNode=parseNode.parent).last();if(!(n instanceof __templates_8.DynamicElement&&"tag"===e.toLowerCase()||n instanceof __templates_8.Element&&n.tagName===e))throw new Error("Mismatched closing HTML tag: "+t);parseElementClose(e)}function parseElementClose(t){if("view"!==t){var e=viewForTagName(t);if(e){parseNamedViewElement(n=parseNode.content.pop(),e,e.name)}else{n=parseNode.last();_$markup_9.emit("element",n),_$markup_9.emit("element:"+t,n)}}else{var n;parseViewElement(n=parseNode.content.pop())}}function viewForTagName(t){return parseNode.view&&parseNode.view.views.tagMap[t]}function parseHtmlText(t,e){parseText(t,parseTextLiteral,parseTextExpression,e?"string":"html")}function parseHtmlComment(t,e){if(_$lib_32.isConditionalComment(t)){var n=new __templates_8.Comment(e);parseNode.content.push(n)}}_$lib_8.createTemplate=createTemplate,_$lib_8.createStringTemplate=createStringTemplate,_$lib_8.createExpression=createExpression,_$lib_8.createPathExpression=_$createPathExpression_7,_$lib_8.markup=_$markup_9,__templates_8.View.prototype._parse=function(){var t;try{if(this.literal){var e=this.unminified?this.source:this.source.replace(/^\s*\n/,"").replace(/\s*$/,"");t=new __templates_8.Text(e)}else if(this.string)t=createStringTemplate(this.source,this);else{t=createTemplate(e=this.unminified?this.source:_$lib_32.minify(this.source).replace(/&sp;/g," "),this)}}catch(t){throw appendErrorMessage(t,'\n\nWithin template "'+this.name+'":\n'+this.source)}return this.template=t,t};var doctypeRegExp=/^<!DOCTYPE\s+([^\s]+)(?:\s+(PUBLIC|SYSTEM)\s+"([^"]+)"(?:\s+"([^"]+)")?)?\s*>/i;function parseHtmlOther(t){var e=doctypeRegExp.exec(t);if(e){var n,r,i=e[1],o=e[2]&&e[2].toLowerCase();"public"===o?(n=e[3],r=e[4]):"system"===o&&(r=e[3]);var s=new __templates_8.Doctype(i,n,r);parseNode.content.push(s)}else __unexpected_8(t)}function parseTextLiteral(t){var e=new __templates_8.Text(t);parseNode.content.push(e)}function parseTextExpression(t,e){var n=createExpression(t);if(n.meta.blockType)parseBlockExpression(n);else if("view"===n.meta.valueType)parseViewExpression(n);else if(n.meta.unescaped&&"html"===e){var r=new __templates_8.DynamicHtml(n);parseNode.content.push(r)}else{var i=new __templates_8.DynamicText(n);parseNode.content.push(i)}}function parseBlockExpression(t){var e=t.meta.blockType;if(t.meta.isEnd){var n=(r=(parseNode=parseNode.parent).last())&&(r.expression||r.expressions&&r.expressions[0]);if(!(n&&"end"===e&&n.meta.blockType||e===n.meta.blockType))throw new Error("Mismatched closing template tag: "+t.meta.source)}else if("else"===e||"else if"===e){var r=(parseNode=parseNode.parent).last();parseNode=parseNode.child(),r instanceof __templates_8.ConditionalBlock?(r.expressions.push(t),r.contents.push(parseNode.content)):r instanceof __templates_8.EachBlock?("else"!==e&&__unexpected_8(t.meta.source),r.elseContent=parseNode.content):__unexpected_8(t.meta.source)}else{var i,o=parseNode.child();i="if"===e||"unless"===e?new __templates_8.ConditionalBlock([t],[o.content]):"each"===e?new __templates_8.EachBlock(t,o.content):new __templates_8.Block(t,o.content),parseNode.content.push(i),parseNode=o}}function parseViewElement(t){var e=t.attributes.is||t.attributes.name;if(!e)throw new Error('The <view> element requires an "is" attribute');if(delete t.attributes.is,delete t.attributes.name,e.expression){var n=viewAttributesFromElement(t),r=componentHooksFromAttributes(n);finishParseViewElement(n,t.content||[],createDynamicViewInstance(e.expression,n,r.hooks,r.initHooks))}else{var i=e.data;parseNamedViewElement(t,findView(i),i)}}function findView(t){var e=parseNode.view.views.find(t,parseNode.view.namespace);if(!e){var n=parseNode.view.views.findErrorMessage(t);throw new Error(n)}return e}function parseNamedViewElement(t,e,n){var r=viewAttributesFromElement(t),i=componentHooksFromAttributes(r);finishParseViewElement(r,parseContentAttributes(t.content,e,r),new __templates_8.ViewInstance(e.registeredName,r,i.hooks,i.initHooks))}function createDynamicViewInstance(t,e,n,r){var i=new __templates_8.DynamicViewInstance(t,e,n,r);return new __templates_8.Block(t,[i])}function finishParseViewElement(t,e,n){setContentAttribute(t,e),delete t.within,parseNode.content.push(n)}function setContentAttribute(t,e){t.hasOwnProperty("content")||e.length&&(t.content=attributeValueFromContent(e,t.within))}function attributeValueFromContent(t,e){if(1===t.length){var n=t[0];if(n instanceof __templates_8.Text)return n.data;if(n instanceof __templates_8.DynamicText){var r=n.expression;return r instanceof __expressions_8.LiteralExpression?r.value:e?n:new __expressions_8.ViewParentExpression(r)}}var i=new __templates_8.Template(t);return e?i:new __templates_8.ViewParent(i)}function viewAttributesFromElement(t){var e={};for(var n in t.attributes){var r=t.attributes[n];e[dashToCamelCase(n)]=r.expression instanceof __templates_8.Template?new __templates_8.ViewParent(r.expression):r.expression instanceof __expressions_8.Expression?new __expressions_8.ViewParentExpression(r.expression):r.data}return e}function parseAsAttribute(t,e){var n=_$createPathExpression_7(e);if(!(n instanceof __expressions_8.PathExpression))throw new Error(t+" attribute must be a path: "+t+'="'+e+'"');return n.segments}function parseAsObjectAttribute(t,e){var n;if(!((n=_$createPathExpression_7(e))instanceof __expressions_8.SequenceExpression&&2===n.args.length&&n.args[0]instanceof __expressions_8.PathExpression))throw new Error(t+" attribute requires a path and a key argument: "+t+'="'+e+'"');return{segments:n.args[0].segments,expression:n=n.args[1]}}function parseOnAttribute(t,e){return _$createPathExpression_7(e)}function elementHooksFromAttributes(t,e){if(t){var n=[];for(var r in t){var i=t[r];if("as"!==r)if("as-array"!==r)if("as-object"!==r){var o=/^on-(.+)/.exec(r),s=o&&o[1];if(s){var a=parseOnAttribute(r,i);n.push(new __templates_8.ElementOn(s,a)),delete t[r]}}else{var u=parseAsObjectAttribute(r,i);n.push(new __templates_8.AsObject(u.segments,u.expression)),delete t[r]}else{c=parseAsAttribute(r,i);n.push(new __templates_8.AsArray(c)),delete t[r]}else{var c=parseAsAttribute(r,i);n.push(new __templates_8.AsProperty(c)),delete t[r]}}return n.length?n:void 0}}function componentHooksFromAttributes(t){if(!t)return{};var e=[],n=[];for(var r in t){var i=t[r];if("as"!==r)if("asArray"!==r)if("asObject"!==r){var o=/^on([A-Z_].*)/.exec(r),s=o&&o[1].charAt(0).toLowerCase()+o[1].slice(1);if(s){var a=parseOnAttribute(r,i);n.push(new __templates_8.ComponentOn(s,a)),delete t[r]}}else{var u=parseAsObjectAttribute("as-object",i);e.push(new __templates_8.AsObjectComponent(u.segments,u.expression)),delete t[r]}else{c=parseAsAttribute("as-array",i);e.push(new __templates_8.AsArrayComponent(c)),delete t[r]}else{var c=parseAsAttribute(r,i);e.push(new __templates_8.AsProperty(c)),delete t[r]}}return{hooks:e.length?e:null,initHooks:n.length?n:null}}function dashToCamelCase(t){return t.replace(/-./g,function(t){return t.charAt(1).toUpperCase()})}function parseContentAttributes(t,e,n){var r=[];if(!t)return r;for(var i=0,o=t.length;i<o;i++){var s=t[i];if("attribute"===(a=s instanceof __templates_8.Element&&s.tagName))parseAttributeElement(s,a=parseNameAttribute(s),n);else if(e.attributesMap&&e.attributesMap[a])parseAttributeElement(s,a,n);else if("array"===a){var a;parseArrayElement(s,a=parseNameAttribute(s),n)}else e.arraysMap&&e.arraysMap[a]?parseArrayElement(s,e.arraysMap[a],n):r.push(s)}return r}function parseNameAttribute(t){var e=(t.attributes.is||t.attributes.name).data;if(!e)throw new Error("The <"+t.tagName+'> element requires a literal "is" attribute');return delete t.attributes.is,delete t.attributes.name,e}function parseAttributeElement(t,e,n){var r=dashToCamelCase(e),i=t.attributes&&t.attributes.within;n[r]=attributeValueFromContent(t.content,i)}function createAttributesExpression(t){var e={},n={},r=!0;for(var i in t){var o=t[i];o instanceof __expressions_8.Expression?(e[i]=o,r=!1):o instanceof __templates_8.Template?(e[i]=new __expressions_8.DeferRenderExpression(o),r=!1):(e[i]=new __expressions_8.LiteralExpression(o),n[i]=o)}return r?new __expressions_8.LiteralExpression(n):new __expressions_8.ObjectExpression(e)}function parseArrayElement(t,e,n){var r=viewAttributesFromElement(t);setContentAttribute(r,t.content),delete r.within;var i=createAttributesExpression(r),o=dashToCamelCase(e),s=n[o];if(s instanceof __expressions_8.ArrayExpression)s.items.push(i);else if(Array.isArray(s))if(i instanceof __expressions_8.LiteralExpression)s.push(i.value);else{for(var a=[],u=0;u<s.length;u++)a[u]=new __expressions_8.LiteralExpression(s[u]);a.push(i),n[o]=new __expressions_8.ArrayExpression(a)}else null==s?n[o]=i instanceof __expressions_8.LiteralExpression?[i.value]:new __expressions_8.ArrayExpression([i]):__unexpected_8()}function parseViewExpression(t){var e,n;t instanceof __expressions_8.SequenceExpression?(e=t.args[0],n=t.args[1]):e=t;var r,i=viewAttributesFromExpression(n),o=componentHooksFromAttributes(i);if(e instanceof __expressions_8.LiteralExpression){var s=e.get();findView(s),r=new __templates_8.ViewInstance(s,i,o.hooks,o.initHooks)}else r=createDynamicViewInstance(e,i,o.hooks,o.initHooks);parseNode.content.push(r)}function viewAttributesFromExpression(t){if(t){var e=t instanceof __expressions_8.ObjectExpression?t.properties:t instanceof __expressions_8.LiteralExpression?t.value:null;"object"!=typeof e&&__unexpected_8();var n={};for(var r in e){var i=e[r];n[r]=i instanceof __expressions_8.LiteralExpression?i.value:i instanceof __expressions_8.Expression?new __expressions_8.ViewParentExpression(i):i}return n}}function ParseNode(t,e){this.view=t,this.parent=e,this.content=[],this.namespaceUri=e&&e.namespaceUri}function escapeBraced(t){var e="";return parseText(t,function(t){e+=t},function(t){var n=t.replace(/[&<]/g,function(t){return"&"===t?"&amp;":"&lt;"});e+="{{"+n+"}}"},"string"),e}function unescapeBraced(t){return t.replace(/(?:&amp;|&lt;)/g,function(t){return"&amp;"===t?"&":"<"})}function unescapeTextLiteral(t,e){return"html"===e||"attribute"===e?_$lib_32.unescapeEntities(t):t}function parseText(t,e,n,r){for(var i,o=t;o;){if(o===i)throw new Error("Error parsing template text: "+t);i=o;var s=o.indexOf("{{");if(-1===s)return void e(unescapeTextLiteral(o,r));var a=matchBraces(o,2,s,"{","}");if(-1===a)throw new Error("Mismatched braces in: "+t);if(s>0)e(unescapeTextLiteral(o.slice(0,s),r));var u=o.slice(s+2,a-2);if(u){var c=unescapeBraced(u);n(c=unescapeTextLiteral(c,r),r)}o=o.slice(a)}}function matchBraces(t,e,n,r,i){for(n+=e;e;){var o=t.indexOf(i,n),s=t.indexOf(r,n),a=-1!==s;if(-1!==o&&(!a||o<s))n=o+1,e--;else{if(!a)return-1;n=s+1,e++}}return n}ParseNode.prototype.child=function(){return new ParseNode(this.view,this)},ParseNode.prototype.last=function(){return this.content[this.content.length-1]};var blockRegExp=/^(if|unless|else if|each|with|on)\s+([\s\S]+?)(?:\s+as\s+([^,\s]+)\s*(?:,\s*(\S+))?)?$/,valueRegExp=/^(?:(view|unbound|bound|unescaped)\s+)?([\s\S]*)/;function createExpression(t){t=t.trim();var e,n,r,i,o=new __expressions_8.ExpressionMeta(t),s=blockRegExp.exec(t);if(s)o.blockType=s[1],e=s[2],n=s[3],r=s[4];else if("else"===t||"unbound"===t||"bound"===t)o.blockType=t;else if("/"===t.charAt(0))o.isEnd=!0,o.blockType=t.slice(1).trim()||"end";else{var a;e=t;do{a=(s=valueRegExp.exec(e))[1],e=s[2],"unescaped"===a?o.unescaped=!0:"unbound"===a||"bound"===a?o.bindType=a:a&&(o.valueType=a)}while(a)}try{i=e?_$createPathExpression_7(e):new __expressions_8.Expression,n&&(o.as=parseAlias(n)),r&&(o.keyAs=parseAlias(r))}catch(e){throw appendErrorMessage(e,"\n\nWithin expression: "+t)}return i.meta=o,i}function __unexpected_8(t){throw new Error("Error parsing template: "+t)}function appendErrorMessage(t,e){return t instanceof Error?(t.message+=e,t):new Error(t+e)}function parseAlias(t){var e=_$createPathExpression_7(t);if(e instanceof __expressions_8.AliasPathExpression){if(0===e.segments.length)return e.alias;throw new Error("Alias must not have dots or brackets: "+t)}throw new Error('Alias must be an identifier starting with "#": '+t)}var _$parsing_26={};_$parsing_26=_$parsing_26=_$lib_8;var __path_26=_$pathBrowserify_38({});_$App_17.prototype.addViews=function(t,e){var n=_$parsing_26.parseViews(t,e);_$parsing_26.registerParsedViews(this,n)},_$parsing_26.getImportNamespace=function(t,e,n){var r=__path_26.extname(n),i=null==e.ns?__path_26.basename(e.src,r):e.ns;return t&&i?t+":"+i:t||i||""},_$parsing_26.parseViews=function(t,e,n,r){var i,o,s=[],a=e?e+":":"";return _$lib_32.parse(t+"\n",{rawTags:/^(?:[^\s=\/!>]+:|style|script)$/i,matchEnd:function(t){if(":"===t.slice(-1))return/<\/?[^\s=\/!>]+:[\s>]/i;return new RegExp("</"+t,"i")},start:function(t,e,n){if(":"!==e.charAt(e.length-1))throw new Error("Expected tag ending in colon (:) instead of "+t);if(i=e.slice(0,-1),o=n,"import"===i){if("function"!=typeof r)throw new Error("Template import implementation not provided");r(o)}},text:function(t,e){if(!i||"import"===i)return;s.push({name:a+i,source:t,options:o,filename:n})}}),s},_$parsing_26.registerParsedViews=function(t,e){for(var n=0,r=e.length;n<r;n++){var i=e[n];t.views.register(i.name,i.source,i.options)}};var _$parsing_28=_$parsing_26,_$derbyDebug_6=function(t){t.on("ready",function(e){window.MODEL=e.model,window.APP=t,t.findComponent=findComponent,t.componentCommand=componentCommand,t.derby.Model.prototype.logEvents=logEvents})};function findComponent(t,e){null==e&&(e=0);for(var n,r=document.createTreeWalker(document,128,null,!1);n=r.nextNode();)if(n.data===t){if(0===e)return n.$component;e--}}function componentCommand(t){for(var e,n=0,r=document.createTreeWalker(document,128,null,!1);e=r.nextNode();){if(e===t)return"(component = APP.findComponent('"+e.data+"',"+n+"))";e.data===t.data&&n++}}function logEvents(t){null==t&&(t=""),this.on("all",t+"**",console.log.bind(console))}var _$CM_4={};(function(t){function e(){}if(_$CM_4=e,e.prototype.view=t,require&&require.resolve){var n=_$pathBrowserify_38({}),r=require.resolve("codemirror");e.root=n.resolve(r,"../../")}e.prototype.init=function(){var t=this.model;t.setNull("options",{}),t.setNull("debounce",150)},e.prototype.create=function(){var t,e=this.model,n=this,r=this.getAttribute("options"),i=this.cm=CodeMirror.fromTextArea(this.textarea,r);if(r.mode){var o=r.mode;if(/\//.test(r.mode)){var s=CodeMirror.findModeByMIME(r.mode);s&&(o=s.mode)}CodeMirror.autoLoadMode(i,o)}e.on("change","text",function(t,e,r){if(!r.editing){var o=r.$stringInsert,s=r.$stringRemove;if(o&&o.text)n.supress=!0,i.replaceRange(o.text,i.posFromIndex(o.index)),n.supress=!1,n.check();else if(s&&s.howMany){n.supress=!0;var a=i.posFromIndex(s.index),u=i.posFromIndex(s.howMany);i.replaceRange("",a,u),n.supress=!1}else{var c=n.cm.getCursor();n.supress=!0,n.cm.setValue(t),n.supress=!1,n.cm.setCursor(c)}}}),i.on("change",function(r,i){n.supress||(t&&(clearTimeout(t),t=null),t=setTimeout(function(){var t=r.getValue();n.model.pass({editing:!0}).setDiff("text",t)},e.get("debounce")))})},e.prototype.check=function(){var t=this;setTimeout(function(){var e=t.cm.getValue(),n=t.model.get("text")||"",r=t.cm.getCursor();e!=n&&(t.supress=!0,t.cm.setValue(n),t.supress=!1,t.cm.setCursor(r))},0)}}).call(this,"/node_modules/d-codemirror");var _$d3_5={exports:{}};!function(){var t={version:"3.5.17"},e=[].slice,n=function(t){return e.call(t)},r=this.document;function i(t){return t&&(t.ownerDocument||t.document||t).documentElement}function o(t){return t&&(t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView)}if(r)try{n(r.documentElement.childNodes)[0].nodeType}catch(t){n=function(t){for(var e=t.length,n=new Array(e);e--;)n[e]=t[e];return n}}if(Date.now||(Date.now=function(){return+new Date}),r)try{r.createElement("DIV").style.setProperty("opacity",0,"")}catch(t){var s=this.Element.prototype,a=s.setAttribute,u=s.setAttributeNS,c=this.CSSStyleDeclaration.prototype,l=c.setProperty;s.setAttribute=function(t,e){a.call(this,t,e+"")},s.setAttributeNS=function(t,e,n){u.call(this,t,e,n+"")},c.setProperty=function(t,e,n){l.call(this,t,e+"",n)}}function h(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function p(t){return null===t?NaN:+t}function f(t){return!isNaN(t)}function d(t){return{left:function(e,n,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)<0?r=o+1:i=o}return r},right:function(e,n,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)>0?i=o:r=o+1}return r}}}t.ascending=h,t.descending=function(t,e){return e<t?-1:e>t?1:e>=t?0:NaN},t.min=function(t,e){var n,r,i=-1,o=t.length;if(1===arguments.length){for(;++i<o;)if(null!=(r=t[i])&&r>=r){n=r;break}for(;++i<o;)null!=(r=t[i])&&n>r&&(n=r)}else{for(;++i<o;)if(null!=(r=e.call(t,t[i],i))&&r>=r){n=r;break}for(;++i<o;)null!=(r=e.call(t,t[i],i))&&n>r&&(n=r)}return n},t.max=function(t,e){var n,r,i=-1,o=t.length;if(1===arguments.length){for(;++i<o;)if(null!=(r=t[i])&&r>=r){n=r;break}for(;++i<o;)null!=(r=t[i])&&r>n&&(n=r)}else{for(;++i<o;)if(null!=(r=e.call(t,t[i],i))&&r>=r){n=r;break}for(;++i<o;)null!=(r=e.call(t,t[i],i))&&r>n&&(n=r)}return n},t.extent=function(t,e){var n,r,i,o=-1,s=t.length;if(1===arguments.length){for(;++o<s;)if(null!=(r=t[o])&&r>=r){n=i=r;break}for(;++o<s;)null!=(r=t[o])&&(n>r&&(n=r),i<r&&(i=r))}else{for(;++o<s;)if(null!=(r=e.call(t,t[o],o))&&r>=r){n=i=r;break}for(;++o<s;)null!=(r=e.call(t,t[o],o))&&(n>r&&(n=r),i<r&&(i=r))}return[n,i]},t.sum=function(t,e){var n,r=0,i=t.length,o=-1;if(1===arguments.length)for(;++o<i;)f(n=+t[o])&&(r+=n);else for(;++o<i;)f(n=+e.call(t,t[o],o))&&(r+=n);return r},t.mean=function(t,e){var n,r=0,i=t.length,o=-1,s=i;if(1===arguments.length)for(;++o<i;)f(n=p(t[o]))?r+=n:--s;else for(;++o<i;)f(n=p(e.call(t,t[o],o)))?r+=n:--s;if(s)return r/s},t.quantile=function(t,e){var n=(t.length-1)*e+1,r=Math.floor(n),i=+t[r-1],o=n-r;return o?i+o*(t[r]-i):i},t.median=function(e,n){var r,i=[],o=e.length,s=-1;if(1===arguments.length)for(;++s<o;)f(r=p(e[s]))&&i.push(r);else for(;++s<o;)f(r=p(n.call(e,e[s],s)))&&i.push(r);if(i.length)return t.quantile(i.sort(h),.5)},t.variance=function(t,e){var n,r,i=t.length,o=0,s=0,a=-1,u=0;if(1===arguments.length)for(;++a<i;)f(n=p(t[a]))&&(s+=(r=n-o)*(n-(o+=r/++u)));else for(;++a<i;)f(n=p(e.call(t,t[a],a)))&&(s+=(r=n-o)*(n-(o+=r/++u)));if(u>1)return s/(u-1)},t.deviation=function(){var e=t.variance.apply(this,arguments);return e?Math.sqrt(e):e};var m=d(h);function v(t){return t.length}t.bisectLeft=m.left,t.bisect=t.bisectRight=m.right,t.bisector=function(t){return d(1===t.length?function(e,n){return h(t(e),n)}:t)},t.shuffle=function(t,e,n){(o=arguments.length)<3&&(n=t.length,o<2&&(e=0));for(var r,i,o=n-e;o;)i=Math.random()*o--|0,r=t[o+e],t[o+e]=t[i+e],t[i+e]=r;return t},t.permute=function(t,e){for(var n=e.length,r=new Array(n);n--;)r[n]=t[e[n]];return r},t.pairs=function(t){for(var e=0,n=t.length-1,r=t[0],i=new Array(n<0?0:n);e<n;)i[e]=[r,r=t[++e]];return i},t.transpose=function(e){if(!(o=e.length))return[];for(var n=-1,r=t.min(e,v),i=new Array(r);++n<r;)for(var o,s=-1,a=i[n]=new Array(o);++s<o;)a[s]=e[s][n];return i},t.zip=function(){return t.transpose(arguments)},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e},t.values=function(t){var e=[];for(var n in t)e.push(t[n]);return e},t.entries=function(t){var e=[];for(var n in t)e.push({key:n,value:t[n]});return e},t.merge=function(t){for(var e,n,r,i=t.length,o=-1,s=0;++o<i;)s+=t[o].length;for(n=new Array(s);--i>=0;)for(e=(r=t[i]).length;--e>=0;)n[--s]=r[e];return n};var g=Math.abs;function y(t,e){for(var n in e)Object.defineProperty(t.prototype,n,{value:e[n],enumerable:!1})}function _(){this._=Object.create(null)}t.range=function(t,e,n){if(arguments.length<3&&(n=1,arguments.length<2&&(e=t,t=0)),(e-t)/n==1/0)throw new Error("infinite range");var r,i=[],o=function(t){var e=1;for(;t*e%1;)e*=10;return e}(g(n)),s=-1;if(t*=o,e*=o,(n*=o)<0)for(;(r=t+n*++s)>e;)i.push(r/o);else for(;(r=t+n*++s)<e;)i.push(r/o);return i},t.map=function(t,e){var n=new _;if(t instanceof _)t.forEach(function(t,e){n.set(t,e)});else if(Array.isArray(t)){var r,i=-1,o=t.length;if(1===arguments.length)for(;++i<o;)n.set(i,t[i]);else for(;++i<o;)n.set(e.call(t,r=t[i],i),r)}else for(var s in t)n.set(s,t[s]);return n};var b="__proto__",x="\0";function E(t){return(t+="")===b||t[0]===x?x+t:t}function w(t){return(t+="")[0]===x?t.slice(1):t}function S(t){return E(t)in this._}function C(t){return(t=E(t))in this._&&delete this._[t]}function M(){var t=[];for(var e in this._)t.push(w(e));return t}function T(){var t=0;for(var e in this._)++t;return t}function A(){for(var t in this._)return!1;return!0}function $(){this._=Object.create(null)}function k(t){return t}function D(t,e,n){return function(){var r=n.apply(e,arguments);return r===e?t:r}}function R(t,e){if(e in t)return e;e=e.charAt(0).toUpperCase()+e.slice(1);for(var n=0,r=O.length;n<r;++n){var i=O[n]+e;if(i in t)return i}}y(_,{has:S,get:function(t){return this._[E(t)]},set:function(t,e){return this._[E(t)]=e},remove:C,keys:M,values:function(){var t=[];for(var e in this._)t.push(this._[e]);return t},entries:function(){var t=[];for(var e in this._)t.push({key:w(e),value:this._[e]});return t},size:T,empty:A,forEach:function(t){for(var e in this._)t.call(this,w(e),this._[e])}}),t.nest=function(){var e,n,r={},i=[],o=[];function s(t,o,a){if(a>=i.length)return n?n.call(r,o):e?o.sort(e):o;for(var u,c,l,h,p=-1,f=o.length,d=i[a++],m=new _;++p<f;)(h=m.get(u=d(c=o[p])))?h.push(c):m.set(u,[c]);return t?(c=t(),l=function(e,n){c.set(e,s(t,n,a))}):(c={},l=function(e,n){c[e]=s(t,n,a)}),m.forEach(l),c}return r.map=function(t,e){return s(e,t,0)},r.entries=function(e){return function t(e,n){if(n>=i.length)return e;var r=[],s=o[n++];return e.forEach(function(e,i){r.push({key:e,values:t(i,n)})}),s?r.sort(function(t,e){return s(t.key,e.key)}):r}(s(t.map,e,0),0)},r.key=function(t){return i.push(t),r},r.sortKeys=function(t){return o[i.length-1]=t,r},r.sortValues=function(t){return e=t,r},r.rollup=function(t){return n=t,r},r},t.set=function(t){var e=new $;if(t)for(var n=0,r=t.length;n<r;++n)e.add(t[n]);return e},y($,{has:S,add:function(t){return this._[E(t+="")]=!0,t},remove:C,values:M,size:T,empty:A,forEach:function(t){for(var e in this._)t.call(this,w(e))}}),t.behavior={},t.rebind=function(t,e){for(var n,r=1,i=arguments.length;++r<i;)t[n=arguments[r]]=D(t,e,e[n]);return t};var O=["webkit","ms","moz","Moz","o","O"];function N(){}function I(){}function P(t){var e=[],n=new _;function r(){for(var n,r=e,i=-1,o=r.length;++i<o;)(n=r[i].on)&&n.apply(this,arguments);return t}return r.on=function(r,i){var o,s=n.get(r);return arguments.length<2?s&&s.on:(s&&(s.on=null,e=e.slice(0,o=e.indexOf(s)).concat(e.slice(o+1)),n.remove(r)),i&&e.push(n.set(r,{on:i})),t)},r}function L(){t.event.preventDefault()}function j(){for(var e,n=t.event;e=n.sourceEvent;)n=e;return n}function B(e){for(var n=new I,r=0,i=arguments.length;++r<i;)n[arguments[r]]=P(n);return n.of=function(r,i){return function(o){try{var s=o.sourceEvent=t.event;o.target=e,t.event=o,n[o.type].apply(r,i)}finally{t.event=s}}},n}t.dispatch=function(){for(var t=new I,e=-1,n=arguments.length;++e<n;)t[arguments[e]]=P(t);return t},I.prototype.on=function(t,e){var n=t.indexOf("."),r="";if(n>=0&&(r=t.slice(n+1),t=t.slice(0,n)),t)return arguments.length<2?this[t].on(r):this[t].on(r,e);if(2===arguments.length){if(null==e)for(t in this)this.hasOwnProperty(t)&&this[t].on(r,null);return this}},t.event=null,t.requote=function(t){return t.replace(F,"\\$&")};var F=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,q={}.__proto__?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)t[n]=e[n]};function U(t){return q(t,Q),t}var H=function(t,e){return e.querySelector(t)},V=function(t,e){return e.querySelectorAll(t)},z=function(t,e){var n=t.matches||t[R(t,"matchesSelector")];return(z=function(t,e){return n.call(t,e)})(t,e)};"function"==typeof Sizzle&&(H=function(t,e){return Sizzle(t,e)[0]||null},V=Sizzle,z=Sizzle.matchesSelector),t.selection=function(){return t.select(r.documentElement)};var Q=t.selection.prototype=[];function G(t){return"function"==typeof t?t:function(){return H(t,this)}}function W(t){return"function"==typeof t?t:function(){return V(t,this)}}Q.select=function(t){var e,n,r,i,o=[];t=G(t);for(var s=-1,a=this.length;++s<a;){o.push(e=[]),e.parentNode=(r=this[s]).parentNode;for(var u=-1,c=r.length;++u<c;)(i=r[u])?(e.push(n=t.call(i,i.__data__,u,s)),n&&"__data__"in i&&(n.__data__=i.__data__)):e.push(null)}return U(o)},Q.selectAll=function(t){var e,r,i=[];t=W(t);for(var o=-1,s=this.length;++o<s;)for(var a=this[o],u=-1,c=a.length;++u<c;)(r=a[u])&&(i.push(e=n(t.call(r,r.__data__,u,o))),e.parentNode=r);return U(i)};var Y="http://www.w3.org/1999/xhtml",X={svg:"http://www.w3.org/2000/svg",xhtml:Y,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function J(e,n){return e=t.ns.qualify(e),null==n?e.local?function(){this.removeAttributeNS(e.space,e.local)}:function(){this.removeAttribute(e)}:"function"==typeof n?e.local?function(){var t=n.apply(this,arguments);null==t?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,t)}:function(){var t=n.apply(this,arguments);null==t?this.removeAttribute(e):this.setAttribute(e,t)}:e.local?function(){this.setAttributeNS(e.space,e.local,n)}:function(){this.setAttribute(e,n)}}function K(t){return t.trim().replace(/\s+/g," ")}function Z(e){return new RegExp("(?:^|\\s+)"+t.requote(e)+"(?:\\s+|$)","g")}function tt(t){return(t+"").trim().split(/^|\s+/)}function et(t,e){var n=(t=tt(t).map(nt)).length;return"function"==typeof e?function(){for(var r=-1,i=e.apply(this,arguments);++r<n;)t[r](this,i)}:function(){for(var r=-1;++r<n;)t[r](this,e)}}function nt(t){var e=Z(t);return function(n,r){if(i=n.classList)return r?i.add(t):i.remove(t);var i=n.getAttribute("class")||"";r?(e.lastIndex=0,e.test(i)||n.setAttribute("class",K(i+" "+t))):n.setAttribute("class",K(i.replace(e," ")))}}function rt(t,e,n){return null==e?function(){this.style.removeProperty(t)}:"function"==typeof e?function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}:function(){this.style.setProperty(t,e,n)}}function it(t,e){return null==e?function(){delete this[t]}:"function"==typeof e?function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}:function(){this[t]=e}}function ot(e){return"function"==typeof e?e:(e=t.ns.qualify(e)).local?function(){return this.ownerDocument.createElementNS(e.space,e.local)}:function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Y&&t.documentElement.namespaceURI===Y?t.createElement(e):t.createElementNS(n,e)}}function st(){var t=this.parentNode;t&&t.removeChild(this)}function at(t){return{__data__:t}}function ut(t){return function(){return z(this,t)}}function ct(t,e){for(var n=0,r=t.length;n<r;n++)for(var i,o=t[n],s=0,a=o.length;s<a;s++)(i=o[s])&&e(i,s,n);return t}function lt(t){return q(t,ht),t}t.ns={prefix:X,qualify:function(t){var e=t.indexOf(":"),n=t;return e>=0&&"xmlns"!==(n=t.slice(0,e))&&(t=t.slice(e+1)),X.hasOwnProperty(n)?{space:X[n],local:t}:t}},Q.attr=function(e,n){if(arguments.length<2){if("string"==typeof e){var r=this.node();return(e=t.ns.qualify(e)).local?r.getAttributeNS(e.space,e.local):r.getAttribute(e)}for(n in e)this.each(J(n,e[n]));return this}return this.each(J(e,n))},Q.classed=function(t,e){if(arguments.length<2){if("string"==typeof t){var n=this.node(),r=(t=tt(t)).length,i=-1;if(e=n.classList){for(;++i<r;)if(!e.contains(t[i]))return!1}else for(e=n.getAttribute("class");++i<r;)if(!Z(t[i]).test(e))return!1;return!0}for(e in t)this.each(et(e,t[e]));return this}return this.each(et(t,e))},Q.style=function(t,e,n){var r=arguments.length;if(r<3){if("string"!=typeof t){for(n in r<2&&(e=""),t)this.each(rt(n,t[n],e));return this}if(r<2){var i=this.node();return o(i).getComputedStyle(i,null).getPropertyValue(t)}n=""}return this.each(rt(t,e,n))},Q.property=function(t,e){if(arguments.length<2){if("string"==typeof t)return this.node()[t];for(e in t)this.each(it(e,t[e]));return this}return this.each(it(t,e))},Q.text=function(t){return arguments.length?this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}:null==t?function(){this.textContent=""}:function(){this.textContent=t}):this.node().textContent},Q.html=function(t){return arguments.length?this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}:null==t?function(){this.innerHTML=""}:function(){this.innerHTML=t}):this.node().innerHTML},Q.append=function(t){return t=ot(t),this.select(function(){return this.appendChild(t.apply(this,arguments))})},Q.insert=function(t,e){return t=ot(t),e=G(e),this.select(function(){return this.insertBefore(t.apply(this,arguments),e.apply(this,arguments)||null)})},Q.remove=function(){return this.each(st)},Q.data=function(t,e){var n,r,i=-1,o=this.length;if(!arguments.length){for(t=new Array(o=(n=this[0]).length);++i<o;)(r=n[i])&&(t[i]=r.__data__);return t}function s(t,n){var r,i,o,s=t.length,l=n.length,h=Math.min(s,l),p=new Array(l),f=new Array(l),d=new Array(s);if(e){var m,v=new _,g=new Array(s);for(r=-1;++r<s;)(i=t[r])&&(v.has(m=e.call(i,i.__data__,r))?d[r]=i:v.set(m,i),g[r]=m);for(r=-1;++r<l;)(i=v.get(m=e.call(n,o=n[r],r)))?!0!==i&&(p[r]=i,i.__data__=o):f[r]=at(o),v.set(m,!0);for(r=-1;++r<s;)r in g&&!0!==v.get(g[r])&&(d[r]=t[r])}else{for(r=-1;++r<h;)i=t[r],o=n[r],i?(i.__data__=o,p[r]=i):f[r]=at(o);for(;r<l;++r)f[r]=at(n[r]);for(;r<s;++r)d[r]=t[r]}f.update=p,f.parentNode=p.parentNode=d.parentNode=t.parentNode,a.push(f),u.push(p),c.push(d)}var a=lt([]),u=U([]),c=U([]);if("function"==typeof t)for(;++i<o;)s(n=this[i],t.call(n,n.parentNode.__data__,i));else for(;++i<o;)s(n=this[i],t);return u.enter=function(){return a},u.exit=function(){return c},u},Q.datum=function(t){return arguments.length?this.property("__data__",t):this.property("__data__")},Q.filter=function(t){var e,n,r,i=[];"function"!=typeof t&&(t=ut(t));for(var o=0,s=this.length;o<s;o++){i.push(e=[]),e.parentNode=(n=this[o]).parentNode;for(var a=0,u=n.length;a<u;a++)(r=n[a])&&t.call(r,r.__data__,a,o)&&e.push(r)}return U(i)},Q.order=function(){for(var t=-1,e=this.length;++t<e;)for(var n,r=this[t],i=r.length-1,o=r[i];--i>=0;)(n=r[i])&&(o&&o!==n.nextSibling&&o.parentNode.insertBefore(n,o),o=n);return this},Q.sort=function(t){t=function(t){arguments.length||(t=h);return function(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}}.apply(this,arguments);for(var e=-1,n=this.length;++e<n;)this[e].sort(t);return this.order()},Q.each=function(t){return ct(this,function(e,n,r){t.call(e,e.__data__,n,r)})},Q.call=function(t){var e=n(arguments);return t.apply(e[0]=this,e),this},Q.empty=function(){return!this.node()},Q.node=function(){for(var t=0,e=this.length;t<e;t++)for(var n=this[t],r=0,i=n.length;r<i;r++){var o=n[r];if(o)return o}return null},Q.size=function(){var t=0;return ct(this,function(){++t}),t};var ht=[];function pt(e,r,i){var o="__on"+e,s=e.indexOf("."),a=dt;s>0&&(e=e.slice(0,s));var u=ft.get(e);function c(){var t=this[o];t&&(this.removeEventListener(e,t,t.$),delete this[o])}return u&&(e=u,a=mt),s?r?function(){var t=a(r,n(arguments));c.call(this),this.addEventListener(e,this[o]=t,t.$=i),t._=r}:c:r?N:function(){var n,r=new RegExp("^__on([^.]+)"+t.requote(e)+"$");for(var i in this)if(n=i.match(r)){var o=this[i];this.removeEventListener(n[1],o,o.$),delete this[i]}}}t.selection.enter=lt,t.selection.enter.prototype=ht,ht.append=Q.append,ht.empty=Q.empty,ht.node=Q.node,ht.call=Q.call,ht.size=Q.size,ht.select=function(t){for(var e,n,r,i,o,s=[],a=-1,u=this.length;++a<u;){r=(i=this[a]).update,s.push(e=[]),e.parentNode=i.parentNode;for(var c=-1,l=i.length;++c<l;)(o=i[c])?(e.push(r[c]=n=t.call(i.parentNode,o.__data__,c,a)),n.__data__=o.__data__):e.push(null)}return U(s)},ht.insert=function(t,e){var n,r,i;return arguments.length<2&&(n=this,e=function(t,e,o){var s,a=n[o].update,u=a.length;for(o!=i&&(i=o,r=0),e>=r&&(r=e+1);!(s=a[r])&&++r<u;);return s}),Q.insert.call(this,t,e)},t.select=function(t){var e;return"string"==typeof t?(e=[H(t,r)]).parentNode=r.documentElement:(e=[t]).parentNode=i(t),U([e])},t.selectAll=function(t){var e;return"string"==typeof t?(e=n(V(t,r))).parentNode=r.documentElement:(e=n(t)).parentNode=null,U([e])},Q.on=function(t,e,n){var r=arguments.length;if(r<3){if("string"!=typeof t){for(n in r<2&&(e=!1),t)this.each(pt(n,t[n],e));return this}if(r<2)return(r=this.node()["__on"+t])&&r._;n=!1}return this.each(pt(t,e,n))};var ft=t.map({mouseenter:"mouseover",mouseleave:"mouseout"});function dt(e,n){return function(r){var i=t.event;t.event=r,n[0]=this.__data__;try{e.apply(this,n)}finally{t.event=i}}}function mt(t,e){var n=dt(t,e);return function(t){var e=t.relatedTarget;e&&(e===this||8&e.compareDocumentPosition(this))||n.call(this,t)}}r&&ft.forEach(function(t){"on"+t in r&&ft.remove(t)});var vt,gt=0;function yt(e){var n=".dragsuppress-"+ ++gt,r="click"+n,s=t.select(o(e)).on("touchmove"+n,L).on("dragstart"+n,L).on("selectstart"+n,L);if(null==vt&&(vt=!("onselectstart"in e)&&R(e.style,"userSelect")),vt){var a=i(e).style,u=a[vt];a[vt]="none"}return function(t){if(s.on(n,null),vt&&(a[vt]=u),t){var e=function(){s.on(r,null)};s.on(r,function(){L(),e()},!0),setTimeout(e,0)}}}t.mouse=function(t){return bt(t,j())};var _t=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;function bt(e,n){n.changedTouches&&(n=n.changedTouches[0]);var r=e.ownerSVGElement||e;if(r.createSVGPoint){var i=r.createSVGPoint();if(_t<0){var s=o(e);if(s.scrollX||s.scrollY){var a=(r=t.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important"))[0][0].getScreenCTM();_t=!(a.f||a.e),r.remove()}}return _t?(i.x=n.pageX,i.y=n.pageY):(i.x=n.clientX,i.y=n.clientY),[(i=i.matrixTransform(e.getScreenCTM().inverse())).x,i.y]}var u=e.getBoundingClientRect();return[n.clientX-u.left-e.clientLeft,n.clientY-u.top-e.clientTop]}function xt(){return t.event.changedTouches[0].identifier}t.touch=function(t,e,n){if(arguments.length<3&&(n=e,e=j().changedTouches),e)for(var r,i=0,o=e.length;i<o;++i)if((r=e[i]).identifier===n)return bt(t,r)},t.behavior.drag=function(){var e=B(s,"drag","dragstart","dragend"),n=null,r=a(N,t.mouse,o,"mousemove","mouseup"),i=a(xt,t.touch,k,"touchmove","touchend");function s(){this.on("mousedown.drag",r).on("touchstart.drag",i)}function a(r,i,o,s,a){return function(){var u,c=t.event.target.correspondingElement||t.event.target,l=this.parentNode,h=e.of(this,arguments),p=0,f=r(),d=".drag"+(null==f?"":"-"+f),m=t.select(o(c)).on(s+d,function(){var t,e,n=i(l,f);if(!n)return;t=n[0]-g[0],e=n[1]-g[1],p|=t|e,g=n,h({type:"drag",x:n[0]+u[0],y:n[1]+u[1],dx:t,dy:e})}).on(a+d,function(){if(!i(l,f))return;m.on(s+d,null).on(a+d,null),v(p),h({type:"dragend"})}),v=yt(c),g=i(l,f);u=n?[(u=n.apply(this,arguments)).x-g[0],u.y-g[1]]:[0,0],h({type:"dragstart"})}}return s.origin=function(t){return arguments.length?(n=t,s):n},t.rebind(s,e,"on")},t.touches=function(t,e){return arguments.length<2&&(e=j().touches),e?n(e).map(function(e){var n=bt(t,e);return n.identifier=e.identifier,n}):[]};var Et=1e-6,wt=Et*Et,St=Math.PI,Ct=2*St,Mt=Ct-Et,Tt=St/2,At=St/180,$t=180/St;function kt(t){return t>0?1:t<0?-1:0}function Dt(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(e[1]-t[1])*(n[0]-t[0])}function Rt(t){return t>1?0:t<-1?St:Math.acos(t)}function Ot(t){return t>1?Tt:t<-1?-Tt:Math.asin(t)}function Nt(t){return((t=Math.exp(t))+1/t)/2}function It(t){return(t=Math.sin(t/2))*t}var Pt=Math.SQRT2;t.interpolateZoom=function(t,e){var n,r,i=t[0],o=t[1],s=t[2],a=e[0],u=e[1],c=e[2],l=a-i,h=u-o,p=l*l+h*h;if(p<wt)r=Math.log(c/s)/Pt,n=function(t){return[i+t*l,o+t*h,s*Math.exp(Pt*t*r)]};else{var f=Math.sqrt(p),d=(c*c-s*s+4*p)/(2*s*2*f),m=(c*c-s*s-4*p)/(2*c*2*f),v=Math.log(Math.sqrt(d*d+1)-d),g=Math.log(Math.sqrt(m*m+1)-m);r=(g-v)/Pt,n=function(t){var e,n=t*r,a=Nt(v),u=s/(2*f)*(a*(e=Pt*n+v,((e=Math.exp(2*e))-1)/(e+1))-function(t){return((t=Math.exp(t))-1/t)/2}(v));return[i+u*l,o+u*h,s*a/Nt(Pt*n+v)]}}return n.duration=1e3*r,n},t.behavior.zoom=function(){var e,n,i,s,a,u,c,l,h,p={x:0,y:0,k:1},f=[960,500],d=Bt,m=250,v=0,g="mousedown.zoom",y="mousemove.zoom",_="mouseup.zoom",b="touchstart.zoom",x=B(E,"zoomstart","zoom","zoomend");function E(t){t.on(g,D).on(jt+".zoom",O).on("dblclick.zoom",N).on(b,R)}function w(t){return[(t[0]-p.x)/p.k,(t[1]-p.y)/p.k]}function S(t){p.k=Math.max(d[0],Math.min(d[1],t))}function C(t,e){e=function(t){return[t[0]*p.k+p.x,t[1]*p.k+p.y]}(e),p.x+=t[0]-e[0],p.y+=t[1]-e[1]}function M(e,r,i,o){e.__chart__={x:p.x,y:p.y,k:p.k},S(Math.pow(2,o)),C(n=r,i),e=t.select(e),m>0&&(e=e.transition().duration(m)),e.call(E.event)}function T(){c&&c.domain(u.range().map(function(t){return(t-p.x)/p.k}).map(u.invert)),h&&h.domain(l.range().map(function(t){return(t-p.y)/p.k}).map(l.invert))}function A(t){v++||t({type:"zoomstart"})}function $(t){T(),t({type:"zoom",scale:p.k,translate:[p.x,p.y]})}function k(t){--v||(t({type:"zoomend"}),n=null)}function D(){var e=this,n=x.of(e,arguments),r=0,i=t.select(o(e)).on(y,function(){r=1,C(t.mouse(e),s),$(n)}).on(_,function(){i.on(y,null).on(_,null),a(r),k(n)}),s=w(t.mouse(e)),a=yt(e);pa.call(e),A(n)}function R(){var e,n=this,r=x.of(n,arguments),i={},o=0,s=".zoom-"+t.event.changedTouches[0].identifier,u="touchmove"+s,c="touchend"+s,l=[],h=t.select(n),f=yt(n);function d(){var r=t.touches(n);return e=p.k,r.forEach(function(t){t.identifier in i&&(i[t.identifier]=w(t))}),r}function m(){var e=t.event.target;t.select(e).on(u,v).on(c,y),l.push(e);for(var r=t.event.changedTouches,s=0,h=r.length;s<h;++s)i[r[s].identifier]=null;var f=d(),m=Date.now();if(1===f.length){if(m-a<500){var g=f[0];M(n,g,i[g.identifier],Math.floor(Math.log(p.k)/Math.LN2)+1),L()}a=m}else if(f.length>1){g=f[0];var _=f[1],b=g[0]-_[0],x=g[1]-_[1];o=b*b+x*x}}function v(){var s,u,c,l,h=t.touches(n);pa.call(n);for(var p=0,f=h.length;p<f;++p,l=null)if(c=h[p],l=i[c.identifier]){if(u)break;s=c,u=l}if(l){var d=(d=c[0]-s[0])*d+(d=c[1]-s[1])*d,m=o&&Math.sqrt(d/o);s=[(s[0]+c[0])/2,(s[1]+c[1])/2],u=[(u[0]+l[0])/2,(u[1]+l[1])/2],S(m*e)}a=null,C(s,u),$(r)}function y(){if(t.event.touches.length){for(var e=t.event.changedTouches,n=0,o=e.length;n<o;++n)delete i[e[n].identifier];for(var a in i)return void d()}t.selectAll(l).on(s,null),h.on(g,D).on(b,R),f(),k(r)}m(),A(r),h.on(g,null).on(b,m)}function O(){var r=x.of(this,arguments);s?clearTimeout(s):(pa.call(this),e=w(n=i||t.mouse(this)),A(r)),s=setTimeout(function(){s=null,k(r)},50),L(),S(Math.pow(2,.002*Lt())*p.k),C(n,e),$(r)}function N(){var e=t.mouse(this),n=Math.log(p.k)/Math.LN2;M(this,e,w(e),t.event.shiftKey?Math.ceil(n)-1:Math.floor(n)+1)}return jt||(jt="onwheel"in r?(Lt=function(){return-t.event.deltaY*(t.event.deltaMode?120:1)},"wheel"):"onmousewheel"in r?(Lt=function(){return t.event.wheelDelta},"mousewheel"):(Lt=function(){return-t.event.detail},"MozMousePixelScroll")),E.event=function(e){e.each(function(){var e=x.of(this,arguments),r=p;ma?t.select(this).transition().each("start.zoom",function(){p=this.__chart__||{x:0,y:0,k:1},A(e)}).tween("zoom:zoom",function(){var i=f[0],o=f[1],s=n?n[0]:i/2,a=n?n[1]:o/2,u=t.interpolateZoom([(s-p.x)/p.k,(a-p.y)/p.k,i/p.k],[(s-r.x)/r.k,(a-r.y)/r.k,i/r.k]);return function(t){var n=u(t),r=i/n[2];this.__chart__=p={x:s-n[0]*r,y:a-n[1]*r,k:r},$(e)}}).each("interrupt.zoom",function(){k(e)}).each("end.zoom",function(){k(e)}):(this.__chart__=p,A(e),$(e),k(e))})},E.translate=function(t){return arguments.length?(p={x:+t[0],y:+t[1],k:p.k},T(),E):[p.x,p.y]},E.scale=function(t){return arguments.length?(p={x:p.x,y:p.y,k:null},S(+t),T(),E):p.k},E.scaleExtent=function(t){return arguments.length?(d=null==t?Bt:[+t[0],+t[1]],E):d},E.center=function(t){return arguments.length?(i=t&&[+t[0],+t[1]],E):i},E.size=function(t){return arguments.length?(f=t&&[+t[0],+t[1]],E):f},E.duration=function(t){return arguments.length?(m=+t,E):m},E.x=function(t){return arguments.length?(c=t,u=t.copy(),p={x:0,y:0,k:1},E):c},E.y=function(t){return arguments.length?(h=t,l=t.copy(),p={x:0,y:0,k:1},E):h},t.rebind(E,x,"on")};var Lt,jt,Bt=[0,1/0];function Ft(){}function qt(t,e,n){return this instanceof qt?(this.h=+t,this.s=+e,void(this.l=+n)):arguments.length<2?t instanceof qt?new qt(t.h,t.s,t.l):ce(""+t,le,qt):new qt(t,e,n)}t.color=Ft,Ft.prototype.toString=function(){return this.rgb()+""},t.hsl=qt;var Ut=qt.prototype=new Ft;function Ht(t,e,n){var r,i;function o(t){return Math.round(255*function(t){return t>360?t-=360:t<0&&(t+=360),t<60?r+(i-r)*t/60:t<180?i:t<240?r+(i-r)*(240-t)/60:r}(t))}return t=isNaN(t)?0:(t%=360)<0?t+360:t,e=isNaN(e)?0:e<0?0:e>1?1:e,r=2*(n=n<0?0:n>1?1:n)-(i=n<=.5?n*(1+e):n+e-n*e),new ie(o(t+120),o(t),o(t-120))}function Vt(e,n,r){return this instanceof Vt?(this.h=+e,this.c=+n,void(this.l=+r)):arguments.length<2?e instanceof Vt?new Vt(e.h,e.c,e.l):te(e instanceof Gt?e.l:(e=he((e=t.rgb(e)).r,e.g,e.b)).l,e.a,e.b):new Vt(e,n,r)}Ut.brighter=function(t){return t=Math.pow(.7,arguments.length?t:1),new qt(this.h,this.s,this.l/t)},Ut.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),new qt(this.h,this.s,t*this.l)},Ut.rgb=function(){return Ht(this.h,this.s,this.l)},t.hcl=Vt;var zt=Vt.prototype=new Ft;function Qt(t,e,n){return isNaN(t)&&(t=0),isNaN(e)&&(e=0),new Gt(n,Math.cos(t*=At)*e,Math.sin(t)*e)}function Gt(t,e,n){return this instanceof Gt?(this.l=+t,this.a=+e,void(this.b=+n)):arguments.length<2?t instanceof Gt?new Gt(t.l,t.a,t.b):t instanceof Vt?Qt(t.h,t.c,t.l):he((t=ie(t)).r,t.g,t.b):new Gt(t,e,n)}zt.brighter=function(t){return new Vt(this.h,this.c,Math.min(100,this.l+Wt*(arguments.length?t:1)))},zt.darker=function(t){return new Vt(this.h,this.c,Math.max(0,this.l-Wt*(arguments.length?t:1)))},zt.rgb=function(){return Qt(this.h,this.c,this.l).rgb()},t.lab=Gt;var Wt=18,Yt=.95047,Xt=1,Jt=1.08883,Kt=Gt.prototype=new Ft;function Zt(t,e,n){var r=(t+16)/116,i=r+e/500,o=r-n/200;return new ie(re(3.2404542*(i=ee(i)*Yt)-1.5371385*(r=ee(r)*Xt)-.4985314*(o=ee(o)*Jt)),re(-.969266*i+1.8760108*r+.041556*o),re(.0556434*i-.2040259*r+1.0572252*o))}function te(t,e,n){return t>0?new Vt(Math.atan2(n,e)*$t,Math.sqrt(e*e+n*n),t):new Vt(NaN,NaN,t)}function ee(t){return t>.206893034?t*t*t:(t-4/29)/7.787037}function ne(t){return t>.008856?Math.pow(t,1/3):7.787037*t+4/29}function re(t){return Math.round(255*(t<=.00304?12.92*t:1.055*Math.pow(t,1/2.4)-.055))}function ie(t,e,n){return this instanceof ie?(this.r=~~t,this.g=~~e,void(this.b=~~n)):arguments.length<2?t instanceof ie?new ie(t.r,t.g,t.b):ce(""+t,ie,Ht):new ie(t,e,n)}function oe(t){return new ie(t>>16,t>>8&255,255&t)}function se(t){return oe(t)+""}Kt.brighter=function(t){return new Gt(Math.min(100,this.l+Wt*(arguments.length?t:1)),this.a,this.b)},Kt.darker=function(t){return new Gt(Math.max(0,this.l-Wt*(arguments.length?t:1)),this.a,this.b)},Kt.rgb=function(){return Zt(this.l,this.a,this.b)},t.rgb=ie;var ae=ie.prototype=new Ft;function ue(t){return t<16?"0"+Math.max(0,t).toString(16):Math.min(255,t).toString(16)}function ce(t,e,n){var r,i,o,s=0,a=0,u=0;if(r=/([a-z]+)\((.*)\)/.exec(t=t.toLowerCase()))switch(i=r[2].split(","),r[1]){case"hsl":return n(parseFloat(i[0]),parseFloat(i[1])/100,parseFloat(i[2])/100);case"rgb":return e(fe(i[0]),fe(i[1]),fe(i[2]))}return(o=de.get(t))?e(o.r,o.g,o.b):(null==t||"#"!==t.charAt(0)||isNaN(o=parseInt(t.slice(1),16))||(4===t.length?(s=(3840&o)>>4,s|=s>>4,a=240&o,a|=a>>4,u=15&o,u|=u<<4):7===t.length&&(s=(16711680&o)>>16,a=(65280&o)>>8,u=255&o)),e(s,a,u))}function le(t,e,n){var r,i,o=Math.min(t/=255,e/=255,n/=255),s=Math.max(t,e,n),a=s-o,u=(s+o)/2;return a?(i=u<.5?a/(s+o):a/(2-s-o),r=t==s?(e-n)/a+(e<n?6:0):e==s?(n-t)/a+2:(t-e)/a+4,r*=60):(r=NaN,i=u>0&&u<1?0:r),new qt(r,i,u)}function he(t,e,n){var r=ne((.4124564*(t=pe(t))+.3575761*(e=pe(e))+.1804375*(n=pe(n)))/Yt),i=ne((.2126729*t+.7151522*e+.072175*n)/Xt);return Gt(116*i-16,500*(r-i),200*(i-ne((.0193339*t+.119192*e+.9503041*n)/Jt)))}function pe(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function fe(t){var e=parseFloat(t);return"%"===t.charAt(t.length-1)?Math.round(2.55*e):e}ae.brighter=function(t){t=Math.pow(.7,arguments.length?t:1);var e=this.r,n=this.g,r=this.b,i=30;return e||n||r?(e&&e<i&&(e=i),n&&n<i&&(n=i),r&&r<i&&(r=i),new ie(Math.min(255,e/t),Math.min(255,n/t),Math.min(255,r/t))):new ie(i,i,i)},ae.darker=function(t){return new ie((t=Math.pow(.7,arguments.length?t:1))*this.r,t*this.g,t*this.b)},ae.hsl=function(){return le(this.r,this.g,this.b)},ae.toString=function(){return"#"+ue(this.r)+ue(this.g)+ue(this.b)};var de=t.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});function me(t){return"function"==typeof t?t:function(){return t}}function ve(t){return function(e,n,r){return 2===arguments.length&&"function"==typeof n&&(r=n,n=null),ge(e,n,t,r)}}function ge(e,r,i,o){var s={},a=t.dispatch("beforesend","progress","load","error"),u={},c=new XMLHttpRequest,l=null;function h(){var t,e=c.status;if(!e&&function(t){var e=t.responseType;return e&&"text"!==e?t.response:t.responseText}(c)||e>=200&&e<300||304===e){try{t=i.call(s,c)}catch(t){return void a.error.call(s,t)}a.load.call(s,t)}else a.error.call(s,c)}return!this.XDomainRequest||"withCredentials"in c||!/^(http(s)?:)?\/\//.test(e)||(c=new XDomainRequest),"onload"in c?c.onload=c.onerror=h:c.onreadystatechange=function(){c.readyState>3&&h()},c.onprogress=function(e){var n=t.event;t.event=e;try{a.progress.call(s,c)}finally{t.event=n}},s.header=function(t,e){return t=(t+"").toLowerCase(),arguments.length<2?u[t]:(null==e?delete u[t]:u[t]=e+"",s)},s.mimeType=function(t){return arguments.length?(r=null==t?null:t+"",s):r},s.responseType=function(t){return arguments.length?(l=t,s):l},s.response=function(t){return i=t,s},["get","post"].forEach(function(t){s[t]=function(){return s.send.apply(s,[t].concat(n(arguments)))}}),s.send=function(t,n,i){if(2===arguments.length&&"function"==typeof n&&(i=n,n=null),c.open(t,e,!0),null==r||"accept"in u||(u.accept=r+",*/*"),c.setRequestHeader)for(var o in u)c.setRequestHeader(o,u[o]);return null!=r&&c.overrideMimeType&&c.overrideMimeType(r),null!=l&&(c.responseType=l),null!=i&&s.on("error",i).on("load",function(t){i(null,t)}),a.beforesend.call(s,c),c.send(null==n?null:n),s},s.abort=function(){return c.abort(),s},t.rebind(s,a,"on"),null==o?s:s.get(function(t){return 1===t.length?function(e,n){t(null==e?n:null)}:t}(o))}de.forEach(function(t,e){de.set(t,oe(e))}),t.functor=me,t.xhr=ve(k),t.dsv=function(t,e){var n=new RegExp('["'+t+"\n]"),r=t.charCodeAt(0);function i(t,n,r){arguments.length<3&&(r=n,n=null);var i=ge(t,e,null==n?o:s(n),r);return i.row=function(t){return arguments.length?i.response(null==(n=t)?o:s(t)):n},i}function o(t){return i.parse(t.responseText)}function s(t){return function(e){return i.parse(e.responseText,t)}}function a(e){return e.map(u).join(t)}function u(t){return n.test(t)?'"'+t.replace(/\"/g,'""')+'"':t}return i.parse=function(t,e){var n;return i.parseRows(t,function(t,r){if(n)return n(t,r-1);var i=new Function("d","return {"+t.map(function(t,e){return JSON.stringify(t)+": d["+e+"]"}).join(",")+"}");n=e?function(t,n){return e(i(t),n)}:i})},i.parseRows=function(t,e){var n,i,o={},s={},a=[],u=t.length,c=0,l=0;function h(){if(c>=u)return s;if(i)return i=!1,o;var e=c;if(34===t.charCodeAt(e)){for(var n=e;n++<u;)if(34===t.charCodeAt(n)){if(34!==t.charCodeAt(n+1))break;++n}return c=n+2,13===(a=t.charCodeAt(n+1))?(i=!0,10===t.charCodeAt(n+2)&&++c):10===a&&(i=!0),t.slice(e+1,n).replace(/""/g,'"')}for(;c<u;){var a,l=1;if(10===(a=t.charCodeAt(c++)))i=!0;else if(13===a)i=!0,10===t.charCodeAt(c)&&(++c,++l);else if(a!==r)continue;return t.slice(e,c-l)}return t.slice(e)}for(;(n=h())!==s;){for(var p=[];n!==o&&n!==s;)p.push(n),n=h();e&&null==(p=e(p,l++))||a.push(p)}return a},i.format=function(e){if(Array.isArray(e[0]))return i.formatRows(e);var n=new $,r=[];return e.forEach(function(t){for(var e in t)n.has(e)||r.push(n.add(e))}),[r.map(u).join(t)].concat(e.map(function(e){return r.map(function(t){return u(e[t])}).join(t)})).join("\n")},i.formatRows=function(t){return t.map(a).join("\n")},i},t.csv=t.dsv(",","text/csv"),t.tsv=t.dsv("\t","text/tab-separated-values");var ye,_e,be,xe,Ee=this[R(this,"requestAnimationFrame")]||function(t){setTimeout(t,17)};function we(t,e,n){var r=arguments.length;r<2&&(e=0),r<3&&(n=Date.now());var i={c:t,t:n+e,n:null};return _e?_e.n=i:ye=i,_e=i,be||(xe=clearTimeout(xe),be=1,Ee(Se)),i}function Se(){var t=Ce(),e=Me()-t;e>24?(isFinite(e)&&(clearTimeout(xe),xe=setTimeout(Se,e)),be=0):(be=1,Ee(Se))}function Ce(){for(var t=Date.now(),e=ye;e;)t>=e.t&&e.c(t-e.t)&&(e.c=null),e=e.n;return t}function Me(){for(var t,e=ye,n=1/0;e;)e.c?(e.t<n&&(n=e.t),e=(t=e).n):e=t?t.n=e.n:ye=e.n;return _e=t,n}function Te(t,e){return e-(t?Math.ceil(Math.log(t)/Math.LN10):1)}t.timer=function(){we.apply(this,arguments)},t.timer.flush=function(){Ce(),Me()},t.round=function(t,e){return e?Math.round(t*(e=Math.pow(10,e)))/e:Math.round(t)};var Ae=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(function(t,e){var n=Math.pow(10,3*g(8-e));return{scale:e>8?function(t){return t/n}:function(t){return t*n},symbol:t}});function $e(e){var n=e.decimal,r=e.thousands,i=e.grouping,o=e.currency,s=i&&r?function(t,e){for(var n=t.length,o=[],s=0,a=i[0],u=0;n>0&&a>0&&(u+a+1>e&&(a=Math.max(1,e-u)),o.push(t.substring(n-=a,n+a)),!((u+=a+1)>e));)a=i[s=(s+1)%i.length];return o.reverse().join(r)}:k;return function(e){var r=ke.exec(e),i=r[1]||" ",a=r[2]||">",u=r[3]||"-",c=r[4]||"",l=r[5],h=+r[6],p=r[7],f=r[8],d=r[9],m=1,v="",g="",y=!1,_=!0;switch(f&&(f=+f.substring(1)),(l||"0"===i&&"="===a)&&(l=i="0",a="="),d){case"n":p=!0,d="g";break;case"%":m=100,g="%",d="f";break;case"p":m=100,g="%",d="r";break;case"b":case"o":case"x":case"X":"#"===c&&(v="0"+d.toLowerCase());case"c":_=!1;case"d":y=!0,f=0;break;case"s":m=-1,d="r"}"$"===c&&(v=o[0],g=o[1]),"r"!=d||f||(d="g"),null!=f&&("g"==d?f=Math.max(1,Math.min(21,f)):"e"!=d&&"f"!=d||(f=Math.max(0,Math.min(20,f)))),d=De.get(d)||Re;var b=l&&p;return function(e){var r=g;if(y&&e%1)return"";var o=e<0||0===e&&1/e<0?(e=-e,"-"):"-"===u?"":u;if(m<0){var c=t.formatPrefix(e,f);e=c.scale(e),r=c.symbol+g}else e*=m;var x,E,w=(e=d(e,f)).lastIndexOf(".");if(w<0){var S=_?e.lastIndexOf("e"):-1;S<0?(x=e,E=""):(x=e.substring(0,S),E=e.substring(S))}else x=e.substring(0,w),E=n+e.substring(w+1);!l&&p&&(x=s(x,1/0));var C=v.length+x.length+E.length+(b?0:o.length),M=C<h?new Array(C=h-C+1).join(i):"";return b&&(x=s(M+x,M.length?h-E.length:1/0)),o+=v,e=x+E,("<"===a?o+e+M:">"===a?M+o+e:"^"===a?M.substring(0,C>>=1)+o+e+M.substring(C):o+(b?e:M+e))+r}}}t.formatPrefix=function(e,n){var r=0;return(e=+e)&&(e<0&&(e*=-1),n&&(e=t.round(e,Te(e,n))),r=1+Math.floor(1e-12+Math.log(e)/Math.LN10),r=Math.max(-24,Math.min(24,3*Math.floor((r-1)/3)))),Ae[8+r/3]};var ke=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,De=t.map({b:function(t){return t.toString(2)},c:function(t){return String.fromCharCode(t)},o:function(t){return t.toString(8)},x:function(t){return t.toString(16)},X:function(t){return t.toString(16).toUpperCase()},g:function(t,e){return t.toPrecision(e)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},r:function(e,n){return(e=t.round(e,Te(e,n))).toFixed(Math.max(0,Math.min(20,Te(e*(1+1e-15),n))))}});function Re(t){return t+""}var Oe=t.time={},Ne=Date;function Ie(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}Ie.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){Pe.setUTCDate.apply(this._,arguments)},setDay:function(){Pe.setUTCDay.apply(this._,arguments)},setFullYear:function(){Pe.setUTCFullYear.apply(this._,arguments)},setHours:function(){Pe.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){Pe.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){Pe.setUTCMinutes.apply(this._,arguments)},setMonth:function(){Pe.setUTCMonth.apply(this._,arguments)},setSeconds:function(){Pe.setUTCSeconds.apply(this._,arguments)},setTime:function(){Pe.setTime.apply(this._,arguments)}};var Pe=Date.prototype;function Le(t,e,n){function r(e){var n=t(e),r=o(n,1);return e-n<r-e?n:r}function i(n){return e(n=t(new Ne(n-1)),1),n}function o(t,n){return e(t=new Ne(+t),n),t}function s(t,r,o){var s=i(t),a=[];if(o>1)for(;s<r;)n(s)%o||a.push(new Date(+s)),e(s,1);else for(;s<r;)a.push(new Date(+s)),e(s,1);return a}t.floor=t,t.round=r,t.ceil=i,t.offset=o,t.range=s;var a=t.utc=je(t);return a.floor=a,a.round=je(r),a.ceil=je(i),a.offset=je(o),a.range=function(t,e,n){try{Ne=Ie;var r=new Ie;return r._=t,s(r,e,n)}finally{Ne=Date}},t}function je(t){return function(e,n){try{Ne=Ie;var r=new Ie;return r._=e,t(r,n)._}finally{Ne=Date}}}function Be(e){var n=e.dateTime,r=e.date,i=e.time,o=e.periods,s=e.days,a=e.shortDays,u=e.months,c=e.shortMonths;function l(t){var e=t.length;function n(n){for(var r,i,o,s=[],a=-1,u=0;++a<e;)37===t.charCodeAt(a)&&(s.push(t.slice(u,a)),null!=(i=Fe[r=t.charAt(++a)])&&(r=t.charAt(++a)),(o=x[r])&&(r=o(n,null==i?"e"===r?" ":"0":i)),s.push(r),u=a+1);return s.push(t.slice(u,a)),s.join("")}return n.parse=function(e){var n={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null};if(h(n,t,e,0)!=e.length)return null;"p"in n&&(n.H=n.H%12+12*n.p);var r=null!=n.Z&&Ne!==Ie,i=new(r?Ie:Ne);return"j"in n?i.setFullYear(n.y,0,n.j):"W"in n||"U"in n?("w"in n||(n.w="W"in n?1:0),i.setFullYear(n.y,0,1),i.setFullYear(n.y,0,"W"in n?(n.w+6)%7+7*n.W-(i.getDay()+5)%7:n.w+7*n.U-(i.getDay()+6)%7)):i.setFullYear(n.y,n.m,n.d),i.setHours(n.H+(n.Z/100|0),n.M+n.Z%100,n.S,n.L),r?i._:i},n.toString=function(){return t},n}function h(t,e,n,r){for(var i,o,s,a=0,u=e.length,c=n.length;a<u;){if(r>=c)return-1;if(37===(i=e.charCodeAt(a++))){if(s=e.charAt(a++),!(o=E[s in Fe?e.charAt(a++):s])||(r=o(t,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}l.utc=function(t){var e=l(t);function n(t){try{var n=new(Ne=Ie);return n._=t,e(n)}finally{Ne=Date}}return n.parse=function(t){try{Ne=Ie;var n=e.parse(t);return n&&n._}finally{Ne=Date}},n.toString=e.toString,n},l.multi=l.utc.multi=un;var p=t.map(),f=Ve(s),d=ze(s),m=Ve(a),v=ze(a),g=Ve(u),y=ze(u),_=Ve(c),b=ze(c);o.forEach(function(t,e){p.set(t.toLowerCase(),e)});var x={a:function(t){return a[t.getDay()]},A:function(t){return s[t.getDay()]},b:function(t){return c[t.getMonth()]},B:function(t){return u[t.getMonth()]},c:l(n),d:function(t,e){return He(t.getDate(),e,2)},e:function(t,e){return He(t.getDate(),e,2)},H:function(t,e){return He(t.getHours(),e,2)},I:function(t,e){return He(t.getHours()%12||12,e,2)},j:function(t,e){return He(1+Oe.dayOfYear(t),e,3)},L:function(t,e){return He(t.getMilliseconds(),e,3)},m:function(t,e){return He(t.getMonth()+1,e,2)},M:function(t,e){return He(t.getMinutes(),e,2)},p:function(t){return o[+(t.getHours()>=12)]},S:function(t,e){return He(t.getSeconds(),e,2)},U:function(t,e){return He(Oe.sundayOfYear(t),e,2)},w:function(t){return t.getDay()},W:function(t,e){return He(Oe.mondayOfYear(t),e,2)},x:l(r),X:l(i),y:function(t,e){return He(t.getFullYear()%100,e,2)},Y:function(t,e){return He(t.getFullYear()%1e4,e,4)},Z:sn,"%":function(){return"%"}},E={a:function(t,e,n){m.lastIndex=0;var r=m.exec(e.slice(n));return r?(t.w=v.get(r[0].toLowerCase()),n+r[0].length):-1},A:function(t,e,n){f.lastIndex=0;var r=f.exec(e.slice(n));return r?(t.w=d.get(r[0].toLowerCase()),n+r[0].length):-1},b:function(t,e,n){_.lastIndex=0;var r=_.exec(e.slice(n));return r?(t.m=b.get(r[0].toLowerCase()),n+r[0].length):-1},B:function(t,e,n){g.lastIndex=0;var r=g.exec(e.slice(n));return r?(t.m=y.get(r[0].toLowerCase()),n+r[0].length):-1},c:function(t,e,n){return h(t,x.c.toString(),e,n)},d:Ze,e:Ze,H:en,I:en,j:tn,L:on,m:Ke,M:nn,p:function(t,e,n){var r=p.get(e.slice(n,n+=2).toLowerCase());return null==r?-1:(t.p=r,n)},S:rn,U:Ge,w:Qe,W:We,x:function(t,e,n){return h(t,x.x.toString(),e,n)},X:function(t,e,n){return h(t,x.X.toString(),e,n)},y:Xe,Y:Ye,Z:Je,"%":an};return l}Oe.year=Le(function(t){return(t=Oe.day(t)).setMonth(0,1),t},function(t,e){t.setFullYear(t.getFullYear()+e)},function(t){return t.getFullYear()}),Oe.years=Oe.year.range,Oe.years.utc=Oe.year.utc.range,Oe.day=Le(function(t){var e=new Ne(2e3,0);return e.setFullYear(t.getFullYear(),t.getMonth(),t.getDate()),e},function(t,e){t.setDate(t.getDate()+e)},function(t){return t.getDate()-1}),Oe.days=Oe.day.range,Oe.days.utc=Oe.day.utc.range,Oe.dayOfYear=function(t){var e=Oe.year(t);return Math.floor((t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(t,e){e=7-e;var n=Oe[t]=Le(function(t){return(t=Oe.day(t)).setDate(t.getDate()-(t.getDay()+e)%7),t},function(t,e){t.setDate(t.getDate()+7*Math.floor(e))},function(t){var n=Oe.year(t).getDay();return Math.floor((Oe.dayOfYear(t)+(n+e)%7)/7)-(n!==e)});Oe[t+"s"]=n.range,Oe[t+"s"].utc=n.utc.range,Oe[t+"OfYear"]=function(t){var n=Oe.year(t).getDay();return Math.floor((Oe.dayOfYear(t)+(n+e)%7)/7)}}),Oe.week=Oe.sunday,Oe.weeks=Oe.sunday.range,Oe.weeks.utc=Oe.sunday.utc.range,Oe.weekOfYear=Oe.sundayOfYear;var Fe={"-":"",_:" ",0:"0"},qe=/^\s*\d+/,Ue=/^%/;function He(t,e,n){var r=t<0?"-":"",i=(r?-t:t)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(e)+i:i)}function Ve(e){return new RegExp("^(?:"+e.map(t.requote).join("|")+")","i")}function ze(t){for(var e=new _,n=-1,r=t.length;++n<r;)e.set(t[n].toLowerCase(),n);return e}function Qe(t,e,n){qe.lastIndex=0;var r=qe.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function Ge(t,e,n){qe.lastIndex=0;var r=qe.exec(e.slice(n));return r?(t.U=+r[0],n+r[0].length):-1}function We(t,e,n){qe.lastIndex=0;var r=qe.exec(e.slice(n));return r?(t.W=+r[0],n+r[0].length):-1}function Ye(t,e,n){qe.lastIndex=0;var r=qe.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function Xe(t,e,n){qe.lastIndex=0;var r,i=qe.exec(e.slice(n,n+2));return i?(t.y=(r=+i[0])+(r>68?1900:2e3),n+i[0].length):-1}function Je(t,e,n){return/^[+-]\d{4}$/.test(e=e.slice(n,n+5))?(t.Z=-e,n+5):-1}function Ke(t,e,n){qe.lastIndex=0;var r=qe.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function Ze(t,e,n){qe.lastIndex=0;var r=qe.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function tn(t,e,n){qe.lastIndex=0;var r=qe.exec(e.slice(n,n+3));return r?(t.j=+r[0],n+r[0].length):-1}function en(t,e,n){qe.lastIndex=0;var r=qe.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function nn(t,e,n){qe.lastIndex=0;var r=qe.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function rn(t,e,n){qe.lastIndex=0;var r=qe.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function on(t,e,n){qe.lastIndex=0;var r=qe.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function sn(t){var e=t.getTimezoneOffset(),n=e>0?"-":"+",r=g(e)/60|0,i=g(e)%60;return n+He(r,"0",2)+He(i,"0",2)}function an(t,e,n){Ue.lastIndex=0;var r=Ue.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function un(t){for(var e=t.length,n=-1;++n<e;)t[n][0]=this(t[n][0]);return function(e){for(var n=0,r=t[n];!r[1](e);)r=t[++n];return r[0](e)}}t.locale=function(t){return{numberFormat:$e(t),timeFormat:Be(t)}};var cn=t.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function ln(){}t.format=cn.numberFormat,t.geo={},ln.prototype={s:0,t:0,add:function(t){pn(t,this.t,hn),pn(hn.s,this.s,this),this.s?this.t+=hn.t:this.s=hn.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var hn=new ln;function pn(t,e,n){var r=n.s=t+e,i=r-t,o=r-i;n.t=t-o+(e-i)}function fn(t,e){t&&mn.hasOwnProperty(t.type)&&mn[t.type](t,e)}t.geo.stream=function(t,e){t&&dn.hasOwnProperty(t.type)?dn[t.type](t,e):fn(t,e)};var dn={Feature:function(t,e){fn(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)fn(n[r].geometry,e)}},mn={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){vn(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)vn(n[r],e,0)},Polygon:function(t,e){gn(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)gn(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)fn(n[r],e)}};function vn(t,e,n){var r,i=-1,o=t.length-n;for(e.lineStart();++i<o;)r=t[i],e.point(r[0],r[1],r[2]);e.lineEnd()}function gn(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)vn(t[n],e,1);e.polygonEnd()}t.geo.area=function(e){return yn=0,t.geo.stream(e,Dn),yn};var yn,_n,bn,xn,En,wn,Sn,Cn,Mn,Tn,An,$n,kn=new ln,Dn={sphere:function(){yn+=4*St},point:N,lineStart:N,lineEnd:N,polygonStart:function(){kn.reset(),Dn.lineStart=Rn},polygonEnd:function(){var t=2*kn;yn+=t<0?4*St+t:t,Dn.lineStart=Dn.lineEnd=Dn.point=N}};function Rn(){var t,e,n,r,i;function o(t,e){e=e*At/2+St/4;var o=(t*=At)-n,s=o>=0?1:-1,a=s*o,u=Math.cos(e),c=Math.sin(e),l=i*c,h=r*u+l*Math.cos(a),p=l*s*Math.sin(a);kn.add(Math.atan2(p,h)),n=t,r=u,i=c}Dn.point=function(s,a){Dn.point=o,n=(t=s)*At,r=Math.cos(a=(e=a)*At/2+St/4),i=Math.sin(a)},Dn.lineEnd=function(){o(t,e)}}function On(t){var e=t[0],n=t[1],r=Math.cos(n);return[r*Math.cos(e),r*Math.sin(e),Math.sin(n)]}function Nn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function In(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Pn(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function Ln(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function jn(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function Bn(t){return[Math.atan2(t[1],t[0]),Ot(t[2])]}function Fn(t,e){return g(t[0]-e[0])<Et&&g(t[1]-e[1])<Et}t.geo.bounds=function(){var e,n,r,i,o,s,a,u,c,l,h,p={point:f,lineStart:m,lineEnd:v,polygonStart:function(){p.point=y,p.lineStart=_,p.lineEnd=b,c=0,Dn.polygonStart()},polygonEnd:function(){Dn.polygonEnd(),p.point=f,p.lineStart=m,p.lineEnd=v,kn<0?(e=-(r=180),n=-(i=90)):c>Et?i=90:c<-Et&&(n=-90),h[0]=e,h[1]=r}};function f(t,o){l.push(h=[e=t,r=t]),o<n&&(n=o),o>i&&(i=o)}function d(t,s){var a=On([t*At,s*At]);if(u){var c=In(u,a),l=In([c[1],-c[0],0],c);jn(l),l=Bn(l);var h=t-o,p=h>0?1:-1,d=l[0]*$t*p,m=g(h)>180;if(m^(p*o<d&&d<p*t))(v=l[1]*$t)>i&&(i=v);else if(m^(p*o<(d=(d+360)%360-180)&&d<p*t)){var v;(v=-l[1]*$t)<n&&(n=v)}else s<n&&(n=s),s>i&&(i=s);m?t<o?x(e,t)>x(e,r)&&(r=t):x(t,r)>x(e,r)&&(e=t):r>=e?(t<e&&(e=t),t>r&&(r=t)):t>o?x(e,t)>x(e,r)&&(r=t):x(t,r)>x(e,r)&&(e=t)}else f(t,s);u=a,o=t}function m(){p.point=d}function v(){h[0]=e,h[1]=r,p.point=f,u=null}function y(t,e){if(u){var n=t-o;c+=g(n)>180?n+(n>0?360:-360):n}else s=t,a=e;Dn.point(t,e),d(t,e)}function _(){Dn.lineStart()}function b(){y(s,a),Dn.lineEnd(),g(c)>Et&&(e=-(r=180)),h[0]=e,h[1]=r,u=null}function x(t,e){return(e-=t)<0?e+360:e}function E(t,e){return t[0]-e[0]}function w(t,e){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}return function(o){if(i=r=-(e=n=1/0),l=[],t.geo.stream(o,p),c=l.length){l.sort(E);for(var s=1,a=[m=l[0]];s<c;++s)w((f=l[s])[0],m)||w(f[1],m)?(x(m[0],f[1])>x(m[0],m[1])&&(m[1]=f[1]),x(f[0],m[1])>x(m[0],m[1])&&(m[0]=f[0])):a.push(m=f);for(var u,c,f,d=-1/0,m=(s=0,a[c=a.length-1]);s<=c;m=f,++s)f=a[s],(u=x(m[1],f[0]))>d&&(d=u,e=f[0],r=m[1])}return l=h=null,e===1/0||n===1/0?[[NaN,NaN],[NaN,NaN]]:[[e,n],[r,i]]}}(),t.geo.centroid=function(e){_n=bn=xn=En=wn=Sn=Cn=Mn=Tn=An=$n=0,t.geo.stream(e,qn);var n=Tn,r=An,i=$n,o=n*n+r*r+i*i;return o<wt&&(n=Sn,r=Cn,i=Mn,bn<Et&&(n=xn,r=En,i=wn),(o=n*n+r*r+i*i)<wt)?[NaN,NaN]:[Math.atan2(r,n)*$t,Ot(i/Math.sqrt(o))*$t]};var qn={sphere:N,point:Un,lineStart:Vn,lineEnd:zn,polygonStart:function(){qn.lineStart=Qn},polygonEnd:function(){qn.lineStart=Vn}};function Un(t,e){t*=At;var n=Math.cos(e*=At);Hn(n*Math.cos(t),n*Math.sin(t),Math.sin(e))}function Hn(t,e,n){xn+=(t-xn)/++_n,En+=(e-En)/_n,wn+=(n-wn)/_n}function Vn(){var t,e,n;function r(r,i){r*=At;var o=Math.cos(i*=At),s=o*Math.cos(r),a=o*Math.sin(r),u=Math.sin(i),c=Math.atan2(Math.sqrt((c=e*u-n*a)*c+(c=n*s-t*u)*c+(c=t*a-e*s)*c),t*s+e*a+n*u);bn+=c,Sn+=c*(t+(t=s)),Cn+=c*(e+(e=a)),Mn+=c*(n+(n=u)),Hn(t,e,n)}qn.point=function(i,o){i*=At;var s=Math.cos(o*=At);t=s*Math.cos(i),e=s*Math.sin(i),n=Math.sin(o),qn.point=r,Hn(t,e,n)}}function zn(){qn.point=Un}function Qn(){var t,e,n,r,i;function o(t,e){t*=At;var o=Math.cos(e*=At),s=o*Math.cos(t),a=o*Math.sin(t),u=Math.sin(e),c=r*u-i*a,l=i*s-n*u,h=n*a-r*s,p=Math.sqrt(c*c+l*l+h*h),f=n*s+r*a+i*u,d=p&&-Rt(f)/p,m=Math.atan2(p,f);Tn+=d*c,An+=d*l,$n+=d*h,bn+=m,Sn+=m*(n+(n=s)),Cn+=m*(r+(r=a)),Mn+=m*(i+(i=u)),Hn(n,r,i)}qn.point=function(s,a){t=s,e=a,qn.point=o,s*=At;var u=Math.cos(a*=At);n=u*Math.cos(s),r=u*Math.sin(s),i=Math.sin(a),Hn(n,r,i)},qn.lineEnd=function(){o(t,e),qn.lineEnd=zn,qn.point=Un}}function Gn(t,e){function n(n,r){return n=t(n,r),e(n[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,r){return(n=e.invert(n,r))&&t.invert(n[0],n[1])}),n}function Wn(){return!0}function Yn(t,e,n,r,i){var o=[],s=[];if(t.forEach(function(t){if(!((e=t.length-1)<=0)){var e,n=t[0],r=t[e];if(Fn(n,r)){i.lineStart();for(var a=0;a<e;++a)i.point((n=t[a])[0],n[1]);i.lineEnd()}else{var u=new Jn(n,t,null,!0),c=new Jn(n,null,u,!1);u.o=c,o.push(u),s.push(c),u=new Jn(r,t,null,!1),c=new Jn(r,null,u,!0),u.o=c,o.push(u),s.push(c)}}}),s.sort(e),Xn(o),Xn(s),o.length){for(var a=0,u=n,c=s.length;a<c;++a)s[a].e=u=!u;for(var l,h,p=o[0];;){for(var f=p,d=!0;f.v;)if((f=f.n)===p)return;l=f.z,i.lineStart();do{if(f.v=f.o.v=!0,f.e){if(d)for(a=0,c=l.length;a<c;++a)i.point((h=l[a])[0],h[1]);else r(f.x,f.n.x,1,i);f=f.n}else{if(d)for(a=(l=f.p.z).length-1;a>=0;--a)i.point((h=l[a])[0],h[1]);else r(f.x,f.p.x,-1,i);f=f.p}l=(f=f.o).z,d=!d}while(!f.v);i.lineEnd()}}}function Xn(t){if(e=t.length){for(var e,n,r=0,i=t[0];++r<e;)i.n=n=t[r],n.p=i,i=n;i.n=n=t[0],n.p=i}}function Jn(t,e,n,r){this.x=t,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function Kn(e,n,r,i){return function(o,s){var a,u=n(s),c=o.invert(i[0],i[1]),l={point:h,lineStart:f,lineEnd:d,polygonStart:function(){l.point=b,l.lineStart=x,l.lineEnd=E,a=[],m=[]},polygonEnd:function(){l.point=h,l.lineStart=f,l.lineEnd=d,a=t.merge(a);var e=function(t,e){var n=t[0],r=t[1],i=[Math.sin(n),-Math.cos(n),0],o=0,s=0;kn.reset();for(var a=0,u=e.length;a<u;++a){var c=e[a],l=c.length;if(l)for(var h=c[0],p=h[0],f=h[1]/2+St/4,d=Math.sin(f),m=Math.cos(f),v=1;;){v===l&&(v=0);var g=(t=c[v])[0],y=t[1]/2+St/4,_=Math.sin(y),b=Math.cos(y),x=g-p,E=x>=0?1:-1,w=E*x,S=w>St,C=d*_;if(kn.add(Math.atan2(C*E*Math.sin(w),m*b+C*Math.cos(w))),o+=S?x+E*Ct:x,S^p>=n^g>=n){var M=In(On(h),On(t));jn(M);var T=In(i,M);jn(T);var A=(S^x>=0?-1:1)*Ot(T[2]);(r>A||r===A&&(M[0]||M[1]))&&(s+=S^x>=0?1:-1)}if(!v++)break;p=g,d=_,m=b,h=t}}return(o<-Et||o<Et&&kn<-Et)^1&s}(c,m);a.length?(_||(s.polygonStart(),_=!0),Yn(a,er,e,r,s)):e&&(_||(s.polygonStart(),_=!0),s.lineStart(),r(null,null,1,s),s.lineEnd()),_&&(s.polygonEnd(),_=!1),a=m=null},sphere:function(){s.polygonStart(),s.lineStart(),r(null,null,1,s),s.lineEnd(),s.polygonEnd()}};function h(t,n){var r=o(t,n);e(t=r[0],n=r[1])&&s.point(t,n)}function p(t,e){var n=o(t,e);u.point(n[0],n[1])}function f(){l.point=p,u.lineStart()}function d(){l.point=h,u.lineEnd()}var m,v,g=tr(),y=n(g),_=!1;function b(t,e){v.push([t,e]);var n=o(t,e);y.point(n[0],n[1])}function x(){y.lineStart(),v=[]}function E(){b(v[0][0],v[0][1]),y.lineEnd();var t,e=y.clean(),n=g.buffer(),r=n.length;if(v.pop(),m.push(v),v=null,r)if(1&e){var i,o=-1;if((r=(t=n[0]).length-1)>0){for(_||(s.polygonStart(),_=!0),s.lineStart();++o<r;)s.point((i=t[o])[0],i[1]);s.lineEnd()}}else r>1&&2&e&&n.push(n.pop().concat(n.shift())),a.push(n.filter(Zn))}return l}}function Zn(t){return t.length>1}function tr(){var t,e=[];return{lineStart:function(){e.push(t=[])},point:function(e,n){t.push([e,n])},lineEnd:N,buffer:function(){var n=e;return e=[],t=null,n},rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))}}}function er(t,e){return((t=t.x)[0]<0?t[1]-Tt-Et:Tt-t[1])-((e=e.x)[0]<0?e[1]-Tt-Et:Tt-e[1])}var nr=Kn(Wn,function(t){var e,n=NaN,r=NaN,i=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(o,s){var a=o>0?St:-St,u=g(o-n);g(u-St)<Et?(t.point(n,r=(r+s)/2>0?Tt:-Tt),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(a,r),t.point(o,r),e=0):i!==a&&u>=St&&(g(n-i)<Et&&(n-=i*Et),g(o-a)<Et&&(o-=a*Et),r=function(t,e,n,r){var i,o,s=Math.sin(t-n);return g(s)>Et?Math.atan((Math.sin(e)*(o=Math.cos(r))*Math.sin(n)-Math.sin(r)*(i=Math.cos(e))*Math.sin(t))/(i*o*s)):(e+r)/2}(n,r,o,s),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(a,r),e=0),t.point(n=o,r=s),i=a},lineEnd:function(){t.lineEnd(),n=r=NaN},clean:function(){return 2-e}}},function(t,e,n,r){var i;if(null==t)i=n*Tt,r.point(-St,i),r.point(0,i),r.point(St,i),r.point(St,0),r.point(St,-i),r.point(0,-i),r.point(-St,-i),r.point(-St,0),r.point(-St,i);else if(g(t[0]-e[0])>Et){var o=t[0]<e[0]?St:-St;i=n*o/2,r.point(-o,i),r.point(0,i),r.point(o,i)}else r.point(e[0],e[1])},[-St,-St/2]);function rr(t,e,n,r){return function(i){var o,s=i.a,a=i.b,u=s.x,c=s.y,l=0,h=1,p=a.x-u,f=a.y-c;if(o=t-u,p||!(o>0)){if(o/=p,p<0){if(o<l)return;o<h&&(h=o)}else if(p>0){if(o>h)return;o>l&&(l=o)}if(o=n-u,p||!(o<0)){if(o/=p,p<0){if(o>h)return;o>l&&(l=o)}else if(p>0){if(o<l)return;o<h&&(h=o)}if(o=e-c,f||!(o>0)){if(o/=f,f<0){if(o<l)return;o<h&&(h=o)}else if(f>0){if(o>h)return;o>l&&(l=o)}if(o=r-c,f||!(o<0)){if(o/=f,f<0){if(o>h)return;o>l&&(l=o)}else if(f>0){if(o<l)return;o<h&&(h=o)}return l>0&&(i.a={x:u+l*p,y:c+l*f}),h<1&&(i.b={x:u+h*p,y:c+h*f}),i}}}}}}var ir=1e9;function or(e,n,r,i){return function(u){var c,l,h,p,f,d,m,v,g,y,_,b=u,x=tr(),E=rr(e,n,r,i),w={point:M,lineStart:function(){w.point=T,l&&l.push(h=[]);y=!0,g=!1,m=v=NaN},lineEnd:function(){c&&(T(p,f),d&&g&&x.rejoin(),c.push(x.buffer()));w.point=M,g&&u.lineEnd()},polygonStart:function(){u=x,c=[],l=[],_=!0},polygonEnd:function(){u=b,c=t.merge(c);var n=function(t){for(var e=0,n=l.length,r=t[1],i=0;i<n;++i)for(var o,s=1,a=l[i],u=a.length,c=a[0];s<u;++s)o=a[s],c[1]<=r?o[1]>r&&Dt(c,o,t)>0&&++e:o[1]<=r&&Dt(c,o,t)<0&&--e,c=o;return 0!==e}([e,i]),r=_&&n,o=c.length;(r||o)&&(u.polygonStart(),r&&(u.lineStart(),S(null,null,1,u),u.lineEnd()),o&&Yn(c,s,n,S,u),u.polygonEnd()),c=l=h=null}};function S(t,s,u,c){var l=0,h=0;if(null==t||(l=o(t,u))!==(h=o(s,u))||a(t,s)<0^u>0)do{c.point(0===l||3===l?e:r,l>1?i:n)}while((l=(l+u+4)%4)!==h);else c.point(s[0],s[1])}function C(t,o){return e<=t&&t<=r&&n<=o&&o<=i}function M(t,e){C(t,e)&&u.point(t,e)}function T(t,e){var n=C(t=Math.max(-ir,Math.min(ir,t)),e=Math.max(-ir,Math.min(ir,e)));if(l&&h.push([t,e]),y)p=t,f=e,d=n,y=!1,n&&(u.lineStart(),u.point(t,e));else if(n&&g)u.point(t,e);else{var r={a:{x:m,y:v},b:{x:t,y:e}};E(r)?(g||(u.lineStart(),u.point(r.a.x,r.a.y)),u.point(r.b.x,r.b.y),n||u.lineEnd(),_=!1):n&&(u.lineStart(),u.point(t,e),_=!1)}m=t,v=e,g=n}return w};function o(t,i){return g(t[0]-e)<Et?i>0?0:3:g(t[0]-r)<Et?i>0?2:1:g(t[1]-n)<Et?i>0?1:0:i>0?3:2}function s(t,e){return a(t.x,e.x)}function a(t,e){var n=o(t,1),r=o(e,1);return n!==r?n-r:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}}function sr(t){var e=0,n=St/3,r=kr(t),i=r(e,n);return i.parallels=function(t){return arguments.length?r(e=t[0]*St/180,n=t[1]*St/180):[e/St*180,n/St*180]},i}function ar(t,e){var n=Math.sin(t),r=(n+Math.sin(e))/2,i=1+n*(2*r-n),o=Math.sqrt(i)/r;function s(t,e){var n=Math.sqrt(i-2*r*Math.sin(e))/r;return[n*Math.sin(t*=r),o-n*Math.cos(t)]}return s.invert=function(t,e){var n=o-e;return[Math.atan2(t,n)/r,Ot((i-(t*t+n*n)*r*r)/(2*r))]},s}t.geo.clipExtent=function(){var t,e,n,r,i,o,s={stream:function(t){return i&&(i.valid=!1),(i=o(t)).valid=!0,i},extent:function(a){return arguments.length?(o=or(t=+a[0][0],e=+a[0][1],n=+a[1][0],r=+a[1][1]),i&&(i.valid=!1,i=null),s):[[t,e],[n,r]]}};return s.extent([[0,0],[960,500]])},(t.geo.conicEqualArea=function(){return sr(ar)}).raw=ar,t.geo.albers=function(){return t.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},t.geo.albersUsa=function(){var e,n,r,i,o=t.geo.albers(),s=t.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),a=t.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),u={point:function(t,n){e=[t,n]}};function c(t){var o=t[0],s=t[1];return e=null,n(o,s),e||(r(o,s),e)||i(o,s),e}return c.invert=function(t){var e=o.scale(),n=o.translate(),r=(t[0]-n[0])/e,i=(t[1]-n[1])/e;return(i>=.12&&i<.234&&r>=-.425&&r<-.214?s:i>=.166&&i<.234&&r>=-.214&&r<-.115?a:o).invert(t)},c.stream=function(t){var e=o.stream(t),n=s.stream(t),r=a.stream(t);return{point:function(t,i){e.point(t,i),n.point(t,i),r.point(t,i)},sphere:function(){e.sphere(),n.sphere(),r.sphere()},lineStart:function(){e.lineStart(),n.lineStart(),r.lineStart()},lineEnd:function(){e.lineEnd(),n.lineEnd(),r.lineEnd()},polygonStart:function(){e.polygonStart(),n.polygonStart(),r.polygonStart()},polygonEnd:function(){e.polygonEnd(),n.polygonEnd(),r.polygonEnd()}}},c.precision=function(t){return arguments.length?(o.precision(t),s.precision(t),a.precision(t),c):o.precision()},c.scale=function(t){return arguments.length?(o.scale(t),s.scale(.35*t),a.scale(t),c.translate(o.translate())):o.scale()},c.translate=function(t){if(!arguments.length)return o.translate();var e=o.scale(),l=+t[0],h=+t[1];return n=o.translate(t).clipExtent([[l-.455*e,h-.238*e],[l+.455*e,h+.238*e]]).stream(u).point,r=s.translate([l-.307*e,h+.201*e]).clipExtent([[l-.425*e+Et,h+.12*e+Et],[l-.214*e-Et,h+.234*e-Et]]).stream(u).point,i=a.translate([l-.205*e,h+.212*e]).clipExtent([[l-.214*e+Et,h+.166*e+Et],[l-.115*e-Et,h+.234*e-Et]]).stream(u).point,c},c.scale(1070)};var ur,cr,lr,hr,pr,fr,dr={point:N,lineStart:N,lineEnd:N,polygonStart:function(){cr=0,dr.lineStart=mr},polygonEnd:function(){dr.lineStart=dr.lineEnd=dr.point=N,ur+=g(cr/2)}};function mr(){var t,e,n,r;function i(t,e){cr+=r*t-n*e,n=t,r=e}dr.point=function(o,s){dr.point=i,t=n=o,e=r=s},dr.lineEnd=function(){i(t,e)}}var vr={point:function(t,e){t<lr&&(lr=t);t>pr&&(pr=t);e<hr&&(hr=e);e>fr&&(fr=e)},lineStart:N,lineEnd:N,polygonStart:N,polygonEnd:N};function gr(){var t=yr(4.5),e=[],n={point:r,lineStart:function(){n.point=i},lineEnd:s,polygonStart:function(){n.lineEnd=a},polygonEnd:function(){n.lineEnd=s,n.point=r},pointRadius:function(e){return t=yr(e),n},result:function(){if(e.length){var t=e.join("");return e=[],t}}};function r(n,r){e.push("M",n,",",r,t)}function i(t,r){e.push("M",t,",",r),n.point=o}function o(t,n){e.push("L",t,",",n)}function s(){n.point=r}function a(){e.push("Z")}return n}function yr(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}var _r,br={point:xr,lineStart:Er,lineEnd:wr,polygonStart:function(){br.lineStart=Sr},polygonEnd:function(){br.point=xr,br.lineStart=Er,br.lineEnd=wr}};function xr(t,e){xn+=t,En+=e,++wn}function Er(){var t,e;function n(n,r){var i=n-t,o=r-e,s=Math.sqrt(i*i+o*o);Sn+=s*(t+n)/2,Cn+=s*(e+r)/2,Mn+=s,xr(t=n,e=r)}br.point=function(r,i){br.point=n,xr(t=r,e=i)}}function wr(){br.point=xr}function Sr(){var t,e,n,r;function i(t,e){var i=t-n,o=e-r,s=Math.sqrt(i*i+o*o);Sn+=s*(n+t)/2,Cn+=s*(r+e)/2,Mn+=s,Tn+=(s=r*t-n*e)*(n+t),An+=s*(r+e),$n+=3*s,xr(n=t,r=e)}br.point=function(o,s){br.point=i,xr(t=n=o,e=r=s)},br.lineEnd=function(){i(t,e)}}function Cr(t){var e=4.5,n={point:r,lineStart:function(){n.point=i},lineEnd:s,polygonStart:function(){n.lineEnd=a},polygonEnd:function(){n.lineEnd=s,n.point=r},pointRadius:function(t){return e=t,n},result:N};function r(n,r){t.moveTo(n+e,r),t.arc(n,r,e,0,Ct)}function i(e,r){t.moveTo(e,r),n.point=o}function o(e,n){t.lineTo(e,n)}function s(){n.point=r}function a(){t.closePath()}return n}function Mr(t){var e=.5,n=Math.cos(30*At),r=16;function i(e){return(r?function(e){var n,i,s,a,u,c,l,h,p,f,d,m,v={point:g,lineStart:y,lineEnd:b,polygonStart:function(){e.polygonStart(),v.lineStart=x},polygonEnd:function(){e.polygonEnd(),v.lineStart=y}};function g(n,r){n=t(n,r),e.point(n[0],n[1])}function y(){h=NaN,v.point=_,e.lineStart()}function _(n,i){var s=On([n,i]),a=t(n,i);o(h,p,l,f,d,m,h=a[0],p=a[1],l=n,f=s[0],d=s[1],m=s[2],r,e),e.point(h,p)}function b(){v.point=g,e.lineEnd()}function x(){y(),v.point=E,v.lineEnd=w}function E(t,e){_(n=t,e),i=h,s=p,a=f,u=d,c=m,v.point=_}function w(){o(h,p,l,f,d,m,i,s,n,a,u,c,r,e),v.lineEnd=b,b()}return v}:function(e){return Ar(e,function(n,r){n=t(n,r),e.point(n[0],n[1])})})(e)}function o(r,i,s,a,u,c,l,h,p,f,d,m,v,y){var _=l-r,b=h-i,x=_*_+b*b;if(x>4*e&&v--){var E=a+f,w=u+d,S=c+m,C=Math.sqrt(E*E+w*w+S*S),M=Math.asin(S/=C),T=g(g(S)-1)<Et||g(s-p)<Et?(s+p)/2:Math.atan2(w,E),A=t(T,M),$=A[0],k=A[1],D=$-r,R=k-i,O=b*D-_*R;(O*O/x>e||g((_*D+b*R)/x-.5)>.3||a*f+u*d+c*m<n)&&(o(r,i,s,a,u,c,$,k,T,E/=C,w/=C,S,v,y),y.point($,k),o($,k,T,E,w,S,l,h,p,f,d,m,v,y))}}return i.precision=function(t){return arguments.length?(r=(e=t*t)>0&&16,i):Math.sqrt(e)},i}function Tr(t){this.stream=t}function Ar(t,e){return{point:e,sphere:function(){t.sphere()},lineStart:function(){t.lineStart()},lineEnd:function(){t.lineEnd()},polygonStart:function(){t.polygonStart()},polygonEnd:function(){t.polygonEnd()}}}function $r(t){return kr(function(){return t})()}function kr(e){var n,r,i,o,s,a,u=Mr(function(t,e){return[(t=n(t,e))[0]*c+o,s-t[1]*c]}),c=150,l=480,h=250,p=0,f=0,d=0,m=0,v=0,y=nr,_=k,b=null,x=null;function E(t){return[(t=i(t[0]*At,t[1]*At))[0]*c+o,s-t[1]*c]}function w(t){return(t=i.invert((t[0]-o)/c,(s-t[1])/c))&&[t[0]*$t,t[1]*$t]}function S(){i=Gn(r=Nr(d,m,v),n);var t=n(p,f);return o=l-t[0]*c,s=h+t[1]*c,C()}function C(){return a&&(a.valid=!1,a=null),E}return E.stream=function(t){return a&&(a.valid=!1),(a=Dr(y(r,u(_(t))))).valid=!0,a},E.clipAngle=function(t){return arguments.length?(y=null==t?(b=t,nr):function(t){var e=Math.cos(t),n=e>0,r=g(e)>Et;return Kn(i,function(t){var e,a,u,c,l;return{lineStart:function(){c=u=!1,l=1},point:function(h,p){var f,d=[h,p],m=i(h,p),v=n?m?0:s(h,p):m?s(h+(h<0?St:-St),p):0;if(!e&&(c=u=m)&&t.lineStart(),m!==u&&(f=o(e,d),(Fn(e,f)||Fn(d,f))&&(d[0]+=Et,d[1]+=Et,m=i(d[0],d[1]))),m!==u)l=0,m?(t.lineStart(),f=o(d,e),t.point(f[0],f[1])):(f=o(e,d),t.point(f[0],f[1]),t.lineEnd()),e=f;else if(r&&e&&n^m){var g;v&a||!(g=o(d,e,!0))||(l=0,n?(t.lineStart(),t.point(g[0][0],g[0][1]),t.point(g[1][0],g[1][1]),t.lineEnd()):(t.point(g[1][0],g[1][1]),t.lineEnd(),t.lineStart(),t.point(g[0][0],g[0][1])))}!m||e&&Fn(e,d)||t.point(d[0],d[1]),e=d,u=m,a=v},lineEnd:function(){u&&t.lineEnd(),e=null},clean:function(){return l|(c&&u)<<1}}},jr(t,6*At),n?[0,-t]:[-St,t-St]);function i(t,n){return Math.cos(t)*Math.cos(n)>e}function o(t,n,r){var i=[1,0,0],o=In(On(t),On(n)),s=Nn(o,o),a=o[0],u=s-a*a;if(!u)return!r&&t;var c=e*s/u,l=-e*a/u,h=In(i,o),p=Ln(i,c);Pn(p,Ln(o,l));var f=h,d=Nn(p,f),m=Nn(f,f),v=d*d-m*(Nn(p,p)-1);if(!(v<0)){var y=Math.sqrt(v),_=Ln(f,(-d-y)/m);if(Pn(_,p),_=Bn(_),!r)return _;var b,x=t[0],E=n[0],w=t[1],S=n[1];E<x&&(b=x,x=E,E=b);var C=E-x,M=g(C-St)<Et;if(!M&&S<w&&(b=w,w=S,S=b),M||C<Et?M?w+S>0^_[1]<(g(_[0]-x)<Et?w:S):w<=_[1]&&_[1]<=S:C>St^(x<=_[0]&&_[0]<=E)){var T=Ln(f,(-d+y)/m);return Pn(T,p),[_,Bn(T)]}}}function s(e,r){var i=n?t:St-t,o=0;return e<-i?o|=1:e>i&&(o|=2),r<-i?o|=4:r>i&&(o|=8),o}}((b=+t)*At),C()):b},E.clipExtent=function(t){return arguments.length?(x=t,_=t?or(t[0][0],t[0][1],t[1][0],t[1][1]):k,C()):x},E.scale=function(t){return arguments.length?(c=+t,S()):c},E.translate=function(t){return arguments.length?(l=+t[0],h=+t[1],S()):[l,h]},E.center=function(t){return arguments.length?(p=t[0]%360*At,f=t[1]%360*At,S()):[p*$t,f*$t]},E.rotate=function(t){return arguments.length?(d=t[0]%360*At,m=t[1]%360*At,v=t.length>2?t[2]%360*At:0,S()):[d*$t,m*$t,v*$t]},t.rebind(E,u,"precision"),function(){return n=e.apply(this,arguments),E.invert=n.invert&&w,S()}}function Dr(t){return Ar(t,function(e,n){t.point(e*At,n*At)})}function Rr(t,e){return[t,e]}function Or(t,e){return[t>St?t-Ct:t<-St?t+Ct:t,e]}function Nr(t,e,n){return t?e||n?Gn(Pr(t),Lr(e,n)):Pr(t):e||n?Lr(e,n):Or}function Ir(t){return function(e,n){return[(e+=t)>St?e-Ct:e<-St?e+Ct:e,n]}}function Pr(t){var e=Ir(t);return e.invert=Ir(-t),e}function Lr(t,e){var n=Math.cos(t),r=Math.sin(t),i=Math.cos(e),o=Math.sin(e);function s(t,e){var s=Math.cos(e),a=Math.cos(t)*s,u=Math.sin(t)*s,c=Math.sin(e),l=c*n+a*r;return[Math.atan2(u*i-l*o,a*n-c*r),Ot(l*i+u*o)]}return s.invert=function(t,e){var s=Math.cos(e),a=Math.cos(t)*s,u=Math.sin(t)*s,c=Math.sin(e),l=c*i-u*o;return[Math.atan2(u*i+c*o,a*n+l*r),Ot(l*n-a*r)]},s}function jr(t,e){var n=Math.cos(t),r=Math.sin(t);return function(i,o,s,a){var u=s*e;null!=i?(i=Br(n,i),o=Br(n,o),(s>0?i<o:i>o)&&(i+=s*Ct)):(i=t+s*Ct,o=t-.5*u);for(var c,l=i;s>0?l>o:l<o;l-=u)a.point((c=Bn([n,-r*Math.cos(l),-r*Math.sin(l)]))[0],c[1])}}function Br(t,e){var n=On(e);n[0]-=t,jn(n);var r=Rt(-n[1]);return((-n[2]<0?-r:r)+2*Math.PI-Et)%(2*Math.PI)}function Fr(e,n,r){var i=t.range(e,n-Et,r).concat(n);return function(t){return i.map(function(e){return[t,e]})}}function qr(e,n,r){var i=t.range(e,n-Et,r).concat(n);return function(t){return i.map(function(e){return[e,t]})}}function Ur(t){return t.source}function Hr(t){return t.target}t.geo.path=function(){var e,n,r,i,o,s=4.5;function a(e){return e&&("function"==typeof s&&i.pointRadius(+s.apply(this,arguments)),o&&o.valid||(o=r(i)),t.geo.stream(e,o)),i.result()}function u(){return o=null,a}return a.area=function(e){return ur=0,t.geo.stream(e,r(dr)),ur},a.centroid=function(e){return xn=En=wn=Sn=Cn=Mn=Tn=An=$n=0,t.geo.stream(e,r(br)),$n?[Tn/$n,An/$n]:Mn?[Sn/Mn,Cn/Mn]:wn?[xn/wn,En/wn]:[NaN,NaN]},a.bounds=function(e){return pr=fr=-(lr=hr=1/0),t.geo.stream(e,r(vr)),[[lr,hr],[pr,fr]]},a.projection=function(t){return arguments.length?(r=(e=t)?t.stream||(n=t,i=Mr(function(t,e){return n([t*$t,e*$t])}),function(t){return Dr(i(t))}):k,u()):e;var n,i},a.context=function(t){return arguments.length?(i=null==(n=t)?new gr:new Cr(t),"function"!=typeof s&&i.pointRadius(s),u()):n},a.pointRadius=function(t){return arguments.length?(s="function"==typeof t?t:(i.pointRadius(+t),+t),a):s},a.projection(t.geo.albersUsa()).context(null)},t.geo.transform=function(t){return{stream:function(e){var n=new Tr(e);for(var r in t)n[r]=t[r];return n}}},Tr.prototype={point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},t.geo.projection=$r,t.geo.projectionMutator=kr,(t.geo.equirectangular=function(){return $r(Rr)}).raw=Rr.invert=Rr,t.geo.rotation=function(t){function e(e){return(e=t(e[0]*At,e[1]*At))[0]*=$t,e[1]*=$t,e}return t=Nr(t[0]%360*At,t[1]*At,t.length>2?t[2]*At:0),e.invert=function(e){return(e=t.invert(e[0]*At,e[1]*At))[0]*=$t,e[1]*=$t,e},e},Or.invert=Rr,t.geo.circle=function(){var t,e,n=[0,0],r=6;function i(){var t="function"==typeof n?n.apply(this,arguments):n,r=Nr(-t[0]*At,-t[1]*At,0).invert,i=[];return e(null,null,1,{point:function(t,e){i.push(t=r(t,e)),t[0]*=$t,t[1]*=$t}}),{type:"Polygon",coordinates:[i]}}return i.origin=function(t){return arguments.length?(n=t,i):n},i.angle=function(n){return arguments.length?(e=jr((t=+n)*At,r*At),i):t},i.precision=function(n){return arguments.length?(e=jr(t*At,(r=+n)*At),i):r},i.angle(90)},t.geo.distance=function(t,e){var n,r=(e[0]-t[0])*At,i=t[1]*At,o=e[1]*At,s=Math.sin(r),a=Math.cos(r),u=Math.sin(i),c=Math.cos(i),l=Math.sin(o),h=Math.cos(o);return Math.atan2(Math.sqrt((n=h*s)*n+(n=c*l-u*h*a)*n),u*l+c*h*a)},t.geo.graticule=function(){var e,n,r,i,o,s,a,u,c,l,h,p,f=10,d=f,m=90,v=360,y=2.5;function _(){return{type:"MultiLineString",coordinates:b()}}function b(){return t.range(Math.ceil(i/m)*m,r,m).map(h).concat(t.range(Math.ceil(u/v)*v,a,v).map(p)).concat(t.range(Math.ceil(n/f)*f,e,f).filter(function(t){return g(t%m)>Et}).map(c)).concat(t.range(Math.ceil(s/d)*d,o,d).filter(function(t){return g(t%v)>Et}).map(l))}return _.lines=function(){return b().map(function(t){return{type:"LineString",coordinates:t}})},_.outline=function(){return{type:"Polygon",coordinates:[h(i).concat(p(a).slice(1),h(r).reverse().slice(1),p(u).reverse().slice(1))]}},_.extent=function(t){return arguments.length?_.majorExtent(t).minorExtent(t):_.minorExtent()},_.majorExtent=function(t){return arguments.length?(i=+t[0][0],r=+t[1][0],u=+t[0][1],a=+t[1][1],i>r&&(t=i,i=r,r=t),u>a&&(t=u,u=a,a=t),_.precision(y)):[[i,u],[r,a]]},_.minorExtent=function(t){return arguments.length?(n=+t[0][0],e=+t[1][0],s=+t[0][1],o=+t[1][1],n>e&&(t=n,n=e,e=t),s>o&&(t=s,s=o,o=t),_.precision(y)):[[n,s],[e,o]]},_.step=function(t){return arguments.length?_.majorStep(t).minorStep(t):_.minorStep()},_.majorStep=function(t){return arguments.length?(m=+t[0],v=+t[1],_):[m,v]},_.minorStep=function(t){return arguments.length?(f=+t[0],d=+t[1],_):[f,d]},_.precision=function(t){return arguments.length?(y=+t,c=Fr(s,o,90),l=qr(n,e,y),h=Fr(u,a,90),p=qr(i,r,y),_):y},_.majorExtent([[-180,-90+Et],[180,90-Et]]).minorExtent([[-180,-80-Et],[180,80+Et]])},t.geo.greatArc=function(){var e,n,r=Ur,i=Hr;function o(){return{type:"LineString",coordinates:[e||r.apply(this,arguments),n||i.apply(this,arguments)]}}return o.distance=function(){return t.geo.distance(e||r.apply(this,arguments),n||i.apply(this,arguments))},o.source=function(t){return arguments.length?(r=t,e="function"==typeof t?null:t,o):r},o.target=function(t){return arguments.length?(i=t,n="function"==typeof t?null:t,o):i},o.precision=function(){return arguments.length?o:0},o},t.geo.interpolate=function(t,e){return n=t[0]*At,r=t[1]*At,i=e[0]*At,o=e[1]*At,s=Math.cos(r),a=Math.sin(r),u=Math.cos(o),c=Math.sin(o),l=s*Math.cos(n),h=s*Math.sin(n),p=u*Math.cos(i),f=u*Math.sin(i),d=2*Math.asin(Math.sqrt(It(o-r)+s*u*It(i-n))),m=1/Math.sin(d),(v=d?function(t){var e=Math.sin(t*=d)*m,n=Math.sin(d-t)*m,r=n*l+e*p,i=n*h+e*f,o=n*a+e*c;return[Math.atan2(i,r)*$t,Math.atan2(o,Math.sqrt(r*r+i*i))*$t]}:function(){return[n*$t,r*$t]}).distance=d,v;var n,r,i,o,s,a,u,c,l,h,p,f,d,m,v},t.geo.length=function(e){return _r=0,t.geo.stream(e,Vr),_r};var Vr={sphere:N,point:N,lineStart:function(){var t,e,n;function r(r,i){var o=Math.sin(i*=At),s=Math.cos(i),a=g((r*=At)-t),u=Math.cos(a);_r+=Math.atan2(Math.sqrt((a=s*Math.sin(a))*a+(a=n*o-e*s*u)*a),e*o+n*s*u),t=r,e=o,n=s}Vr.point=function(i,o){t=i*At,e=Math.sin(o*=At),n=Math.cos(o),Vr.point=r},Vr.lineEnd=function(){Vr.point=Vr.lineEnd=N}},lineEnd:N,polygonStart:N,polygonEnd:N};function zr(t,e){function n(e,n){var r=Math.cos(e),i=Math.cos(n),o=t(r*i);return[o*i*Math.sin(e),o*Math.sin(n)]}return n.invert=function(t,n){var r=Math.sqrt(t*t+n*n),i=e(r),o=Math.sin(i),s=Math.cos(i);return[Math.atan2(t*o,r*s),Math.asin(r&&n*o/r)]},n}var Qr=zr(function(t){return Math.sqrt(2/(1+t))},function(t){return 2*Math.asin(t/2)});(t.geo.azimuthalEqualArea=function(){return $r(Qr)}).raw=Qr;var Gr=zr(function(t){var e=Math.acos(t);return e&&e/Math.sin(e)},k);function Wr(t,e){var n=Math.cos(t),r=function(t){return Math.tan(St/4+t/2)},i=t===e?Math.sin(t):Math.log(n/Math.cos(e))/Math.log(r(e)/r(t)),o=n*Math.pow(r(t),i)/i;if(!i)return Jr;function s(t,e){o>0?e<-Tt+Et&&(e=-Tt+Et):e>Tt-Et&&(e=Tt-Et);var n=o/Math.pow(r(e),i);return[n*Math.sin(i*t),o-n*Math.cos(i*t)]}return s.invert=function(t,e){var n=o-e,r=kt(i)*Math.sqrt(t*t+n*n);return[Math.atan2(t,n)/i,2*Math.atan(Math.pow(o/r,1/i))-Tt]},s}function Yr(t,e){var n=Math.cos(t),r=t===e?Math.sin(t):(n-Math.cos(e))/(e-t),i=n/r+t;if(g(r)<Et)return Rr;function o(t,e){var n=i-e;return[n*Math.sin(r*t),i-n*Math.cos(r*t)]}return o.invert=function(t,e){var n=i-e;return[Math.atan2(t,n)/r,i-kt(r)*Math.sqrt(t*t+n*n)]},o}(t.geo.azimuthalEquidistant=function(){return $r(Gr)}).raw=Gr,(t.geo.conicConformal=function(){return sr(Wr)}).raw=Wr,(t.geo.conicEquidistant=function(){return sr(Yr)}).raw=Yr;var Xr=zr(function(t){return 1/t},Math.atan);function Jr(t,e){return[t,Math.log(Math.tan(St/4+e/2))]}function Kr(t){var e,n=$r(t),r=n.scale,i=n.translate,o=n.clipExtent;return n.scale=function(){var t=r.apply(n,arguments);return t===n?e?n.clipExtent(null):n:t},n.translate=function(){var t=i.apply(n,arguments);return t===n?e?n.clipExtent(null):n:t},n.clipExtent=function(t){var s=o.apply(n,arguments);if(s===n){if(e=null==t){var a=St*r(),u=i();o([[u[0]-a,u[1]-a],[u[0]+a,u[1]+a]])}}else e&&(s=null);return s},n.clipExtent(null)}(t.geo.gnomonic=function(){return $r(Xr)}).raw=Xr,Jr.invert=function(t,e){return[t,2*Math.atan(Math.exp(e))-Tt]},(t.geo.mercator=function(){return Kr(Jr)}).raw=Jr;var Zr=zr(function(){return 1},Math.asin);(t.geo.orthographic=function(){return $r(Zr)}).raw=Zr;var ti=zr(function(t){return 1/(1+t)},function(t){return 2*Math.atan(t)});function ei(t,e){return[Math.log(Math.tan(St/4+e/2)),-t]}function ni(t){return t[0]}function ri(t){return t[1]}function ii(t){for(var e=t.length,n=[0,1],r=2,i=2;i<e;i++){for(;r>1&&Dt(t[n[r-2]],t[n[r-1]],t[i])<=0;)--r;n[r++]=i}return n.slice(0,r)}function oi(t,e){return t[0]-e[0]||t[1]-e[1]}(t.geo.stereographic=function(){return $r(ti)}).raw=ti,ei.invert=function(t,e){return[-e,2*Math.atan(Math.exp(t))-Tt]},(t.geo.transverseMercator=function(){var t=Kr(ei),e=t.center,n=t.rotate;return t.center=function(t){return t?e([-t[1],t[0]]):[(t=e())[1],-t[0]]},t.rotate=function(t){return t?n([t[0],t[1],t.length>2?t[2]+90:90]):[(t=n())[0],t[1],t[2]-90]},n([0,0,90])}).raw=ei,t.geom={},t.geom.hull=function(t){var e=ni,n=ri;if(arguments.length)return r(t);function r(t){if(t.length<3)return[];var r,i=me(e),o=me(n),s=t.length,a=[],u=[];for(r=0;r<s;r++)a.push([+i.call(this,t[r],r),+o.call(this,t[r],r),r]);for(a.sort(oi),r=0;r<s;r++)u.push([a[r][0],-a[r][1]]);var c=ii(a),l=ii(u),h=l[0]===c[0],p=l[l.length-1]===c[c.length-1],f=[];for(r=c.length-1;r>=0;--r)f.push(t[a[c[r]][2]]);for(r=+h;r<l.length-p;++r)f.push(t[a[l[r]][2]]);return f}return r.x=function(t){return arguments.length?(e=t,r):e},r.y=function(t){return arguments.length?(n=t,r):n},r},t.geom.polygon=function(t){return q(t,si),t};var si=t.geom.polygon.prototype=[];function ai(t,e,n){return(n[0]-e[0])*(t[1]-e[1])<(n[1]-e[1])*(t[0]-e[0])}function ui(t,e,n,r){var i=t[0],o=n[0],s=e[0]-i,a=r[0]-o,u=t[1],c=n[1],l=e[1]-u,h=r[1]-c,p=(a*(u-c)-h*(i-o))/(h*s-a*l);return[i+p*s,u+p*l]}function ci(t){var e=t[0],n=t[t.length-1];return!(e[0]-n[0]||e[1]-n[1])}si.area=function(){for(var t,e=-1,n=this.length,r=this[n-1],i=0;++e<n;)t=r,r=this[e],i+=t[1]*r[0]-t[0]*r[1];return.5*i},si.centroid=function(t){var e,n,r=-1,i=this.length,o=0,s=0,a=this[i-1];for(arguments.length||(t=-1/(6*this.area()));++r<i;)e=a,a=this[r],n=e[0]*a[1]-a[0]*e[1],o+=(e[0]+a[0])*n,s+=(e[1]+a[1])*n;return[o*t,s*t]},si.clip=function(t){for(var e,n,r,i,o,s,a=ci(t),u=-1,c=this.length-ci(this),l=this[c-1];++u<c;){for(e=t.slice(),t.length=0,i=this[u],o=e[(r=e.length-a)-1],n=-1;++n<r;)ai(s=e[n],l,i)?(ai(o,l,i)||t.push(ui(o,s,l,i)),t.push(s)):ai(o,l,i)&&t.push(ui(o,s,l,i)),o=s;a&&t.push(t[0]),l=i}return t};var li,hi,pi,fi,di,mi=[],vi=[];function gi(){Ii(this),this.edge=this.site=this.circle=null}function yi(t){var e=mi.pop()||new gi;return e.site=t,e}function _i(t){Ai(t),pi.remove(t),mi.push(t),Ii(t)}function bi(t){var e=t.circle,n=e.x,r=e.cy,i={x:n,y:r},o=t.P,s=t.N,a=[t];_i(t);for(var u=o;u.circle&&g(n-u.circle.x)<Et&&g(r-u.circle.cy)<Et;)o=u.P,a.unshift(u),_i(u),u=o;a.unshift(u),Ai(u);for(var c=s;c.circle&&g(n-c.circle.x)<Et&&g(r-c.circle.cy)<Et;)s=c.N,a.push(c),_i(c),c=s;a.push(c),Ai(c);var l,h=a.length;for(l=1;l<h;++l)c=a[l],u=a[l-1],Ri(c.edge,u.site,c.site,i);u=a[0],(c=a[h-1]).edge=Di(u.site,c.site,null,i),Ti(u),Ti(c)}function xi(t){for(var e,n,r,i,o=t.x,s=t.y,a=pi._;a;)if((r=Ei(a,s)-o)>Et)a=a.L;else{if(!((i=o-wi(a,s))>Et)){r>-Et?(e=a.P,n=a):i>-Et?(e=a,n=a.N):e=n=a;break}if(!a.R){e=a;break}a=a.R}var u=yi(t);if(pi.insert(e,u),e||n){if(e===n)return Ai(e),n=yi(e.site),pi.insert(u,n),u.edge=n.edge=Di(e.site,u.site),Ti(e),void Ti(n);if(n){Ai(e),Ai(n);var c=e.site,l=c.x,h=c.y,p=t.x-l,f=t.y-h,d=n.site,m=d.x-l,v=d.y-h,g=2*(p*v-f*m),y=p*p+f*f,_=m*m+v*v,b={x:(v*y-f*_)/g+l,y:(p*_-m*y)/g+h};Ri(n.edge,c,d,b),u.edge=Di(c,t,null,b),n.edge=Di(t,d,null,b),Ti(e),Ti(n)}else u.edge=Di(e.site,u.site)}}function Ei(t,e){var n=t.site,r=n.x,i=n.y,o=i-e;if(!o)return r;var s=t.P;if(!s)return-1/0;var a=(n=s.site).x,u=n.y,c=u-e;if(!c)return a;var l=a-r,h=1/o-1/c,p=l/c;return h?(-p+Math.sqrt(p*p-2*h*(l*l/(-2*c)-u+c/2+i-o/2)))/h+r:(r+a)/2}function wi(t,e){var n=t.N;if(n)return Ei(n,e);var r=t.site;return r.y===e?r.x:1/0}function Si(t){this.site=t,this.edges=[]}function Ci(t,e){return e.angle-t.angle}function Mi(){Ii(this),this.x=this.y=this.arc=this.site=this.cy=null}function Ti(t){var e=t.P,n=t.N;if(e&&n){var r=e.site,i=t.site,o=n.site;if(r!==o){var s=i.x,a=i.y,u=r.x-s,c=r.y-a,l=o.x-s,h=2*(u*(v=o.y-a)-c*l);if(!(h>=-wt)){var p=u*u+c*c,f=l*l+v*v,d=(v*p-c*f)/h,m=(u*f-l*p)/h,v=m+a,g=vi.pop()||new Mi;g.arc=t,g.site=i,g.x=d+s,g.y=v+Math.sqrt(d*d+m*m),g.cy=v,t.circle=g;for(var y=null,_=di._;_;)if(g.y<_.y||g.y===_.y&&g.x<=_.x){if(!_.L){y=_.P;break}_=_.L}else{if(!_.R){y=_;break}_=_.R}di.insert(y,g),y||(fi=g)}}}}function Ai(t){var e=t.circle;e&&(e.P||(fi=e.N),di.remove(e),vi.push(e),Ii(e),t.circle=null)}function $i(t,e){var n=t.b;if(n)return!0;var r,i,o=t.a,s=e[0][0],a=e[1][0],u=e[0][1],c=e[1][1],l=t.l,h=t.r,p=l.x,f=l.y,d=h.x,m=h.y,v=(p+d)/2,g=(f+m)/2;if(m===f){if(v<s||v>=a)return;if(p>d){if(o){if(o.y>=c)return}else o={x:v,y:u};n={x:v,y:c}}else{if(o){if(o.y<u)return}else o={x:v,y:c};n={x:v,y:u}}}else if(i=g-(r=(p-d)/(m-f))*v,r<-1||r>1)if(p>d){if(o){if(o.y>=c)return}else o={x:(u-i)/r,y:u};n={x:(c-i)/r,y:c}}else{if(o){if(o.y<u)return}else o={x:(c-i)/r,y:c};n={x:(u-i)/r,y:u}}else if(f<m){if(o){if(o.x>=a)return}else o={x:s,y:r*s+i};n={x:a,y:r*a+i}}else{if(o){if(o.x<s)return}else o={x:a,y:r*a+i};n={x:s,y:r*s+i}}return t.a=o,t.b=n,!0}function ki(t,e){this.l=t,this.r=e,this.a=this.b=null}function Di(t,e,n,r){var i=new ki(t,e);return li.push(i),n&&Ri(i,t,e,n),r&&Ri(i,e,t,r),hi[t.i].edges.push(new Oi(i,t,e)),hi[e.i].edges.push(new Oi(i,e,t)),i}function Ri(t,e,n,r){t.a||t.b?t.l===n?t.b=r:t.a=r:(t.a=r,t.l=e,t.r=n)}function Oi(t,e,n){var r=t.a,i=t.b;this.edge=t,this.site=e,this.angle=n?Math.atan2(n.y-e.y,n.x-e.x):t.l===e?Math.atan2(i.x-r.x,r.y-i.y):Math.atan2(r.x-i.x,i.y-r.y)}function Ni(){this._=null}function Ii(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function Pi(t,e){var n=e,r=e.R,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function Li(t,e){var n=e,r=e.L,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function ji(t){for(;t.L;)t=t.L;return t}function Bi(t,e){var n,r,i,o=t.sort(Fi).pop();for(li=[],hi=new Array(t.length),pi=new Ni,di=new Ni;;)if(i=fi,o&&(!i||o.y<i.y||o.y===i.y&&o.x<i.x))o.x===n&&o.y===r||(hi[o.i]=new Si(o),xi(o),n=o.x,r=o.y),o=t.pop();else{if(!i)break;bi(i.arc)}e&&(function(t){for(var e,n=li,r=rr(t[0][0],t[0][1],t[1][0],t[1][1]),i=n.length;i--;)(!$i(e=n[i],t)||!r(e)||g(e.a.x-e.b.x)<Et&&g(e.a.y-e.b.y)<Et)&&(e.a=e.b=null,n.splice(i,1))}(e),function(t){for(var e,n,r,i,o,s,a,u,c,l,h=t[0][0],p=t[1][0],f=t[0][1],d=t[1][1],m=hi,v=m.length;v--;)if((o=m[v])&&o.prepare())for(u=(a=o.edges).length,s=0;s<u;)r=(l=a[s].end()).x,i=l.y,e=(c=a[++s%u].start()).x,n=c.y,(g(r-e)>Et||g(i-n)>Et)&&(a.splice(s,0,new Oi((y=o.site,_=l,b=g(r-h)<Et&&d-i>Et?{x:h,y:g(e-h)<Et?n:d}:g(i-d)<Et&&p-r>Et?{x:g(n-d)<Et?e:p,y:d}:g(r-p)<Et&&i-f>Et?{x:p,y:g(e-p)<Et?n:f}:g(i-f)<Et&&r-h>Et?{x:g(n-f)<Et?e:h,y:f}:null,x=void 0,x=new ki(y,null),x.a=_,x.b=b,li.push(x),x),o.site,null)),++u);var y,_,b,x}(e));var s={cells:hi,edges:li};return pi=di=li=hi=null,s}function Fi(t,e){return e.y-t.y||e.x-t.x}Si.prototype.prepare=function(){for(var t,e=this.edges,n=e.length;n--;)(t=e[n].edge).b&&t.a||e.splice(n,1);return e.sort(Ci),e.length},Oi.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},Ni.prototype={insert:function(t,e){var n,r,i;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;n=t}else this._?(t=ji(this._),e.P=null,e.N=t,t.P=t.L=e,n=t):(e.P=e.N=null,this._=e,n=null);for(e.L=e.R=null,e.U=n,e.C=!0,t=e;n&&n.C;)n===(r=n.U).L?(i=r.R)&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.R&&(Pi(this,n),n=(t=n).U),n.C=!1,r.C=!0,Li(this,r)):(i=r.L)&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.L&&(Li(this,n),n=(t=n).U),n.C=!1,r.C=!0,Pi(this,r)),n=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,n,r,i=t.U,o=t.L,s=t.R;if(n=o?s?ji(s):o:s,i?i.L===t?i.L=n:i.R=n:this._=n,o&&s?(r=n.C,n.C=t.C,n.L=o,o.U=n,n!==s?(i=n.U,n.U=t.U,t=n.R,i.L=t,n.R=s,s.U=n):(n.U=i,i=n,t=n.R)):(r=t.C,t=n),t&&(t.U=i),!r)if(t&&t.C)t.C=!1;else{do{if(t===this._)break;if(t===i.L){if((e=i.R).C&&(e.C=!1,i.C=!0,Pi(this,i),e=i.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,Li(this,e),e=i.R),e.C=i.C,i.C=e.R.C=!1,Pi(this,i),t=this._;break}}else if((e=i.L).C&&(e.C=!1,i.C=!0,Li(this,i),e=i.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,Pi(this,e),e=i.L),e.C=i.C,i.C=e.L.C=!1,Li(this,i),t=this._;break}e.C=!0,t=i,i=i.U}while(!t.C);t&&(t.C=!1)}}},t.geom.voronoi=function(t){var e=ni,n=ri,r=e,i=n,o=qi;if(t)return s(t);function s(t){var e=new Array(t.length),n=o[0][0],r=o[0][1],i=o[1][0],s=o[1][1];return Bi(a(t),o).cells.forEach(function(o,a){var u=o.edges,c=o.site;(e[a]=u.length?u.map(function(t){var e=t.start();return[e.x,e.y]}):c.x>=n&&c.x<=i&&c.y>=r&&c.y<=s?[[n,s],[i,s],[i,r],[n,r]]:[]).point=t[a]}),e}function a(t){return t.map(function(t,e){return{x:Math.round(r(t,e)/Et)*Et,y:Math.round(i(t,e)/Et)*Et,i:e}})}return s.links=function(t){return Bi(a(t)).edges.filter(function(t){return t.l&&t.r}).map(function(e){return{source:t[e.l.i],target:t[e.r.i]}})},s.triangles=function(t){var e=[];return Bi(a(t)).cells.forEach(function(n,r){for(var i,o,s,a,u=n.site,c=n.edges.sort(Ci),l=-1,h=c.length,p=c[h-1].edge,f=p.l===u?p.r:p.l;++l<h;)p,i=f,f=(p=c[l].edge).l===u?p.r:p.l,r<i.i&&r<f.i&&(s=i,a=f,((o=u).x-a.x)*(s.y-o.y)-(o.x-s.x)*(a.y-o.y)<0)&&e.push([t[r],t[i.i],t[f.i]])}),e},s.x=function(t){return arguments.length?(r=me(e=t),s):e},s.y=function(t){return arguments.length?(i=me(n=t),s):n},s.clipExtent=function(t){return arguments.length?(o=null==t?qi:t,s):o===qi?null:o},s.size=function(t){return arguments.length?s.clipExtent(t&&[[0,0],t]):o===qi?null:o&&o[1]},s};var qi=[[-1e6,-1e6],[1e6,1e6]];function Ui(t){return t.x}function Hi(t){return t.y}function Vi(e,n){e=t.rgb(e),n=t.rgb(n);var r=e.r,i=e.g,o=e.b,s=n.r-r,a=n.g-i,u=n.b-o;return function(t){return"#"+ue(Math.round(r+s*t))+ue(Math.round(i+a*t))+ue(Math.round(o+u*t))}}function zi(t,e){var n,r={},i={};for(n in t)n in e?r[n]=Xi(t[n],e[n]):i[n]=t[n];for(n in e)n in t||(i[n]=e[n]);return function(t){for(n in r)i[n]=r[n](t);return i}}function Qi(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Gi(t,e){var n,r,i,o=Wi.lastIndex=Yi.lastIndex=0,s=-1,a=[],u=[];for(t+="",e+="";(n=Wi.exec(t))&&(r=Yi.exec(e));)(i=r.index)>o&&(i=e.slice(o,i),a[s]?a[s]+=i:a[++s]=i),(n=n[0])===(r=r[0])?a[s]?a[s]+=r:a[++s]=r:(a[++s]=null,u.push({i:s,x:Qi(n,r)})),o=Yi.lastIndex;return o<e.length&&(i=e.slice(o),a[s]?a[s]+=i:a[++s]=i),a.length<2?u[0]?(e=u[0].x,function(t){return e(t)+""}):function(){return e}:(e=u.length,function(t){for(var n,r=0;r<e;++r)a[(n=u[r]).i]=n.x(t);return a.join("")})}t.geom.delaunay=function(e){return t.geom.voronoi().triangles(e)},t.geom.quadtree=function(t,e,n,r,i){var o,s=ni,a=ri;if(o=arguments.length)return s=Ui,a=Hi,3===o&&(i=n,r=e,n=e=0),u(t);function u(t){var u,c,l,h,p,f,d,m,v,y=me(s),_=me(a);if(null!=e)f=e,d=n,m=r,v=i;else if(m=v=-(f=d=1/0),c=[],l=[],p=t.length,o)for(h=0;h<p;++h)(u=t[h]).x<f&&(f=u.x),u.y<d&&(d=u.y),u.x>m&&(m=u.x),u.y>v&&(v=u.y),c.push(u.x),l.push(u.y);else for(h=0;h<p;++h){var b=+y(u=t[h],h),x=+_(u,h);b<f&&(f=b),x<d&&(d=x),b>m&&(m=b),x>v&&(v=x),c.push(b),l.push(x)}var E=m-f,w=v-d;function S(t,e,n,r,i,o,s,a){if(!isNaN(n)&&!isNaN(r))if(t.leaf){var u=t.x,c=t.y;if(null!=u)if(g(u-n)+g(c-r)<.01)C(t,e,n,r,i,o,s,a);else{var l=t.point;t.x=t.y=t.point=null,C(t,l,u,c,i,o,s,a),C(t,e,n,r,i,o,s,a)}else t.x=n,t.y=r,t.point=e}else C(t,e,n,r,i,o,s,a)}function C(t,e,n,r,i,o,s,a){var u=.5*(i+s),c=.5*(o+a),l=n>=u,h=r>=c,p=h<<1|l;t.leaf=!1,l?i=u:s=u,h?o=c:a=c,S(t=t.nodes[p]||(t.nodes[p]={leaf:!0,nodes:[],point:null,x:null,y:null}),e,n,r,i,o,s,a)}E>w?v=d+E:m=f+w;var M={leaf:!0,nodes:[],point:null,x:null,y:null,add:function(t){S(M,t,+y(t,++h),+_(t,h),f,d,m,v)}};if(M.visit=function(t){!function t(e,n,r,i,o,s){if(!e(n,r,i,o,s)){var a=.5*(r+o),u=.5*(i+s),c=n.nodes;c[0]&&t(e,c[0],r,i,a,u),c[1]&&t(e,c[1],a,i,o,u),c[2]&&t(e,c[2],r,u,a,s),c[3]&&t(e,c[3],a,u,o,s)}}(t,M,f,d,m,v)},M.find=function(t){return function(t,e,n,r,i,o,s){var a,u=1/0;return function t(c,l,h,p,f){if(!(l>o||h>s||p<r||f<i)){if(d=c.point){var d,m=e-c.x,v=n-c.y,g=m*m+v*v;if(g<u){var y=Math.sqrt(u=g);r=e-y,i=n-y,o=e+y,s=n+y,a=d}}for(var _=c.nodes,b=.5*(l+p),x=.5*(h+f),E=(n>=x)<<1|e>=b,w=E+4;E<w;++E)if(c=_[3&E])switch(3&E){case 0:t(c,l,h,b,x);break;case 1:t(c,b,h,p,x);break;case 2:t(c,l,x,b,f);break;case 3:t(c,b,x,p,f)}}}(t,r,i,o,s),a}(M,t[0],t[1],f,d,m,v)},h=-1,null==e){for(;++h<p;)S(M,t[h],c[h],l[h],f,d,m,v);--h}else t.forEach(M.add);return c=l=t=u=null,M}return u.x=function(t){return arguments.length?(s=t,u):s},u.y=function(t){return arguments.length?(a=t,u):a},u.extent=function(t){return arguments.length?(null==t?e=n=r=i=null:(e=+t[0][0],n=+t[0][1],r=+t[1][0],i=+t[1][1]),u):null==e?null:[[e,n],[r,i]]},u.size=function(t){return arguments.length?(null==t?e=n=r=i=null:(e=n=0,r=+t[0],i=+t[1]),u):null==e?null:[r-e,i-n]},u},t.interpolateRgb=Vi,t.interpolateObject=zi,t.interpolateNumber=Qi,t.interpolateString=Gi;var Wi=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Yi=new RegExp(Wi.source,"g");function Xi(e,n){for(var r,i=t.interpolators.length;--i>=0&&!(r=t.interpolators[i](e,n)););return r}function Ji(t,e){var n,r=[],i=[],o=t.length,s=e.length,a=Math.min(t.length,e.length);for(n=0;n<a;++n)r.push(Xi(t[n],e[n]));for(;n<o;++n)i[n]=t[n];for(;n<s;++n)i[n]=e[n];return function(t){for(n=0;n<a;++n)i[n]=r[n](t);return i}}t.interpolate=Xi,t.interpolators=[function(t,e){var n=typeof e;return("string"===n?de.has(e.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(e)?Vi:Gi:e instanceof Ft?Vi:Array.isArray(e)?Ji:"object"===n&&isNaN(e)?zi:Qi)(t,e)}],t.interpolateArray=Ji;var Ki=function(){return k},Zi=t.map({linear:Ki,poly:function(t){return function(e){return Math.pow(e,t)}},quad:function(){return ro},cubic:function(){return io},sin:function(){return so},exp:function(){return ao},circle:function(){return uo},elastic:function(t,e){var n;arguments.length<2&&(e=.45);arguments.length?n=e/Ct*Math.asin(1/t):(t=1,n=e/4);return function(r){return 1+t*Math.pow(2,-10*r)*Math.sin((r-n)*Ct/e)}},back:function(t){t||(t=1.70158);return function(e){return e*e*((t+1)*e-t)}},bounce:function(){return co}}),to=t.map({in:k,out:eo,"in-out":no,"out-in":function(t){return no(eo(t))}});function eo(t){return function(e){return 1-t(1-e)}}function no(t){return function(e){return.5*(e<.5?t(2*e):2-t(2-2*e))}}function ro(t){return t*t}function io(t){return t*t*t}function oo(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function so(t){return 1-Math.cos(t*Tt)}function ao(t){return Math.pow(2,10*(t-1))}function uo(t){return 1-Math.sqrt(1-t*t)}function co(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function lo(t,e){return e-=t,function(n){return Math.round(t+e*n)}}function ho(t){var e,n,r,i=[t.a,t.b],o=[t.c,t.d],s=fo(i),a=po(i,o),u=fo(((e=o)[0]+=(r=-a)*(n=i)[0],e[1]+=r*n[1],e))||0;i[0]*o[1]<o[0]*i[1]&&(i[0]*=-1,i[1]*=-1,s*=-1,a*=-1),this.rotate=(s?Math.atan2(i[1],i[0]):Math.atan2(-o[0],o[1]))*$t,this.translate=[t.e,t.f],this.scale=[s,u],this.skew=u?Math.atan2(a,u)*$t:0}function po(t,e){return t[0]*e[0]+t[1]*e[1]}function fo(t){var e=Math.sqrt(po(t,t));return e&&(t[0]/=e,t[1]/=e),e}t.ease=function(t){var n,r=t.indexOf("-"),i=r>=0?t.slice(0,r):t,o=r>=0?t.slice(r+1):"in";return i=Zi.get(i)||Ki,o=to.get(o)||k,n=o(i.apply(null,e.call(arguments,1))),function(t){return t<=0?0:t>=1?1:n(t)}},t.interpolateHcl=function(e,n){e=t.hcl(e),n=t.hcl(n);var r=e.h,i=e.c,o=e.l,s=n.h-r,a=n.c-i,u=n.l-o;isNaN(a)&&(a=0,i=isNaN(i)?n.c:i);isNaN(s)?(s=0,r=isNaN(r)?n.h:r):s>180?s-=360:s<-180&&(s+=360);return function(t){return Qt(r+s*t,i+a*t,o+u*t)+""}},t.interpolateHsl=function(e,n){e=t.hsl(e),n=t.hsl(n);var r=e.h,i=e.s,o=e.l,s=n.h-r,a=n.s-i,u=n.l-o;isNaN(a)&&(a=0,i=isNaN(i)?n.s:i);isNaN(s)?(s=0,r=isNaN(r)?n.h:r):s>180?s-=360:s<-180&&(s+=360);return function(t){return Ht(r+s*t,i+a*t,o+u*t)+""}},t.interpolateLab=function(e,n){e=t.lab(e),n=t.lab(n);var r=e.l,i=e.a,o=e.b,s=n.l-r,a=n.a-i,u=n.b-o;return function(t){return Zt(r+s*t,i+a*t,o+u*t)+""}},t.interpolateRound=lo,t.transform=function(e){var n=r.createElementNS(t.ns.prefix.svg,"g");return(t.transform=function(t){if(null!=t){n.setAttribute("transform",t);var e=n.transform.baseVal.consolidate()}return new ho(e?e.matrix:mo)})(e)},ho.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var mo={a:1,b:0,c:0,d:1,e:0,f:0};function vo(t){return t.length?t.pop()+",":""}function go(e,n){var r=[],i=[];return e=t.transform(e),n=t.transform(n),function(t,e,n,r){if(t[0]!==e[0]||t[1]!==e[1]){var i=n.push("translate(",null,",",null,")");r.push({i:i-4,x:Qi(t[0],e[0])},{i:i-2,x:Qi(t[1],e[1])})}else(e[0]||e[1])&&n.push("translate("+e+")")}(e.translate,n.translate,r,i),function(t,e,n,r){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),r.push({i:n.push(vo(n)+"rotate(",null,")")-2,x:Qi(t,e)})):e&&n.push(vo(n)+"rotate("+e+")")}(e.rotate,n.rotate,r,i),function(t,e,n,r){t!==e?r.push({i:n.push(vo(n)+"skewX(",null,")")-2,x:Qi(t,e)}):e&&n.push(vo(n)+"skewX("+e+")")}(e.skew,n.skew,r,i),function(t,e,n,r){if(t[0]!==e[0]||t[1]!==e[1]){var i=n.push(vo(n)+"scale(",null,",",null,")");r.push({i:i-4,x:Qi(t[0],e[0])},{i:i-2,x:Qi(t[1],e[1])})}else 1===e[0]&&1===e[1]||n.push(vo(n)+"scale("+e+")")}(e.scale,n.scale,r,i),e=n=null,function(t){for(var e,n=-1,o=i.length;++n<o;)r[(e=i[n]).i]=e.x(t);return r.join("")}}function yo(t,e){return e=(e-=t=+t)||1/e,function(n){return(n-t)/e}}function _o(t,e){return e=(e-=t=+t)||1/e,function(n){return Math.max(0,Math.min(1,(n-t)/e))}}function bo(t){for(var e=t.source,n=t.target,r=function(t,e){if(t===e)return t;var n=xo(t),r=xo(e),i=n.pop(),o=r.pop(),s=null;for(;i===o;)s=i,i=n.pop(),o=r.pop();return s}(e,n),i=[e];e!==r;)e=e.parent,i.push(e);for(var o=i.length;n!==r;)i.splice(o,0,n),n=n.parent;return i}function xo(t){for(var e=[],n=t.parent;null!=n;)e.push(t),t=n,n=n.parent;return e.push(t),e}function Eo(t){t.fixed|=2}function wo(t){t.fixed&=-7}function So(t){t.fixed|=4,t.px=t.x,t.py=t.y}function Co(t){t.fixed&=-5}t.interpolateTransform=go,t.layout={},t.layout.bundle=function(){return function(t){for(var e=[],n=-1,r=t.length;++n<r;)e.push(bo(t[n]));return e}},t.layout.chord=function(){var e,n,r,i,o,s,a,u={},c=0;function l(){var u,l,p,f,d,m={},v=[],g=t.range(i),y=[];for(e=[],n=[],u=0,f=-1;++f<i;){for(l=0,d=-1;++d<i;)l+=r[f][d];v.push(l),y.push(t.range(i)),u+=l}for(o&&g.sort(function(t,e){return o(v[t],v[e])}),s&&y.forEach(function(t,e){t.sort(function(t,n){return s(r[e][t],r[e][n])})}),u=(Ct-c*i)/u,l=0,f=-1;++f<i;){for(p=l,d=-1;++d<i;){var _=g[f],b=y[_][d],x=r[_][b],E=l,w=l+=x*u;m[_+"-"+b]={index:_,subindex:b,startAngle:E,endAngle:w,value:x}}n[_]={index:_,startAngle:p,endAngle:l,value:v[_]},l+=c}for(f=-1;++f<i;)for(d=f-1;++d<i;){var S=m[f+"-"+d],C=m[d+"-"+f];(S.value||C.value)&&e.push(S.value<C.value?{source:C,target:S}:{source:S,target:C})}a&&h()}function h(){e.sort(function(t,e){return a((t.source.value+t.target.value)/2,(e.source.value+e.target.value)/2)})}return u.matrix=function(t){return arguments.length?(i=(r=t)&&r.length,e=n=null,u):r},u.padding=function(t){return arguments.length?(c=t,e=n=null,u):c},u.sortGroups=function(t){return arguments.length?(o=t,e=n=null,u):o},u.sortSubgroups=function(t){return arguments.length?(s=t,e=null,u):s},u.sortChords=function(t){return arguments.length?(a=t,e&&h(),u):a},u.chords=function(){return e||l(),e},u.groups=function(){return n||l(),n},u},t.layout.force=function(){var e,n,r,i,o,s,a={},u=t.dispatch("start","tick","end"),c=[1,1],l=.9,h=Mo,p=To,f=-30,d=Ao,m=.1,v=.64,g=[],y=[];function _(t){return function(e,n,r,i){if(e.point!==t){var o=e.cx-t.x,s=e.cy-t.y,a=i-n,u=o*o+s*s;if(a*a/v<u){if(u<d){var c=e.charge/u;t.px-=o*c,t.py-=s*c}return!0}if(e.point&&u&&u<d){c=e.pointCharge/u;t.px-=o*c,t.py-=s*c}}return!e.charge}}function b(e){e.px=t.event.x,e.py=t.event.y,a.resume()}return a.tick=function(){if((r*=.99)<.005)return e=null,u.end({type:"end",alpha:r=0}),!0;var n,a,h,p,d,v,b,x,E,w=g.length,S=y.length;for(a=0;a<S;++a)p=(h=y[a]).source,(v=(x=(d=h.target).x-p.x)*x+(E=d.y-p.y)*E)&&(x*=v=r*o[a]*((v=Math.sqrt(v))-i[a])/v,E*=v,d.x-=x*(b=p.weight+d.weight?p.weight/(p.weight+d.weight):.5),d.y-=E*b,p.x+=x*(b=1-b),p.y+=E*b);if((b=r*m)&&(x=c[0]/2,E=c[1]/2,a=-1,b))for(;++a<w;)(h=g[a]).x+=(x-h.x)*b,h.y+=(E-h.y)*b;if(f)for(!function t(e,n,r){var i=0,o=0;e.charge=0;if(!e.leaf)for(var s,a=e.nodes,u=a.length,c=-1;++c<u;)null!=(s=a[c])&&(t(s,n,r),e.charge+=s.charge,i+=s.charge*s.cx,o+=s.charge*s.cy);if(e.point){e.leaf||(e.point.x+=Math.random()-.5,e.point.y+=Math.random()-.5);var l=n*r[e.point.index];e.charge+=e.pointCharge=l,i+=l*e.point.x,o+=l*e.point.y}e.cx=i/e.charge;e.cy=o/e.charge}(n=t.geom.quadtree(g),r,s),a=-1;++a<w;)(h=g[a]).fixed||n.visit(_(h));for(a=-1;++a<w;)(h=g[a]).fixed?(h.x=h.px,h.y=h.py):(h.x-=(h.px-(h.px=h.x))*l,h.y-=(h.py-(h.py=h.y))*l);u.tick({type:"tick",alpha:r})},a.nodes=function(t){return arguments.length?(g=t,a):g},a.links=function(t){return arguments.length?(y=t,a):y},a.size=function(t){return arguments.length?(c=t,a):c},a.linkDistance=function(t){return arguments.length?(h="function"==typeof t?t:+t,a):h},a.distance=a.linkDistance,a.linkStrength=function(t){return arguments.length?(p="function"==typeof t?t:+t,a):p},a.friction=function(t){return arguments.length?(l=+t,a):l},a.charge=function(t){return arguments.length?(f="function"==typeof t?t:+t,a):f},a.chargeDistance=function(t){return arguments.length?(d=t*t,a):Math.sqrt(d)},a.gravity=function(t){return arguments.length?(m=+t,a):m},a.theta=function(t){return arguments.length?(v=t*t,a):Math.sqrt(v)},a.alpha=function(t){return arguments.length?(t=+t,r?t>0?r=t:(e.c=null,e.t=NaN,e=null,u.end({type:"end",alpha:r=0})):t>0&&(u.start({type:"start",alpha:r=t}),e=we(a.tick)),a):r},a.start=function(){var t,e,n,r=g.length,u=y.length,l=c[0],d=c[1];for(t=0;t<r;++t)(n=g[t]).index=t,n.weight=0;for(t=0;t<u;++t)"number"==typeof(n=y[t]).source&&(n.source=g[n.source]),"number"==typeof n.target&&(n.target=g[n.target]),++n.source.weight,++n.target.weight;for(t=0;t<r;++t)n=g[t],isNaN(n.x)&&(n.x=m("x",l)),isNaN(n.y)&&(n.y=m("y",d)),isNaN(n.px)&&(n.px=n.x),isNaN(n.py)&&(n.py=n.y);if(i=[],"function"==typeof h)for(t=0;t<u;++t)i[t]=+h.call(this,y[t],t);else for(t=0;t<u;++t)i[t]=h;if(o=[],"function"==typeof p)for(t=0;t<u;++t)o[t]=+p.call(this,y[t],t);else for(t=0;t<u;++t)o[t]=p;if(s=[],"function"==typeof f)for(t=0;t<r;++t)s[t]=+f.call(this,g[t],t);else for(t=0;t<r;++t)s[t]=f;function m(n,i){if(!e){for(e=new Array(r),c=0;c<r;++c)e[c]=[];for(c=0;c<u;++c){var o=y[c];e[o.source.index].push(o.target),e[o.target.index].push(o.source)}}for(var s,a=e[t],c=-1,l=a.length;++c<l;)if(!isNaN(s=a[c][n]))return s;return Math.random()*i}return a.resume()},a.resume=function(){return a.alpha(.1)},a.stop=function(){return a.alpha(0)},a.drag=function(){if(n||(n=t.behavior.drag().origin(k).on("dragstart.force",Eo).on("drag.force",b).on("dragend.force",wo)),!arguments.length)return n;this.on("mouseover.force",So).on("mouseout.force",Co).call(n)},t.rebind(a,u,"on")};var Mo=20,To=1,Ao=1/0;function $o(e,n){return t.rebind(e,n,"sort","children","value"),e.nodes=e,e.links=Io,e}function ko(t,e){for(var n=[t];null!=(t=n.pop());)if(e(t),(i=t.children)&&(r=i.length))for(var r,i;--r>=0;)n.push(i[r])}function Do(t,e){for(var n=[t],r=[];null!=(t=n.pop());)if(r.push(t),(o=t.children)&&(i=o.length))for(var i,o,s=-1;++s<i;)n.push(o[s]);for(;null!=(t=r.pop());)e(t)}function Ro(t){return t.children}function Oo(t){return t.value}function No(t,e){return e.value-t.value}function Io(e){return t.merge(e.map(function(t){return(t.children||[]).map(function(e){return{source:t,target:e}})}))}t.layout.hierarchy=function(){var t=No,e=Ro,n=Oo;function r(i){var o,s=[i],a=[];for(i.depth=0;null!=(o=s.pop());)if(a.push(o),(c=e.call(r,o,o.depth))&&(u=c.length)){for(var u,c,l;--u>=0;)s.push(l=c[u]),l.parent=o,l.depth=o.depth+1;n&&(o.value=0),o.children=c}else n&&(o.value=+n.call(r,o,o.depth)||0),delete o.children;return Do(i,function(e){var r,i;t&&(r=e.children)&&r.sort(t),n&&(i=e.parent)&&(i.value+=e.value)}),a}return r.sort=function(e){return arguments.length?(t=e,r):t},r.children=function(t){return arguments.length?(e=t,r):e},r.value=function(t){return arguments.length?(n=t,r):n},r.revalue=function(t){return n&&(ko(t,function(t){t.children&&(t.value=0)}),Do(t,function(t){var e;t.children||(t.value=+n.call(r,t,t.depth)||0),(e=t.parent)&&(e.value+=t.value)})),t},r},t.layout.partition=function(){var e=t.layout.hierarchy(),n=[1,1];function r(t,r){var i=e.call(this,t,r);return function t(e,n,r,i){var o=e.children;if(e.x=n,e.y=e.depth*i,e.dx=r,e.dy=i,o&&(s=o.length)){var s,a,u,c=-1;for(r=e.value?r/e.value:0;++c<s;)t(a=o[c],n,u=a.value*r,i),n+=u}}(i[0],0,n[0],n[1]/function t(e){var n=e.children,r=0;if(n&&(i=n.length))for(var i,o=-1;++o<i;)r=Math.max(r,t(n[o]));return 1+r}(i[0])),i}return r.size=function(t){return arguments.length?(n=t,r):n},$o(r,e)},t.layout.pie=function(){var e=Number,n=Po,r=0,i=Ct,o=0;function s(a){var u,c=a.length,l=a.map(function(t,n){return+e.call(s,t,n)}),h=+("function"==typeof r?r.apply(this,arguments):r),p=("function"==typeof i?i.apply(this,arguments):i)-h,f=Math.min(Math.abs(p)/c,+("function"==typeof o?o.apply(this,arguments):o)),d=f*(p<0?-1:1),m=t.sum(l),v=m?(p-c*d)/m:0,g=t.range(c),y=[];return null!=n&&g.sort(n===Po?function(t,e){return l[e]-l[t]}:function(t,e){return n(a[t],a[e])}),g.forEach(function(t){y[t]={data:a[t],value:u=l[t],startAngle:h,endAngle:h+=u*v+d,padAngle:f}}),y}return s.value=function(t){return arguments.length?(e=t,s):e},s.sort=function(t){return arguments.length?(n=t,s):n},s.startAngle=function(t){return arguments.length?(r=t,s):r},s.endAngle=function(t){return arguments.length?(i=t,s):i},s.padAngle=function(t){return arguments.length?(o=t,s):o},s};var Po={};function Lo(t){return t.x}function jo(t){return t.y}function Bo(t,e,n){t.y0=e,t.y=n}t.layout.stack=function(){var e=k,n=Uo,r=Ho,i=Bo,o=Lo,s=jo;function a(u,c){if(!(f=u.length))return u;var l=u.map(function(t,n){return e.call(a,t,n)}),h=l.map(function(t){return t.map(function(t,e){return[o.call(a,t,e),s.call(a,t,e)]})}),p=n.call(a,h,c);l=t.permute(l,p),h=t.permute(h,p);var f,d,m,v,g=r.call(a,h,c),y=l[0].length;for(m=0;m<y;++m)for(i.call(a,l[0][m],v=g[m],h[0][m][1]),d=1;d<f;++d)i.call(a,l[d][m],v+=h[d-1][m][1],h[d][m][1]);return u}return a.values=function(t){return arguments.length?(e=t,a):e},a.order=function(t){return arguments.length?(n="function"==typeof t?t:Fo.get(t)||Uo,a):n},a.offset=function(t){return arguments.length?(r="function"==typeof t?t:qo.get(t)||Ho,a):r},a.x=function(t){return arguments.length?(o=t,a):o},a.y=function(t){return arguments.length?(s=t,a):s},a.out=function(t){return arguments.length?(i=t,a):i},a};var Fo=t.map({"inside-out":function(e){var n,r,i=e.length,o=e.map(Vo),s=e.map(zo),a=t.range(i).sort(function(t,e){return o[t]-o[e]}),u=0,c=0,l=[],h=[];for(n=0;n<i;++n)r=a[n],u<c?(u+=s[r],l.push(r)):(c+=s[r],h.push(r));return h.reverse().concat(l)},reverse:function(e){return t.range(e.length).reverse()},default:Uo}),qo=t.map({silhouette:function(t){var e,n,r,i=t.length,o=t[0].length,s=[],a=0,u=[];for(n=0;n<o;++n){for(e=0,r=0;e<i;e++)r+=t[e][n][1];r>a&&(a=r),s.push(r)}for(n=0;n<o;++n)u[n]=(a-s[n])/2;return u},wiggle:function(t){var e,n,r,i,o,s,a,u,c,l=t.length,h=t[0],p=h.length,f=[];for(f[0]=u=c=0,n=1;n<p;++n){for(e=0,i=0;e<l;++e)i+=t[e][n][1];for(e=0,o=0,a=h[n][0]-h[n-1][0];e<l;++e){for(r=0,s=(t[e][n][1]-t[e][n-1][1])/(2*a);r<e;++r)s+=(t[r][n][1]-t[r][n-1][1])/a;o+=s*t[e][n][1]}f[n]=u-=i?o/i*a:0,u<c&&(c=u)}for(n=0;n<p;++n)f[n]-=c;return f},expand:function(t){var e,n,r,i=t.length,o=t[0].length,s=1/i,a=[];for(n=0;n<o;++n){for(e=0,r=0;e<i;e++)r+=t[e][n][1];if(r)for(e=0;e<i;e++)t[e][n][1]/=r;else for(e=0;e<i;e++)t[e][n][1]=s}for(n=0;n<o;++n)a[n]=0;return a},zero:Ho});function Uo(e){return t.range(e.length)}function Ho(t){for(var e=-1,n=t[0].length,r=[];++e<n;)r[e]=0;return r}function Vo(t){for(var e,n=1,r=0,i=t[0][1],o=t.length;n<o;++n)(e=t[n][1])>i&&(r=n,i=e);return r}function zo(t){return t.reduce(Qo,0)}function Qo(t,e){return t+e[1]}function Go(t,e){return Wo(t,Math.ceil(Math.log(e.length)/Math.LN2+1))}function Wo(t,e){for(var n=-1,r=+t[0],i=(t[1]-r)/e,o=[];++n<=e;)o[n]=i*n+r;return o}function Yo(e){return[t.min(e),t.max(e)]}function Xo(t,e){return t.value-e.value}function Jo(t,e){var n=t._pack_next;t._pack_next=e,e._pack_prev=t,e._pack_next=n,n._pack_prev=e}function Ko(t,e){t._pack_next=e,e._pack_prev=t}function Zo(t,e){var n=e.x-t.x,r=e.y-t.y,i=t.r+e.r;return.999*i*i>n*n+r*r}function ts(t){if((e=t.children)&&(u=e.length)){var e,n,r,i,o,s,a,u,c=1/0,l=-1/0,h=1/0,p=-1/0;if(e.forEach(es),(n=e[0]).x=-n.r,n.y=0,_(n),u>1&&((r=e[1]).x=r.r,r.y=0,_(r),u>2))for(rs(n,r,i=e[2]),_(i),Jo(n,i),n._pack_prev=i,Jo(i,r),r=n._pack_next,o=3;o<u;o++){rs(n,r,i=e[o]);var f=0,d=1,m=1;for(s=r._pack_next;s!==r;s=s._pack_next,d++)if(Zo(s,i)){f=1;break}if(1==f)for(a=n._pack_prev;a!==s._pack_prev&&!Zo(a,i);a=a._pack_prev,m++);f?(d<m||d==m&&r.r<n.r?Ko(n,r=s):Ko(n=a,r),o--):(Jo(n,i),r=i,_(i))}var v=(c+l)/2,g=(h+p)/2,y=0;for(o=0;o<u;o++)(i=e[o]).x-=v,i.y-=g,y=Math.max(y,i.r+Math.sqrt(i.x*i.x+i.y*i.y));t.r=y,e.forEach(ns)}function _(t){c=Math.min(t.x-t.r,c),l=Math.max(t.x+t.r,l),h=Math.min(t.y-t.r,h),p=Math.max(t.y+t.r,p)}}function es(t){t._pack_next=t._pack_prev=t}function ns(t){delete t._pack_next,delete t._pack_prev}function rs(t,e,n){var r=t.r+n.r,i=e.x-t.x,o=e.y-t.y;if(r&&(i||o)){var s=e.r+n.r,a=i*i+o*o,u=.5+((r*=r)-(s*=s))/(2*a),c=Math.sqrt(Math.max(0,2*s*(r+a)-(r-=a)*r-s*s))/(2*a);n.x=t.x+u*i+c*o,n.y=t.y+u*o-c*i}else n.x=t.x+r,n.y=t.y}function is(t,e){return t.parent==e.parent?1:2}function os(t){var e=t.children;return e.length?e[0]:t.t}function ss(t){var e,n=t.children;return(e=n.length)?n[e-1]:t.t}function as(t,e,n){var r=n/(e.i-t.i);e.c-=r,e.s+=n,t.c+=r,e.z+=n,e.m+=n}function us(t,e,n){return t.a.parent===e.parent?t.a:n}function cs(t){return{x:t.x,y:t.y,dx:t.dx,dy:t.dy}}function ls(t,e){var n=t.x+e[3],r=t.y+e[0],i=t.dx-e[1]-e[3],o=t.dy-e[0]-e[2];return i<0&&(n+=i/2,i=0),o<0&&(r+=o/2,o=0),{x:n,y:r,dx:i,dy:o}}function hs(t){var e=t[0],n=t[t.length-1];return e<n?[e,n]:[n,e]}function ps(t){return t.rangeExtent?t.rangeExtent():hs(t.range())}function fs(t,e,n,r){var i=n(t[0],t[1]),o=r(e[0],e[1]);return function(t){return o(i(t))}}function ds(t,e){var n,r=0,i=t.length-1,o=t[r],s=t[i];return s<o&&(n=r,r=i,i=n,n=o,o=s,s=n),t[r]=e.floor(o),t[i]=e.ceil(s),t}function ms(t){return t?{floor:function(e){return Math.floor(e/t)*t},ceil:function(e){return Math.ceil(e/t)*t}}:vs}t.layout.histogram=function(){var e=!0,n=Number,r=Yo,i=Go;function o(o,s){for(var a,u,c=[],l=o.map(n,this),h=r.call(this,l,s),p=i.call(this,h,l,s),f=(s=-1,l.length),d=p.length-1,m=e?1:1/f;++s<d;)(a=c[s]=[]).dx=p[s+1]-(a.x=p[s]),a.y=0;if(d>0)for(s=-1;++s<f;)(u=l[s])>=h[0]&&u<=h[1]&&((a=c[t.bisect(p,u,1,d)-1]).y+=m,a.push(o[s]));return c}return o.value=function(t){return arguments.length?(n=t,o):n},o.range=function(t){return arguments.length?(r=me(t),o):r},o.bins=function(t){return arguments.length?(i="number"==typeof t?function(e){return Wo(e,t)}:me(t),o):i},o.frequency=function(t){return arguments.length?(e=!!t,o):e},o},t.layout.pack=function(){var e,n=t.layout.hierarchy().sort(Xo),r=0,i=[1,1];function o(t,o){var s=n.call(this,t,o),a=s[0],u=i[0],c=i[1],l=null==e?Math.sqrt:"function"==typeof e?e:function(){return e};if(a.x=a.y=0,Do(a,function(t){t.r=+l(t.value)}),Do(a,ts),r){var h=r*(e?1:Math.max(2*a.r/u,2*a.r/c))/2;Do(a,function(t){t.r+=h}),Do(a,ts),Do(a,function(t){t.r-=h})}return function t(e,n,r,i){var o=e.children;e.x=n+=i*e.x;e.y=r+=i*e.y;e.r*=i;if(o)for(var s=-1,a=o.length;++s<a;)t(o[s],n,r,i)}(a,u/2,c/2,e?1:1/Math.max(2*a.r/u,2*a.r/c)),s}return o.size=function(t){return arguments.length?(i=t,o):i},o.radius=function(t){return arguments.length?(e=null==t||"function"==typeof t?t:+t,o):e},o.padding=function(t){return arguments.length?(r=+t,o):r},$o(o,n)},t.layout.tree=function(){var e=t.layout.hierarchy().sort(null).value(null),n=is,r=[1,1],i=null;function o(t,o){var c=e.call(this,t,o),l=c[0],h=function(t){var e,n={A:null,children:[t]},r=[n];for(;null!=(e=r.pop());)for(var i,o=e.children,s=0,a=o.length;s<a;++s)r.push((o[s]=i={_:o[s],parent:e,children:(i=o[s].children)&&i.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:s}).a=i);return n.children[0]}(l);if(Do(h,s),h.parent.m=-h.z,ko(h,a),i)ko(l,u);else{var p=l,f=l,d=l;ko(l,function(t){t.x<p.x&&(p=t),t.x>f.x&&(f=t),t.depth>d.depth&&(d=t)});var m=n(p,f)/2-p.x,v=r[0]/(f.x+n(f,p)/2+m),g=r[1]/(d.depth||1);ko(l,function(t){t.x=(t.x+m)*v,t.y=t.depth*g})}return c}function s(t){var e=t.children,r=t.parent.children,i=t.i?r[t.i-1]:null;if(e.length){!function(t){var e,n=0,r=0,i=t.children,o=i.length;for(;--o>=0;)(e=i[o]).z+=n,e.m+=n,n+=e.s+(r+=e.c)}(t);var o=(e[0].z+e[e.length-1].z)/2;i?(t.z=i.z+n(t._,i._),t.m=t.z-o):t.z=o}else i&&(t.z=i.z+n(t._,i._));t.parent.A=function(t,e,r){if(e){for(var i,o=t,s=t,a=e,u=o.parent.children[0],c=o.m,l=s.m,h=a.m,p=u.m;a=ss(a),o=os(o),a&&o;)u=os(u),(s=ss(s)).a=t,(i=a.z+h-o.z-c+n(a._,o._))>0&&(as(us(a,t,r),t,i),c+=i,l+=i),h+=a.m,c+=o.m,p+=u.m,l+=s.m;a&&!ss(s)&&(s.t=a,s.m+=h-l),o&&!os(u)&&(u.t=o,u.m+=c-p,r=t)}return r}(t,i,t.parent.A||r[0])}function a(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function u(t){t.x*=r[0],t.y=t.depth*r[1]}return o.separation=function(t){return arguments.length?(n=t,o):n},o.size=function(t){return arguments.length?(i=null==(r=t)?u:null,o):i?null:r},o.nodeSize=function(t){return arguments.length?(i=null==(r=t)?null:u,o):i?r:null},$o(o,e)},t.layout.cluster=function(){var e=t.layout.hierarchy().sort(null).value(null),n=is,r=[1,1],i=!1;function o(o,s){var a,u=e.call(this,o,s),c=u[0],l=0;Do(c,function(e){var r=e.children;r&&r.length?(e.x=function(t){return t.reduce(function(t,e){return t+e.x},0)/t.length}(r),e.y=function(e){return 1+t.max(e,function(t){return t.y})}(r)):(e.x=a?l+=n(e,a):0,e.y=0,a=e)});var h=function t(e){var n=e.children;return n&&n.length?t(n[0]):e}(c),p=function t(e){var n,r=e.children;return r&&(n=r.length)?t(r[n-1]):e}(c),f=h.x-n(h,p)/2,d=p.x+n(p,h)/2;return Do(c,i?function(t){t.x=(t.x-c.x)*r[0],t.y=(c.y-t.y)*r[1]}:function(t){t.x=(t.x-f)/(d-f)*r[0],t.y=(1-(c.y?t.y/c.y:1))*r[1]}),u}return o.separation=function(t){return arguments.length?(n=t,o):n},o.size=function(t){return arguments.length?(i=null==(r=t),o):i?null:r},o.nodeSize=function(t){return arguments.length?(i=null!=(r=t),o):i?r:null},$o(o,e)},t.layout.treemap=function(){var e,n=t.layout.hierarchy(),r=Math.round,i=[1,1],o=null,s=cs,a=!1,u="squarify",c=.5*(1+Math.sqrt(5));function l(t,e){for(var n,r,i=-1,o=t.length;++i<o;)r=(n=t[i]).value*(e<0?0:e),n.area=isNaN(r)||r<=0?0:r}function h(t){var e=t.children;if(e&&e.length){var n,r,i,o=s(t),a=[],c=e.slice(),p=1/0,m="slice"===u?o.dx:"dice"===u?o.dy:"slice-dice"===u?1&t.depth?o.dy:o.dx:Math.min(o.dx,o.dy);for(l(c,o.dx*o.dy/t.value),a.area=0;(i=c.length)>0;)a.push(n=c[i-1]),a.area+=n.area,"squarify"!==u||(r=f(a,m))<=p?(c.pop(),p=r):(a.area-=a.pop().area,d(a,m,o,!1),m=Math.min(o.dx,o.dy),a.length=a.area=0,p=1/0);a.length&&(d(a,m,o,!0),a.length=a.area=0),e.forEach(h)}}function p(t){var e=t.children;if(e&&e.length){var n,r=s(t),i=e.slice(),o=[];for(l(i,r.dx*r.dy/t.value),o.area=0;n=i.pop();)o.push(n),o.area+=n.area,null!=n.z&&(d(o,n.z?r.dx:r.dy,r,!i.length),o.length=o.area=0);e.forEach(p)}}function f(t,e){for(var n,r=t.area,i=0,o=1/0,s=-1,a=t.length;++s<a;)(n=t[s].area)&&(n<o&&(o=n),n>i&&(i=n));return e*=e,(r*=r)?Math.max(e*i*c/r,r/(e*o*c)):1/0}function d(t,e,n,i){var o,s=-1,a=t.length,u=n.x,c=n.y,l=e?r(t.area/e):0;if(e==n.dx){for((i||l>n.dy)&&(l=n.dy);++s<a;)(o=t[s]).x=u,o.y=c,o.dy=l,u+=o.dx=Math.min(n.x+n.dx-u,l?r(o.area/l):0);o.z=!0,o.dx+=n.x+n.dx-u,n.y+=l,n.dy-=l}else{for((i||l>n.dx)&&(l=n.dx);++s<a;)(o=t[s]).x=u,o.y=c,o.dx=l,c+=o.dy=Math.min(n.y+n.dy-c,l?r(o.area/l):0);o.z=!1,o.dy+=n.y+n.dy-c,n.x+=l,n.dx-=l}}function m(t){var r=e||n(t),o=r[0];return o.x=o.y=0,o.value?(o.dx=i[0],o.dy=i[1]):o.dx=o.dy=0,e&&n.revalue(o),l([o],o.dx*o.dy/o.value),(e?p:h)(o),a&&(e=r),r}return m.size=function(t){return arguments.length?(i=t,m):i},m.padding=function(t){if(!arguments.length)return o;function e(e){return ls(e,t)}var n;return s=null==(o=t)?cs:"function"==(n=typeof t)?function(e){var n=t.call(m,e,e.depth);return null==n?cs(e):ls(e,"number"==typeof n?[n,n,n,n]:n)}:"number"===n?(t=[t,t,t,t],e):e,m},m.round=function(t){return arguments.length?(r=t?Math.round:Number,m):r!=Number},m.sticky=function(t){return arguments.length?(a=t,e=null,m):a},m.ratio=function(t){return arguments.length?(c=t,m):c},m.mode=function(t){return arguments.length?(u=t+"",m):u},$o(m,n)},t.random={normal:function(t,e){var n=arguments.length;return n<2&&(e=1),n<1&&(t=0),function(){var n,r,i;do{i=(n=2*Math.random()-1)*n+(r=2*Math.random()-1)*r}while(!i||i>1);return t+e*n*Math.sqrt(-2*Math.log(i)/i)}},logNormal:function(){var e=t.random.normal.apply(t,arguments);return function(){return Math.exp(e())}},bates:function(e){var n=t.random.irwinHall(e);return function(){return n()/e}},irwinHall:function(t){return function(){for(var e=0,n=0;n<t;n++)e+=Math.random();return e}}},t.scale={};var vs={floor:k,ceil:k};function gs(e,n,r,i){var o=[],s=[],a=0,u=Math.min(e.length,n.length)-1;for(e[u]<e[0]&&(e=e.slice().reverse(),n=n.slice().reverse());++a<=u;)o.push(r(e[a-1],e[a])),s.push(i(n[a-1],n[a]));return function(n){var r=t.bisect(e,n,1,u)-1;return s[r](o[r](n))}}function ys(e,n){return t.rebind(e,n,"range","rangeRound","interpolate","clamp")}function _s(t,e){return ds(t,ms(bs(t,e)[2])),ds(t,ms(bs(t,e)[2])),t}function bs(t,e){null==e&&(e=10);var n=hs(t),r=n[1]-n[0],i=Math.pow(10,Math.floor(Math.log(r/e)/Math.LN10)),o=e/r*i;return o<=.15?i*=10:o<=.35?i*=5:o<=.75&&(i*=2),n[0]=Math.ceil(n[0]/i)*i,n[1]=Math.floor(n[1]/i)*i+.5*i,n[2]=i,n}function xs(e,n){return t.range.apply(t,bs(e,n))}function Es(e,n,r){var i=bs(e,n);if(r){var o=ke.exec(r);if(o.shift(),"s"===o[8]){var s=t.formatPrefix(Math.max(g(i[0]),g(i[1])));return o[7]||(o[7]="."+Ss(s.scale(i[2]))),o[8]="f",r=t.format(o.join("")),function(t){return r(s.scale(t))+s.symbol}}o[7]||(o[7]="."+function(t,e){var n=Ss(e[2]);return t in ws?Math.abs(n-Ss(Math.max(g(e[0]),g(e[1]))))+ +("e"!==t):n-2*("%"===t)}(o[8],i)),r=o.join("")}else r=",."+Ss(i[2])+"f";return t.format(r)}t.scale.linear=function(){return function t(e,n,r,i){var o,s;function a(){var t=Math.min(e.length,n.length)>2?gs:fs,a=i?_o:yo;return o=t(e,n,a,r),s=t(n,e,a,Xi),u}function u(t){return o(t)}u.invert=function(t){return s(t)};u.domain=function(t){return arguments.length?(e=t.map(Number),a()):e};u.range=function(t){return arguments.length?(n=t,a()):n};u.rangeRound=function(t){return u.range(t).interpolate(lo)};u.clamp=function(t){return arguments.length?(i=t,a()):i};u.interpolate=function(t){return arguments.length?(r=t,a()):r};u.ticks=function(t){return xs(e,t)};u.tickFormat=function(t,n){return Es(e,t,n)};u.nice=function(t){return _s(e,t),a()};u.copy=function(){return t(e,n,r,i)};return a()}([0,1],[0,1],Xi,!1)};var ws={s:1,g:1,p:1,r:1,e:1};function Ss(t){return-Math.floor(Math.log(t)/Math.LN10+.01)}t.scale.log=function(){return function e(n,r,i,o){function s(t){return(i?Math.log(t<0?0:t):-Math.log(t>0?0:-t))/Math.log(r)}function a(t){return i?Math.pow(r,t):-Math.pow(r,-t)}function u(t){return n(s(t))}u.invert=function(t){return a(n.invert(t))};u.domain=function(t){return arguments.length?(i=t[0]>=0,n.domain((o=t.map(Number)).map(s)),u):o};u.base=function(t){return arguments.length?(r=+t,n.domain(o.map(s)),u):r};u.nice=function(){var t=ds(o.map(s),i?Math:Ms);return n.domain(t),o=t.map(a),u};u.ticks=function(){var t=hs(o),e=[],n=t[0],u=t[1],c=Math.floor(s(n)),l=Math.ceil(s(u)),h=r%1?2:r;if(isFinite(l-c)){if(i){for(;c<l;c++)for(var p=1;p<h;p++)e.push(a(c)*p);e.push(a(c))}else for(e.push(a(c));c++<l;)for(var p=h-1;p>0;p--)e.push(a(c)*p);for(c=0;e[c]<n;c++);for(l=e.length;e[l-1]>u;l--);e=e.slice(c,l)}return e};u.tickFormat=function(e,n){if(!arguments.length)return Cs;arguments.length<2?n=Cs:"function"!=typeof n&&(n=t.format(n));var i=Math.max(1,r*e/u.ticks().length);return function(t){var e=t/a(Math.round(s(t)));return e*r<r-.5&&(e*=r),e<=i?n(t):""}};u.copy=function(){return e(n.copy(),r,i,o)};return ys(u,n)}(t.scale.linear().domain([0,1]),10,!0,[1,10])};var Cs=t.format(".0e"),Ms={floor:function(t){return-Math.ceil(-t)},ceil:function(t){return-Math.floor(-t)}};function Ts(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}t.scale.pow=function(){return function t(e,n,r){var i=Ts(n),o=Ts(1/n);function s(t){return e(i(t))}s.invert=function(t){return o(e.invert(t))};s.domain=function(t){return arguments.length?(e.domain((r=t.map(Number)).map(i)),s):r};s.ticks=function(t){return xs(r,t)};s.tickFormat=function(t,e){return Es(r,t,e)};s.nice=function(t){return s.domain(_s(r,t))};s.exponent=function(t){return arguments.length?(i=Ts(n=t),o=Ts(1/n),e.domain(r.map(i)),s):n};s.copy=function(){return t(e.copy(),n,r)};return ys(s,e)}(t.scale.linear(),1,[0,1])},t.scale.sqrt=function(){return t.scale.pow().exponent(.5)},t.scale.ordinal=function(){return function e(n,r){var i,o,s;function a(t){return o[((i.get(t)||("range"===r.t?i.set(t,n.push(t)):NaN))-1)%o.length]}function u(e,r){return t.range(n.length).map(function(t){return e+r*t})}a.domain=function(t){if(!arguments.length)return n;n=[],i=new _;for(var e,o=-1,s=t.length;++o<s;)i.has(e=t[o])||i.set(e,n.push(e));return a[r.t].apply(a,r.a)};a.range=function(t){return arguments.length?(o=t,s=0,r={t:"range",a:arguments},a):o};a.rangePoints=function(t,e){arguments.length<2&&(e=0);var i=t[0],c=t[1],l=n.length<2?(i=(i+c)/2,0):(c-i)/(n.length-1+e);return o=u(i+l*e/2,l),s=0,r={t:"rangePoints",a:arguments},a};a.rangeRoundPoints=function(t,e){arguments.length<2&&(e=0);var i=t[0],c=t[1],l=n.length<2?(i=c=Math.round((i+c)/2),0):(c-i)/(n.length-1+e)|0;return o=u(i+Math.round(l*e/2+(c-i-(n.length-1+e)*l)/2),l),s=0,r={t:"rangeRoundPoints",a:arguments},a};a.rangeBands=function(t,e,i){arguments.length<2&&(e=0),arguments.length<3&&(i=e);var c=t[1]<t[0],l=t[c-0],h=t[1-c],p=(h-l)/(n.length-e+2*i);return o=u(l+p*i,p),c&&o.reverse(),s=p*(1-e),r={t:"rangeBands",a:arguments},a};a.rangeRoundBands=function(t,e,i){arguments.length<2&&(e=0),arguments.length<3&&(i=e);var c=t[1]<t[0],l=t[c-0],h=t[1-c],p=Math.floor((h-l)/(n.length-e+2*i));return o=u(l+Math.round((h-l-(n.length-e)*p)/2),p),c&&o.reverse(),s=Math.round(p*(1-e)),r={t:"rangeRoundBands",a:arguments},a};a.rangeBand=function(){return s};a.rangeExtent=function(){return hs(r.a[0])};a.copy=function(){return e(n,r)};return a.domain(n)}([],{t:"range",a:[[]]})},t.scale.category10=function(){return t.scale.ordinal().range(As)},t.scale.category20=function(){return t.scale.ordinal().range($s)},t.scale.category20b=function(){return t.scale.ordinal().range(ks)},t.scale.category20c=function(){return t.scale.ordinal().range(Ds)};var As=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(se),$s=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(se),ks=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(se),Ds=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(se);function Rs(){return 0}t.scale.quantile=function(){return function e(n,r){var i;function o(){var e=0,o=r.length;for(i=[];++e<o;)i[e-1]=t.quantile(n,e/o);return s}function s(e){if(!isNaN(e=+e))return r[t.bisect(i,e)]}s.domain=function(t){return arguments.length?(n=t.map(p).filter(f).sort(h),o()):n};s.range=function(t){return arguments.length?(r=t,o()):r};s.quantiles=function(){return i};s.invertExtent=function(t){return(t=r.indexOf(t))<0?[NaN,NaN]:[t>0?i[t-1]:n[0],t<i.length?i[t]:n[n.length-1]]};s.copy=function(){return e(n,r)};return o()}([],[])},t.scale.quantize=function(){return function t(e,n,r){var i,o;function s(t){return r[Math.max(0,Math.min(o,Math.floor(i*(t-e))))]}function a(){return i=r.length/(n-e),o=r.length-1,s}s.domain=function(t){return arguments.length?(e=+t[0],n=+t[t.length-1],a()):[e,n]};s.range=function(t){return arguments.length?(r=t,a()):r};s.invertExtent=function(t){return[t=(t=r.indexOf(t))<0?NaN:t/i+e,t+1/i]};s.copy=function(){return t(e,n,r)};return a()}(0,1,[0,1])},t.scale.threshold=function(){return function e(n,r){function i(e){if(e<=e)return r[t.bisect(n,e)]}i.domain=function(t){return arguments.length?(n=t,i):n};i.range=function(t){return arguments.length?(r=t,i):r};i.invertExtent=function(t){return t=r.indexOf(t),[n[t-1],n[t]]};i.copy=function(){return e(n,r)};return i}([.5],[0,1])},t.scale.identity=function(){return function t(e){function n(t){return+t}n.invert=n;n.domain=n.range=function(t){return arguments.length?(e=t.map(n),n):e};n.ticks=function(t){return xs(e,t)};n.tickFormat=function(t,n){return Es(e,t,n)};n.copy=function(){return t(e)};return n}([0,1])},t.svg={},t.svg.arc=function(){var t=Ns,e=Is,n=Rs,r=Os,i=Ps,o=Ls,s=js;function a(){var a=Math.max(0,+t.apply(this,arguments)),c=Math.max(0,+e.apply(this,arguments)),l=i.apply(this,arguments)-Tt,h=o.apply(this,arguments)-Tt,p=Math.abs(h-l),f=l>h?0:1;if(c<a&&(d=c,c=a,a=d),p>=Mt)return u(c,f)+(a?u(a,1-f):"")+"Z";var d,m,v,g,y,_,b,x,E,w,S,C,M=0,T=0,A=[];if((g=(+s.apply(this,arguments)||0)/2)&&(v=r===Os?Math.sqrt(a*a+c*c):+r.apply(this,arguments),f||(T*=-1),c&&(T=Ot(v/c*Math.sin(g))),a&&(M=Ot(v/a*Math.sin(g)))),c){y=c*Math.cos(l+T),_=c*Math.sin(l+T),b=c*Math.cos(h-T),x=c*Math.sin(h-T);var $=Math.abs(h-l-2*T)<=St?0:1;if(T&&Bs(y,_,b,x)===f^$){var k=(l+h)/2;y=c*Math.cos(k),_=c*Math.sin(k),b=x=null}}else y=_=0;if(a){E=a*Math.cos(h-M),w=a*Math.sin(h-M),S=a*Math.cos(l+M),C=a*Math.sin(l+M);var D=Math.abs(l-h+2*M)<=St?0:1;if(M&&Bs(E,w,S,C)===1-f^D){var R=(l+h)/2;E=a*Math.cos(R),w=a*Math.sin(R),S=C=null}}else E=w=0;if(p>Et&&(d=Math.min(Math.abs(c-a)/2,+n.apply(this,arguments)))>.001){m=a<c^f?0:1;var O=d,N=d;if(p<St){var I=null==S?[E,w]:null==b?[y,_]:ui([y,_],[S,C],[b,x],[E,w]),P=y-I[0],L=_-I[1],j=b-I[0],B=x-I[1],F=1/Math.sin(Math.acos((P*j+L*B)/(Math.sqrt(P*P+L*L)*Math.sqrt(j*j+B*B)))/2),q=Math.sqrt(I[0]*I[0]+I[1]*I[1]);N=Math.min(d,(a-q)/(F-1)),O=Math.min(d,(c-q)/(F+1))}if(null!=b){var U=Fs(null==S?[E,w]:[S,C],[y,_],c,O,f),H=Fs([b,x],[E,w],c,O,f);d===O?A.push("M",U[0],"A",O,",",O," 0 0,",m," ",U[1],"A",c,",",c," 0 ",1-f^Bs(U[1][0],U[1][1],H[1][0],H[1][1]),",",f," ",H[1],"A",O,",",O," 0 0,",m," ",H[0]):A.push("M",U[0],"A",O,",",O," 0 1,",m," ",H[0])}else A.push("M",y,",",_);if(null!=S){var V=Fs([y,_],[S,C],a,-N,f),z=Fs([E,w],null==b?[y,_]:[b,x],a,-N,f);d===N?A.push("L",z[0],"A",N,",",N," 0 0,",m," ",z[1],"A",a,",",a," 0 ",f^Bs(z[1][0],z[1][1],V[1][0],V[1][1]),",",1-f," ",V[1],"A",N,",",N," 0 0,",m," ",V[0]):A.push("L",z[0],"A",N,",",N," 0 0,",m," ",V[0])}else A.push("L",E,",",w)}else A.push("M",y,",",_),null!=b&&A.push("A",c,",",c," 0 ",$,",",f," ",b,",",x),A.push("L",E,",",w),null!=S&&A.push("A",a,",",a," 0 ",D,",",1-f," ",S,",",C);return A.push("Z"),A.join("")}function u(t,e){return"M0,"+t+"A"+t+","+t+" 0 1,"+e+" 0,"+-t+"A"+t+","+t+" 0 1,"+e+" 0,"+t}return a.innerRadius=function(e){return arguments.length?(t=me(e),a):t},a.outerRadius=function(t){return arguments.length?(e=me(t),a):e},a.cornerRadius=function(t){return arguments.length?(n=me(t),a):n},a.padRadius=function(t){return arguments.length?(r=t==Os?Os:me(t),a):r},a.startAngle=function(t){return arguments.length?(i=me(t),a):i},a.endAngle=function(t){return arguments.length?(o=me(t),a):o},a.padAngle=function(t){return arguments.length?(s=me(t),a):s},a.centroid=function(){var n=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,r=(+i.apply(this,arguments)+ +o.apply(this,arguments))/2-Tt;return[Math.cos(r)*n,Math.sin(r)*n]},a};var Os="auto";function Ns(t){return t.innerRadius}function Is(t){return t.outerRadius}function Ps(t){return t.startAngle}function Ls(t){return t.endAngle}function js(t){return t&&t.padAngle}function Bs(t,e,n,r){return(t-n)*e-(e-r)*t>0?0:1}function Fs(t,e,n,r,i){var o=t[0]-e[0],s=t[1]-e[1],a=(i?r:-r)/Math.sqrt(o*o+s*s),u=a*s,c=-a*o,l=t[0]+u,h=t[1]+c,p=e[0]+u,f=e[1]+c,d=(l+p)/2,m=(h+f)/2,v=p-l,g=f-h,y=v*v+g*g,_=n-r,b=l*f-p*h,x=(g<0?-1:1)*Math.sqrt(Math.max(0,_*_*y-b*b)),E=(b*g-v*x)/y,w=(-b*v-g*x)/y,S=(b*g+v*x)/y,C=(-b*v+g*x)/y,M=E-d,T=w-m,A=S-d,$=C-m;return M*M+T*T>A*A+$*$&&(E=S,w=C),[[E-u,w-c],[E*n/_,w*n/_]]}function qs(t){var e=ni,n=ri,r=Wn,i=Hs,o=i.key,s=.7;function a(o){var a,u=[],c=[],l=-1,h=o.length,p=me(e),f=me(n);function d(){u.push("M",i(t(c),s))}for(;++l<h;)r.call(this,a=o[l],l)?c.push([+p.call(this,a,l),+f.call(this,a,l)]):c.length&&(d(),c=[]);return c.length&&d(),u.length?u.join(""):null}return a.x=function(t){return arguments.length?(e=t,a):e},a.y=function(t){return arguments.length?(n=t,a):n},a.defined=function(t){return arguments.length?(r=t,a):r},a.interpolate=function(t){return arguments.length?(o="function"==typeof t?i=t:(i=Us.get(t)||Hs).key,a):o},a.tension=function(t){return arguments.length?(s=t,a):s},a}t.svg.line=function(){return qs(k)};var Us=t.map({linear:Hs,"linear-closed":Vs,step:function(t){var e=0,n=t.length,r=t[0],i=[r[0],",",r[1]];for(;++e<n;)i.push("H",(r[0]+(r=t[e])[0])/2,"V",r[1]);n>1&&i.push("H",r[0]);return i.join("")},"step-before":zs,"step-after":Qs,basis:Ys,"basis-open":function(t){if(t.length<4)return Hs(t);var e,n=[],r=-1,i=t.length,o=[0],s=[0];for(;++r<3;)e=t[r],o.push(e[0]),s.push(e[1]);n.push(Xs(Zs,o)+","+Xs(Zs,s)),--r;for(;++r<i;)e=t[r],o.shift(),o.push(e[0]),s.shift(),s.push(e[1]),ta(n,o,s);return n.join("")},"basis-closed":function(t){var e,n,r=-1,i=t.length,o=i+4,s=[],a=[];for(;++r<4;)n=t[r%i],s.push(n[0]),a.push(n[1]);e=[Xs(Zs,s),",",Xs(Zs,a)],--r;for(;++r<o;)n=t[r%i],s.shift(),s.push(n[0]),a.shift(),a.push(n[1]),ta(e,s,a);return e.join("")},bundle:function(t,e){var n=t.length-1;if(n)for(var r,i,o=t[0][0],s=t[0][1],a=t[n][0]-o,u=t[n][1]-s,c=-1;++c<=n;)r=t[c],i=c/n,r[0]=e*r[0]+(1-e)*(o+i*a),r[1]=e*r[1]+(1-e)*(s+i*u);return Ys(t)},cardinal:function(t,e){return t.length<3?Hs(t):t[0]+Gs(t,Ws(t,e))},"cardinal-open":function(t,e){return t.length<4?Hs(t):t[1]+Gs(t.slice(1,-1),Ws(t,e))},"cardinal-closed":function(t,e){return t.length<3?Vs(t):t[0]+Gs((t.push(t[0]),t),Ws([t[t.length-2]].concat(t,[t[1]]),e))},monotone:function(t){return t.length<3?Hs(t):t[0]+Gs(t,function(t){var e,n,r,i,o=[],s=function(t){var e=0,n=t.length-1,r=[],i=t[0],o=t[1],s=r[0]=ea(i,o);for(;++e<n;)r[e]=(s+(s=ea(i=o,o=t[e+1])))/2;return r[e]=s,r}(t),a=-1,u=t.length-1;for(;++a<u;)e=ea(t[a],t[a+1]),g(e)<Et?s[a]=s[a+1]=0:(n=s[a]/e,r=s[a+1]/e,(i=n*n+r*r)>9&&(i=3*e/Math.sqrt(i),s[a]=i*n,s[a+1]=i*r));a=-1;for(;++a<=u;)i=(t[Math.min(u,a+1)][0]-t[Math.max(0,a-1)][0])/(6*(1+s[a]*s[a])),o.push([i||0,s[a]*i||0]);return o}(t))}});function Hs(t){return t.length>1?t.join("L"):t+"Z"}function Vs(t){return t.join("L")+"Z"}function zs(t){for(var e=0,n=t.length,r=t[0],i=[r[0],",",r[1]];++e<n;)i.push("V",(r=t[e])[1],"H",r[0]);return i.join("")}function Qs(t){for(var e=0,n=t.length,r=t[0],i=[r[0],",",r[1]];++e<n;)i.push("H",(r=t[e])[0],"V",r[1]);return i.join("")}function Gs(t,e){if(e.length<1||t.length!=e.length&&t.length!=e.length+2)return Hs(t);var n=t.length!=e.length,r="",i=t[0],o=t[1],s=e[0],a=s,u=1;if(n&&(r+="Q"+(o[0]-2*s[0]/3)+","+(o[1]-2*s[1]/3)+","+o[0]+","+o[1],i=t[1],u=2),e.length>1){a=e[1],o=t[u],u++,r+="C"+(i[0]+s[0])+","+(i[1]+s[1])+","+(o[0]-a[0])+","+(o[1]-a[1])+","+o[0]+","+o[1];for(var c=2;c<e.length;c++,u++)o=t[u],a=e[c],r+="S"+(o[0]-a[0])+","+(o[1]-a[1])+","+o[0]+","+o[1]}if(n){var l=t[u];r+="Q"+(o[0]+2*a[0]/3)+","+(o[1]+2*a[1]/3)+","+l[0]+","+l[1]}return r}function Ws(t,e){for(var n,r=[],i=(1-e)/2,o=t[0],s=t[1],a=1,u=t.length;++a<u;)n=o,o=s,s=t[a],r.push([i*(s[0]-n[0]),i*(s[1]-n[1])]);return r}function Ys(t){if(t.length<3)return Hs(t);var e=1,n=t.length,r=t[0],i=r[0],o=r[1],s=[i,i,i,(r=t[1])[0]],a=[o,o,o,r[1]],u=[i,",",o,"L",Xs(Zs,s),",",Xs(Zs,a)];for(t.push(t[n-1]);++e<=n;)r=t[e],s.shift(),s.push(r[0]),a.shift(),a.push(r[1]),ta(u,s,a);return t.pop(),u.push("L",r),u.join("")}function Xs(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}Us.forEach(function(t,e){e.key=t,e.closed=/-closed$/.test(t)});var Js=[0,2/3,1/3,0],Ks=[0,1/3,2/3,0],Zs=[0,1/6,2/3,1/6];function ta(t,e,n){t.push("C",Xs(Js,e),",",Xs(Js,n),",",Xs(Ks,e),",",Xs(Ks,n),",",Xs(Zs,e),",",Xs(Zs,n))}function ea(t,e){return(e[1]-t[1])/(e[0]-t[0])}function na(t){for(var e,n,r,i=-1,o=t.length;++i<o;)n=(e=t[i])[0],r=e[1]-Tt,e[0]=n*Math.cos(r),e[1]=n*Math.sin(r);return t}function ra(t){var e=ni,n=ni,r=0,i=ri,o=Wn,s=Hs,a=s.key,u=s,c="L",l=.7;function h(a){var h,p,f,d=[],m=[],v=[],g=-1,y=a.length,_=me(e),b=me(r),x=e===n?function(){return p}:me(n),E=r===i?function(){return f}:me(i);function w(){d.push("M",s(t(v),l),c,u(t(m.reverse()),l),"Z")}for(;++g<y;)o.call(this,h=a[g],g)?(m.push([p=+_.call(this,h,g),f=+b.call(this,h,g)]),v.push([+x.call(this,h,g),+E.call(this,h,g)])):m.length&&(w(),m=[],v=[]);return m.length&&w(),d.length?d.join(""):null}return h.x=function(t){return arguments.length?(e=n=t,h):n},h.x0=function(t){return arguments.length?(e=t,h):e},h.x1=function(t){return arguments.length?(n=t,h):n},h.y=function(t){return arguments.length?(r=i=t,h):i},h.y0=function(t){return arguments.length?(r=t,h):r},h.y1=function(t){return arguments.length?(i=t,h):i},h.defined=function(t){return arguments.length?(o=t,h):o},h.interpolate=function(t){return arguments.length?(a="function"==typeof t?s=t:(s=Us.get(t)||Hs).key,u=s.reverse||s,c=s.closed?"M":"L",h):a},h.tension=function(t){return arguments.length?(l=t,h):l},h}function ia(t){return t.radius}function oa(t){return[t.x,t.y]}function sa(){return 64}function aa(){return"circle"}function ua(t){var e=Math.sqrt(t/St);return"M0,"+e+"A"+e+","+e+" 0 1,1 0,"+-e+"A"+e+","+e+" 0 1,1 0,"+e+"Z"}t.svg.line.radial=function(){var t=qs(na);return t.radius=t.x,delete t.x,t.angle=t.y,delete t.y,t},zs.reverse=Qs,Qs.reverse=zs,t.svg.area=function(){return ra(k)},t.svg.area.radial=function(){var t=ra(na);return t.radius=t.x,delete t.x,t.innerRadius=t.x0,delete t.x0,t.outerRadius=t.x1,delete t.x1,t.angle=t.y,delete t.y,t.startAngle=t.y0,delete t.y0,t.endAngle=t.y1,delete t.y1,t},t.svg.chord=function(){var t=Ur,e=Hr,n=ia,r=Ps,i=Ls;function o(n,r){var i,o,c=s(this,t,n,r),l=s(this,e,n,r);return"M"+c.p0+a(c.r,c.p1,c.a1-c.a0)+(o=l,(i=c).a0==o.a0&&i.a1==o.a1?u(c.r,c.p1,c.r,c.p0):u(c.r,c.p1,l.r,l.p0)+a(l.r,l.p1,l.a1-l.a0)+u(l.r,l.p1,c.r,c.p0))+"Z"}function s(t,e,o,s){var a=e.call(t,o,s),u=n.call(t,a,s),c=r.call(t,a,s)-Tt,l=i.call(t,a,s)-Tt;return{r:u,a0:c,a1:l,p0:[u*Math.cos(c),u*Math.sin(c)],p1:[u*Math.cos(l),u*Math.sin(l)]}}function a(t,e,n){return"A"+t+","+t+" 0 "+ +(n>St)+",1 "+e}function u(t,e,n,r){return"Q 0,0 "+r}return o.radius=function(t){return arguments.length?(n=me(t),o):n},o.source=function(e){return arguments.length?(t=me(e),o):t},o.target=function(t){return arguments.length?(e=me(t),o):e},o.startAngle=function(t){return arguments.length?(r=me(t),o):r},o.endAngle=function(t){return arguments.length?(i=me(t),o):i},o},t.svg.diagonal=function(){var t=Ur,e=Hr,n=oa;function r(r,i){var o=t.call(this,r,i),s=e.call(this,r,i),a=(o.y+s.y)/2,u=[o,{x:o.x,y:a},{x:s.x,y:a},s];return"M"+(u=u.map(n))[0]+"C"+u[1]+" "+u[2]+" "+u[3]}return r.source=function(e){return arguments.length?(t=me(e),r):t},r.target=function(t){return arguments.length?(e=me(t),r):e},r.projection=function(t){return arguments.length?(n=t,r):n},r},t.svg.diagonal.radial=function(){var e=t.svg.diagonal(),n=oa,r=e.projection;return e.projection=function(t){return arguments.length?r(function(t){return function(){var e=t.apply(this,arguments),n=e[0],r=e[1]-Tt;return[n*Math.cos(r),n*Math.sin(r)]}}(n=t)):n},e},t.svg.symbol=function(){var t=aa,e=sa;function n(n,r){return(ca.get(t.call(this,n,r))||ua)(e.call(this,n,r))}return n.type=function(e){return arguments.length?(t=me(e),n):t},n.size=function(t){return arguments.length?(e=me(t),n):e},n};var ca=t.map({circle:ua,cross:function(t){var e=Math.sqrt(t/5)/2;return"M"+-3*e+","+-e+"H"+-e+"V"+-3*e+"H"+e+"V"+-e+"H"+3*e+"V"+e+"H"+e+"V"+3*e+"H"+-e+"V"+e+"H"+-3*e+"Z"},diamond:function(t){var e=Math.sqrt(t/(2*ha)),n=e*ha;return"M0,"+-e+"L"+n+",0 0,"+e+" "+-n+",0Z"},square:function(t){var e=Math.sqrt(t)/2;return"M"+-e+","+-e+"L"+e+","+-e+" "+e+","+e+" "+-e+","+e+"Z"},"triangle-down":function(t){var e=Math.sqrt(t/la),n=e*la/2;return"M0,"+n+"L"+e+","+-n+" "+-e+","+-n+"Z"},"triangle-up":function(t){var e=Math.sqrt(t/la),n=e*la/2;return"M0,"+-n+"L"+e+","+n+" "+-e+","+n+"Z"}});t.svg.symbolTypes=ca.keys();var la=Math.sqrt(3),ha=Math.tan(30*At);Q.transition=function(t){for(var e,n,r=ma||++ya,i=xa(t),o=[],s=va||{time:Date.now(),ease:oo,delay:0,duration:250},a=-1,u=this.length;++a<u;){o.push(e=[]);for(var c=this[a],l=-1,h=c.length;++l<h;)(n=c[l])&&Ea(n,l,i,r,s),e.push(n)}return da(o,i,r)},Q.interrupt=function(t){return this.each(null==t?pa:fa(xa(t)))};var pa=fa(xa());function fa(t){return function(){var e,n,r;(e=this[t])&&(r=e[n=e.active])&&(r.timer.c=null,r.timer.t=NaN,--e.count?delete e[n]:delete this[t],e.active+=.5,r.event&&r.event.interrupt.call(this,this.__data__,r.index))}}function da(t,e,n){return q(t,ga),t.namespace=e,t.id=n,t}var ma,va,ga=[],ya=0;function _a(t,e,n,r){var i=t.id,o=t.namespace;return ct(t,"function"==typeof n?function(t,s,a){t[o][i].tween.set(e,r(n.call(t,t.__data__,s,a)))}:(n=r(n),function(t){t[o][i].tween.set(e,n)}))}function ba(t){return null==t&&(t=""),function(){this.textContent=t}}function xa(t){return null==t?"__transition__":"__transition_"+t+"__"}function Ea(t,e,n,r,i){var o,s,a,u,c,l=t[n]||(t[n]={active:0,count:0}),h=l[r];function p(n){var i=l.active,p=l[i];for(var d in p&&(p.timer.c=null,p.timer.t=NaN,--l.count,delete l[i],p.event&&p.event.interrupt.call(t,t.__data__,p.index)),l)if(+d<r){var m=l[d];m.timer.c=null,m.timer.t=NaN,--l.count,delete l[d]}s.c=f,we(function(){return s.c&&f(n||1)&&(s.c=null,s.t=NaN),1},0,o),l.active=r,h.event&&h.event.start.call(t,t.__data__,e),c=[],h.tween.forEach(function(n,r){(r=r.call(t,t.__data__,e))&&c.push(r)}),u=h.ease,a=h.duration}function f(i){for(var o=i/a,s=u(o),p=c.length;p>0;)c[--p].call(t,s);if(o>=1)return h.event&&h.event.end.call(t,t.__data__,e),--l.count?delete l[r]:delete t[n],1}h||(o=i.time,s=we(function(t){var e=h.delay;if(s.t=e+o,e<=t)return p(t-e);s.c=p},0,o),h=l[r]={tween:new _,time:o,timer:s,delay:i.delay,duration:i.duration,ease:i.ease,index:e},i=null,++l.count)}ga.call=Q.call,ga.empty=Q.empty,ga.node=Q.node,ga.size=Q.size,t.transition=function(e,n){return e&&e.transition?ma?e.transition(n):e:t.selection().transition(e)},t.transition.prototype=ga,ga.select=function(t){var e,n,r,i=this.id,o=this.namespace,s=[];t=G(t);for(var a=-1,u=this.length;++a<u;){s.push(e=[]);for(var c=this[a],l=-1,h=c.length;++l<h;)(r=c[l])&&(n=t.call(r,r.__data__,l,a))?("__data__"in r&&(n.__data__=r.__data__),Ea(n,l,o,i,r[o][i]),e.push(n)):e.push(null)}return da(s,o,i)},ga.selectAll=function(t){var e,n,r,i,o,s=this.id,a=this.namespace,u=[];t=W(t);for(var c=-1,l=this.length;++c<l;)for(var h=this[c],p=-1,f=h.length;++p<f;)if(r=h[p]){o=r[a][s],n=t.call(r,r.__data__,p,c),u.push(e=[]);for(var d=-1,m=n.length;++d<m;)(i=n[d])&&Ea(i,d,a,s,o),e.push(i)}return da(u,a,s)},ga.filter=function(t){var e,n,r=[];"function"!=typeof t&&(t=ut(t));for(var i=0,o=this.length;i<o;i++){r.push(e=[]);for(var s,a=0,u=(s=this[i]).length;a<u;a++)(n=s[a])&&t.call(n,n.__data__,a,i)&&e.push(n)}return da(r,this.namespace,this.id)},ga.tween=function(t,e){var n=this.id,r=this.namespace;return arguments.length<2?this.node()[r][n].tween.get(t):ct(this,null==e?function(e){e[r][n].tween.remove(t)}:function(i){i[r][n].tween.set(t,e)})},ga.attr=function(e,n){if(arguments.length<2){for(n in e)this.attr(n,e[n]);return this}var r="transform"==e?go:Xi,i=t.ns.qualify(e);function o(){this.removeAttribute(i)}function s(){this.removeAttributeNS(i.space,i.local)}return _a(this,"attr."+e,n,i.local?function(t){return null==t?s:(t+="",function(){var e,n=this.getAttributeNS(i.space,i.local);return n!==t&&(e=r(n,t),function(t){this.setAttributeNS(i.space,i.local,e(t))})})}:function(t){return null==t?o:(t+="",function(){var e,n=this.getAttribute(i);return n!==t&&(e=r(n,t),function(t){this.setAttribute(i,e(t))})})})},ga.attrTween=function(e,n){var r=t.ns.qualify(e);return this.tween("attr."+e,r.local?function(t,e){var i=n.call(this,t,e,this.getAttributeNS(r.space,r.local));return i&&function(t){this.setAttributeNS(r.space,r.local,i(t))}}:function(t,e){var i=n.call(this,t,e,this.getAttribute(r));return i&&function(t){this.setAttribute(r,i(t))}})},ga.style=function(t,e,n){var r=arguments.length;if(r<3){if("string"!=typeof t){for(n in r<2&&(e=""),t)this.style(n,t[n],e);return this}n=""}function i(){this.style.removeProperty(t)}return _a(this,"style."+t,e,function(e){return null==e?i:(e+="",function(){var r,i=o(this).getComputedStyle(this,null).getPropertyValue(t);return i!==e&&(r=Xi(i,e),function(e){this.style.setProperty(t,r(e),n)})})})},ga.styleTween=function(t,e,n){return arguments.length<3&&(n=""),this.tween("style."+t,function(r,i){var s=e.call(this,r,i,o(this).getComputedStyle(this,null).getPropertyValue(t));return s&&function(e){this.style.setProperty(t,s(e),n)}})},ga.text=function(t){return _a(this,"text",t,ba)},ga.remove=function(){var t=this.namespace;return this.each("end.transition",function(){var e;this[t].count<2&&(e=this.parentNode)&&e.removeChild(this)})},ga.ease=function(e){var n=this.id,r=this.namespace;return arguments.length<1?this.node()[r][n].ease:("function"!=typeof e&&(e=t.ease.apply(t,arguments)),ct(this,function(t){t[r][n].ease=e}))},ga.delay=function(t){var e=this.id,n=this.namespace;return arguments.length<1?this.node()[n][e].delay:ct(this,"function"==typeof t?function(r,i,o){r[n][e].delay=+t.call(r,r.__data__,i,o)}:(t=+t,function(r){r[n][e].delay=t}))},ga.duration=function(t){var e=this.id,n=this.namespace;return arguments.length<1?this.node()[n][e].duration:ct(this,"function"==typeof t?function(r,i,o){r[n][e].duration=Math.max(1,t.call(r,r.__data__,i,o))}:(t=Math.max(1,t),function(r){r[n][e].duration=t}))},ga.each=function(e,n){var r=this.id,i=this.namespace;if(arguments.length<2){var o=va,s=ma;try{ma=r,ct(this,function(t,n,o){va=t[i][r],e.call(t,t.__data__,n,o)})}finally{va=o,ma=s}}else ct(this,function(o){var s=o[i][r];(s.event||(s.event=t.dispatch("start","end","interrupt"))).on(e,n)});return this},ga.transition=function(){for(var t,e,n,r=this.id,i=++ya,o=this.namespace,s=[],a=0,u=this.length;a<u;a++){s.push(t=[]);for(var c,l=0,h=(c=this[a]).length;l<h;l++)(e=c[l])&&Ea(e,l,o,i,{time:(n=e[o][r]).time,ease:n.ease,delay:n.delay+n.duration,duration:n.duration}),t.push(e)}return da(s,o,i)},t.svg.axis=function(){var e,r=t.scale.linear(),i=wa,o=6,s=6,a=3,u=[10],c=null;function l(n){n.each(function(){var n,l=t.select(this),h=this.__chart__||r,p=this.__chart__=r.copy(),f=null==c?p.ticks?p.ticks.apply(p,u):p.domain():c,d=null==e?p.tickFormat?p.tickFormat.apply(p,u):k:e,m=l.selectAll(".tick").data(f,p),v=m.enter().insert("g",".domain").attr("class","tick").style("opacity",Et),g=t.transition(m.exit()).style("opacity",Et).remove(),y=t.transition(m.order()).style("opacity",1),_=Math.max(o,0)+a,b=ps(p),x=l.selectAll(".domain").data([0]),E=(x.enter().append("path").attr("class","domain"),t.transition(x));v.append("line"),v.append("text");var w,S,C,M,T=v.select("line"),A=y.select("line"),$=m.select("text").text(d),D=v.select("text"),R=y.select("text"),O="top"===i||"left"===i?-1:1;if("bottom"===i||"top"===i?(n=Ca,w="x",C="y",S="x2",M="y2",$.attr("dy",O<0?"0em":".71em").style("text-anchor","middle"),E.attr("d","M"+b[0]+","+O*s+"V0H"+b[1]+"V"+O*s)):(n=Ma,w="y",C="x",S="y2",M="x2",$.attr("dy",".32em").style("text-anchor",O<0?"end":"start"),E.attr("d","M"+O*s+","+b[0]+"H0V"+b[1]+"H"+O*s)),T.attr(M,O*o),D.attr(C,O*_),A.attr(S,0).attr(M,O*o),R.attr(w,0).attr(C,O*_),p.rangeBand){var N=p,I=N.rangeBand()/2;h=p=function(t){return N(t)+I}}else h.rangeBand?h=p:g.call(n,p,h);v.call(n,h,p),y.call(n,p,p)})}return l.scale=function(t){return arguments.length?(r=t,l):r},l.orient=function(t){return arguments.length?(i=t in Sa?t+"":wa,l):i},l.ticks=function(){return arguments.length?(u=n(arguments),l):u},l.tickValues=function(t){return arguments.length?(c=t,l):c},l.tickFormat=function(t){return arguments.length?(e=t,l):e},l.tickSize=function(t){var e=arguments.length;return e?(o=+t,s=+arguments[e-1],l):o},l.innerTickSize=function(t){return arguments.length?(o=+t,l):o},l.outerTickSize=function(t){return arguments.length?(s=+t,l):s},l.tickPadding=function(t){return arguments.length?(a=+t,l):a},l.tickSubdivide=function(){return arguments.length&&l},l};var wa="bottom",Sa={top:1,right:1,bottom:1,left:1};function Ca(t,e,n){t.attr("transform",function(t){var r=e(t);return"translate("+(isFinite(r)?r:n(t))+",0)"})}function Ma(t,e,n){t.attr("transform",function(t){var r=e(t);return"translate(0,"+(isFinite(r)?r:n(t))+")"})}t.svg.brush=function(){var e,n,r=B(p,"brushstart","brush","brushend"),i=null,s=null,a=[0,0],u=[0,0],c=!0,l=!0,h=Aa[0];function p(e){e.each(function(){var e=t.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",v).on("touchstart.brush",v),n=e.selectAll(".background").data([0]);n.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),e.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var r=e.selectAll(".resize").data(h,k);r.exit().remove(),r.enter().append("g").attr("class",function(t){return"resize "+t}).style("cursor",function(t){return Ta[t]}).append("rect").attr("x",function(t){return/[ew]$/.test(t)?-3:null}).attr("y",function(t){return/^[ns]/.test(t)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),r.style("display",p.empty()?"none":null);var o,a=t.transition(e),u=t.transition(n);i&&(o=ps(i),u.attr("x",o[0]).attr("width",o[1]-o[0]),d(a)),s&&(o=ps(s),u.attr("y",o[0]).attr("height",o[1]-o[0]),m(a)),f(a)})}function f(t){t.selectAll(".resize").attr("transform",function(t){return"translate("+a[+/e$/.test(t)]+","+u[+/^s/.test(t)]+")"})}function d(t){t.select(".extent").attr("x",a[0]),t.selectAll(".extent,.n>rect,.s>rect").attr("width",a[1]-a[0])}function m(t){t.select(".extent").attr("y",u[0]),t.selectAll(".extent,.e>rect,.w>rect").attr("height",u[1]-u[0])}function v(){var h,v,g=this,y=t.select(t.event.target),_=r.of(g,arguments),b=t.select(g),x=y.datum(),E=!/^(n|s)$/.test(x)&&i,w=!/^(e|w)$/.test(x)&&s,S=y.classed("extent"),C=yt(g),M=t.mouse(g),T=t.select(o(g)).on("keydown.brush",function(){32==t.event.keyCode&&(S||(h=null,M[0]-=a[1],M[1]-=u[1],S=2),L())}).on("keyup.brush",function(){32==t.event.keyCode&&2==S&&(M[0]+=a[1],M[1]+=u[1],S=0,L())});if(t.event.changedTouches?T.on("touchmove.brush",k).on("touchend.brush",R):T.on("mousemove.brush",k).on("mouseup.brush",R),b.interrupt().selectAll("*").interrupt(),S)M[0]=a[0]-M[0],M[1]=u[0]-M[1];else if(x){var A=+/w$/.test(x),$=+/^n/.test(x);v=[a[1-A]-M[0],u[1-$]-M[1]],M[0]=a[A],M[1]=u[$]}else t.event.altKey&&(h=M.slice());function k(){var e=t.mouse(g),n=!1;v&&(e[0]+=v[0],e[1]+=v[1]),S||(t.event.altKey?(h||(h=[(a[0]+a[1])/2,(u[0]+u[1])/2]),M[0]=a[+(e[0]<h[0])],M[1]=u[+(e[1]<h[1])]):h=null),E&&D(e,i,0)&&(d(b),n=!0),w&&D(e,s,1)&&(m(b),n=!0),n&&(f(b),_({type:"brush",mode:S?"move":"resize"}))}function D(t,r,i){var o,s,p=ps(r),f=p[0],d=p[1],m=M[i],v=i?u:a,g=v[1]-v[0];if(S&&(f-=m,d-=g+m),o=(i?l:c)?Math.max(f,Math.min(d,t[i])):t[i],S?s=(o+=m)+g:(h&&(m=Math.max(f,Math.min(d,2*h[i]-o))),m<o?(s=o,o=m):s=m),v[0]!=o||v[1]!=s)return i?n=null:e=null,v[0]=o,v[1]=s,!0}function R(){k(),b.style("pointer-events","all").selectAll(".resize").style("display",p.empty()?"none":null),t.select("body").style("cursor",null),T.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),C(),_({type:"brushend"})}b.style("pointer-events","none").selectAll(".resize").style("display",null),t.select("body").style("cursor",y.style("cursor")),_({type:"brushstart"}),k()}return p.event=function(i){i.each(function(){var i=r.of(this,arguments),o={x:a,y:u,i:e,j:n},s=this.__chart__||o;this.__chart__=o,ma?t.select(this).transition().each("start.brush",function(){e=s.i,n=s.j,a=s.x,u=s.y,i({type:"brushstart"})}).tween("brush:brush",function(){var t=Ji(a,o.x),r=Ji(u,o.y);return e=n=null,function(e){a=o.x=t(e),u=o.y=r(e),i({type:"brush",mode:"resize"})}}).each("end.brush",function(){e=o.i,n=o.j,i({type:"brush",mode:"resize"}),i({type:"brushend"})}):(i({type:"brushstart"}),i({type:"brush",mode:"resize"}),i({type:"brushend"}))})},p.x=function(t){return arguments.length?(h=Aa[!(i=t)<<1|!s],p):i},p.y=function(t){return arguments.length?(h=Aa[!i<<1|!(s=t)],p):s},p.clamp=function(t){return arguments.length?(i&&s?(c=!!t[0],l=!!t[1]):i?c=!!t:s&&(l=!!t),p):i&&s?[c,l]:i?c:s?l:null},p.extent=function(t){var r,o,c,l,h;return arguments.length?(i&&(r=t[0],o=t[1],s&&(r=r[0],o=o[0]),e=[r,o],i.invert&&(r=i(r),o=i(o)),o<r&&(h=r,r=o,o=h),r==a[0]&&o==a[1]||(a=[r,o])),s&&(c=t[0],l=t[1],i&&(c=c[1],l=l[1]),n=[c,l],s.invert&&(c=s(c),l=s(l)),l<c&&(h=c,c=l,l=h),c==u[0]&&l==u[1]||(u=[c,l])),p):(i&&(e?(r=e[0],o=e[1]):(r=a[0],o=a[1],i.invert&&(r=i.invert(r),o=i.invert(o)),o<r&&(h=r,r=o,o=h))),s&&(n?(c=n[0],l=n[1]):(c=u[0],l=u[1],s.invert&&(c=s.invert(c),l=s.invert(l)),l<c&&(h=c,c=l,l=h))),i&&s?[[r,c],[o,l]]:i?[r,o]:s&&[c,l])},p.clear=function(){return p.empty()||(a=[0,0],u=[0,0],e=n=null),p},p.empty=function(){return!!i&&a[0]==a[1]||!!s&&u[0]==u[1]},t.rebind(p,r,"on")};var Ta={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Aa=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],$a=Oe.format=cn.timeFormat,ka=$a.utc,Da=ka("%Y-%m-%dT%H:%M:%S.%LZ");function Ra(t){return t.toISOString()}function Oa(e,n,r){function i(t){return e(t)}function o(e,r){var i=(e[1]-e[0])/r,o=t.bisect(Ia,i);return o==Ia.length?[n.year,bs(e.map(function(t){return t/31536e6}),r)[2]]:o?n[i/Ia[o-1]<Ia[o]/i?o-1:o]:[ja,bs(e,r)[2]]}return i.invert=function(t){return Na(e.invert(t))},i.domain=function(t){return arguments.length?(e.domain(t),i):e.domain().map(Na)},i.nice=function(t,e){var n=i.domain(),r=hs(n),s=null==t?o(r,10):"number"==typeof t&&o(r,t);function a(n){return!isNaN(n)&&!t.range(n,Na(+n+1),e).length}return s&&(t=s[0],e=s[1]),i.domain(ds(n,e>1?{floor:function(e){for(;a(e=t.floor(e));)e=Na(e-1);return e},ceil:function(e){for(;a(e=t.ceil(e));)e=Na(+e+1);return e}}:t))},i.ticks=function(t,e){var n=hs(i.domain()),r=null==t?o(n,10):"number"==typeof t?o(n,t):!t.range&&[{range:t},e];return r&&(t=r[0],e=r[1]),t.range(n[0],Na(+n[1]+1),e<1?1:e)},i.tickFormat=function(){return r},i.copy=function(){return Oa(e.copy(),n,r)},ys(i,e)}function Na(t){return new Date(t)}$a.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?Ra:Da,Ra.parse=function(t){var e=new Date(t);return isNaN(e)?null:e},Ra.toString=Da.toString,Oe.second=Le(function(t){return new Ne(1e3*Math.floor(t/1e3))},function(t,e){t.setTime(t.getTime()+1e3*Math.floor(e))},function(t){return t.getSeconds()}),Oe.seconds=Oe.second.range,Oe.seconds.utc=Oe.second.utc.range,Oe.minute=Le(function(t){return new Ne(6e4*Math.floor(t/6e4))},function(t,e){t.setTime(t.getTime()+6e4*Math.floor(e))},function(t){return t.getMinutes()}),Oe.minutes=Oe.minute.range,Oe.minutes.utc=Oe.minute.utc.range,Oe.hour=Le(function(t){var e=t.getTimezoneOffset()/60;return new Ne(36e5*(Math.floor(t/36e5-e)+e))},function(t,e){t.setTime(t.getTime()+36e5*Math.floor(e))},function(t){return t.getHours()}),Oe.hours=Oe.hour.range,Oe.hours.utc=Oe.hour.utc.range,Oe.month=Le(function(t){return(t=Oe.day(t)).setDate(1),t},function(t,e){t.setMonth(t.getMonth()+e)},function(t){return t.getMonth()}),Oe.months=Oe.month.range,Oe.months.utc=Oe.month.utc.range;var Ia=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],Pa=[[Oe.second,1],[Oe.second,5],[Oe.second,15],[Oe.second,30],[Oe.minute,1],[Oe.minute,5],[Oe.minute,15],[Oe.minute,30],[Oe.hour,1],[Oe.hour,3],[Oe.hour,6],[Oe.hour,12],[Oe.day,1],[Oe.day,2],[Oe.week,1],[Oe.month,1],[Oe.month,3],[Oe.year,1]],La=$a.multi([[".%L",function(t){return t.getMilliseconds()}],[":%S",function(t){return t.getSeconds()}],["%I:%M",function(t){return t.getMinutes()}],["%I %p",function(t){return t.getHours()}],["%a %d",function(t){return t.getDay()&&1!=t.getDate()}],["%b %d",function(t){return 1!=t.getDate()}],["%B",function(t){return t.getMonth()}],["%Y",Wn]]),ja={range:function(e,n,r){return t.range(Math.ceil(e/r)*r,+n,r).map(Na)},floor:k,ceil:k};Pa.year=Oe.year,Oe.scale=function(){return Oa(t.scale.linear(),Pa,La)};var Ba=Pa.map(function(t){return[t[0].utc,t[1]]}),Fa=ka.multi([[".%L",function(t){return t.getUTCMilliseconds()}],[":%S",function(t){return t.getUTCSeconds()}],["%I:%M",function(t){return t.getUTCMinutes()}],["%I %p",function(t){return t.getUTCHours()}],["%a %d",function(t){return t.getUTCDay()&&1!=t.getUTCDate()}],["%b %d",function(t){return 1!=t.getUTCDate()}],["%B",function(t){return t.getUTCMonth()}],["%Y",Wn]]);function qa(t){return JSON.parse(t.responseText)}function Ua(t){var e=r.createRange();return e.selectNode(r.body),e.createContextualFragment(t.responseText)}Ba.year=Oe.year.utc,Oe.scale.utc=function(){return Oa(t.scale.linear(),Ba,Fa)},t.text=ve(function(t){return t.responseText}),t.json=function(t,e){return ge(t,"application/json",qa,e)},t.html=function(t,e){return ge(t,"text/html",Ua,e)},t.xml=ve(function(t){return t.responseXML}),"function"==typeof define&&define.amd?(this.d3=t,define(t)):_$d3_5.exports?_$d3_5.exports=t:this.d3=t}(),_$d3_5=_$d3_5.exports;var _$BarChart_3={};(function(t){function e(){}_$BarChart_3=e,e.prototype.view=t,e.prototype.init=function(){var t=this.model;t.setNull("data",[]),t.setNull("width",200),t.setNull("height",100),t.set("layout",[]),this.yScale=_$d3_5.scale.linear().range([0,t.get("height")]),this.xScale=_$d3_5.scale.ordinal().rangeBands([0,t.get("width")],.1),this.transform()},e.prototype.create=function(){var t=this.model,e=this;t.on("all","data**",function(){e.transform()})},e.prototype.transform=function(){var t=this.model,e=this,n=t.get("data")||[];this.xScale.domain(_$d3_5.range(n.length)),this.yScale.domain([0,_$d3_5.max(n,function(t){return t.value})]);var r=n.map(function(t,n){return{x:e.xScale(n),y:e.yScale.range()[1]-e.yScale(t.value),width:e.xScale.rangeBand()/2,height:e.yScale(t.value)}});t.setDiffDeep("layout",r)},e.prototype.clicker=function(t,e,n,r){console.log("clicked!",t,e,r)}}).call(this,"/node_modules/d-barchart");var _$render_99={exports:{}};return function(t,e){"use strict";var n=_$render_99.exports=_$derby_derby.createApp("render",t);n.use(_$derbyDebug_6),n.serverUse(_$render_99,"derby-stylus"),n.loadViews(e),n.loadStyles(e),n.component(_$CM_4),n.component(_$BarChart_3);function r(){}n.component("editor",r),r.prototype.init=function(t){t.set("source",'Render anywhere!\n<div style="text-align: right">\n  {{each data.bars as #bar}}\n    <div style="width: {{#bar.value}}px; border-bottom: 4px solid {{data.color}};">\n      {{Math.floor(#bar.value)}}\n    </div>\n  {{/each}}\n</div>')},r.prototype.parse=function(t){try{return _$parsing_28.createTemplate(t)}catch(t){return t.message}},n.get("/",function(t,e,n,r){var i=e.at("home.data");i.subscribe(function(e){if(e)return r(e);i.createNull({bars:[{value:1},{value:10},{value:20}],color:"#12B9B3"}),t.render()})}),n.proto.remove=function(t){this.model.remove("home.data.bars",t)},n.proto.add=function(){this.model.push("home.data.bars",{value:100*Math.random()})}}.call(this,"/render/index.js","/render"),_$render_99=_$render_99.exports,exposedRequire.m.racer=_$lib_racer,exposedRequire.m.derby=_$derby_derby,exposedRequire}("function"==typeof require?require:void 0);
//# sourceMappingURL=/derby/render-2ed3594e9675d6b1fbaea4e8235a5dfb.map.json