require=function(require){var exposedRequire=function t(e,n){return t.m.hasOwnProperty(e)?t.m[e]:"function"!=typeof require||n?"function"==typeof t.r?t.r(e,1):void 0:require(e,1)};exposedRequire.m={},exposedRequire.r=require;var createModuleFactory=function(t){var e;return function(n){return e||t(e={exports:{},parent:n},e.exports),e.exports}},_$index_93=createModuleFactory(function(t,e){(function(e,n){var i;(i=t.exports=_$derby_derby.createApp("sink",e)).use(_$derbyDebug_5),i.serverUse(t,"derby-stylus"),i.loadViews(n+"/../views"),i.loadStyles(n+"/../styles"),i.component(_$ConnectionAlert_4),i.component(_$BeforeUnload_3),_$pages_96({}),_$bench_91({}),_$liveCss_95({}),_$home_92({}),_$leaderboard_94({}),_$table_97({}),["get","post","put","del"].forEach(function(t){return i[t](i.pages.submit.href,function(e,n,i){var r,o,s;return o=i.body,s=i.query,r=JSON.stringify({method:t,body:o,query:s},null,"  "),n.set("_page.args",r),e.render("submit")})}),i.get(i.pages.error.href,function(){throw new Error(500)}),i.get(i.pages.back.href,function(t){return t.redirect("back")})}).call(this,"/sink/src/index.coffee","/sink/src")}),_$table_97=createModuleFactory(function(t,e){var n;(n=_$index_93({})).component(_$sortableTable_90),n.get(n.pages.table.href,function(t,e,n,i){return e.subscribe("sink.table",function(n){return n?i(n):(e.createNull("sink.table",{rows:[]}),t.render("table"))})}),n.component("table",function(){function t(){}return t.prototype.init=function(t){return this.rows=t.scope("sink.table.rows"),t.ref("table",this.rows)},t.prototype.onRowMove=function(t,e){return this.rows.move(t,e)},t.prototype.onColMove=function(t,e){var n;for(n=this.rows.get("length");n--;)this.rows.move(n+".cells",t,e)},t.prototype.addRow=function(){var t,e;for(t=[],e=this.rows.get("0.cells.length");e--;)t.push({});return this.rows.push({cells:t})},t.prototype.addCol=function(){var t;for(t=this.rows.get("length");t--;)this.rows.push(t+".cells",{})},t.prototype.deleteRow=function(t){return this.rows.remove(t)},t.prototype.deleteCol=function(t){var e;for(e=this.rows.get("length");e--;)this.rows.remove(e+".cells",t)},t.prototype.colName=function(t,e){var n;return null==e&&(e=""),n=t%26,e=String.fromCharCode(65+n)+e,(t=Math.floor(t/26))?this.colName(t-1,e):e},t}())}),_$leaderboard_94=createModuleFactory(function(t,e){var n,i;n=_$index_93({}),i=function(){return 5*Math.floor(20*Math.random())},n.get(n.pages.leaderboard.href,function(t,e,n,i){return e.query("players",{$sort:{score:-1,name:1},$limit:10}).subscribe(function(e){return e?i(e):t.render("leaderboard")})}),n.component("leaderboard",function(){function t(){}return t.prototype.init=function(t){return this.players=t.root.at("players"),t.ref("list",this.players.sort({limit:5},function(t,e){return t&&e?t.score<e.score?1:t.score>e.score?-1:t.name>e.name?1:t.name<e.name?-1:0:0}))},t.prototype.create=function(){return this.dom.on("click",(t=this,function(e){if(!t.board.contains(e.target))return t.deselect()}));var t},t.prototype.add=function(){var t;if(t=this.model.del("newPlayer"))return this.players.add({name:t,score:i()})},t.prototype.remove=function(){return this.model.del("selected")},t.prototype.increment=function(t){return this.model.increment("selected.score",t)},t.prototype.select=function(t){return this.model.ref("selected",this.players.at(t.id))},t.prototype.deselect=function(){return this.model.removeRef("selected")},t}())}),_$home_92=createModuleFactory(function(t,e){var n;(n=_$index_93({})).get(n.pages.home.href,function(t,e,n,i){var r;return(r=e.at("sink.home")).subscribe(function(e){return e?i(e):(r.createNull({titleColor:"black",colors:[{name:"black"},{name:"deep pink"},{name:"lime green"},{name:"coral"},{name:"dark turquoise"},{name:"dark orchid"}],ellipse:{cx:100,cy:100,rx:50,ry:50,fill:"red"}}),t.render("home"))})}),n.component("home:colored-title",function(){function t(){}return t.prototype.init=function(t){return t.ref("titleColor",t.scope("sink.home.titleColor")),this.colors=t.scope("sink.home.colors"),t.ref("colors",this.colors)},t.prototype.unspace=function(t){return"string"!=typeof t?t:t.replace(/\s/g,"")},t.prototype.capitalize=function(t){return"string"!=typeof t?t:t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()},t.prototype.colorInputValue={get:function(t,e){return t},set:function(t,e,n){return e===n?[t,t]:[t]}},t.prototype.titleInputValue={get:function(t){return t},set:function(t,e){var n,i,r,o;for(n=i=0,r=(o=this.colors.get()||[]).length;i<r;n=++i)o[n].name===e&&this.colors.setDiff(n+".name",t);return[t]}},t}())}),_$liveCss_95=createModuleFactory(function(t,e){var n,i;i=(n=_$index_93({})).pages.liveCss.href+"/:popped(popout)?",n.get(i,function(t,e,n,i){var r;return(r=e.at("sink.liveCss")).subscribe(function(e){return e?i(e):(r.createNull({styles:[{prop:"color",value:"#c00",active:!0},{prop:"font-weight",value:"bold",active:!0},{prop:"font-size",value:"18px",active:!1}],outputText:"Edit this text..."}),t.render("live-css"))})}),n.get({from:i,to:i},function(){}),n.component("live-css",function(){function t(){}return t.prototype.init=function(t){return t.ref("poppedOut",t.scope("$render.params.popped")),t.ref("styles",t.scope("sink.liveCss.styles")),t.ref("outputText",t.scope("sink.liveCss.outputText"))},t.prototype.addStyle=function(){return this.model.push("styles",{})},t.prototype.deleteStyle=function(t){return this.model.remove("styles",t)},t.prototype.hasActiveStyles=function(t){var e,n,i;for(e=0,n=(i=t||[]).length;e<n;e++)if(i[e].active)return!0;return!1},t}())}),_$bench_91=createModuleFactory(function(t,e){var n,i;(i=_$index_93({})).get(i.pages.bench.href,function(t){return t.render("bench")}),i.component("bench:circles",function(){function t(){}return t.prototype.init=function(t){var e;return this.n=t.get("n")||100,this.boxes=t.at("boxes"),e=function(){var t,e,i;for(i=[],t=0,e=this.n;0<=e?t<e:t>e;0<=e?++t:--t)i.push(new n(0));return i}.call(this),this.boxes.set(e),t.set("modes",["setAll","setBox","setProperty"])},t.prototype.start=function(t){return clearTimeout(this.timeout),this.model.set("mode",t),this.fn=this[t],this.frames=0,this.startTime=+new Date,this.run()},t.prototype.stop=function(){return clearTimeout(this.timeout)},t.prototype.run=function(){var t,e;return this.fn(),20==this.frames++&&(t=1e3*this.frames/(new Date-this.startTime),this.model.set("fps",t.toFixed(1)),this.frames=0,this.startTime=+new Date),this.timeout=setTimeout((e=this,function(){return e.run()}),0)},t.prototype.tickProperty=function(t){var e;return e=t.increment("count"),t.set("top",10*Math.sin(e/10)),t.set("left",10*Math.cos(e/10)),t.set("color",e%255),t.set("content",e%100)},t.prototype.setProperty=function(){var t,e,n;for(t=e=0,n=this.n;0<=n?e<n:e>n;t=0<=n?++e:--e)this.tickProperty(this.boxes.at(t))},t.prototype.tickBox=function(t){var e;return e=t.get("count")+1,t.set({count:e,top:10*Math.sin(e/10),left:10*Math.cos(e/10),color:e%255,content:e%100})},t.prototype.setBox=function(){var t,e,n;for(t=e=0,n=this.n;0<=n?e<n:e>n;t=0<=n?++e:--e)this.tickBox(this.boxes.at(t))},t.prototype.setAll=function(){var t,e,i;return i=this.boxes.get(),e=function(){var e,r,o;for(o=[],e=0,r=i.length;e<r;e++)t=i[e],o.push(new n(t.count+1));return o}(),this.boxes.set(e)},t}()),n=function(){return function(t){this.count=t,this.top=10*Math.sin(t/10),this.left=10*Math.cos(t/10),this.color=t%255,this.content=t%100}}()}),_$pages_96=createModuleFactory(function(t,e){var n,i;(n=_$index_93({})).pages={home:{title:"Home",href:"/"},liveCss:{title:"Live CSS",href:"/live-css"},table:{title:"Table editor",href:"/table"},leaderboard:{title:"Leaderboard",href:"/leaderboard"},bench:{title:"Bindings benchmark",href:"/bench"},submit:{title:"Submit form",href:"/submit"},back:{title:"Back redirect",href:"/back"},error:{title:"Error test",href:"/error"}},n.proto.navItems=function(t){var e,r,o,s;for(r in e=[],s=n.pages)o=s[r],e.push({title:o.title,href:o.href,isCurrent:t===i(r)});return e[e.length-1].isLast=!0,e},n.proto.pageTitle=function(t){var e;return null!=(e=n.pages[t])?e.title:void 0},i=function(t){return t.replace(/[a-z][A-Z]/g,function(t){return t.charAt(0)+"-"+t.charAt(1).toLowerCase()})}}),_$documentListeners_20=createModuleFactory(function(t,e){function n(t){var e=t.type;return"text"===e||"textarea"===e||"search"===e||"url"===e||"tel"===e||"password"===e}function i(t){var e=t.type;return"number"===e||"range"===e&&!t.multiple}e.add=function(t){t.addEventListener("input",o,!0),t.addEventListener("change",s,!0),parseFloat(window.navigator.appVersion.split("MSIE ")[1])<=9&&t.addEventListener("selectionchange",function(t){document.activeElement&&o({target:document.activeElement})},!0);var e=document.createElement("input");if(e.type="number",e.value="7",e.valueAsNumber!=e.valueAsNumber){var n=r;r=function(t){return"number"===t.type?i(t)?parseFloat(t.value):t.value:n.apply(this,arguments)}}},e.inputSupportsSelection=n;var r=function(t){return i(t)?t.valueAsNumber:t.value};function o(t){var e=t.target;"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName||c(t,e)}function s(t){var e=t.target;"INPUT"===e.tagName?(a(e,"checked"),c(t,e)):"SELECT"===e.tagName?function t(e){for(var n=e.firstChild;n;n=n.nextSibling)"OPTION"===n.tagName?a(n,"selected"):n.hasChildNodes()&&t(n)}(e):"TEXTAREA"===e.tagName&&c(t,e)}function a(t,e){var n=t.$bindAttributes&&t.$bindAttributes[e];if(n&&!n.isUnbound()){var i=t[e];n.template.expression.set(n.context,i)}}function c(t,e){var i=e.$bindAttributes&&e.$bindAttributes.value;if(i&&!i.isUnbound())if(n(e)){var o={$event:t};!function(t,e,n){var i=t.template.expression,r=i.pathSegments(t.context);if(r){var o=t.context.controller.model.pass(n);_$textDiff_22.onTextInput(o,r,e)}else i.set&&i.set(t.context,e)}(i,e.value,o)}else{var s=r(e);i.template.expression.set(i.context,s)}}}),_$templates_11=createModuleFactory(function(t,e){var n=_$serializeObject_66({}),i=_$options_10({}).DependencyOptions,r=_$util_12.concat,o=_$util_12.hasKeys,s=_$util_12.traverseAndCreate;function a(t,e,n,i){for(var r=0;r<e.length;r++)t=c(t,e[r],n,i);return t}function c(t,e,n,i){var o=l(e,n,i);return r(t,o)}function l(t,e,n){return t.dependencies(e,n)}!function(){for(var t in _$saddle_65)e[t]=_$saddle_65[t]}(),e.Marker=u,e.View=d,e.ViewInstance=m,e.DynamicViewInstance=_,e.ViewParent=v,e.ContextClosure=y,e.Views=b,e.MarkupHook=w,e.ElementOn=E,e.ComponentOn=x,e.AsProperty=C,e.AsObject=T,e.AsObjectComponent=S,e.AsArray=D,e.AsArrayComponent=$,e.emptyTemplate=new _$saddle_65.Template([]),_$saddle_65.Template.prototype.isUnbound=function(t){return t.unbound},_$saddle_65.Binding.prototype.isUnbound=function(){return this.template.expression.isUnbound(this.context)},_$saddle_65.Template.prototype.resolve=function(){},_$saddle_65.Template.prototype.dependencies=function(t,e){if(!i.shouldIgnoreTemplate(this,e))return a(null,this.content,t,e)},_$saddle_65.Doctype.prototype.dependencies=function(){},_$saddle_65.Text.prototype.dependencies=function(){},_$saddle_65.DynamicText.prototype.dependencies=function(t,e){if(!i.shouldIgnoreTemplate(this,e))return l(this.expression,t,e)},_$saddle_65.Comment.prototype.dependencies=function(){},_$saddle_65.DynamicComment.prototype.dependencies=function(t,e){if(!i.shouldIgnoreTemplate(this,e))return l(this.expression,t,e)},_$saddle_65.Html.prototype.dependencies=function(){},_$saddle_65.DynamicHtml.prototype.dependencies=function(t,e){if(!i.shouldIgnoreTemplate(this,e))return l(this.expression,t,e)},_$saddle_65.Element.prototype.dependencies=function(t,e){if(!i.shouldIgnoreTemplate(this,e)){var n=function(t,e,n,i){for(var r in e)t=c(t,e[r],n,i);return t}(null,this.attributes,t,e);return this.content?a(n,this.content,t,e):n}},_$saddle_65.DynamicElement.prototype.dependencies=function(t,e){if(!i.shouldIgnoreTemplate(this,e))return c(_$saddle_65.Element.prototype.dependencies(t,e),this.tagName,t,e)},_$saddle_65.Block.prototype.dependencies=function(t,e){if(!i.shouldIgnoreTemplate(this,e)){var n=this.expression.meta&&"on"===this.expression.meta.blockType?l(this.expression,t,e):null,r=t.child(this.expression);return a(n,this.content,r,e)}},_$saddle_65.ConditionalBlock.prototype.dependencies=function(t,e){if(!i.shouldIgnoreTemplate(this,e)){var n=this.getCondition(t);if(null==n)return l(this.expressions[0],t,e);var r=function(t,e,n,i,r){for(var o=0;o<=r;o++)t=c(t,e[o],n,i);return t}(null,this.expressions,t,e,n),o=this.expressions[n];return a(r,this.contents[n],t.child(o),e)}},_$saddle_65.EachBlock.prototype.dependencies=function(t,e){if(!i.shouldIgnoreTemplate(this,e)){var n=l(this.expression,t,e),r=this.expression.get(t);if(r&&r.length)for(var o=0;o<r.length;o++){var s=t.eachChild(this.expression,o);n=a(n,this.content,s,e)}else this.elseContent&&(n=a(n,this.elseContent,t,e));return n}},_$saddle_65.Attribute.prototype.dependencies=function(){},_$saddle_65.DynamicAttribute.prototype.dependencies=function(t,e){if(!i.shouldIgnoreTemplate(this,e))return l(this.expression,t,e)};var h=[{emit:function(t,e){e.$component=t.controller,t.controller.markerNode=e}}];function u(t){_$saddle_65.Comment.call(this,t,h)}function p(t){for(var e=t.split(/\s+/),n=0,i=e.length;n<i;n++)this[e[n]]=!0}function f(t){for(var e=t.split(/\s+/),n=0,i=e.length;n<i;n++){var r=e[n].split("/");this[r[0]]=r[1]||r[0]}}function d(t,e,n,i){this.views=t,this.name=e,this.source=n,this.options=i;var r=(this.name||"").split(":"),o=r.pop();this.namespace=r.join(":"),this.registeredName="index"===o?this.namespace:this.name,this.attributesMap=i&&i.attributes&&new p(i.attributes),this.arraysMap=i&&i.arrays&&new f(i.arrays),this.unminified=i&&(i.unminified||""===i.unminified),this.string=i&&(i.string||""===i.string),this.literal=i&&(i.literal||""===i.literal),this.template=null,this.componentFactory=null,this.fromSerialized=!1}function m(t,e,n,i){this.name=t,this.attributes=e,this.hooks=n,this.initHooks=i,this.view=null}function _(t,e,n,i){this.nameExpression=t,this.attributes=e,this.hooks=n,this.initHooks=i}function v(t){this.template=t}function y(t,e){this.template=t,this.context=e}function g(){}function b(){this.nameMap=new g,this.tagMap=new g,this.elementMap=this.tagMap}function w(){}function E(t,e){this.name=t,this.expression=e}function x(t,e){this.name=t,this.expression=e}function C(t){this.segments=t,this.lastSegment=t.pop()}function T(t,e){C.call(this,t),this.keyExpression=e}function S(t,e){T.call(this,t,e)}function D(t){C.call(this,t)}function $(t){D.call(this,t)}u.prototype=Object.create(_$saddle_65.Comment.prototype),u.prototype.constructor=u,u.prototype.type="Marker",u.prototype.serialize=function(){return n.instance(this,this.data)},u.prototype.get=function(){return""},d.prototype=Object.create(_$saddle_65.Template.prototype),d.prototype.constructor=d,d.prototype.type="View",d.prototype.serialize=function(){return null},d.prototype._isComponent=function(t){return!!this.componentFactory&&(!t.attributes||!t.attributes.extend)},d.prototype._initComponent=function(t){return this._isComponent(t)?this.componentFactory.init(t):t},d.prototype._queueCreate=function(t,e){if(this._isComponent(t)){var n=this.componentFactory;if(t.queue(function(){n.create(e)}),!t.hooks)return;t.queue(function(){for(var n=0,i=t.hooks.length;n<i;n++)t.hooks[n].emit(t,e.controller)})}},d.prototype.get=function(t,e){var n=this._initComponent(t);return(this.template||this.parse()).get(n,e)},d.prototype.getFragment=function(t,e){var n=this._initComponent(t),i=(this.template||this.parse()).getFragment(n,e);return this._queueCreate(t,n),i},d.prototype.appendTo=function(t,e){var n=this._initComponent(e);(this.template||this.parse()).appendTo(t,n),this._queueCreate(e,n)},d.prototype.attachTo=function(t,e,n){var i=this._initComponent(n);e=(this.template||this.parse()).attachTo(t,e,i);return this._queueCreate(n,i),e},d.prototype.dependencies=function(t,e){if(!i.shouldIgnoreTemplate(this,e)){var n=this.template||this.parse(),r=this._isComponent(t)?t.componentChild(null):t;return n.dependencies(r,e)}},d.prototype.parse=function(){if(this._parse(),this.componentFactory){var t=new u(this.name);this.template.content.unshift(t)}return this.template},d.prototype._parse=function(){throw new Error("View parsing not available")},m.prototype=Object.create(_$saddle_65.Template.prototype),m.prototype.constructor=m,m.prototype.type="ViewInstance",m.prototype.serialize=function(){return n.instance(this,this.name,this.attributes,this.hooks,this.initHooks)},m.prototype.get=function(t,e){var n=this._find(t),i=t.viewChild(n,this.attributes,this.hooks,this.initHooks);return n.get(i,e)},m.prototype.getFragment=function(t,e){var n=this._find(t),i=t.viewChild(n,this.attributes,this.hooks,this.initHooks);return n.getFragment(i,e)},m.prototype.appendTo=function(t,e){var n=this._find(e),i=e.viewChild(n,this.attributes,this.hooks,this.initHooks);n.appendTo(t,i)},m.prototype.attachTo=function(t,e,n){var i=this._find(n),r=n.viewChild(i,this.attributes,this.hooks,this.initHooks);return i.attachTo(t,e,r)},m.prototype.dependencies=function(t,e){if(!i.shouldIgnoreTemplate(this,e)){var n=this._find(t),r=t.viewChild(n,this.attributes,this.hooks,this.initHooks);return n.dependencies(r,e)}},m.prototype._find=function(t){if(this.view)return this.view;var e=t.getView(),n=e&&e.namespace;if(this.view=t.meta.views.find(this.name,n),!this.view){var i=t.meta.views.findErrorMessage(this.name,e);throw new Error(i)}return this.view},_.prototype=Object.create(m.prototype),_.prototype.constructor=_,_.prototype.type="DynamicViewInstance",_.prototype.serialize=function(){return n.instance(this,this.nameExpression,this.attributes,this.hooks,this.initHooks)},_.prototype._find=function(t){var n=this.nameExpression.get(t),i=t.getView(),r=i&&i.namespace;return n&&t.meta.views.find(n,r)||e.emptyTemplate},_.prototype.dependencies=function(t,e){if(!i.shouldIgnoreTemplate(this,e)){var n=this.nameExpression.dependencies(t),o=m.prototype.dependencies.call(this,t,e);return r(n,o)}},v.prototype=Object.create(_$saddle_65.Template.prototype),v.prototype.constructor=v,v.prototype.type="ViewParent",v.prototype.serialize=function(){return n.instance(this,this.template)},v.prototype.get=function(t,e){var n=t.forViewParent();return this.template.get(n,e)},v.prototype.getFragment=function(t,e){var n=t.forViewParent();return this.template.getFragment(n,e)},v.prototype.appendTo=function(t,e){var n=e.forViewParent();this.template.appendTo(t,n)},v.prototype.attachTo=function(t,e,n){var i=n.forViewParent();return this.template.attachTo(t,e,i)},v.prototype.dependencies=function(t,e){if(!i.shouldIgnoreTemplate(this,e)){var n=t.forViewParent();return this.template.dependencies(n,e)}},y.prototype=Object.create(_$saddle_65.Template.prototype),y.prototype.constructor=y,y.prototype.serialize=function(){throw new Error("ContextClosure cannot be serialized")},y.prototype.get=function(t,e){var n=t.closureChild(this.context);return this.template.get(n,e)},y.prototype.getFragment=function(t,e){var n=t.closureChild(this.context);return this.template.getFragment(n,e)},y.prototype.appendTo=function(t,e){var n=e.closureChild(this.context);this.template.appendTo(t,n)},y.prototype.attachTo=function(t,e,n){var i=n.closureChild(this.context);return this.template.attachTo(t,e,i)},y.prototype.dependencies=function(t,e){if(!i.shouldIgnoreTemplate(this.template,e)){var n=t.closureChild(this.context);return this.template.dependencies(n,e)}},y.prototype.equals=function(t){return t instanceof y&&this.context===t.context&&this.template.equals(t.template)},b.prototype.find=function(t,e){var n=this.nameMap;if(s=n[e?e+":"+t:t])return s;var i=t.split(":"),r=i.length;for(e&&(i=e.split(":").concat(i));r>0;){for(var o=i.slice();o.length>r;){var s;if(o.splice(-1-r,1),s=n[o.join(":")])return s}r--}},b.prototype.register=function(t,e,n){var i=t.replace(/:index$/,""),r=this.nameMap[i];if(r){var o=r.componentFactory;d.call(r,this,t,e,n),r.componentFactory=o}else r=new d(this,t,e,n);this.nameMap[i]=r;var s=n&&(n.tag||n.element);return s&&(this.tagMap[s]=r),r},b.prototype.deserialize=function(t){for(var e=0;e<t.length;e++){var n=t[e],i=n[0],r=n[1],o=n[2],s=n[3],a=this.register(r,o,s);a.parse=i,a.fromSerialized=!0}},b.prototype.serialize=function(t){var i=t&&t.server,r=t&&t.minify,s=[];for(var a in this.nameMap){var c=this.nameMap[a],l=c.template||c.parse();if(!i&&c.options){if(c.options.serverOnly)continue;c.options.server&&(l=e.emptyTemplate)}s.push("[function(){return this.template="+l.serialize()+"},"+n.args([c.name,r?null:c.source,o(c.options)?c.options:null])+"]")}return"function(derbyTemplates, views){var expressions = derbyTemplates.expressions,templates = derbyTemplates.templates;views.deserialize(["+s.join(",")+"])}"},b.prototype.findErrorMessage=function(t,e){var n=Object.keys(this.nameMap),i='Cannot find view "'+t+'" in'+[""].concat(n).join("\n  ")+"\n";return e&&(i+='\nWithin template "'+e.name+'":\n'+e.source),i},w.prototype.module=_$saddle_65.Template.prototype.module,E.prototype=Object.create(w.prototype),E.prototype.constructor=E,E.prototype.type="ElementOn",E.prototype.serialize=function(){return n.instance(this,this.name,this.expression)},E.prototype.emit=function(t,e){var n=this;if("create"===this.name)this.apply(t,e);else if("destroy"===this.name){(e.$destroyListeners||(e.$destroyListeners=[])).push(function(){n.apply(t,e)})}else e.addEventListener(this.name,function(i){return n.apply(t,e,i)},!1)},E.prototype.apply=function(t,e,n){var i=t.controller.model.data;i.$event=n,i.$element=e;var r=this.expression.apply(t);return delete i.$event,delete i.$element,r},x.prototype=Object.create(w.prototype),x.prototype.constructor=x,x.prototype.type="ComponentOn",x.prototype.serialize=function(){return n.instance(this,this.name,this.expression)},x.prototype.emit=function(t,e){var n=this.expression;e.on(this.name,function(){var e=arguments.length&&Array.prototype.slice.call(arguments);return n.apply(t,e)})},C.prototype=Object.create(w.prototype),C.prototype.constructor=C,C.prototype.type="AsProperty",C.prototype.serialize=function(){var t=this.segments.concat(this.lastSegment);return n.instance(this,t)},C.prototype.emit=function(t,e){s(t.controller,this.segments)[this.lastSegment]=e},T.prototype=Object.create(C.prototype),T.prototype.constructor=T,T.prototype.type="AsObject",T.prototype.serialize=function(){var t=this.segments.concat(this.lastSegment);return n.instance(this,t,this.keyExpression)},T.prototype.emit=function(t,e){var n=s(t.controller,this.segments),i=n[this.lastSegment]||(n[this.lastSegment]={}),r=this.keyExpression.get(t);i[r]=e,this.addListeners(e,i,r)},T.prototype.addListeners=function(t,e,n){this.addDestroyListener(t,function(){delete e[n]})},T.prototype.addDestroyListener=function(t,e){(t.$destroyListeners||(t.$destroyListeners=[])).push(e)},S.prototype=Object.create(T.prototype),S.prototype.constructor=S,S.prototype.type="AsObjectComponent",S.prototype.addDestroyListener=function(t,e){t.on("destroy",e)},D.prototype=Object.create(C.prototype),D.prototype.constructor=D,D.prototype.type="AsArray",D.prototype.emit=function(t,e){for(var n=s(t.controller,this.segments),i=n[this.lastSegment]||(n[this.lastSegment]=[]),r=i.length;r--;){var o=i[r];if(o===e)return;if(4&this.comparePosition(e,o))return i.splice(r+1,0,e),void this.addListeners(e,i)}i.unshift(e),this.addListeners(e,i)},D.prototype.addListeners=function(t,e){this.addDestroyListener(t,function(){var n=e.indexOf(t);-1!==n&&e.splice(n,1)})},D.prototype.comparePosition=function(t,e){return e.compareDocumentPosition(t)},D.prototype.addDestroyListener=T.prototype.addDestroyListener,$.prototype=Object.create(D.prototype),$.prototype.constructor=$,$.prototype.type="AsArrayComponent",$.prototype.comparePosition=function(t,e){return e.markerNode.compareDocumentPosition(t.markerNode)},$.prototype.addDestroyListener=S.prototype.addDestroyListener}),_$options_10=createModuleFactory(function(t,e){var n=_$templates_11({});function i(t){this.setIgnoreTemplate(t&&t.ignoreTemplate)}e.DependencyOptions=i,i.shouldIgnoreTemplate=function(t,e){return!!e&&e.ignoreTemplate===t},i.prototype.setIgnoreTemplate=function(t){for(;t instanceof n.ContextClosure;)t=t.template;this.ignoreTemplate=t}}),_$serializeObject_66=createModuleFactory(function(t,e){function n(t){for(var e=[],n=t.length;n--;){var r=i(t[n]);e.unshift(r)}for(n=e.length;n--;){if("void 0"!==(r=e[n])&&"null"!==r)break;e.pop()}return e.join(", ")}function i(t){if(t&&t.serialize)return t.serialize();if(void 0===t)return"void 0";if(null===t)return"null";if("string"==typeof t)return r(t);if("number"==typeof t||"boolean"==typeof t)return t+"";if(Array.isArray(t)){for(var e=[],n=0;n<t.length;n++){var o=i(t[n]);e.push(o)}return"["+e.join(", ")+"]"}if("object"==typeof t){e=[];for(var s in t){o=i(t[s]);e.push(r(s)+": "+o)}return"{"+e.join(", ")+"}"}}function r(t){return"'"+t.replace(/['\r\n\\]/g,function(t){return"'"===t?"\\'":"\r"===t?"\\r":"\n"===t?"\\n":"\\"===t?"\\\\":""})+"'"}e.instance=function(t){var e=Array.prototype.slice.call(arguments,1);return"new "+t.module+"."+t.type+"("+n(e)+")"},e.args=n}),objectCreate=Object.create||objectCreatePolyfill,objectKeys=Object.keys||objectKeysPolyfill,bind=Function.prototype.bind||functionBindPolyfill;function EventEmitter(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=objectCreate(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}var _$EventEmitter_23=EventEmitter;EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0;var defaultMaxListeners=10,hasDefineProperty;try{var o={};Object.defineProperty&&Object.defineProperty(o,"x",{value:0}),hasDefineProperty=0===o.x}catch(t){hasDefineProperty=!1}function $getMaxListeners(t){return void 0===t._maxListeners?EventEmitter.defaultMaxListeners:t._maxListeners}function emitNone(t,e,n){if(e)t.call(n);else for(var i=t.length,r=arrayClone(t,i),o=0;o<i;++o)r[o].call(n)}function emitOne(t,e,n,i){if(e)t.call(n,i);else for(var r=t.length,o=arrayClone(t,r),s=0;s<r;++s)o[s].call(n,i)}function emitTwo(t,e,n,i,r){if(e)t.call(n,i,r);else for(var o=t.length,s=arrayClone(t,o),a=0;a<o;++a)s[a].call(n,i,r)}function emitThree(t,e,n,i,r,o){if(e)t.call(n,i,r,o);else for(var s=t.length,a=arrayClone(t,s),c=0;c<s;++c)a[c].call(n,i,r,o)}function emitMany(t,e,n,i){if(e)t.apply(n,i);else for(var r=t.length,o=arrayClone(t,r),s=0;s<r;++s)o[s].apply(n,i)}function _addListener(t,e,n,i){var r,o,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=t._events)?(o.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),s=o[e]):(o=t._events=objectCreate(null),t._eventsCount=0),s){if("function"==typeof s?s=o[e]=i?[n,s]:[s,n]:i?s.unshift(n):s.push(n),!s.warned&&(r=$getMaxListeners(t))&&r>0&&s.length>r){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+' "'+String(e)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=s.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",a.name,a.message)}}else s=o[e]=n,++t._eventsCount;return t}function onceWrapper(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var t=new Array(arguments.length),e=0;e<t.length;++e)t[e]=arguments[e];this.listener.apply(this.target,t)}}function _onceWrap(t,e,n){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},r=bind.call(onceWrapper,i);return r.listener=n,i.wrapFn=r,r}function _listeners(t,e,n){var i=t._events;if(!i)return[];var r=i[e];return r?"function"==typeof r?n?[r.listener||r]:[r]:n?unwrapListeners(r):arrayClone(r,r.length):[]}function listenerCount(t){var e=this._events;if(e){var n=e[t];if("function"==typeof n)return 1;if(n)return n.length}return 0}function spliceOne(t,e){for(var n=e,i=n+1,r=t.length;i<r;n+=1,i+=1)t[n]=t[i];t.pop()}function arrayClone(t,e){for(var n=new Array(e),i=0;i<e;++i)n[i]=t[i];return n}function unwrapListeners(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function objectCreatePolyfill(t){var e=function(){};return e.prototype=t,new e}function objectKeysPolyfill(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return n}function functionBindPolyfill(t){var e=this;return function(){return e.apply(t,arguments)}}hasDefineProperty?Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(t){if("number"!=typeof t||t<0||t!=t)throw new TypeError('"defaultMaxListeners" must be a positive number');defaultMaxListeners=t}}):EventEmitter.defaultMaxListeners=defaultMaxListeners,EventEmitter.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},EventEmitter.prototype.getMaxListeners=function(){return $getMaxListeners(this)},EventEmitter.prototype.emit=function(t){var e,n,i,r,o,s,a="error"===t;if(s=this._events)a=a&&null==s.error;else if(!a)return!1;if(a){if(arguments.length>1&&(e=arguments[1]),e instanceof Error)throw e;var c=new Error('Unhandled "error" event. ('+e+")");throw c.context=e,c}if(!(n=s[t]))return!1;var l="function"==typeof n;switch(i=arguments.length){case 1:emitNone(n,l,this);break;case 2:emitOne(n,l,this,arguments[1]);break;case 3:emitTwo(n,l,this,arguments[1],arguments[2]);break;case 4:emitThree(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(i-1),o=1;o<i;o++)r[o-1]=arguments[o];emitMany(n,l,this,r)}return!0},EventEmitter.prototype.addListener=function(t,e){return _addListener(this,t,e,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function(t,e){return _addListener(this,t,e,!0)},EventEmitter.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,_onceWrap(this,t,e)),this},EventEmitter.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,_onceWrap(this,t,e)),this},EventEmitter.prototype.removeListener=function(t,e){var n,i,r,o,s;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(n=i[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=objectCreate(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===e||n[o].listener===e){s=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():spliceOne(n,r),1===n.length&&(i[t]=n[0]),i.removeListener&&this.emit("removeListener",t,s||e)}return this},EventEmitter.prototype.removeAllListeners=function(t){var e,n,i;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=objectCreate(null),this._eventsCount=0):n[t]&&(0==--this._eventsCount?this._events=objectCreate(null):delete n[t]),this;if(0===arguments.length){var r,o=objectKeys(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=objectCreate(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(e)for(i=e.length-1;i>=0;i--)this.removeListener(t,e[i]);return this},EventEmitter.prototype.listeners=function(t){return _listeners(this,t,!0)},EventEmitter.prototype.rawListeners=function(t){return _listeners(this,t,!1)},EventEmitter.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):listenerCount.call(t,e)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var _$rng_88={};(function(t){var e,n=t.crypto||t.msCrypto;if(n&&n.getRandomValues){var i=new Uint8Array(16);e=function(){return n.getRandomValues(i),i}}if(!e){var r=new Array(16);e=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),r[e]=t>>>((3&e)<<3)&255;return r}}_$rng_88=e}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});for(var _byteToHex=[],_hexToByte={},i=0;i<256;i++)_byteToHex[i]=(i+256).toString(16).substr(1),_hexToByte[_byteToHex[i]]=i;function parse(t,e,n){var i=e&&n||0,r=0;for(e=e||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,function(t){r<16&&(e[i+r++]=_hexToByte[t])});r<16;)e[i+r++]=0;return e}function unparse(t,e){var n=e||0,i=_byteToHex;return i[t[n++]]+i[t[n++]]+i[t[n++]]+i[t[n++]]+"-"+i[t[n++]]+i[t[n++]]+"-"+i[t[n++]]+i[t[n++]]+"-"+i[t[n++]]+i[t[n++]]+"-"+i[t[n++]]+i[t[n++]]+i[t[n++]]+i[t[n++]]+i[t[n++]]+i[t[n++]]}var _seedBytes=_$rng_88(),_nodeId=[1|_seedBytes[0],_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]],_clockseq=16383&(_seedBytes[6]<<8|_seedBytes[7]),_lastMSecs=0,_lastNSecs=0;function v1(t,e,n){var i=e&&n||0,r=e||[],o=void 0!==(t=t||{}).clockseq?t.clockseq:_clockseq,s=void 0!==t.msecs?t.msecs:(new Date).getTime(),a=void 0!==t.nsecs?t.nsecs:_lastNSecs+1,c=s-_lastMSecs+(a-_lastNSecs)/1e4;if(c<0&&void 0===t.clockseq&&(o=o+1&16383),(c<0||s>_lastMSecs)&&void 0===t.nsecs&&(a=0),a>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_lastMSecs=s,_lastNSecs=a,_clockseq=o;var l=(1e4*(268435455&(s+=122192928e5))+a)%4294967296;r[i++]=l>>>24&255,r[i++]=l>>>16&255,r[i++]=l>>>8&255,r[i++]=255&l;var h=s/4294967296*1e4&268435455;r[i++]=h>>>8&255,r[i++]=255&h,r[i++]=h>>>24&15|16,r[i++]=h>>>16&255,r[i++]=o>>>8|128,r[i++]=255&o;for(var u=t.node||_nodeId,p=0;p<6;p++)r[i+p]=u[p];return e||unparse(r)}function v4(t,e,n){var i=e&&n||0;"string"==typeof t&&(e="binary"==t?new Array(16):null,t=null);var r=(t=t||{}).random||(t.rng||_$rng_88)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e)for(var o=0;o<16;o++)e[i+o]=r[o];return e||unparse(r)}var uuid=v4;uuid.v1=v1,uuid.v4=v4,uuid.parse=parse,uuid.unparse=unparse;var _$uuid_89=uuid;Model.INITS=[];var _$Model_45=Model;function Model(t){this.root=this;var e=Model.INITS;t||(t={}),this.debug=t.debug||{};for(var n=0;n<e.length;n++)e[n](this,t)}function ChildModel(t){this.root=t.root,this._events=t._events,this._maxListeners=t._maxListeners,this._context=t._context,this._at=t._at,this._pass=t._pass,this._silent=t._silent,this._eventContext=t._eventContext,this._preventCompose=t._preventCompose}Model.prototype.id=function(){return _$uuid_89.v4()},Model.prototype._child=function(){return new ChildModel(this)},Model.ChildModel=ChildModel,ChildModel.prototype=new Model;var isArray=Array.isArray,keyList=Object.keys,hasProp=Object.prototype.hasOwnProperty,_$equal_24=function t(e,n){if(e===n)return!0;if(e&&n&&"object"==typeof e&&"object"==typeof n){var i,r,o,s=isArray(e),a=isArray(n);if(s&&a){if((r=e.length)!=n.length)return!1;for(i=r;0!=i--;)if(!t(e[i],n[i]))return!1;return!0}if(s!=a)return!1;var c=e instanceof Date,l=n instanceof Date;if(c!=l)return!1;if(c&&l)return e.getTime()==n.getTime();var h=e instanceof RegExp,u=n instanceof RegExp;if(h!=u)return!1;if(h&&u)return e.toString()==n.toString();var p=keyList(e);if((r=p.length)!==keyList(n).length)return!1;for(i=r;0!=i--;)if(!hasProp.call(n,p[i]))return!1;for(i=r;0!=i--;)if(!t(e[o=p[i]],n[o]))return!1;return!0}return e!=e&&n!=n},_$browser_30={},process=_$browser_30={},cachedSetTimeout,cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(t){if(cachedSetTimeout===setTimeout)return setTimeout(t,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(t,0);try{return cachedSetTimeout(t,0)}catch(e){try{return cachedSetTimeout.call(null,t,0)}catch(e){return cachedSetTimeout.call(this,t,0)}}}function runClearTimeout(t){if(cachedClearTimeout===clearTimeout)return clearTimeout(t);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(t);try{return cachedClearTimeout(t)}catch(e){try{return cachedClearTimeout.call(null,t)}catch(e){return cachedClearTimeout.call(this,t)}}}!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(t){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(t){cachedClearTimeout=defaultClearTimeout}}();var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var t=runTimeout(cleanUpNextTick);draining=!0;for(var e=queue.length;e;){for(currentQueue=queue,queue=[];++queueIndex<e;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,e=queue.length}currentQueue=null,draining=!1,runClearTimeout(t)}}function Item(t,e){this.fun=t,this.array=e}function noop(){}process.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];queue.push(new Item(t,e)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(t){return[]},process.binding=function(t){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(t){throw new Error("process.chdir is not supported")},process.umask=function(){return 0};var _$util_64={};(function(t){var e="browser"!==t.title;function n(t){this.cb=t,this.isDone=!1,this.count=0}function i(t){var e=new t.constructor;for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function r(t){return t!=t}function o(t){return/^[0-9]+$/.test(t)}function s(t,e){for(var n=Math.min(t.length,e.length),i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}_$util_64.isServer=e,_$util_64.asyncGroup=function(t){var e=new n(t);return function(){return e.add()}},_$util_64.castSegments=function(t){for(var e=t.length;e--;){var n=t[e];"string"==typeof n&&o(n)&&(t[e]=+n)}return t},_$util_64.contains=function(t,e){for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0},_$util_64.copy=function(t){if(t instanceof Date)return new Date(t);if("object"==typeof t)return null===t?null:Array.isArray(t)?t.slice():i(t);return t},_$util_64.copyObject=i,_$util_64.deepCopy=function t(e){if(e instanceof Date)return new Date(e);if("object"==typeof e){if(null===e)return null;if(Array.isArray(e)){for(var n=[],i=e.length;i--;)n[i]=t(e[i]);return n}var r=new e.constructor;for(var o in e)e.hasOwnProperty(o)&&(r[o]=t(e[o]));return r}return e},_$util_64.deepEqual=_$equal_24,_$util_64.equal=function(t,e){return t===e||r(t)&&r(e)},_$util_64.equalsNaN=r,_$util_64.isArrayIndex=o,_$util_64.lookup=function(t,e){if(!t)return e;for(var n=0,i=t.length;n<i;n++){if(null==e)return e;e=e[t[n]]}return e},_$util_64.mergeInto=function(t,e){for(var n in e)t[n]=e[n];return t},_$util_64.mayImpact=s,_$util_64.mayImpactAny=function(t,e){for(var n=0,i=t.length;n<i;n++)if(s(t[n],e))return!0;return!1},_$util_64.serverRequire=function(t,n){if(!e)return;return t.require(n)},_$util_64.serverUse=function(t,n,i){if(!e)return this;var r=t.require(n);return this.use(r,i)},_$util_64.use=function(t,e){var n=this._plugins||(this._plugins=[]);-1===n.indexOf(t)&&(n.push(t),t(this,e));return this},n.prototype.add=function(){this.count++;var t=this;return function(e){if(t.count--,!t.isDone)return e?(t.isDone=!0,void t.cb(e)):void(t.count>0||(t.isDone=!0,t.cb()))}}}).call(this,_$browser_30);var _$unbundle_62={};_$Model_45.prototype.unbundle=function(t){for(var e in this.connection&&this.connection.startBulk(),this._initQueries(t.queries),t.collections){var n=t.collections[e];for(var i in n)this.getOrCreateDoc(e,i,n[i])}for(var r in t.contexts){var o=t.contexts[r],s=this.context(r);for(var e in o.fetchedDocs){n=o.fetchedDocs[e];for(var i in n)for(var a=n[i];a--;)s._context.fetchDoc(e,i),this._fetchedDocs.increment(e,i)}for(var e in o.subscribedDocs){n=o.subscribedDocs[e];for(var i in n)for(a=n[i];a--;)s.subscribeDoc(e,i)}for(var e in o.createdDocs){n=o.createdDocs[e];for(var i in n)s._context.createDoc(e,i)}}this.connection&&this.connection.endBulk();for(var c=0;c<t.refs.length;c++){var l=t.refs[c];this.ref(l[0],l[1])}for(c=0;c<t.refLists.length;c++){l=t.refLists[c];this.refList(l[0],l[1],l[2],l[3])}for(c=0;c<t.fns.length;c++){l=t.fns[c];this.start.apply(this,l)}for(c=0;c<t.filters.length;c++){l=t.filters[c];this._filters.add(l[1],l[2],l[3],l[4],l[5]).ref(l[0])}};var _$events_52={},__EventEmitter_52=_$EventEmitter_23.EventEmitter;function patternContained(t,e,n){var i=n.patternSegments;if(!i)return!1;if(t===n.pattern||"**"===t)return!0;var r=e.length;if(r>i.length)return!1;for(var o=0;o<r;o++)if(e[o]!==i[o])return!1;return!0}function Passed(t,e){for(var n in t)this[n]=t[n];for(var n in e)this[n]=e[n]}function eventListener(t,e,n,i,r){var o,s,a;if(r?(o=n,s=i,a=r):i?(a=i,t.isPath(n)?o=n:s=n):a=n,s&&s.useEventObjects)var c=!0;if(o){var l=t.path(o);return c?modelEventListener(e,l,a,t._eventContext):modelEventListenerLegacy(l,a,t._eventContext)}var h=t.path();return h?c?modelEventListener(e,h,a,t._eventContext):modelEventListenerLegacy(h,a,t._eventContext):a}function modelEventListenerLegacy(t,e,n){var i=_$util_64.castSegments(t.split(".")),r=testPatternFn(t,i);function o(t,n){var i=r(t);if(i){var o=i.length?i.concat(n):n;return e.apply(null,o),!0}}return o.pattern=t,o.patternSegments=i,o.eventContext=n,o}function modelEventListener(t,e,n,i){var r=_$util_64.castSegments(e.split(".")),o=testPatternFn(e,r),s=getEventFactory(t);function a(t,e){var i=o(t);if(i){var r=s(e);return n(r,i),!0}}return a.pattern=e,a.patternSegments=r,a.eventContext=i,a}function getEventFactory(t){switch(t){case"change":return function(t){return new ChangeEvent(t)};case"insert":return function(t){return new InsertEvent(t)};case"remove":return function(t){return new RemoveEvent(t)};case"move":return function(t){return new MoveEvent(t)};case"load":return function(t){return new LoadEvent(t)};case"unload":return function(t){return new UnloadEvent(t)};case"all":return function(t){return getEventFactory(t[0])(t.slice(1))};default:throw new Error("Unknown event: "+t)}}function ChangeEvent(t){this.value=t[0],this.previous=t[1],this.passed=t[2]}function InsertEvent(t){this.index=t[0],this.values=t[1],this.passed=t[2]}function RemoveEvent(t){this.index=t[0],this.removed=t[1],this.passed=t[2]}function MoveEvent(t){this.from=t[0],this.to=t[1],this.howMany=t[2],this.passed=t[3]}function LoadEvent(t){this.document=t[0],this.passed=t[1]}function UnloadEvent(t){this.previousDocument=t[0],this.passed=t[1]}function testPatternFn(t,e){if("**"===t)return function(t){return[t.join(".")]};var n=stripRestWildcard(e);return function(t){var i=e.length;if(!(i>t.length)&&(i===t.length||n)){for(var r=[],o=0;o<i;o++){var s=e[o],a=t[o];if("*"!==s&&"**"!==s){if(s!==a)return}else r.push(a)}if(n){var c=t.slice(o).join(".");r.push(c)}return r}}}function stripRestWildcard(t){var e=t.length-1,n=t[e];if("**"===n)return t.pop(),!0;if("string"!=typeof n)return!1;var i=/^([^\*]+)\*\*$/.exec(n);return!!i&&(t[e]=i[1],!0)}_$Model_45.MUTATOR_EVENTS={change:!0,insert:!0,remove:!0,move:!0,load:!0,unload:!0},_$Model_45.INITS.push(function(t){__EventEmitter_52.call(this),t.setMaxListeners(0),t.root._defaultCallback=function(e){e&&t._emitError(e)},t.root._mutatorEventQueue=null,t.root._pass=new Passed({},{}),t.root._silent=null,t.root._eventContext=null}),_$util_64.mergeInto(_$Model_45.prototype,__EventEmitter_52.prototype),_$Model_45.prototype.wrapCallback=function(t){if(!t)return this.root._defaultCallback;var e=this;return function(){try{return t.apply(this,arguments)}catch(t){e._emitError(t)}}},_$Model_45.prototype._emitError=function(t,e){var n=t.message?t.message:"string"==typeof t?t:"Unknown model error";if(e&&(n+=" "+e),t.data)try{n+=" "+JSON.stringify(t.data)}catch(t){}t instanceof Error?t.message=n:t=new Error(n),this.emit("error",t)},_$Model_45.prototype._emit=__EventEmitter_52.prototype.emit,_$Model_45.prototype.emit=function(t){if("error"===t)return this._emit.apply(this,arguments);if(_$Model_45.MUTATOR_EVENTS[t]){if(this._silent)return this;var e=arguments[1],n=arguments[2];if(this._emit(t+"Immediate",e,n),this.root._mutatorEventQueue)return this.root._mutatorEventQueue.push([t,e,n]),this;for(this.root._mutatorEventQueue=[],this._emit(t,e,n),this._emit("all",e,[t].concat(n));this.root._mutatorEventQueue.length;){var i=this.root._mutatorEventQueue.shift();t=i[0],e=i[1],n=i[2],this._emit(t,e,n),this._emit("all",e,[t].concat(n))}return this.root._mutatorEventQueue=null,this}return this._emit.apply(this,arguments)},_$Model_45.prototype._on=__EventEmitter_52.prototype.on,_$Model_45.prototype.addListener=_$Model_45.prototype.on=function(t,e,n,i){var r=eventListener(this,t,e,n,i);return this._on(t,r),r},_$Model_45.prototype.once=function(t,e,n,i){var r=eventListener(this,t,e,n,i);function o(){r.apply(null,arguments)&&this.removeListener(t,o)}return this._on(t,o),o},_$Model_45.prototype._removeAllListeners=__EventEmitter_52.prototype.removeAllListeners,_$Model_45.prototype.removeAllListeners=function(t,e){if(!t){for(var n in this._events)this.removeAllListeners(n,e);return this}var i=this.path(e);if(!i)return 0===arguments.length?this._removeAllListeners():this._removeAllListeners(t);for(var r=this.listeners(t),o=i.split("."),s=r.length;s--;){var a=r[s];patternContained(i,o,a)&&this.removeListener(t,a)}return this},_$Model_45.prototype.pass=function(t,e){var n=this._child();return n._pass=e?new Passed(t,this._pass):new Passed(this._pass,t),n},_$Model_45.prototype.silent=function(t){var e=this._child();return e._silent=null==t||t,e},_$Model_45.prototype.eventContext=function(t){var e=this._child();return e._eventContext=t,e},_$Model_45.prototype.removeContextListeners=function(t){for(var e in 0===arguments.length&&(t=this._eventContext),this._events)for(var n=this.listeners(e),i=n.length;i--;){var r=n[i];r.eventContext===t&&this.removeListener(e,r)}return this},ChangeEvent.prototype.type="change",InsertEvent.prototype.type="insert",RemoveEvent.prototype.type="remove",MoveEvent.prototype.type="move",LoadEvent.prototype.type="load",UnloadEvent.prototype.type="unload";var _$paths_57={};function createScoped(t,e){var n=t._child();return n._at=e,n}_$paths_57.mixin={},_$Model_45.prototype._splitPath=function(t){var e=this.path(t);return e&&e.split(".")||[]},_$Model_45.prototype.path=function(t){return null==t||""===t?this._at?this._at:"":"string"==typeof t||"number"==typeof t?this._at?this._at+"."+t:""+t:"function"==typeof t.path?t.path():void 0},_$Model_45.prototype.isPath=function(t){return null!=this.path(t)},_$Model_45.prototype.scope=function(t){if(arguments.length>1)for(var e=1;e<arguments.length;e++)t=t+"."+arguments[e];return createScoped(this,t)},_$Model_45.prototype.at=function(t){if(arguments.length>1)for(var e=1;e<arguments.length;e++)t=t+"."+arguments[e];return createScoped(this,this.path(t))},_$Model_45.prototype.parent=function(t){null==t&&(t=1);var e=this._splitPath(),n=Math.max(0,e.length-t),i=e.slice(0,n).join(".");return this.scope(i)},_$Model_45.prototype.leaf=function(t){t||(t=this.path());var e=t.lastIndexOf(".");return t.slice(e+1)};var _$Doc_43=Doc;function Doc(t,e,n){this.collectionName=e,this.id=n,this.collectionData=t&&t.data[e]}Doc.prototype.path=function(t){var e=this.collectionName+"."+this.id;return t&&t.length&&(e+="."+t.join(".")),e},Doc.prototype._errorMessage=function(t,e,n){return t+" at "+this.path(e)+": "+JSON.stringify(n,null,2)};var _$LocalDoc_44=LocalDoc;function LocalDoc(t,e,n,i){_$Doc_43.call(this,t,e,n),this.data=i,this._updateCollectionData()}function nodeCreateArray(t,e){return t=t[e]||(t[e]=[])}LocalDoc.prototype=new _$Doc_43,LocalDoc.prototype._updateCollectionData=function(){this.collectionData[this.id]=this.data},LocalDoc.prototype.create=function(t,e){if(void 0!==this.data){var n=this._errorMessage("create on local document with data",null,this.data);return e(new Error(n))}this.data=t,this._updateCollectionData(),e()},LocalDoc.prototype.set=function(t,e,n){return this._apply(t,function(t,n){var i=t[n];return t[n]=e,i},n)},LocalDoc.prototype.del=function(t,e){var n=this.get(t);if(void 0!==n)return this._apply(t,function(t,e){return delete t[e],n},e);e()},LocalDoc.prototype.increment=function(t,e,n){var i=this;return this._validatedApply(t,function(e){if("number"!=typeof e&&null!=e)return new TypeError(i._errorMessage("increment on non-number",t,e))},function(t,n){var i=(t[n]||0)+e;return t[n]=i,i},n)},LocalDoc.prototype.push=function(t,e,n){return this._arrayApply(t,function(t){return t.push(e)},n)},LocalDoc.prototype.unshift=function(t,e,n){return this._arrayApply(t,function(t){return t.unshift(e)},n)},LocalDoc.prototype.insert=function(t,e,n,i){return this._arrayApply(t,function(t){return t.splice.apply(t,[e,0].concat(n)),t.length},i)},LocalDoc.prototype.pop=function(t,e){return this._arrayApply(t,function(t){return t.pop()},e)},LocalDoc.prototype.shift=function(t,e){return this._arrayApply(t,function(t){return t.shift()},e)},LocalDoc.prototype.remove=function(t,e,n,i){return this._arrayApply(t,function(t){return t.splice(e,n)},i)},LocalDoc.prototype.move=function(t,e,n,i,r){return this._arrayApply(t,function(t){var r=t.splice(e,i);return t.splice.apply(t,[n,0].concat(r)),r},r)},LocalDoc.prototype.stringInsert=function(t,e,n,i){var r=this;return this._validatedApply(t,function(e){if("string"!=typeof e&&null!=e)return new TypeError(r._errorMessage("stringInsert on non-string",t,e))},function(t,i){var r=t[i];return null==r?(t[i]=n,r):(t[i]=r.slice(0,e)+n+r.slice(e),r)},i)},LocalDoc.prototype.stringRemove=function(t,e,n,i){var r=this;return this._validatedApply(t,function(e){if("string"!=typeof e&&null!=e)return new TypeError(r._errorMessage("stringRemove on non-string",t,e))},function(t,i){var r=t[i];return null==r?r:(e<0&&(e+=r.length),t[i]=r.slice(0,e)+r.slice(e+n),r)},i)},LocalDoc.prototype.get=function(t){return _$util_64.lookup(t,this.data)},LocalDoc.prototype._createImplied=function(t,e){for(var n=this,i="data",r=0,o=t[r++];null!=o;)n=n[i]||(n[i]=/^\d+$/.test(o)?[]:{}),i=o,o=t[r++];return e(n,i)},LocalDoc.prototype._apply=function(t,e,n){var i=this._createImplied(t,e);return this._updateCollectionData(),n(),i},LocalDoc.prototype._validatedApply=function(t,e,n,i){var r=this._createImplied(t,function(t,r){var o=e(t[r]);return o?i(o):n(t,r)});return this._updateCollectionData(),i(),r},LocalDoc.prototype._arrayApply=function(t,e,n){var i=this._createImplied(t,nodeCreateArray);if(!Array.isArray(i)){var r=this._errorMessage(e.name+" on non-array",t,i);return n(new TypeError(r))}var o=e(i);return this._updateCollectionData(),n(),o};var _$collections_48={};function CollectionMap(){}function ModelData(){}function DocMap(){}function CollectionData(){}function Collection(t,e,n){this.model=t,this.name=e,this.Doc=n,this.docs=new DocMap,this.data=t.data[e]=new CollectionData}function noKeys(t){for(var e in t)return!1;return!0}_$Model_45.INITS.push(function(t){t.root.collections=new CollectionMap,t.root.data=new ModelData}),_$Model_45.prototype.getCollection=function(t){return this.root.collections[t]},_$Model_45.prototype.getDoc=function(t,e){var n=this.root.collections[t];return n&&n.docs[e]},_$Model_45.prototype.get=function(t){var e=this._splitPath(t);return this._get(e)},_$Model_45.prototype._get=function(t){return _$util_64.lookup(t,this.root.data)},_$Model_45.prototype.getCopy=function(t){var e=this._splitPath(t);return this._getCopy(e)},_$Model_45.prototype._getCopy=function(t){var e=this._get(t);return _$util_64.copy(e)},_$Model_45.prototype.getDeepCopy=function(t){var e=this._splitPath(t);return this._getDeepCopy(e)},_$Model_45.prototype._getDeepCopy=function(t){var e=this._get(t);return _$util_64.deepCopy(e)},_$Model_45.prototype.getOrCreateCollection=function(t){var e=this.root.collections[t];if(e)return e;var n=this._getDocConstructor(t);return e=new Collection(this.root,t,n),this.root.collections[t]=e,e},_$Model_45.prototype._getDocConstructor=function(){return _$LocalDoc_44},_$Model_45.prototype.getOrCreateDoc=function(t,e,n){var i=this.getOrCreateCollection(t);return i.docs[e]||i.add(e,n)},_$Model_45.prototype.destroy=function(t){var e=this._splitPath(t),n=this.silent();if(n.removeAllListeners(null,t),n._removeAllRefs(e),n._stopAll(e),n._removeAllFilters(e),0===e.length){this.root.collections=new CollectionMap;var i=this.root.data;for(var r in i)delete i[r]}else if(1===e.length){var o=this.getCollection(e[0]);o&&o.destroy()}else n._del(e)},Collection.prototype.add=function(t,e){var n=new this.Doc(this.model,this.name,t,e,this);return this.docs[t]=n,n},Collection.prototype.destroy=function(){delete this.model.collections[this.name],delete this.model.data[this.name]},Collection.prototype.remove=function(t){delete this.docs[t],delete this.data[t],noKeys(this.docs)&&this.destroy()},Collection.prototype.get=function(){return this.data};var _$mutators_56={};_$Model_45.prototype._mutate=function(t,e,n){n=this.wrapCallback(n);var i=t[0],r=t[1];if(!i||!r){var o=e.name+" must be performed under a collection and document id. Invalid path: "+t.join(".");return n(new Error(o))}var s=this.getOrCreateDoc(i,r),a=t.slice(2);if(this._preventCompose&&s.shareDoc){var c=s.shareDoc.preventCompose;s.shareDoc.preventCompose=!0;var l=e(s,a,n);return s.shareDoc.preventCompose=c,l}return e(s,a,n)},_$Model_45.prototype.set=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var i=this._splitPath(t);return this._set(i,e,n)},_$Model_45.prototype._set=function(t,e,n){t=this._dereference(t);var i=this;return this._mutate(t,function(n,r,o){var s=n.set(r,e,o);return 0===r.length&&(e=n.get(r)),i.emit("change",t,[e,s,i._pass]),s},n)},_$Model_45.prototype.setNull=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var i=this._splitPath(t);return this._setNull(i,e,n)},_$Model_45.prototype._setNull=function(t,e,n){t=this._dereference(t);var i=this;return this._mutate(t,function(n,r,o){var s=n.get(r);return null!=s?(o(),s):(n.set(r,e,o),i.emit("change",t,[e,s,i._pass]),e)},n)},_$Model_45.prototype.setEach=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var i=this._splitPath(t);return this._setEach(i,e,n)},_$Model_45.prototype._setEach=function(t,e,n){t=this._dereference(t);var i=_$util_64.asyncGroup(this.wrapCallback(n));for(var r in e){var o=e[r];this._set(t.concat(r),o,i())}},_$Model_45.prototype.create=function(){var t,e,n;0===arguments.length?e={}:1===arguments.length?"function"==typeof arguments[0]?(e={},n=arguments[0]):e=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var i=this._splitPath(t);return this._create(i,e,n)},_$Model_45.prototype._create=function(t,e,n){if(2!==(t=this._dereference(t)).length){var i="create may only be used on a document path. Invalid path: "+t.join(".");return(n=this.wrapCallback(n))(new Error(i))}var r=this;this._mutate(t,function(n,i,o){n.create(e,o),e=n.get(),r.emit("change",t,[e,void 0,r._pass])},n)},_$Model_45.prototype.createNull=function(){var t,e,n;0===arguments.length?e={}:1===arguments.length?"function"==typeof arguments[0]?(e={},n=arguments[0]):e=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var i=this._splitPath(t);return this._createNull(i,e,n)},_$Model_45.prototype._createNull=function(t,e,n){t=this._dereference(t);var i=this.getDoc(t[0],t[1]);i&&null!=i.get()||this._create(t,e,n)},_$Model_45.prototype.add=function(){var t,e,n;0===arguments.length?e={}:1===arguments.length?"function"==typeof arguments[0]?(e={},n=arguments[0]):e=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var i=this._splitPath(t);return this._add(i,e,n)},_$Model_45.prototype._add=function(t,e,n){if("object"!=typeof e){var i="add requires an object value. Invalid value: "+e;return(n=this.wrapCallback(n))(new Error(i))}var r=e.id||this.id();e.id=r,t=this._dereference(t.concat(r));var o=this;return this._mutate(t,function(n,i,r){var s;i.length?s=n.set(i,e,r):(n.create(e,r),e=n.get()),o.emit("change",t,[e,s,o._pass])},n),r},_$Model_45.prototype.del=function(){var t,e;1===arguments.length?"function"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:(t=arguments[0],e=arguments[1]);var n=this._splitPath(t);return this._del(n,e)},_$Model_45.prototype._del=function(t,e){t=this._dereference(t);var n=this;return this._mutate(t,function(e,i,r){var o=e.del(i,r);if(2===t.length){var s=t[0],a=t[1];n.root.collections[s].remove(a)}return n.emit("change",t,[void 0,o,n._pass]),o},e)},_$Model_45.prototype.increment=function(){var t,e,n;1===arguments.length?"function"==typeof arguments[0]?n=arguments[0]:"number"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(n=arguments[1],"number"==typeof arguments[0]?e=arguments[0]:t=arguments[0]):(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var i=this._splitPath(t);return this._increment(i,e,n)},_$Model_45.prototype._increment=function(t,e,n){t=this._dereference(t),null==e&&(e=1);var i=this;return this._mutate(t,function(n,r,o){var s=n.increment(r,e,o),a=s-e;return i.emit("change",t,[s,a,i._pass]),s},n)},_$Model_45.prototype.push=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var i=this._splitPath(t);return this._push(i,e,n)},_$Model_45.prototype._push=function(t,e,n){t=this._dereference(t,!0);var i=this;return this._mutate(t,function(n,r,o){var s=n.push(r,e,o);return i.emit("insert",t,[s-1,[e],i._pass]),s},n)},_$Model_45.prototype.unshift=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var i=this._splitPath(t);return this._unshift(i,e,n)},_$Model_45.prototype._unshift=function(t,e,n){t=this._dereference(t,!0);var i=this;return this._mutate(t,function(n,r,o){var s=n.unshift(r,e,o);return i.emit("insert",t,[0,[e],i._pass]),s},n)},_$Model_45.prototype.insert=function(){var t,e,n,i;if(arguments.length<2)throw new Error("Not enough arguments for insert");2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?(t=arguments[0],e=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3]);var r=this._splitPath(t);return this._insert(r,+e,n,i)},_$Model_45.prototype._insert=function(t,e,n,i){t=this._dereference(t,!0);var r=this;return this._mutate(t,function(i,o,s){var a=Array.isArray(n)?n:[n],c=i.insert(o,e,a,s);return r.emit("insert",t,[e,a,r._pass]),c},i)},_$Model_45.prototype.pop=function(){var t,e;1===arguments.length?"function"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:(t=arguments[0],e=arguments[1]);var n=this._splitPath(t);return this._pop(n,e)},_$Model_45.prototype._pop=function(t,e){t=this._dereference(t,!0);var n=this;return this._mutate(t,function(e,i,r){var o=e.get(i),s=o&&o.length;if(s){var a=e.pop(i,r);return n.emit("remove",t,[s-1,[a],n._pass]),a}r()},e)},_$Model_45.prototype.shift=function(){var t,e;1===arguments.length?"function"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:(t=arguments[0],e=arguments[1]);var n=this._splitPath(t);return this._shift(n,e)},_$Model_45.prototype._shift=function(t,e){t=this._dereference(t,!0);var n=this;return this._mutate(t,function(e,i,r){var o=e.get(i);if(o&&o.length){var s=e.shift(i,r);return n.emit("remove",t,[0,[s],n._pass]),s}r()},e)},_$Model_45.prototype.remove=function(){var t,e,n,i;arguments.length<2?e=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(i=arguments[1],"number"==typeof arguments[0]?e=arguments[0]:t=arguments[0]):"number"==typeof arguments[0]?(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(i=arguments[2],"number"==typeof arguments[0]?(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1])):(t=arguments[0],e=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3]);var r=this._splitPath(t);return null==e&&(e=r.pop()),this._remove(r,+e,n,i)},_$Model_45.prototype._remove=function(t,e,n,i){t=this._dereference(t,!0),null==n&&(n=1);var r=this;return this._mutate(t,function(i,o,s){var a=i.remove(o,e,n,s);return r.emit("remove",t,[e,a,r._pass]),a},i)},_$Model_45.prototype.move=function(){var t,e,n,i,r;if(arguments.length<2)throw new Error("Not enough arguments for move");2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(e=arguments[0],n=arguments[1],r=arguments[2]):"number"==typeof arguments[0]?(e=arguments[0],n=arguments[1],i=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2]):4===arguments.length?"function"==typeof arguments[3]?(r=arguments[3],"number"==typeof arguments[0]?(e=arguments[0],n=arguments[1],i=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2])):(t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3]):(t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3],r=arguments[4]);var o=this._splitPath(t);return this._move(o,e,n,i,r)},_$Model_45.prototype._move=function(t,e,n,i,r){t=this._dereference(t,!0),null==i&&(i=1);var o=this;return this._mutate(t,function(r,s,a){if(n=+n,(e=+e)<0||n<0){var c=r.get(s).length;e<0&&(e+=c),n<0&&(n+=c)}var l=r.move(s,e,n,i,a);return o.emit("move",t,[e,n,l.length,o._pass]),l},r)},_$Model_45.prototype.stringInsert=function(){var t,e,n,i;if(arguments.length<2)throw new Error("Not enough arguments for stringInsert");2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(e=arguments[0],n=arguments[1],i=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3]);var r=this._splitPath(t);return this._stringInsert(r,e,n,i)},_$Model_45.prototype._stringInsert=function(t,e,n,i){t=this._dereference(t);var r=this;return this._mutate(t,function(i,o,s){var a=i.stringInsert(o,e,n,s),c=i.get(o),l=r.pass({$stringInsert:{index:e,text:n}})._pass;r.emit("change",t,[c,a,l])},i)},_$Model_45.prototype.stringRemove=function(){var t,e,n,i;if(arguments.length<2)throw new Error("Not enough arguments for stringRemove");2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(e=arguments[0],n=arguments[1],i=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3]);var r=this._splitPath(t);return this._stringRemove(r,e,n,i)},_$Model_45.prototype._stringRemove=function(t,e,n,i){t=this._dereference(t);var r=this;return this._mutate(t,function(i,o,s){var a=i.stringRemove(o,e,n,s),c=i.get(o),l=r.pass({$stringRemove:{index:e,howMany:n}})._pass;r.emit("change",t,[c,a,l])},i)},_$Model_45.prototype.subtypeSubmit=function(){var t,e,n,i;if(arguments.length<2)throw new Error("Not enough arguments for subtypeSubmit");2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(e=arguments[0],n=arguments[1],i=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3]);var r=this._splitPath(t);return this._subtypeSubmit(r,e,n,i)},_$Model_45.prototype._subtypeSubmit=function(t,e,n,i){t=this._dereference(t);var r=this;return this._mutate(t,function(i,o,s){var a=i.subtypeSubmit(o,e,n,s),c=i.get(o),l=r.pass({$subtype:{type:e,op:n}})._pass;return r.emit("change",t,[c,void 0,l]),a},i)};var _$arrayDiff_1=arrayDiff;function InsertDiff(t,e){this.index=t,this.values=e}function RemoveDiff(t,e){this.index=t,this.howMany=e}function MoveDiff(t,e,n){this.from=t,this.to=e,this.howMany=n}function strictEqual(t,e){return t===e}function arrayDiff(t,e,n){n||(n=strictEqual);for(var i=t.length,r=e.length,o=[],s={},a={},c=0;c<i;c++)for(var l=t[c],h=0;h<r;h++)if(!a[h]&&n(l,e[h])){var u=c,p=h,f=0;do{s[c++]=a[h++]=!0,f++}while(c<i&&h<r&&n(t[c],e[h])&&!a[h]);o.push(new MoveDiff(u,p,f)),c--;break}var d=[];for(c=0;c<i;)if(s[c])c++;else{var m=c;for(f=0;c<i&&!s[c++];)f++;d.push(new RemoveDiff(m,f))}var _=[];for(h=0;h<r;)if(a[h])h++;else{for(m=h,f=0;h<r&&!a[h++];)f++;var v=e.slice(m,m+f);_.push(new InsertDiff(m,v))}var y,g,b=_.length,w=d.length,E=o.length,x=0;for(y=0;y<w;y++){var C=d[y];for(C.index-=x,x+=C.howMany,g=0;g<E;g++){($=o[g]).from>=C.index&&($.from-=C.howMany)}}for(y=b;y--;){var T=_[y];f=T.values.length;for(g=E;g--;){($=o[g]).to>=T.index&&($.to-=f)}}for(y=E;y-- >1;){if(($=o[y]).to!==$.from)for(g=y;g--;){var S=o[g];S.to>=$.to&&(S.to-=$.howMany),S.to>=$.from&&(S.to+=$.howMany)}}var D=[];for(y=0;y<E;y++){var $;if(($=o[y]).to!==$.from)for(D.push($),g=y+1;g<E;g++){var R=o[g];R.from>=$.from&&(R.from-=$.howMany),R.from>=$.to&&(R.from+=$.howMany)}}return d.concat(D,_)}arrayDiff.InsertDiff=InsertDiff,arrayDiff.RemoveDiff=RemoveDiff,arrayDiff.MoveDiff=MoveDiff,InsertDiff.prototype.type="insert",InsertDiff.prototype.toJSON=function(){return{type:this.type,index:this.index,values:this.values}},RemoveDiff.prototype.type="remove",RemoveDiff.prototype.toJSON=function(){return{type:this.type,index:this.index,howMany:this.howMany}},MoveDiff.prototype.type="move",MoveDiff.prototype.toJSON=function(){return{type:this.type,from:this.from,to:this.to,howMany:this.howMany}};var _$setDiff_60={};function diffDeep(t,e,n,i,r){if("object"==typeof n&&n&&"object"==typeof i&&i)if(Array.isArray(n)&&Array.isArray(i)){var o=_$arrayDiff_1(n,i,_$util_64.deepEqual);if(!o.length)return;if(2===o.length&&o[0].index===o[1].index&&o[0]instanceof _$arrayDiff_1.RemoveDiff&&1===o[0].howMany&&o[1]instanceof _$arrayDiff_1.InsertDiff&&1===o[1].values.length){var s=o[0].index;return void diffDeep(t,c=e.concat(s),n[s],i[s],r)}t._applyArrayDiff(e,o,r())}else{for(var a in n)if(!(a in i)){var c=e.concat(a);t._del(c,r())}for(var a in i){if(!_$util_64.deepEqual(n[a],i[a]))diffDeep(t,c=e.concat(a),n[a],i[a],r)}}else t._setDiff(e,i,r())}_$Model_45.prototype.setDiff=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var i=this._splitPath(t);return this._setDiff(i,e,n)},_$Model_45.prototype._setDiff=function(t,e,n){t=this._dereference(t);var i=this;return this._mutate(t,function(n,r,o){var s=n.get(r);return _$util_64.equal(s,e)?(o(),s):(n.set(r,e,o),i.emit("change",t,[e,s,i._pass]),s)},n)},_$Model_45.prototype.setDiffDeep=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var i=this._splitPath(t);return this._setDiffDeep(i,e,n)},_$Model_45.prototype._setDiffDeep=function(t,e,n){var i=this._get(t);n=this.wrapCallback(n);var r=_$util_64.asyncGroup(n),o=r();diffDeep(this,t,i,e,r),o()},_$Model_45.prototype.setArrayDiff=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var i=this._splitPath(t);return this._setArrayDiff(i,e,n)},_$Model_45.prototype.setArrayDiffDeep=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var i=this._splitPath(t);return this._setArrayDiffDeep(i,e,n)},_$Model_45.prototype._setArrayDiffDeep=function(t,e,n){return this._setArrayDiff(t,e,n,_$util_64.deepEqual)},_$Model_45.prototype._setArrayDiff=function(t,e,n,i){var r=this._get(t);if(r===e)return this.wrapCallback(n)();if(Array.isArray(r)&&Array.isArray(e)){var o=_$arrayDiff_1(r,e,i);this._applyArrayDiff(t,o,n)}else this._set(t,e,n)},_$Model_45.prototype._applyArrayDiff=function(t,e,n){if(!e.length)return this.wrapCallback(n)();t=this._dereference(t);var i=this;return this._mutate(t,function(n,r,o){for(var s=_$util_64.asyncGroup(o),a=0,c=e.length;a<c;a++){var l=e[a];if(l instanceof _$arrayDiff_1.InsertDiff)n.insert(r,l.index,l.values,s()),i.emit("insert",t,[l.index,l.values,i._pass]);else if(l instanceof _$arrayDiff_1.RemoveDiff){var h=n.remove(r,l.index,l.howMany,s());i.emit("remove",t,[l.index,h,i._pass])}else if(l instanceof _$arrayDiff_1.MoveDiff){var u=n.move(r,l.from,l.to,l.howMany,s());i.emit("move",t,[l.from,l.to,u.length,i._pass])}}},n)};var _$emitter_74={},__EventEmitter_74=_$EventEmitter_23.EventEmitter;function mixin(t){for(var e in __EventEmitter_74.prototype)t.prototype[e]=__EventEmitter_74.prototype[e]}_$emitter_74.EventEmitter=__EventEmitter_74,_$emitter_74.mixin=mixin;var SUPPORTED_METHODS=["info","warn","error"];function Logger(){var t={};SUPPORTED_METHODS.forEach(function(e){t[e]=console[e].bind(console)}),this.setMethods(t)}var _$Logger_77=Logger;Logger.prototype.setMethods=function(t){t=t||{};var e=this;SUPPORTED_METHODS.forEach(function(n){"function"==typeof t[n]&&(e[n]=t[n])})};var logger=new _$Logger_77,_$logger_76=logger;function ShareDBError(t,e){this.code=t,this.message=e||"",Error.captureStackTrace?Error.captureStackTrace(this,ShareDBError):this.stack=(new Error).stack}ShareDBError.prototype=Object.create(Error.prototype),ShareDBError.prototype.constructor=ShareDBError,ShareDBError.prototype.name="ShareDBError",ShareDBError.CODES={ERR_APPLY_OP_VERSION_DOES_NOT_MATCH_SNAPSHOT:"ERR_APPLY_OP_VERSION_DOES_NOT_MATCH_SNAPSHOT",ERR_APPLY_SNAPSHOT_NOT_PROVIDED:"ERR_APPLY_SNAPSHOT_NOT_PROVIDED",ERR_CLIENT_ID_BADLY_FORMED:"ERR_CLIENT_ID_BADLY_FORMED",ERR_CONNECTION_STATE_TRANSITION_INVALID:"ERR_CONNECTION_STATE_TRANSITION_INVALID",ERR_DATABASE_ADAPTER_NOT_FOUND:"ERR_DATABASE_ADAPTER_NOT_FOUND",ERR_DATABASE_DOES_NOT_SUPPORT_SUBSCRIBE:"ERR_DATABASE_DOES_NOT_SUPPORT_SUBSCRIBE",ERR_DATABASE_METHOD_NOT_IMPLEMENTED:"ERR_DATABASE_METHOD_NOT_IMPLEMENTED",ERR_DEFAULT_TYPE_MISMATCH:"ERR_DEFAULT_TYPE_MISMATCH",ERR_DOC_MISSING_VERSION:"ERR_DOC_MISSING_VERSION",ERR_DOC_ALREADY_CREATED:"ERR_DOC_ALREADY_CREATED",ERR_DOC_DOES_NOT_EXIST:"ERR_DOC_DOES_NOT_EXIST",ERR_DOC_TYPE_NOT_RECOGNIZED:"ERR_DOC_TYPE_NOT_RECOGNIZED",ERR_DOC_WAS_DELETED:"ERR_DOC_WAS_DELETED",ERR_INFLIGHT_OP_MISSING:"ERR_INFLIGHT_OP_MISSING",ERR_INGESTED_SNAPSHOT_HAS_NO_VERSION:"ERR_INGESTED_SNAPSHOT_HAS_NO_VERSION",ERR_MAX_SUBMIT_RETRIES_EXCEEDED:"ERR_MAX_SUBMIT_RETRIES_EXCEEDED",ERR_MESSAGE_BADLY_FORMED:"ERR_MESSAGE_BADLY_FORMED",ERR_MILESTONE_ARGUMENT_INVALID:"ERR_MILESTONE_ARGUMENT_INVALID",ERR_OP_ALREADY_SUBMITTED:"ERR_OP_ALREADY_SUBMITTED",ERR_OP_NOT_ALLOWED_IN_PROJECTION:"ERR_OP_NOT_ALLOWED_IN_PROJECTION",ERR_OP_SUBMIT_REJECTED:"ERR_OP_SUBMIT_REJECTED",ERR_OP_VERSION_MISMATCH_AFTER_TRANSFORM:"ERR_OP_VERSION_MISMATCH_AFTER_TRANSFORM",ERR_OP_VERSION_MISMATCH_DURING_TRANSFORM:"ERR_OP_VERSION_MISMATCH_DURING_TRANSFORM",ERR_OP_VERSION_NEWER_THAN_CURRENT_SNAPSHOT:"ERR_OP_VERSION_NEWER_THAN_CURRENT_SNAPSHOT",ERR_OT_OP_BADLY_FORMED:"ERR_OT_OP_BADLY_FORMED",ERR_OT_OP_NOT_PROVIDED:"ERR_OT_OP_NOT_PROVIDED",ERR_PROTOCOL_VERSION_NOT_SUPPORTED:"ERR_PROTOCOL_VERSION_NOT_SUPPORTED",ERR_QUERY_EMITTER_LISTENER_NOT_ASSIGNED:"ERR_QUERY_EMITTER_LISTENER_NOT_ASSIGNED",ERR_SNAPSHOT_READ_SILENT_REJECTION:"ERR_SNAPSHOT_READ_SILENT_REJECTION",ERR_SNAPSHOT_READS_REJECTED:"ERR_SNAPSHOT_READS_REJECTED",ERR_SUBMIT_TRANSFORM_OPS_NOT_FOUND:"ERR_SUBMIT_TRANSFORM_OPS_NOT_FOUND",ERR_TYPE_CANNOT_BE_PROJECTED:"ERR_TYPE_CANNOT_BE_PROJECTED",ERR_UNKNOWN_ERROR:"ERR_UNKNOWN_ERROR"};var _$ShareDBError_75=ShareDBError,_$bootstrapTransform_25=bootstrapTransform;function bootstrapTransform(t,e,n,i){var r=t.transformX=function(t,o){n(t),n(o);for(var s,a,c,l=[],h=0;h<o.length;h++){for(var u=o[h],p=[],f=0;f<t.length;){var d=[];if(s=t[f],c=d,e(p,s,a=u,"left"),e(c,a,s,"right"),f++,1!==d.length){if(0===d.length){for(var m=f;m<t.length;m++)i(p,t[m]);u=null;break}for(var _=r(t.slice(f),d),v=0;v<_[0].length;v++)i(p,_[0][v]);for(var y=0;y<_[1].length;y++)i(l,_[1][y]);u=null;break}u=d[0]}null!=u&&i(l,u),t=p}return[t,l]};t.transform=function(t,n,i){if("left"!==i&&"right"!==i)throw new Error("type must be 'left' or 'right'");return 0===n.length?t:1===t.length&&1===n.length?e([],t[0],n[0],i):"left"===i?r(t,n)[0]:r(n,t)[1]}}var _$text0_28={},text=_$text0_28={name:"text0",uri:"http://sharejs.org/types/textv0",create:function(t){if(null!=t&&"string"!=typeof t)throw new Error("Initial data must be a string");return t||""}},strInject=function(t,e,n){return t.slice(0,e)+n+t.slice(e)},checkValidComponent=function(t){if("number"!=typeof t.p)throw new Error("component missing position field");if("string"==typeof t.i==("string"==typeof t.d))throw new Error("component needs an i or d field");if(t.p<0)throw new Error("position cannot be negative")},checkValidOp=function(t){for(var e=0;e<t.length;e++)checkValidComponent(t[e])};text.apply=function(t,e){var n;checkValidOp(e);for(var i=0;i<e.length;i++){var r=e[i];if(null!=r.i)t=strInject(t,r.p,r.i);else{if(n=t.slice(r.p,r.p+r.d.length),r.d!==n)throw new Error("Delete component '"+r.d+"' does not match deleted text '"+n+"'");t=t.slice(0,r.p)+t.slice(r.p+r.d.length)}}return t};var append=text._append=function(t,e){if(""!==e.i&&""!==e.d)if(0===t.length)t.push(e);else{var n=t[t.length-1];null!=n.i&&null!=e.i&&n.p<=e.p&&e.p<=n.p+n.i.length?t[t.length-1]={i:strInject(n.i,e.p-n.p,e.i),p:n.p}:null!=n.d&&null!=e.d&&e.p<=n.p&&n.p<=e.p+e.d.length?t[t.length-1]={d:strInject(e.d,n.p-e.p,n.d),p:e.p}:t.push(e)}};text.compose=function(t,e){checkValidOp(t),checkValidOp(e);for(var n=t.slice(),i=0;i<e.length;i++)append(n,e[i]);return n},text.normalize=function(t){var e=[];null==t.i&&null==t.p||(t=[t]);for(var n=0;n<t.length;n++){var i=t[n];null==i.p&&(i.p=0),append(e,i)}return e};var transformPosition=function(t,e,n){return null!=e.i?e.p<t||e.p===t&&n?t+e.i.length:t:t<=e.p?t:t<=e.p+e.d.length?e.p:t-e.d.length};text.transformCursor=function(t,e,n){for(var i="right"===n,r=0;r<e.length;r++)t=transformPosition(t,e[r],i);return t};var transformComponent=text._tc=function(t,e,n,i){if(checkValidComponent(e),checkValidComponent(n),null!=e.i)append(t,{i:e.i,p:transformPosition(e.p,n,"right"===i)});else if(null!=n.i){var r=e.d;e.p<n.p&&(append(t,{d:r.slice(0,n.p-e.p),p:e.p}),r=r.slice(n.p-e.p)),""!==r&&append(t,{d:r,p:e.p+n.i.length})}else if(e.p>=n.p+n.d.length)append(t,{d:e.d,p:e.p-n.d.length});else if(e.p+e.d.length<=n.p)append(t,e);else{var o={d:"",p:e.p};e.p<n.p&&(o.d=e.d.slice(0,n.p-e.p)),e.p+e.d.length>n.p+n.d.length&&(o.d+=e.d.slice(n.p+n.d.length-e.p));var s=Math.max(e.p,n.p),a=Math.min(e.p+e.d.length,n.p+n.d.length);if(e.d.slice(s-e.p,a-e.p)!==n.d.slice(s-n.p,a-n.p))throw new Error("Delete ops delete different text in the same region of the document");""!==o.d&&(o.p=transformPosition(o.p,n),append(t,o))}return t},invertComponent=function(t){return null!=t.i?{d:t.i,p:t.p}:{i:t.d,p:t.p}};text.invert=function(t){t=t.slice().reverse();for(var e=0;e<t.length;e++)t[e]=invertComponent(t[e]);return t},_$bootstrapTransform_25(text,transformComponent,checkValidOp,append);var __isArray_27=function(t){return"[object Array]"==Object.prototype.toString.call(t)},isObject=function(t){return!!t&&t.constructor===Object},clone=function(t){return JSON.parse(JSON.stringify(t))},json={name:"json0",uri:"http://sharejs.org/types/JSONv0"},subtypes={};function convertFromText(t){t.t="text0";var e={p:t.p.pop()};null!=t.si&&(e.i=t.si),null!=t.sd&&(e.d=t.sd),t.o=[e]}function convertToText(t){t.p.push(t.o[0].p),null!=t.o[0].i&&(t.si=t.o[0].i),null!=t.o[0].d&&(t.sd=t.o[0].d),delete t.t,delete t.o}json.registerSubtype=function(t){subtypes[t.name]=t},json.create=function(t){return void 0===t?null:clone(t)},json.invertComponent=function(t){var e={p:t.p};return t.t&&subtypes[t.t]&&(e.t=t.t,e.o=subtypes[t.t].invert(t.o)),void 0!==t.si&&(e.sd=t.si),void 0!==t.sd&&(e.si=t.sd),void 0!==t.oi&&(e.od=t.oi),void 0!==t.od&&(e.oi=t.od),void 0!==t.li&&(e.ld=t.li),void 0!==t.ld&&(e.li=t.ld),void 0!==t.na&&(e.na=-t.na),void 0!==t.lm&&(e.lm=t.p[t.p.length-1],e.p=t.p.slice(0,t.p.length-1).concat([t.lm])),e},json.invert=function(t){for(var e=t.slice().reverse(),n=[],i=0;i<e.length;i++)n.push(json.invertComponent(e[i]));return n},json.checkValidOp=function(t){for(var e=0;e<t.length;e++)if(!__isArray_27(t[e].p))throw new Error("Missing path")},json.checkList=function(t){if(!__isArray_27(t))throw new Error("Referenced element not a list")},json.checkObj=function(t){if(!isObject(t))throw new Error("Referenced element not an object (it was "+JSON.stringify(t)+")")},json.apply=function(t,e){json.checkValidOp(e),e=clone(e);for(var n={data:t},i=0;i<e.length;i++){var r=e[i];null==r.si&&null==r.sd||convertFromText(r);for(var o=null,s=n,a="data",c=0;c<r.p.length;c++){var l=r.p[c];if(o=s,a,s=s[a],a=l,null==o)throw new Error("Path invalid")}if(r.t&&void 0!==r.o&&subtypes[r.t])s[a]=subtypes[r.t].apply(s[a],r.o);else if(void 0!==r.na){if("number"!=typeof s[a])throw new Error("Referenced element not a number");s[a]+=r.na}else if(void 0!==r.li&&void 0!==r.ld)json.checkList(s),s[a]=r.li;else if(void 0!==r.li)json.checkList(s),s.splice(a,0,r.li);else if(void 0!==r.ld)json.checkList(s),s.splice(a,1);else if(void 0!==r.lm){if(json.checkList(s),r.lm!=a){var h=s[a];s.splice(a,1),s.splice(r.lm,0,h)}}else if(void 0!==r.oi)json.checkObj(s),s[a]=r.oi;else{if(void 0===r.od)throw new Error("invalid / missing instruction in op");json.checkObj(s),delete s[a]}}return n.data},json.shatter=function(t){for(var e=[],n=0;n<t.length;n++)e.push([t[n]]);return e},json.incrementalApply=function(t,e,n){for(var i=0;i<e.length;i++){var r=[e[i]];n(r,t=json.apply(t,r))}return t};var pathMatches=json.pathMatches=function(t,e,n){if(t.length!=e.length)return!1;for(var i=0;i<t.length;i++)if(t[i]!==e[i]&&(!n||i!==t.length-1))return!1;return!0};json.append=function(t,e){if(e=clone(e),0!==t.length){var n=t[t.length-1];if(null==e.si&&null==e.sd||null==n.si&&null==n.sd||(convertFromText(e),convertFromText(n)),pathMatches(e.p,n.p))if(e.t&&n.t&&e.t===n.t&&subtypes[e.t]){if(n.o=subtypes[e.t].compose(n.o,e.o),null!=e.si||null!=e.sd){for(var i=e.p,r=0;r<n.o.length-1;r++)e.o=[n.o.pop()],e.p=i.slice(),convertToText(e),t.push(e);convertToText(n)}}else null!=n.na&&null!=e.na?t[t.length-1]={p:n.p,na:n.na+e.na}:void 0!==n.li&&void 0===e.li&&e.ld===n.li?void 0!==n.ld?delete n.li:t.pop():void 0!==n.od&&void 0===n.oi&&void 0!==e.oi&&void 0===e.od?n.oi=e.oi:void 0!==n.oi&&void 0!==e.od?void 0!==e.oi?n.oi=e.oi:void 0!==n.od?delete n.oi:t.pop():void 0!==e.lm&&e.p[e.p.length-1]===e.lm||t.push(e);else null==e.si&&null==e.sd||null==n.si&&null==n.sd||(convertToText(e),convertToText(n)),t.push(e)}else t.push(e)},json.compose=function(t,e){json.checkValidOp(t),json.checkValidOp(e);for(var n=clone(t),i=0;i<e.length;i++)json.append(n,e[i]);return n},json.normalize=function(t){var e=[];t=__isArray_27(t)?t:[t];for(var n=0;n<t.length;n++){var i=t[n];null==i.p&&(i.p=[]),json.append(e,i)}return e},json.commonLengthForOps=function(t,e){var n=t.p.length,i=e.p.length;if((null!=t.na||t.t)&&n++,(null!=e.na||e.t)&&i++,0===n)return-1;if(0===i)return null;n--,i--;for(var r=0;r<n;r++){var o=t.p[r];if(r>=i||o!==e.p[r])return null}return n},json.canOpAffectPath=function(t,e){return null!=json.commonLengthForOps({p:e},t)},json.transformComponent=function(t,e,n,i){e=clone(e);var r=json.commonLengthForOps(n,e),o=json.commonLengthForOps(e,n),s=e.p.length,a=n.p.length;if((null!=e.na||e.t)&&s++,(null!=n.na||n.t)&&a++,null!=o&&a>s&&e.p[o]==n.p[o])if(void 0!==e.ld)(l=clone(n)).p=l.p.slice(s),e.ld=json.apply(clone(e.ld),[l]);else if(void 0!==e.od){(l=clone(n)).p=l.p.slice(s),e.od=json.apply(clone(e.od),[l])}if(null!=r){var c=s==a,l=n;if(null==e.si&&null==e.sd||null==n.si&&null==n.sd||(convertFromText(e),convertFromText(l=clone(n))),l.t&&subtypes[l.t]){if(e.t&&e.t===l.t){var h=subtypes[e.t].transform(e.o,l.o,i);if(null!=e.si||null!=e.sd)for(var u=e.p,p=0;p<h.length;p++)e.o=[h[p]],e.p=u.slice(),convertToText(e),json.append(t,e);else(!__isArray_27(h)||h.length>0)&&(e.o=h,json.append(t,e));return t}}else if(void 0!==n.na);else if(void 0!==n.li&&void 0!==n.ld){if(n.p[r]===e.p[r]){if(!c)return t;if(void 0!==e.ld){if(void 0===e.li||"left"!==i)return t;e.ld=clone(n.li)}}}else if(void 0!==n.li)void 0!==e.li&&void 0===e.ld&&c&&e.p[r]===n.p[r]?"right"===i&&e.p[r]++:n.p[r]<=e.p[r]&&e.p[r]++,void 0!==e.lm&&c&&n.p[r]<=e.lm&&e.lm++;else if(void 0!==n.ld){if(void 0!==e.lm&&c){if(n.p[r]===e.p[r])return t;u=n.p[r];var f=e.p[r];(u<(d=e.lm)||u===d&&f<d)&&e.lm--}if(n.p[r]<e.p[r])e.p[r]--;else if(n.p[r]===e.p[r]){if(a<s)return t;if(void 0!==e.ld){if(void 0===e.li)return t;delete e.ld}}}else if(void 0!==n.lm)if(void 0!==e.lm&&s===a){f=e.p[r];var d=e.lm,m=n.p[r],_=n.lm;if(m!==_)if(f===m){if("left"!==i)return t;e.p[r]=_,f===d&&(e.lm=_)}else f>m&&e.p[r]--,f>_?e.p[r]++:f===_&&m>_&&(e.p[r]++,f===d&&e.lm++),d>m?e.lm--:d===m&&d>f&&e.lm--,d>_?e.lm++:d===_&&(_>m&&d>f||_<m&&d<f?"right"===i&&e.lm++:d>f?e.lm++:d===m&&e.lm--)}else if(void 0!==e.li&&void 0===e.ld&&c){f=n.p[r],d=n.lm;(u=e.p[r])>f&&e.p[r]--,u>d&&e.p[r]++}else{f=n.p[r],d=n.lm;(u=e.p[r])===f?e.p[r]=d:(u>f&&e.p[r]--,u>d?e.p[r]++:u===d&&f>d&&e.p[r]++)}else if(void 0!==n.oi&&void 0!==n.od){if(e.p[r]===n.p[r]){if(void 0===e.oi||!c)return t;if("right"===i)return t;e.od=n.oi}}else if(void 0!==n.oi){if(void 0!==e.oi&&e.p[r]===n.p[r]){if("left"!==i)return t;json.append(t,{p:e.p,od:n.oi})}}else if(void 0!==n.od&&e.p[r]==n.p[r]){if(!c)return t;if(void 0===e.oi)return t;delete e.od}}return json.append(t,e),t},_$bootstrapTransform_25(json,json.transformComponent,json.checkValidOp,json.append),json.registerSubtype(_$text0_28);var _$json_27=json,_$lib_26={type:_$json_27},_$types_79={};_$types_79.defaultType=_$lib_26.type,_$types_79.map={},_$types_79.register=function(t){t.name&&(_$types_79.map[t.name]=t),t.uri&&(_$types_79.map[t.uri]=t)},_$types_79.register(_$types_79.defaultType);var _$Doc_68={};(function(t){var e=_$ShareDBError_75.CODES;function n(t,e,n){_$emitter_74.EventEmitter.call(this),this.connection=t,this.collection=e,this.id=n,this.version=null,this.type=null,this.data=void 0,this.inflightFetch=[],this.inflightSubscribe=[],this.inflightUnsubscribe=[],this.pendingFetch=[],this.subscribed=!1,this.wantSubscribe=!1,this.inflightOp=null,this.pendingOps=[],this.type=null,this.applyStack=null,this.preventCompose=!1}function i(t,e,n){if(e){var i=t.pop();t.push(function(t){i&&i(t),n&&n(t)})}else t.push(n)}function r(t,n){if(t.del)return delete(i=n).op,delete i.create,void delete i.del;var i;if(n.del)return new _$ShareDBError_75(e.ERR_DOC_WAS_DELETED,"Document was deleted");if(n.create)return new _$ShareDBError_75(e.ERR_DOC_ALREADY_CREATED,"Document already created");if(n.op){if(t.create)return new _$ShareDBError_75(e.ERR_DOC_ALREADY_CREATED,"Document already created");if(t.type.transformX){var r=t.type.transformX(t.op,n.op);t.op=r[0],n.op=r[1]}else{var o=t.type.transform(t.op,n.op,"left"),s=t.type.transform(n.op,t.op,"right");t.op=o,n.op=s}}}function o(t,e){for(var n=!1,i=0;i<t.length;i++){var r=t[i];r&&(r(e),n=!0)}return n}_$Doc_68=n,_$emitter_74.mixin(n),n.prototype.destroy=function(t){var e=this;e.whenNothingPending(function(){e.wantSubscribe?e.unsubscribe(function(n){if(n)return t?t(n):e.emit("error",n);e.connection._destroyDoc(e),t&&t()}):(e.connection._destroyDoc(e),t&&t())})},n.prototype._setType=function(t){if("string"==typeof t&&(t=_$types_79.map[t]),t)this.type=t;else{if(null!==t){var n=new _$ShareDBError_75(e.ERR_DOC_TYPE_NOT_RECOGNIZED,"Missing type "+t);return this.emit("error",n)}this.type=t,this.data=void 0}},n.prototype.ingestSnapshot=function(t,n){if(!t)return n&&n();if("number"!=typeof t.v){var i=new _$ShareDBError_75(e.ERR_INGESTED_SNAPSHOT_HAS_NO_VERSION,"Missing version in ingested snapshot. "+this.collection+"."+this.id);return n?n(i):this.emit("error",i)}if(this.type||this.hasWritePending()){if(null==this.version){if(this.hasWritePending())return n&&this.once("no write pending",n);i=new _$ShareDBError_75(e.ERR_DOC_MISSING_VERSION,"Cannot ingest snapshot in doc with null version. "+this.collection+"."+this.id);return n?n(i):this.emit("error",i)}return t.v>this.version?this.fetch(n):n&&n()}if(this.version>t.v)return n&&n();this.version=t.v;var r=void 0===t.type?_$types_79.defaultType:t.type;this._setType(r),this.data=this.type&&this.type.deserialize?this.type.deserialize(t.data):t.data,this.emit("load"),n&&n()},n.prototype.whenNothingPending=function(e){var n=this;t.nextTick(function(){n.hasPending()?n.once("nothing pending",e):e()})},n.prototype.hasPending=function(){return!!(this.inflightOp||this.pendingOps.length||this.inflightFetch.length||this.inflightSubscribe.length||this.inflightUnsubscribe.length||this.pendingFetch.length)},n.prototype.hasWritePending=function(){return!(!this.inflightOp&&!this.pendingOps.length)},n.prototype._emitNothingPending=function(){this.hasWritePending()||(this.emit("no write pending"),this.hasPending()||this.emit("nothing pending"))},n.prototype._emitResponseError=function(t,n){return t&&t.code===e.ERR_SNAPSHOT_READ_SILENT_REJECTION?(this.wantSubscribe=!1,n&&n(),void this._emitNothingPending()):n?(n(t),void this._emitNothingPending()):(this._emitNothingPending(),void this.emit("error",t))},n.prototype._handleFetch=function(t,e){var n=this.inflightFetch.shift();if(t)return this._emitResponseError(t,n);this.ingestSnapshot(e,n),this._emitNothingPending()},n.prototype._handleSubscribe=function(t,e){var n=this.inflightSubscribe.shift();if(t)return this._emitResponseError(t,n);this.wantSubscribe&&(this.subscribed=!0),this.ingestSnapshot(e,n),this._emitNothingPending()},n.prototype._handleUnsubscribe=function(t){var e=this.inflightUnsubscribe.shift();if(t)return this._emitResponseError(t,e);e&&e(),this._emitNothingPending()},n.prototype._handleOp=function(t,n){if(t)return this.inflightOp?(t.code===e.ERR_OP_SUBMIT_REJECTED&&(t=null),this._rollback(t)):this.emit("error",t);if(this.inflightOp&&n.src===this.inflightOp.src&&n.seq===this.inflightOp.seq)this._opAcknowledged(n);else if(null==this.version||n.v>this.version)this.fetch();else if(!(n.v<this.version)){if(this.inflightOp)if(o=r(this.inflightOp,n))return this._hardRollback(o);for(var i=0;i<this.pendingOps.length;i++){var o;if(o=r(this.pendingOps[i],n))return this._hardRollback(o)}this.version++;try{this._otApply(n,!1)}catch(t){return this._hardRollback(t)}}},n.prototype._onConnectionStateChanged=function(){if(this.connection.canSend)this.flush(),this._resubscribe();else if(this.inflightOp&&(this.pendingOps.unshift(this.inflightOp),this.inflightOp=null),this.subscribed=!1,(this.inflightFetch.length||this.inflightSubscribe.length)&&(this.pendingFetch=this.pendingFetch.concat(this.inflightFetch,this.inflightSubscribe),this.inflightFetch.length=0,this.inflightSubscribe.length=0),this.inflightUnsubscribe.length){var t=this.inflightUnsubscribe;this.inflightUnsubscribe=[],o(t)}},n.prototype._resubscribe=function(){var t=this.pendingFetch;if(this.pendingFetch=[],this.wantSubscribe)return t.length?void this.subscribe(function(e){o(t,e)}):void this.subscribe();t.length&&this.fetch(function(e){o(t,e)})},n.prototype.fetch=function(t){if(this.connection.canSend){var e=this.connection.sendFetch(this);i(this.inflightFetch,e,t)}else this.pendingFetch.push(t)},n.prototype.subscribe=function(t){if(this.wantSubscribe=!0,this.connection.canSend){var e=this.connection.sendSubscribe(this);i(this.inflightSubscribe,e,t)}else this.pendingFetch.push(t)},n.prototype.unsubscribe=function(e){if(this.wantSubscribe=!1,this.subscribed=!1,this.connection.canSend){var n=this.connection.sendUnsubscribe(this);i(this.inflightUnsubscribe,n,e)}else e&&t.nextTick(e)},n.prototype.flush=function(){this.connection.canSend&&!this.inflightOp&&!this.paused&&this.pendingOps.length&&this._sendOp()},n.prototype._otApply=function(t,n){if(t.op){if(!this.type)throw new _$ShareDBError_75(e.ERR_DOC_DOES_NOT_EXIST,"Cannot apply op to uncreated document. "+this.collection+"."+this.id);if(!n&&this.type===_$types_79.defaultType&&t.op.length>1){this.applyStack||(this.applyStack=[]);for(var i=this.applyStack.length,o=0;o<t.op.length;o++){for(var s={op:[t.op[o]]},a=i;a<this.applyStack.length;a++){var c=r(this.applyStack[a],s);if(c)return this._hardRollback(c)}this.emit("before op",s.op,n),this.data=this.type.apply(this.data,s.op),this.emit("op",s.op,n)}return void this._popApplyStack(i)}return this.emit("before op",t.op,n),this.data=this.type.apply(this.data,t.op),void this.emit("op",t.op,n)}if(t.create)return this._setType(t.create.type),this.data=this.type.deserialize?this.type.createDeserialized?this.type.createDeserialized(t.create.data):this.type.deserialize(this.type.create(t.create.data)):this.type.create(t.create.data),void this.emit("create",n);if(t.del){var l=this.data;return this._setType(null),void this.emit("del",l,n)}},n.prototype._sendOp=function(){var t=this.connection.id;if(t){this.inflightOp||(this.inflightOp=this.pendingOps.shift());var n=this.inflightOp;if(!n){var i=new _$ShareDBError_75(e.ERR_INFLIGHT_OP_MISSING,"No op to send on call to _sendOp");return this.emit("error",i)}n.sentAt=Date.now(),n.retries=null==n.retries?0:n.retries+1,null==n.seq&&(n.seq=this.connection.seq++),this.connection.sendOp(this,n),null==n.src&&(n.src=t)}},n.prototype._submit=function(n,i,r){if(i||(i=!0),n.op){if(!this.type){var o=new _$ShareDBError_75(e.ERR_DOC_DOES_NOT_EXIST,"Cannot submit op. Document has not been created. "+this.collection+"."+this.id);return r?r(o):this.emit("error",o)}this.type.normalize&&(n.op=this.type.normalize(n.op))}try{this._pushOp(n,r),this._otApply(n,i)}catch(t){return this._hardRollback(t)}var s=this;t.nextTick(function(){s.flush()})},n.prototype._pushOp=function(t,e){if(this.applyStack)this.applyStack.push(t);else{var n=this._tryCompose(t);if(n)return void n.callbacks.push(e)}t.type=this.type,t.callbacks=[e],this.pendingOps.push(t)},n.prototype._popApplyStack=function(t){if(t>0)this.applyStack.length=t;else{var e=this.applyStack[0];if(this.applyStack=null,e)if(-1!==(i=this.pendingOps.indexOf(e)))for(var n=this.pendingOps.splice(i),i=0;i<n.length;i++){e=n[i];var r=this._tryCompose(e);r?r.callbacks=r.callbacks.concat(e.callbacks):this.pendingOps.push(e)}}},n.prototype._tryCompose=function(t){if(!this.preventCompose){var e=this.pendingOps[this.pendingOps.length-1];if(e&&!e.sentAt)return e.create&&t.op?(e.create.data=this.type.apply(e.create.data,t.op),e):e.op&&t.op&&this.type.compose?(e.op=this.type.compose(e.op,t.op),e):void 0}},n.prototype.submitOp=function(t,e,n){"function"==typeof e&&(n=e,e=null);var i={op:t},r=e&&e.source;this._submit(i,r,n)},n.prototype.create=function(t,n,i,r){if("function"==typeof n?(r=n,i=null,n=null):"function"==typeof i&&(r=i,i=null),n||(n=_$types_79.defaultType.uri),this.type){var o=new _$ShareDBError_75(e.ERR_DOC_ALREADY_CREATED,"Document already exists");return r?r(o):this.emit("error",o)}var s={create:{type:n,data:t}},a=i&&i.source;this._submit(s,a,r)},n.prototype.del=function(t,n){if("function"==typeof t&&(n=t,t=null),!this.type){var i=new _$ShareDBError_75(e.ERR_DOC_DOES_NOT_EXIST,"Document does not exist");return n?n(i):this.emit("error",i)}var r=t&&t.source;this._submit({del:!0},r,n)},n.prototype.pause=function(){this.paused=!0},n.prototype.resume=function(){this.paused=!1,this.flush()},n.prototype._opAcknowledged=function(t){if(this.inflightOp.create)this.version=t.v;else if(t.v!==this.version)return _$logger_76.warn("Invalid version from server. Expected: "+this.version+" Received: "+t.v,t),this.fetch();this.version++,this._clearInflightOp()},n.prototype._rollback=function(t){var e=this.inflightOp;if(e.op&&e.type.invert){e.op=e.type.invert(e.op);for(var n=0;n<this.pendingOps.length;n++){var i=r(this.pendingOps[n],e);if(i)return this._hardRollback(i)}try{this._otApply(e,!1)}catch(t){return this._hardRollback(t)}this._clearInflightOp(t)}else this._hardRollback(t)},n.prototype._hardRollback=function(t){var e=[];this.inflightOp&&e.push(this.inflightOp),e=e.concat(this.pendingOps),this._setType(null),this.version=null,this.inflightOp=null,this.pendingOps=[];var n=this;this.fetch(function(){for(var i=!!e.length,r=0;r<e.length;r++)i=o(e[r].callbacks,t)&&i;if(t&&!i)return n.emit("error",t)})},n.prototype._clearInflightOp=function(t){var e=this.inflightOp;this.inflightOp=null;var n=o(e.callbacks,t);if(this.flush(),this._emitNothingPending(),t&&!n)return this.emit("error",t)}}).call(this,_$browser_30);var _$Query_70={};(function(t){function e(t,e,n,i,r,o,s){_$emitter_74.EventEmitter.call(this),this.action=t,this.connection=e,this.id=n,this.collection=i,this.query=r,this.results=null,o&&o.results&&(this.results=o.results,delete o.results),this.extra=void 0,this.options=o,this.callback=s,this.ready=!1,this.sent=!1}_$Query_70=e,_$emitter_74.mixin(e),e.prototype.hasPending=function(){return!this.ready},e.prototype.send=function(){if(this.connection.canSend){var t={a:this.action,id:this.id,c:this.collection,q:this.query};if(this.options&&(t.o=this.options),this.results){for(var e=[],n=0;n<this.results.length;n++){var i=this.results[n];e.push([i.id,i.version])}t.r=e}this.connection.send(t),this.sent=!0}},e.prototype.destroy=function(e){this.connection.canSend&&"qs"===this.action&&this.connection.send({a:"qu",id:this.id}),this.connection._destroyQuery(this),e&&t.nextTick(e)},e.prototype._onConnectionStateChanged=function(){this.connection.canSend&&!this.sent?this.send():this.sent=!1},e.prototype._handleFetch=function(t,e,n){this.connection._destroyQuery(this),this._handleResponse(t,e,n)},e.prototype._handleSubscribe=function(t,e,n){this._handleResponse(t,e,n)},e.prototype._handleResponse=function(t,e,n){var i=this.callback;if(this.callback=null,t)return this._finishResponse(t,i);if(!e)return this._finishResponse(null,i);var r=this,o=1,s=function(t){if(t)return r._finishResponse(t,i);--o||r._finishResponse(null,i)};if(Array.isArray(e))o+=e.length,this.results=this._ingestSnapshots(e,s),this.extra=n;else for(var a in e){o++;var c=e[a];this.connection.get(c.c||this.collection,a).ingestSnapshot(c,s)}s()},e.prototype._ingestSnapshots=function(t,e){for(var n=[],i=0;i<t.length;i++){var r=t[i],o=this.connection.get(r.c||this.collection,r.d);o.ingestSnapshot(r,e),n.push(o)}return n},e.prototype._finishResponse=function(t,e){if(this.emit("ready"),this.ready=!0,t)return this.connection._destroyQuery(this),e?e(t):this.emit("error",t);e&&e(null,this.results,this.extra)},e.prototype._handleError=function(t){this.emit("error",t)},e.prototype._handleDiff=function(t){for(var e=0;e<t.length;e++){"insert"===(n=t[e]).type&&(n.values=this._ingestSnapshots(n.values))}for(e=0;e<t.length;e++){var n;switch((n=t[e]).type){case"insert":var i=n.values;Array.prototype.splice.apply(this.results,[n.index,0].concat(i)),this.emit("insert",i,n.index);break;case"remove":var r=n.howMany||1,o=this.results.splice(n.index,r);this.emit("remove",o,n.index);break;case"move":r=n.howMany||1;var s=this.results.splice(n.from,r);Array.prototype.splice.apply(this.results,[n.to,0].concat(s)),this.emit("move",s,n.from,n.to)}}this.emit("changed",this.results)},e.prototype._handleExtra=function(t){this.extra=t,this.emit("extra",t)}}).call(this,_$browser_30);var _$Snapshot_78=Snapshot;function Snapshot(t,e,n,i,r){this.id=t,this.v=e,this.type=n,this.data=i,this.m=r}var _$SnapshotRequest_71=SnapshotRequest;function SnapshotRequest(t,e,n,i,r){if(_$emitter_74.EventEmitter.call(this),"function"!=typeof r)throw new Error("Callback is required for SnapshotRequest");this.requestId=e,this.connection=t,this.id=i,this.collection=n,this.callback=r,this.sent=!1}_$emitter_74.mixin(SnapshotRequest),SnapshotRequest.prototype.send=function(){this.connection.canSend&&(this.connection.send(this._message()),this.sent=!0)},SnapshotRequest.prototype._onConnectionStateChanged=function(){this.connection.canSend?this.sent||this.send():this.sent=!1},SnapshotRequest.prototype._handleResponse=function(t,e){if(this.emit("ready"),t)return this.callback(t);var n=e.meta?e.meta:null,i=new _$Snapshot_78(this.id,e.v,e.type,e.data,n);this.callback(null,i)};var _$util_80={};function doNothing(){}_$util_80.hasKeys=function(t){for(var e in t)return!0;return!1},_$util_80.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},_$util_80.isValidVersion=function(t){return null===t||_$util_80.isInteger(t)&&t>=0},_$util_80.isValidTimestamp=function(t){return _$util_80.isValidVersion(t)};var _$SnapshotVersionRequest_73=SnapshotVersionRequest;function SnapshotVersionRequest(t,e,n,i,r,o){if(_$SnapshotRequest_71.call(this,t,e,n,i,o),!_$util_80.isValidVersion(r))throw new Error("Snapshot version must be a positive integer or null");this.version=r}SnapshotVersionRequest.prototype=Object.create(_$SnapshotRequest_71.prototype),SnapshotVersionRequest.prototype._message=function(){return{a:"nf",id:this.requestId,c:this.collection,d:this.id,v:this.version}};var _$SnapshotTimestampRequest_72=SnapshotTimestampRequest;function SnapshotTimestampRequest(t,e,n,i,r,o){if(_$SnapshotRequest_71.call(this,t,e,n,i,o),!_$util_80.isValidTimestamp(r))throw new Error("Snapshot timestamp must be a positive integer or null");this.timestamp=r}SnapshotTimestampRequest.prototype=Object.create(_$SnapshotRequest_71.prototype),SnapshotTimestampRequest.prototype._message=function(){return{a:"nt",id:this.requestId,c:this.collection,d:this.id,ts:this.timestamp}};var _$Connection_67={};(function(t){var e=_$ShareDBError_75.CODES;function n(t){return 0===t.readyState||1===t.readyState?"connecting":"disconnected"}function i(t){_$emitter_74.EventEmitter.call(this),this.collections={},this.nextQueryId=1,this.nextSnapshotRequestId=1,this.queries={},this._snapshotRequests={},this.seq=1,this.id=null,this.agent=null,this.debug=!1,this.state=n(t),this.bindToSocket(t)}function r(t,e){var n=new Error(t.message);return n.code=t.code,e&&(n.data=e),n}function o(t){return t.hasPending()}function s(t){return t.hasWritePending()}_$Connection_67=i,_$emitter_74.mixin(i),i.prototype.bindToSocket=function(e){this.socket&&(this.socket.close(),this.socket.onmessage=null,this.socket.onopen=null,this.socket.onerror=null,this.socket.onclose=null),this.socket=e;var i=n(e);this._setState(i),this.canSend=!1;var r=this;e.onmessage=function(e){try{var n="string"==typeof e.data?JSON.parse(e.data):e.data}catch(t){return void _$logger_76.warn("Failed to parse message",e)}r.debug&&_$logger_76.info("RECV",JSON.stringify(n));var i={data:n};if(r.emit("receive",i),i.data)try{r.handleMessage(i.data)}catch(e){t.nextTick(function(){r.emit("error",e)})}},e.onopen=function(){r._setState("connecting")},e.onerror=function(t){r.emit("connection error",t)},e.onclose=function(t){"closed"===t||"Closed"===t?r._setState("closed",t):"stopped"===t||"Stopped by server"===t?r._setState("stopped",t):r._setState("disconnected",t)}},i.prototype.handleMessage=function(t){var n=null;switch(t.error&&(n=r(t.error,t),delete t.error),t.a){case"init":return 1!==t.protocol?(n=new _$ShareDBError_75(e.ERR_PROTOCOL_VERSION_NOT_SUPPORTED,"Unsupported protocol version: "+t.protocol),this.emit("error",n)):_$types_79.map[t.type]!==_$types_79.defaultType?(n=new _$ShareDBError_75(e.ERR_DEFAULT_TYPE_MISMATCH,t.type+" does not match the server default type"),this.emit("error",n)):"string"!=typeof t.id?(n=new _$ShareDBError_75(e.ERR_CLIENT_ID_BADLY_FORMED,"Client id must be a string"),this.emit("error",n)):(this.id=t.id,void this._setState("connected"));case"qf":return void((i=this.queries[t.id])&&i._handleFetch(n,t.data,t.extra));case"qs":return void((i=this.queries[t.id])&&i._handleSubscribe(n,t.data,t.extra));case"qu":return;case"q":var i;if(!(i=this.queries[t.id]))return;return n?i._handleError(n):(t.diff&&i._handleDiff(t.diff),void(t.hasOwnProperty("extra")&&i._handleExtra(t.extra)));case"bf":return this._handleBulkMessage(n,t,"_handleFetch");case"bs":return this._handleBulkMessage(n,t,"_handleSubscribe");case"bu":return this._handleBulkMessage(n,t,"_handleUnsubscribe");case"nf":case"nt":return this._handleSnapshotFetch(n,t);case"f":return void((o=this.getExisting(t.c,t.d))&&o._handleFetch(n,t.data));case"s":return void((o=this.getExisting(t.c,t.d))&&o._handleSubscribe(n,t.data));case"u":return void((o=this.getExisting(t.c,t.d))&&o._handleUnsubscribe(n));case"op":var o;return void((o=this.getExisting(t.c,t.d))&&o._handleOp(n,t));default:_$logger_76.warn("Ignoring unrecognized message",t)}},i.prototype._handleBulkMessage=function(t,e,n){if(e.data)for(var i in e.data){var o=e.data[i];(a=this.getExisting(e.c,i))&&(t?a[n](t):o.error?a[n](r(o.error)):a[n](null,o))}else if(Array.isArray(e.b))for(var s=0;s<e.b.length;s++){i=e.b[s];(a=this.getExisting(e.c,i))&&a[n](t)}else if(e.b)for(var i in e.b){var a;(a=this.getExisting(e.c,i))&&a[n](t)}else _$logger_76.error("Invalid bulk message",e)},i.prototype._reset=function(){this.seq=1,this.id=null,this.agent=null},i.prototype._setState=function(t,n){if(this.state!==t){if("connecting"===t&&"disconnected"!==this.state&&"stopped"!==this.state&&"closed"!==this.state||"connected"===t&&"connecting"!==this.state){var i=new _$ShareDBError_75(e.ERR_CONNECTION_STATE_TRANSITION_INVALID,"Cannot transition directly from "+this.state+" to "+t);return this.emit("error",i)}for(var r in this.state=t,this.canSend="connected"===t,"disconnected"!==t&&"stopped"!==t&&"closed"!==t||this._reset(),this.startBulk(),this.queries){this.queries[r]._onConnectionStateChanged()}for(var o in this.collections){var s=this.collections[o];for(var r in s)s[r]._onConnectionStateChanged()}for(var r in this._snapshotRequests){this._snapshotRequests[r]._onConnectionStateChanged()}this.endBulk(),this.emit(t,n),this.emit("state",t,n)}},i.prototype.startBulk=function(){this.bulk||(this.bulk={})},i.prototype.endBulk=function(){if(this.bulk)for(var t in this.bulk){var e=this.bulk[t];this._sendBulk("f",t,e.f),this._sendBulk("s",t,e.s),this._sendBulk("u",t,e.u)}this.bulk=null},i.prototype._sendBulk=function(t,e,n){if(n){var i,r=[],o={},s=0;for(var a in n){var c=n[a];null==c?r.push(a):(o[a]=c,i=a,s++)}if(1===r.length){a=r[0];this.send({a:t,c:e,d:a})}else r.length&&this.send({a:"b"+t,c:e,b:r});if(1===s){var l=o[i];this.send({a:t,c:e,d:i,v:l})}else s&&this.send({a:"b"+t,c:e,b:o})}},i.prototype._sendAction=function(t,e,n){if(this._addDoc(e),this.bulk){var i=this.bulk[e.collection]||(this.bulk[e.collection]={}),r=i[t]||(i[t]={}),o=r.hasOwnProperty(e.id);return r[e.id]=n,o}var s={a:t,c:e.collection,d:e.id,v:n};this.send(s)},i.prototype.sendFetch=function(t){return this._sendAction("f",t,t.version)},i.prototype.sendSubscribe=function(t){return this._sendAction("s",t,t.version)},i.prototype.sendUnsubscribe=function(t){return this._sendAction("u",t)},i.prototype.sendOp=function(t,e){this._addDoc(t);var n={a:"op",c:t.collection,d:t.id,v:t.version,src:e.src,seq:e.seq};e.op&&(n.op=e.op),e.create&&(n.create=e.create),e.del&&(n.del=e.del),this.send(n)},i.prototype.send=function(t){this.debug&&_$logger_76.info("SEND",JSON.stringify(t)),this.emit("send",t),this.socket.send(JSON.stringify(t))},i.prototype.close=function(){this.socket.close()},i.prototype.getExisting=function(t,e){if(this.collections[t])return this.collections[t][e]},i.prototype.get=function(t,e){var n=this.collections[t]||(this.collections[t]={}),i=n[e];return i||(i=n[e]=new _$Doc_68(this,t,e),this.emit("doc",i)),i},i.prototype._destroyDoc=function(t){var e=this.collections[t.collection];e&&(delete e[t.id],_$util_80.hasKeys(e)||delete this.collections[t.collection])},i.prototype._addDoc=function(t){var e=this.collections[t.collection];e||(e=this.collections[t.collection]={}),e[t.id]!==t&&(e[t.id]=t)},i.prototype._createQuery=function(t,e,n,i,r){var o=this.nextQueryId++,s=new _$Query_70(t,this,o,e,n,i,r);return this.queries[o]=s,s.send(),s},i.prototype._destroyQuery=function(t){delete this.queries[t.id]},i.prototype.createFetchQuery=function(t,e,n,i){return this._createQuery("qf",t,e,n,i)},i.prototype.createSubscribeQuery=function(t,e,n,i){return this._createQuery("qs",t,e,n,i)},i.prototype.hasPending=function(){return!!(this._firstDoc(o)||this._firstQuery(o)||this._firstSnapshotRequest())},i.prototype.hasWritePending=function(){return!!this._firstDoc(s)},i.prototype.whenNothingPending=function(e){var n=this._firstDoc(o);if(n)n.once("nothing pending",this._nothingPendingRetry(e));else{var i=this._firstQuery(o);if(i)i.once("ready",this._nothingPendingRetry(e));else{var r=this._firstSnapshotRequest();r?r.once("ready",this._nothingPendingRetry(e)):t.nextTick(e)}}},i.prototype._nothingPendingRetry=function(e){var n=this;return function(){t.nextTick(function(){n.whenNothingPending(e)})}},i.prototype._firstDoc=function(t){for(var e in this.collections){var n=this.collections[e];for(var i in n){var r=n[i];if(t(r))return r}}},i.prototype._firstQuery=function(t){for(var e in this.queries){var n=this.queries[e];if(t(n))return n}},i.prototype._firstSnapshotRequest=function(){for(var t in this._snapshotRequests)return this._snapshotRequests[t]},i.prototype.fetchSnapshot=function(t,e,n,i){"function"==typeof n&&(i=n,n=null);var r=this.nextSnapshotRequestId++,o=new _$SnapshotVersionRequest_73(this,r,t,e,n,i);this._snapshotRequests[o.requestId]=o,o.send()},i.prototype.fetchSnapshotByTimestamp=function(t,e,n,i){"function"==typeof n&&(i=n,n=null);var r=this.nextSnapshotRequestId++,o=new _$SnapshotTimestampRequest_72(this,r,t,e,n,i);this._snapshotRequests[o.requestId]=o,o.send()},i.prototype._handleSnapshotFetch=function(t,e){var n=this._snapshotRequests[e.id];n&&(delete this._snapshotRequests[e.id],n._handleResponse(t,e))}}).call(this,_$browser_30);var _$client_69={};_$client_69.Connection=_$Connection_67,_$client_69.types=_$types_79;var _$RemoteDoc_47=RemoteDoc;function RemoteDoc(t,e,n,i,r){r&&(r.docs[n]=this),_$Doc_43.call(this,t,e,n),this.model=t.pass({$remote:!0}),this.debugMutations=t.root.debug.remoteMutations,this.shareDoc=t.root.connection.get(e,n),this.shareDoc.ingestSnapshot(i),this._initShareDoc()}function createInsertOp(t,e,n){if(!Array.isArray(n))return[new ListInsertOp(t,e,n)];for(var i=[],r=0,o=n.length;r<o;r++)i.push(new ListInsertOp(t,e++,n[r]));return i}function ImpliedOp(t,e){this.op=t,this.value=e}function ObjectReplaceOp(t,e,n){this.p=_$util_64.castSegments(t),this.od=e,this.oi=void 0===n?null:n}function ObjectInsertOp(t,e){this.p=_$util_64.castSegments(t),this.oi=void 0===e?null:e}function ObjectDeleteOp(t,e){this.p=_$util_64.castSegments(t),this.od=void 0===e?null:e}function ListReplaceOp(t,e,n,i){this.p=_$util_64.castSegments(t.concat(e)),this.ld=n,this.li=void 0===i?null:i}function ListInsertOp(t,e,n){this.p=_$util_64.castSegments(t.concat(e)),this.li=void 0===n?null:n}function ListRemoveOp(t,e,n){this.p=_$util_64.castSegments(t.concat(e)),this.ld=void 0===n?null:n}function ListMoveOp(t,e,n){this.p=_$util_64.castSegments(t.concat(e)),this.lm=n}function StringInsertOp(t,e,n){this.p=_$util_64.castSegments(t.concat(e)),this.si=n}function StringRemoveOp(t,e,n){this.p=_$util_64.castSegments(t.concat(e)),this.sd=n}function IncrementOp(t,e){this.p=_$util_64.castSegments(t),this.na=e}function SubtypeOp(t,e,n){this.p=_$util_64.castSegments(t),this.t=e,this.o=n}function defined(t){return void 0!==t}RemoteDoc.prototype=new _$Doc_43,RemoteDoc.prototype._initShareDoc=function(){var t=this,e=this.model,n=this.collectionName,i=this.id,r=this.shareDoc;e.root.debug.disableSubmit&&(r.submitOp=function(){},r.create=function(){},r.del=function(){}),r.on("op",function(e,n){n||(t._updateCollectionData(),t._onOp(e))}),r.on("del",function(r,o){o||(delete t.collectionData[i],e.emit("change",[n,i],[void 0,r,e._pass]))}),r.on("create",function(o){if(!o){t._updateCollectionData();var s=r.data;e.emit("change",[n,i],[s,void 0,e._pass])}}),r.on("error",function(t){e._emitError(t,n+"."+i)}),r.on("load",function(){t._updateCollectionData();var o=r.data;void 0!==o&&e.emit("load",[n,i],[o,e._pass])}),this._updateCollectionData()},RemoteDoc.prototype._updateCollectionData=function(){var t=this.shareDoc.data;"object"!=typeof t||Array.isArray(t)||null===t||(t.id=this.id),this.collectionData[this.id]=t},RemoteDoc.prototype.create=function(t,e){this.debugMutations&&console.log("RemoteDoc create",this.path(),t);var n=_$util_64.deepCopy(t);n&&delete n.id,this.shareDoc.create(n,e),this.shareDoc.data=t,this._updateCollectionData(),this.model._context.createDoc(this.collectionName,this.id)},RemoteDoc.prototype.set=function(t,e,n){this.debugMutations&&console.log("RemoteDoc set",this.path(t),e);var i=this._createImplied(t),r=t[t.length-1];if(i instanceof ImpliedOp)return i.value[r]=e,this.shareDoc.submitOp(i.op,n),void this._updateCollectionData();var o=_$util_64.isArrayIndex(r)?[new ListReplaceOp(t.slice(0,-1),r,i,e)]:[new ObjectReplaceOp(t,i,e)];return this.shareDoc.submitOp(o,n),this._updateCollectionData(),i},RemoteDoc.prototype.del=function(t,e){if(this.debugMutations&&console.log("RemoteDoc del",this.path(t)),0===t.length){var n=this.get();return this.shareDoc.del(e),delete this.collectionData[this.id],n}if(void 0!==(n=this.get(t))){var i=[new ObjectDeleteOp(t,n)];return this.shareDoc.submitOp(i,e),this._updateCollectionData(),n}e()},RemoteDoc.prototype.increment=function(t,e,n){this.debugMutations&&console.log("RemoteDoc increment",this.path(t),e);var i=this._createImplied(t);if(i instanceof ImpliedOp){var r=t[t.length-1];return i.value[r]=e,this.shareDoc.submitOp(i.op,n),this._updateCollectionData(),e}if(null==i){r=t[t.length-1];var o=_$util_64.isArrayIndex(r)?[new ListInsertOp(t.slice(0,-1),r,e)]:[new ObjectInsertOp(t,e)];return this.shareDoc.submitOp(o,n),this._updateCollectionData(),e}o=[new IncrementOp(t,e)];return this.shareDoc.submitOp(o,n),this._updateCollectionData(),i+e},RemoteDoc.prototype.push=function(t,e,n){this.debugMutations&&console.log("RemoteDoc push",this.path(t),e);var i=this.shareDoc;return this._arrayApply(t,function(n,r){var o=[new ListInsertOp(t,n.length,e)];return i.submitOp(o,r),n.length},n)},RemoteDoc.prototype.unshift=function(t,e,n){this.debugMutations&&console.log("RemoteDoc unshift",this.path(t),e);var i=this.shareDoc;return this._arrayApply(t,function(n,r){var o=[new ListInsertOp(t,0,e)];return i.submitOp(o,r),n.length},n)},RemoteDoc.prototype.insert=function(t,e,n,i){this.debugMutations&&console.log("RemoteDoc insert",this.path(t),e,n);var r=this.shareDoc;return this._arrayApply(t,function(i,o){var s=createInsertOp(t,e,n);return r.submitOp(s,o),i.length},i)},RemoteDoc.prototype.pop=function(t,e){this.debugMutations&&console.log("RemoteDoc pop",this.path(t));var n=this.shareDoc;return this._arrayApply(t,function(e,i){var r=e.length-1,o=e[r],s=[new ListRemoveOp(t,r,o)];return n.submitOp(s,i),o},e)},RemoteDoc.prototype.shift=function(t,e){this.debugMutations&&console.log("RemoteDoc shift",this.path(t));var n=this.shareDoc;return this._arrayApply(t,function(e,i){var r=e[0],o=[new ListRemoveOp(t,0,r)];return n.submitOp(o,i),r},e)},RemoteDoc.prototype.remove=function(t,e,n,i){this.debugMutations&&console.log("RemoteDoc remove",this.path(t),e,n);var r=this.shareDoc;return this._arrayApply(t,function(i,o){for(var s=i.slice(e,e+n),a=[],c=0,l=s.length;c<l;c++)a.push(new ListRemoveOp(t,e,s[c]));return r.submitOp(a,o),s},i)},RemoteDoc.prototype.move=function(t,e,n,i,r){this.debugMutations&&console.log("RemoteDoc move",this.path(t),e,n,i);var o=this.shareDoc;return this._arrayApply(t,function(r,s){for(var a=r.slice(e,e+i),c=[],l=0;l<i;l++)c.push(new ListMoveOp(t,e<n?e:e+i-1,e<n?n+i-1:n));return o.submitOp(c,s),a},r)},RemoteDoc.prototype.stringInsert=function(t,e,n,i){this.debugMutations&&console.log("RemoteDoc stringInsert",this.path(t),e,n);var r=this._createImplied(t);if(r instanceof ImpliedOp){var o=t[t.length-1];return r.value[o]=n,this.shareDoc.submitOp(r.op,i),void this._updateCollectionData()}if(null==r){o=t[t.length-1];var s=_$util_64.isArrayIndex(o)?[new ListInsertOp(t.slice(0,-1),o,n)]:[new ObjectInsertOp(t,n)];return this.shareDoc.submitOp(s,i),this._updateCollectionData(),r}s=[new StringInsertOp(t,e,n)];return this.shareDoc.submitOp(s,i),this._updateCollectionData(),r},RemoteDoc.prototype.stringRemove=function(t,e,n,i){this.debugMutations&&console.log("RemoteDoc stringRemove",this.path(t),e,n);var r=this._createImplied(t);if(!(r instanceof ImpliedOp)){if(null==r)return r;var o=[new StringRemoveOp(t,e,r.slice(e,e+n))];return this.shareDoc.submitOp(o,i),this._updateCollectionData(),r}},RemoteDoc.prototype.subtypeSubmit=function(t,e,n,i){this.debugMutations&&console.log("RemoteDoc subtypeSubmit",this.path(t),e,n);var r=this._createImplied(t);r instanceof ImpliedOp&&(this.shareDoc.submitOp(r.op),r=void 0);var o=new SubtypeOp(t,e,n);return this.shareDoc.submitOp(o,i),this._updateCollectionData(),r},RemoteDoc.prototype.get=function(t){return _$util_64.lookup(t,this.shareDoc.data)},RemoteDoc.prototype._createImplied=function(t){if(!this.shareDoc.type)throw new Error("Mutation on uncreated remote document");for(var e,n,i=this.shareDoc,r="data",o=i[r],s=0,a=t[s++];null!=a;)o||(e?n=n[r]=_$util_64.isArrayIndex(a)?[]:{}:(n=_$util_64.isArrayIndex(a)?[]:{},e=Array.isArray(i)?r>=i.length?new ListInsertOp(t.slice(0,s-2),r,n):new ListReplaceOp(t.slice(0,s-2),r,o,n):new ObjectInsertOp(t.slice(0,s-1),n)),o=n),o=(i=o)[r=a],a=t[s++];return e?new ImpliedOp(e,n):o},RemoteDoc.prototype._arrayApply=function(t,e,n){var i=this._createImplied(t);if(i instanceof ImpliedOp&&(this.shareDoc.submitOp(i.op),i=this.get(t)),null==i){var r=t[t.length-1],o=_$util_64.isArrayIndex(r)?[new ListInsertOp(t.slice(0,-1),r,[])]:[new ObjectInsertOp(t,[])];this.shareDoc.submitOp(o),i=this.get(t)}if(!Array.isArray(i)){var s=this._errorMessage(e.name+" on non-array",t,i);return n(new TypeError(s))}var a=e(i,n);return this._updateCollectionData(),a},RemoteDoc.prototype._onOp=function(t){var e;if(1!==t.length){if(0===t.length)return;try{t=JSON.stringify(t)}catch(t){}throw new Error("Received op with multiple components from ShareDB "+t)}e=t[0];var n=[this.collectionName,this.id].concat(e.p),i=this.model;if(defined(e.oi)||defined(e.od)){var r=e.oi,o=e.od;i.emit("change",n,[r,o,i._pass])}else if(defined(e.li)&&defined(e.ld)){r=e.li,o=e.ld;i.emit("change",n,[r,o,i._pass])}else if(defined(e.li)){var s=n[n.length-1],a=[e.li];i.emit("insert",n.slice(0,-1),[s,a,i._pass])}else if(defined(e.ld)){s=n[n.length-1];var c=[e.ld];i.emit("remove",n.slice(0,-1),[s,c,i._pass])}else if(defined(e.lm)){var l=n[n.length-1],h=e.lm,u=1;i.emit("move",n.slice(0,-1),[l,h,u,i._pass])}else if(defined(e.si)){s=n[n.length-1];var p=e.si;n=n.slice(0,-1);o=(r=i._get(n)).slice(0,s)+r.slice(s+p.length);var f=i.pass({$stringInsert:{index:s,text:p}})._pass;i.emit("change",n,[r,o,f])}else if(defined(e.sd)){s=n[n.length-1],u=(p=e.sd).length;n=n.slice(0,-1);o=(r=i._get(n)).slice(0,s)+p+r.slice(s),f=i.pass({$stringRemove:{index:s,howMany:u}})._pass;i.emit("change",n,[r,o,f])}else if(defined(e.na)){o=(r=this.get(e.p))-e.na;i.emit("change",n,[r,o,i._pass])}else if(defined(e.t)){r=this.get(e.p),o=void 0;var d=e.t;t=e.o,f=i.pass({$subtype:{type:d,op:t}})._pass;i.emit("change",n,[r,o,f])}};var _$connection_49={},Connection=_$client_69.Connection;_$Model_45.INITS.push(function(t){t.root._preventCompose=!1}),_$Model_45.prototype.preventCompose=function(){var t=this._child();return t._preventCompose=!0,t},_$Model_45.prototype.allowCompose=function(){var t=this._child();return t._preventCompose=!1,t},_$Model_45.prototype.createConnection=function(t){this.root.socket=this._createSocket(t);var e=this;this.root.connection=new Connection(this.root.socket),this.root.connection.on("state",function(t,n){e._setDiff(["$connection","state"],t),e._setDiff(["$connection","reason"],n)}),this._set(["$connection","state"],"connected"),this._finishCreateConnection()},_$Model_45.prototype._finishCreateConnection=function(){var t=this;this.root.connection.on("error",function(e){t._emitError(e)}),this.root.connection.on("doc",function(e){t.getOrCreateDoc(e.collection,e.id)})},_$Model_45.prototype.connect=function(){this.root.socket.open()},_$Model_45.prototype.disconnect=function(){this.root.socket.close()},_$Model_45.prototype.reconnect=function(){this.disconnect(),this.connect()},_$Model_45.prototype.close=function(t){t=this.wrapCallback(t);var e=this;this.whenNothingPending(function(){e.root.socket.close(),t()})},_$Model_45.prototype.getAgent=function(){return this.root.connection.agent},_$Model_45.prototype._isLocal=function(t){var e=t.charAt(0);return"_"===e||"$"===e},_$Model_45.prototype._getDocConstructor=function(t){return this._isLocal(t)?_$LocalDoc_44:_$RemoteDoc_47},_$Model_45.prototype.hasPending=function(){return this.root.connection.hasPending()},_$Model_45.prototype.hasWritePending=function(){return this.root.connection.hasWritePending()},_$Model_45.prototype.whenNothingPending=function(t){return this.root.connection.whenNothingPending(t)};var _$Query_46={};(function(t){var e=_$client_69.types.defaultType;function n(){this.map={},this.collections={}}function i(t,e,n,i){this.model=t.pass({$query:this}),this.collectionName=e,this.expression=n,this.options=i,this.hash=r(e,n,i),this.segments=["$queries",this.hash],this.idsSegments=["$queries",this.hash,"ids"],this.extraSegments=["$queries",this.hash,"extra"],this._pendingSubscribeCallbacks=[],this.subscribeCount=0,this.fetchCount=0,this.created=!1,this.shareQuery=null,this.idMap={}}function r(t,e,n){var i=[t,e,n];return JSON.stringify(i).replace(/\./g,"|")}function o(t){for(var e=[],n=0;n<t.length;n++){var i=t[n];e.push(i.id)}return e}_$Query_46=i,_$Model_45.INITS.push(function(t){t.root._queries=new n}),_$Model_45.prototype.query=function(t,e,n){return"string"==typeof n&&(n={db:n}),this._getOrCreateQuery(t,e,n,i)},_$Model_45.prototype._getOrCreateQuery=function(t,e,n,i){e=this.sanitizeQuery(e);var r=this.root._queries.get(t,e,n);return r||(r=new i(this,t,e,n),this.root._queries.add(r),r)},_$Model_45.prototype.sanitizeQuery=function(t){if(t&&"object"==typeof t)for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];void 0===n?t[e]=null:this.sanitizeQuery(n)}return t},_$Model_45.prototype._initQueries=function(t){for(var e=this.root._queries,n=0;n<t.length;n++){var r=t[n],o=r[0],s=r[1],a=r[2],c=r[3]||[],l=r[4],h=r[5],u=this.root._queries.get(s,a,l);u||(u=new i(this,s,a,l),e.add(u)),u._setExtra(h);for(var p=[],f=0;f<c.length;f++){var d=c[f];if("string"!=typeof d){var m=d[0],_=d[1],v=d[2]||m.id,y=d[3];p.push(v);var g={data:m,v:_,type:y};this.getOrCreateDoc(s,v,g)}else p.push(d)}u._addMapIds(p),this._set(u.idsSegments,p);for(var b=0;b<o.length;b++){var w=o[b],E=w[0]||0,x=w[1]||0,C=w[2];for(C&&u.model.setContext(C);E--;)u.subscribe();for(u.fetchCount+=x;x--;)u.model._context.fetchQuery(u)}}},n.prototype.add=function(t){this.map[t.hash]=t,(this.collections[t.collectionName]||(this.collections[t.collectionName]={}))[t.hash]=t},n.prototype.remove=function(t){delete this.map[t.hash];var e=this.collections[t.collectionName];if(e){for(var n in delete e[t.hash],e)return;delete this.collections[t.collectionName]}},n.prototype.get=function(t,e,n){var i=r(t,e,n);return this.map[i]},n.prototype.toJSON=function(){var t=[];for(var e in this.map){var n=this.map[e];(n.subscribeCount||n.fetchCount)&&t.push(n.serialize())}return t},i.prototype.create=function(){this.created=!0,this.model.root._queries.add(this)},i.prototype.destroy=function(){var t=this.getIds();this.created=!1,this.shareQuery&&(this.shareQuery.destroy(),this.shareQuery=null),this.model.root._queries.remove(this),this.idMap={},this.model._del(this.segments),this._maybeUnloadDocs(t)},i.prototype.fetch=function(t){t=this.model.wrapCallback(t),this.model._context.fetchQuery(this),this.fetchCount++,this.created||this.create();var e=this;return this.model.root.connection.createFetchQuery(this.collectionName,this.expression,this.options,function(n,i,r){if(n)return t(n);e._setExtra(r),e._setResults(i),t()}),this},i.prototype.subscribe=function(e){if(e=this.model.wrapCallback(e),this.model._context.subscribeQuery(this),this.subscribeCount++){var n=this;return t.nextTick(function(){n.model._get(n.segments)?e():n._pendingSubscribeCallbacks.push(e)}),this}this.created||this.create();var i=this.options?_$util_64.copy(this.options):{};return i.results=this._getShareResults(),this.model.root.fetchOnly?this._shareFetchedSubscribe(i,e):this._shareSubscribe(i,e),this},i.prototype._subscribeCb=function(t){var e=this;return function(n,i,r){if(n)return e._flushSubscribeCallbacks(n,t);e._setExtra(r),e._setResults(i),e._flushSubscribeCallbacks(null,t)}},i.prototype._shareFetchedSubscribe=function(t,e){this.model.root.connection.createFetchQuery(this.collectionName,this.expression,t,this._subscribeCb(e))},i.prototype._shareSubscribe=function(t,e){var n=this;this.shareQuery&&this.shareQuery.destroy(),this.shareQuery=this.model.root.connection.createSubscribeQuery(this.collectionName,this.expression,t,this._subscribeCb(e)),this.shareQuery.on("insert",function(t,e){var i=o(t);n._addMapIds(i),n.model._insert(n.idsSegments,e,i)}),this.shareQuery.on("remove",function(t,e){var i=o(t);n._removeMapIds(i),n.model._remove(n.idsSegments,e,t.length)}),this.shareQuery.on("move",function(t,e,i){n.model._move(n.idsSegments,e,i,t.length)}),this.shareQuery.on("extra",function(t){n.model._setDiffDeep(n.extraSegments,t)}),this.shareQuery.on("error",function(t){n.model._emitError(t,n.hash)})},i.prototype._removeMapIds=function(t){for(var e=t.length;e--;){var n=t[e];this.idMap[n]>1?this.idMap[n]--:delete this.idMap[n]}if(this.model.root.unloadDelay){var i=this;setTimeout(function(){i._maybeUnloadDocs(t)},this.model.root.unloadDelay)}else this._maybeUnloadDocs(t)},i.prototype._addMapIds=function(t){for(var e=t.length;e--;){var n=t[e];this.idMap[n]=(this.idMap[n]||0)+1}},i.prototype._diffMapIds=function(t){for(var e=[],n=[],i={},r=t.length;r--;){i[o=t[r]]=!0,this.idMap[o]||e.push(o)}for(var o in this.idMap)i[o]||n.push(o);e.length&&this._addMapIds(e),n.length&&this._removeMapIds(n)},i.prototype._setExtra=function(t){void 0!==t&&this.model._setDiffDeep(this.extraSegments,t)},i.prototype._setResults=function(t){var e=o(t);this._setResultIds(e)},i.prototype._setResultIds=function(t){this._diffMapIds(t),this.model._setArrayDiff(this.idsSegments,t)},i.prototype._maybeUnloadDocs=function(t){for(var e=0;e<t.length;e++){var n=t[e];this.model._maybeUnloadDoc(this.collectionName,n)}},i.prototype._flushSubscribeCallbacks=function(t,e){var n;for(e(t);n=this._pendingSubscribeCallbacks.shift();)n(t)},i.prototype.unfetch=function(t){if(t=this.model.wrapCallback(t),this.model._context.unfetchQuery(this),!this.fetchCount)return t(),this;var e=this;function n(){var n=--e.fetchCount;if(n)return t(null,n);e.subscribeCount||e.destroy(),t(null,0)}return this.model.root.unloadDelay?setTimeout(n,this.model.root.unloadDelay):n(),this},i.prototype.unsubscribe=function(t){if(t=this.model.wrapCallback(t),this.model._context.unsubscribeQuery(this),!this.subscribeCount)return t(),this;var e=this;function n(){var n=--e.subscribeCount;if(n)return t(null,n);e.shareQuery&&(e.shareQuery.destroy(),e.shareQuery=null),function(n){if(n)return t(n);e.fetchCount||e.destroy();t(null,0)}()}return this.model.root.unloadDelay?setTimeout(n,this.model.root.unloadDelay):n(),this},i.prototype._getShareResults=function(){var t=this.model._get(this.idsSegments);if(t){var e=this.model.getCollection(this.collectionName);if(e){for(var n=[],i=0;i<t.length;i++){var r=t[i],o=e.docs[r];n.push(o&&o.shareDoc)}return n}}},i.prototype.get=function(){var t=[],e=this.model._get(this.segments);if(!e)return console.warn("You must fetch or subscribe to a query before getting its results."),t;var n=e.ids;if(!n)return t;for(var i=this.model.getCollection(this.collectionName),r=0,o=n.length;r<o;r++){var s=n[r],a=i&&i.docs[s];t.push(a&&a.get())}return t},i.prototype.getIds=function(){return this.model._get(this.idsSegments)||[]},i.prototype.getExtra=function(){return this.model._get(this.extraSegments)},i.prototype.ref=function(t){var e=this.idsSegments.join(".");return this.model.refList(t,this.collectionName,e)},i.prototype.refIds=function(t){var e=this.idsSegments.join(".");return this.model.root.ref(t,e)},i.prototype.refExtra=function(t,e){var n=this.extraSegments.join(".");return e&&(n+="."+e),this.model.root.ref(t,n)},i.prototype.serialize=function(){var t,n=this.getIds(),i=this.model.getCollection(this.collectionName);if(i){t=[];for(var r=0;r<n.length;r++){var o=n[r],s=i.docs[o];if(s){delete i.docs[o];var a=s.shareDoc.data,c=[a,s.shareDoc.version];a&&a.id===o||(c[2]=o),s.shareDoc.type!==e&&(c[3]=s.shareDoc.type&&s.shareDoc.type.name),t.push(c)}else t.push(o)}}var l=[],h=this.model.root._contexts;for(var u in h){var p=h[u],f=p.subscribedQueries[this.hash]||0,d=p.fetchedQueries[this.hash]||0;(f||d)&&("root"!==u?l.push([f,d,u]):d?l.push([f,d]):l.push([f]))}for(var m=[l,this.collectionName,this.expression,t,this.options,this.getExtra()];null==m[m.length-1];)m.pop();return m}}).call(this,_$browser_30);var _$CollectionCounter_42=CollectionCounter;function CollectionCounter(){this.reset()}CollectionCounter.prototype.reset=function(){this.collections={}},CollectionCounter.prototype.get=function(t,e){var n=this.collections[t];return n&&n[e]},CollectionCounter.prototype.increment=function(t,e){var n=this.collections[t]||(this.collections[t]={}),i=(n[e]||0)+1;return n[e]=i,i},CollectionCounter.prototype.decrement=function(t,e){var n=this.collections[t],i=n&&n[e];if(null!=i){if(i>1)return i--,n[e]=i,i;for(var r in delete n[e],n)return 0;return delete this.collections[t],0}},CollectionCounter.prototype.toJSON=function(){for(var t in this.collections)return this.collections};var _$subscriptions_61={};(function(t){_$Model_45.INITS.push(function(t,e){t.root.fetchOnly=e.fetchOnly,t.root.unloadDelay=e.unloadDelay||_$util_64.isServer?0:1e3,t.root._fetchedDocs=new _$CollectionCounter_42,t.root._subscribedDocs=new _$CollectionCounter_42}),_$Model_45.prototype.fetch=function(){return this._forSubscribable(arguments,"fetch"),this},_$Model_45.prototype.unfetch=function(){return this._forSubscribable(arguments,"unfetch"),this},_$Model_45.prototype.subscribe=function(){return this._forSubscribable(arguments,"subscribe"),this},_$Model_45.prototype.unsubscribe=function(){return this._forSubscribable(arguments,"unsubscribe"),this},_$Model_45.prototype._forSubscribable=function(e,n){var i,r;if(e.length)if("function"==typeof e[0])i=[null],r=e[0];else if(Array.isArray(e[0]))i=e[0],r=e[1];else{"function"==typeof(i=Array.prototype.slice.call(e))[i.length-1]&&(r=i.pop())}else i=[null];var o=_$util_64.asyncGroup(this.wrapCallback(r)),s=o(),a=n+"Doc";this.root.connection.startBulk();for(var c=0;c<i.length;c++){var l=i[c];if(l instanceof _$Query_46)l[n](o());else{var h=this._dereference(this._splitPath(l));if(2===h.length)this[a](h[0],h[1],o());else{var u="Cannot "+n+" to path: "+h.join(".");o()(new Error(u))}}}this.root.connection.endBulk(),t.nextTick(s)},_$Model_45.prototype.fetchDoc=function(t,e,n){n=this.wrapCallback(n),this._context.fetchDoc(t,e),this.root._fetchedDocs.increment(t,e),this.getOrCreateDoc(t,e).shareDoc.fetch(n)},_$Model_45.prototype.subscribeDoc=function(t,e,n){n=this.wrapCallback(n),this._context.subscribeDoc(t,e),this.root._subscribedDocs.increment(t,e);var i=this.getOrCreateDoc(t,e);if(i.shareDoc.subscribed)return n();this.root.fetchOnly?i.shareDoc.fetch(n):i.shareDoc.subscribe(n)},_$Model_45.prototype.unfetchDoc=function(t,e,n){if(n=this.wrapCallback(n),this._context.unfetchDoc(t,e),!this.root._fetchedDocs.get(t,e))return n();var i=this;function r(){var r=i.root._fetchedDocs.decrement(t,e);if(r)return n(null,r);i._maybeUnloadDoc(t,e),n(null,0)}this.root.unloadDelay?setTimeout(r,this.root.unloadDelay):r()},_$Model_45.prototype.unsubscribeDoc=function(t,e,n){if(n=this.wrapCallback(n),this._context.unsubscribeDoc(t,e),!this.root._subscribedDocs.get(t,e))return n();var i=this;function r(){var r=i.root._subscribedDocs.decrement(t,e);if(r)return n(null,r);if(i.root.fetchOnly)o();else{var s=i.getDoc(t,e),a=s&&s.shareDoc;if(!a)return o();a.unsubscribe(o)}}function o(r){if(i._maybeUnloadDoc(t,e),r)return n(r);n(null,0)}this.root.unloadDelay?setTimeout(r,this.root.unloadDelay):r()},_$Model_45.prototype._maybeUnloadDoc=function(t,e){var n=this.getDoc(t,e);if(n&&!(this._hasDocReferences(t,e)||n.shareDoc&&n.shareDoc.hasPending())){var i=n.get();this.root.collections[t].remove(e),n.shareDoc&&n.shareDoc.destroy(),this.emit("unload",[t,e],[i,this._pass])}},_$Model_45.prototype._hasDocReferences=function(t,e){var n=this.root._queries.collections[t];if(n)for(var i in n){var r=n[i];if((r.subscribeCount||r.fetchCount)&&r.idMap[e]>0)return!0}return!(!this.root._fetchedDocs.get(t,e)&&!this.root._subscribedDocs.get(t,e))}}).call(this,_$browser_30);var _$contexts_50={};function Contexts(){}function FetchedQueries(){}function SubscribedQueries(){}function Context(t,e){this.model=t,this.id=e,this.fetchedDocs=new _$CollectionCounter_42,this.subscribedDocs=new _$CollectionCounter_42,this.createdDocs=new _$CollectionCounter_42,this.fetchedQueries=new FetchedQueries,this.subscribedQueries=new SubscribedQueries}function mapIncrement(t,e){t[e]=(t[e]||0)+1}function mapDecrement(t,e){t[e]&&t[e]--,t[e]||delete t[e]}_$Model_45.INITS.push(function(t){t.root._contexts=new Contexts,t.root.setContext("root")}),_$Model_45.prototype.context=function(t){var e=this._child();return e.setContext(t),e},_$Model_45.prototype.setContext=function(t){this._context=this.getOrCreateContext(t)},_$Model_45.prototype.getOrCreateContext=function(t){return this.root._contexts[t]||(this.root._contexts[t]=new Context(this,t))},_$Model_45.prototype.unload=function(t){var e=t?this.root._contexts[t]:this._context;e&&e.unload()},_$Model_45.prototype.unloadAll=function(){var t=this.root._contexts;for(var e in t)t[e].unload()},Context.prototype.toJSON=function(){var t=this.fetchedDocs.toJSON(),e=this.subscribedDocs.toJSON(),n=this.createdDocs.toJSON();if(t||e||n)return{fetchedDocs:t,subscribedDocs:e,createdDocs:n}},Context.prototype.fetchDoc=function(t,e){this.fetchedDocs.increment(t,e)},Context.prototype.subscribeDoc=function(t,e){this.subscribedDocs.increment(t,e)},Context.prototype.unfetchDoc=function(t,e){this.fetchedDocs.decrement(t,e)},Context.prototype.unsubscribeDoc=function(t,e){this.subscribedDocs.decrement(t,e)},Context.prototype.createDoc=function(t,e){this.createdDocs.increment(t,e)},Context.prototype.fetchQuery=function(t){mapIncrement(this.fetchedQueries,t.hash)},Context.prototype.subscribeQuery=function(t){mapIncrement(this.subscribedQueries,t.hash)},Context.prototype.unfetchQuery=function(t){mapDecrement(this.fetchedQueries,t.hash)},Context.prototype.unsubscribeQuery=function(t){mapDecrement(this.subscribedQueries,t.hash)},Context.prototype.unload=function(){var t=this.model;for(var e in this.fetchedQueries){if(i=t.root._queries.map[e])for(var n=this.fetchedQueries[e];n--;)i.unfetch()}for(var e in this.subscribedQueries){var i;if(i=t.root._queries.map[e])for(n=this.subscribedQueries[e];n--;)i.unsubscribe()}for(var r in this.fetchedDocs.collections){var o=this.fetchedDocs.collections[r];for(var s in o)for(n=o[s];n--;)t.unfetchDoc(r,s)}for(var r in this.subscribedDocs.collections){o=this.subscribedDocs.collections[r];for(var s in o)for(n=o[s];n--;)t.unsubscribeDoc(r,s)}for(var r in this.createdDocs.collections){o=this.createdDocs.collections[r];for(var s in o)t._maybeUnloadDoc(r,s)}this.createdDocs.reset()};var _$defaultFns_51={},defaultFns=_$defaultFns_51=new DefaultFns;function DefaultFns(){}function FnPair(t,e){this.get=t,this.set=e}function getReverse(t){return t&&t.slice().reverse()}function setReverse(t){return{0:getReverse(t)}}function asc(t,e){return t<e?-1:t>e?1:0}function desc(t,e){return t>e?-1:t<e?1:0}defaultFns.reverse=new FnPair(getReverse,setReverse),defaultFns.asc=asc,defaultFns.desc=desc;var _$fn_54={};(function(t){function e(){}function n(t,e,n){var i,r,o,s,a,c=e.pop();"string"==typeof c?r=c:i=c,n&&(o=t.path(e.shift())),c=e[e.length-1],Array.isArray(c)||t.isPath(c)||(s=e.pop());for(var l=(a=1===e.length&&Array.isArray(e[0])?e[0]:e).length;l--;)a[l]=t.path(a[l]);return{name:r,path:o,inputPaths:a,fns:i,options:s}}function i(){}function r(t){this.model=t,this.nameMap=t.root._namedFns,this.fromMap=new i}function o(t,e,n,i,r,o){if(this.model=t.pass({$fn:this}),this.name=e,this.from=n,this.inputPaths=i,this.options=o,!r)throw new TypeError("Model function not found: "+e);this.getFn=r.get||r,this.setFn=r.set,this.fromSegments=n&&n.split("."),this.inputsSegments=[];for(var s=0;s<this.inputPaths.length;s++){var a=this.inputPaths[s].split(".");this.inputsSegments.push(a)}var c=o&&o.copy||"output";this.copyInput="input"===c||"both"===c,this.copyOutput="output"===c||"both"===c,this.mode=o&&o.mode||"diffDeep",this.async=!(!o||!o.async),this.eventPending=!1}_$Model_45.INITS.push(function(t){t.root._namedFns=new e,t.root._fns=new r(t),t.on("all",function(e,n){var i=n[n.length-1],r=t.root._fns.fromMap;for(var o in r){var s=r[o];i.$fn!==s&&(_$util_64.mayImpactAny(s.inputsSegments,e)?s.onInput(i):_$util_64.mayImpact(s.fromSegments,e)&&s.onOutput(i))}})}),_$Model_45.prototype.fn=function(t,e){this.root._namedFns[t]=e},_$Model_45.prototype.evaluate=function(){var t=n(this,Array.prototype.slice.call(arguments),!1);return this.root._fns.get(t.name,t.inputPaths,t.fns,t.options)},_$Model_45.prototype.start=function(){var t=n(this,Array.prototype.slice.call(arguments),!0);return this.root._fns.start(t.name,t.path,t.inputPaths,t.fns,t.options)},_$Model_45.prototype.stop=function(t){var e=this.path(t);this._stop(e)},_$Model_45.prototype._stop=function(t){this.root._fns.stop(t)},_$Model_45.prototype.stopAll=function(t){var e=this._splitPath(t);this._stopAll(e)},_$Model_45.prototype._stopAll=function(t){var e=this.root._fns.fromMap;for(var n in e){var i=e[n].fromSegments;_$util_64.contains(t,i)&&this._stop(n)}},r.prototype.get=function(t,e,n,i){return n||(n=this.nameMap[t]||_$defaultFns_51[t]),new o(this.model,t,null,e,n,i).get()},r.prototype.start=function(t,e,n,i,r){i||(i=this.nameMap[t]||_$defaultFns_51[t]);var s=new o(this.model,t,e,n,i,r);return this.fromMap[e]=s,s._onInput()},r.prototype.stop=function(t){var e=this.fromMap[t];return delete this.fromMap[t],e},r.prototype.toJSON=function(){var t=[];for(var e in this.fromMap){var n=this.fromMap[e];if(n.name){var i=[n.from].concat(n.inputPaths);n.options&&i.push(n.options),i.push(n.name),t.push(i)}}return t},o.prototype.apply=function(t,e){for(var n=0,i=this.inputsSegments.length;n<i;n++){var r=this.model._get(this.inputsSegments[n]);e.push(this.copyInput?_$util_64.deepCopy(r):r)}return t.apply(this.model,e)},o.prototype.get=function(){return this.apply(this.getFn,[])},o.prototype.set=function(t,e){if(this.setFn){var n=this.apply(this.setFn,[t]);if(n){var i=this.inputsSegments,r=this.model.pass(e,!0);for(var o in n){t=this.copyOutput?_$util_64.deepCopy(n[o]):n[o];this._setValue(r,i[o],t)}}}},o.prototype.onInput=function(e){if(!this.async)return this._onInput(e);if(!this.eventPending){this.eventPending=!0;var n=this;t.nextTick(function(){n._onInput(e),n.eventPending=!1})}},o.prototype._onInput=function(t){var e=this.copyOutput?_$util_64.deepCopy(this.get()):this.get();return this._setValue(this.model.pass(t,!0),this.fromSegments,e),e},o.prototype.onOutput=function(t){var e=this.model._get(this.fromSegments);return this.set(e,t)},o.prototype._setValue=function(t,e,n){"diffDeep"===this.mode?t._setDiffDeep(e,n):"arrayDeep"===this.mode?t._setArrayDiffDeep(e,n):"array"===this.mode?t._setArrayDiff(e,n):t._setDiff(e,n)}}).call(this,_$browser_30);var _$filter_53={};function parseFilterArguments(t,e){var n,i=e.pop();t.isPath(e[e.length-1])||(n=e.pop());for(var r=t.path(e.shift()),o=e.length;o--;)e[o]=t.path(e[o]);return{path:r,inputPaths:e.length?e:null,options:n,fn:i}}function FromMap(){}function Filters(t){this.model=t,this.fromMap=new FromMap}function Filter(t,e,n,i,r,o){if(this.filters=t,this.model=t.model.pass({$filter:this}),this.path=e,this.segments=e.split("."),this.filterName=null,this.sortName=null,this.bundle=!0,this.filterFn=null,this.sortFn=null,this.inputPaths=r,this.inputsSegments=null,r){this.inputsSegments=[];for(var s=0;s<this.inputPaths.length;s++){var a=this.inputPaths[s].split(".");this.inputsSegments.push(a)}}this.options=o,this.skip=o&&o.skip,this.limit=o&&o.limit,n&&this.filter(n),i&&this.sort(i),this.idsSegments=null,this.from=null,this.fromSegments=null}_$Model_45.INITS.push(function(t){t.root._filters=new Filters(t),t.on("all",function(e,n){var i=n[n.length-1],r=t.root._filters.fromMap;for(var o in r){var s=r[o];i.$filter!==s&&((_$util_64.mayImpact(s.segments,e)||s.inputsSegments&&_$util_64.mayImpactAny(s.inputsSegments,e))&&s.update(i))}})}),_$Model_45.prototype.filter=function(){var t=parseFilterArguments(this,Array.prototype.slice.call(arguments));return this.root._filters.add(t.path,t.fn,null,t.inputPaths,t.options)},_$Model_45.prototype.sort=function(){var t=parseFilterArguments(this,Array.prototype.slice.call(arguments));return this.root._filters.add(t.path,null,t.fn||"asc",t.inputPaths,t.options)},_$Model_45.prototype.removeAllFilters=function(t){var e=this._splitPath(t);this._removeAllFilters(e)},_$Model_45.prototype._removeAllFilters=function(t){var e=this.root._filters.fromMap;for(var n in e)_$util_64.contains(t,e[n].fromSegments)&&e[n].destroy()},Filters.prototype.add=function(t,e,n,i,r){return new Filter(this,t,e,n,i,r)},Filters.prototype.toJSON=function(){var t=[];for(var e in this.fromMap){var n=this.fromMap[e];if(n.bundle){var i=[e,n.path,n.filterName,n.sortName,n.inputPaths];n.options&&i.push(n.options),t.push(i)}}return t},Filter.prototype.filter=function(t){if("function"==typeof t)return this.filterFn=t,this.bundle=!1,this;if("string"==typeof t&&(this.filterName=t,this.filterFn=this.model.root._namedFns[t]||_$defaultFns_51[t],!this.filterFn))throw new TypeError("Filter function not found: "+t);return this},Filter.prototype.sort=function(t){if(t||(t="asc"),"function"==typeof t)return this.sortFn=t,this.bundle=!1,this;if("string"==typeof t&&(this.sortName=t,this.sortFn=this.model.root._namedFns[t]||_$defaultFns_51[t],!this.sortFn))throw new TypeError("Sort function not found: "+t);return this},Filter.prototype._slice=function(t){if(null==this.skip&&null==this.limit)return t;var e,n=this.skip||0;return this.limit&&(e=n+this.limit),t.slice(n,e)},Filter.prototype.getInputs=function(){if(this.inputsSegments){for(var t=[],e=0,n=this.inputsSegments.length;e<n;e++){var i=this.model._get(this.inputsSegments[e]);t.push(i)}return t}},Filter.prototype.callFilter=function(t,e,n){var i=t[e];return n?this.filterFn.apply(this.model,[i,e,t].concat(n)):this.filterFn.call(this.model,i,e,t)},Filter.prototype.ids=function(){var t=this.model._get(this.segments),e=[];if(!t)return e;if(Array.isArray(t))throw new Error("model.filter is not currently supported on arrays");if(this.filterFn){var n=this.getInputs();for(var i in t)t.hasOwnProperty(i)&&this.callFilter(t,i,n)&&e.push(i)}else e=Object.keys(t);var r=this.sortFn;return r&&e.sort(function(e,n){return r(t[e],t[n])}),this._slice(e)},Filter.prototype.get=function(){var t=this.model._get(this.segments),e=[];if(Array.isArray(t))throw new Error("model.filter is not currently supported on arrays");if(this.filterFn){var n=this.getInputs();for(var i in t)t.hasOwnProperty(i)&&this.callFilter(t,i,n)&&e.push(t[i])}else for(var i in t)t.hasOwnProperty(i)&&e.push(t[i]);return this.sortFn&&e.sort(this.sortFn),this._slice(e)},Filter.prototype.update=function(t){var e=this.ids();this.model.pass(t,!0)._setArrayDiff(this.idsSegments,e)},Filter.prototype.ref=function(t){return t=this.model.path(t),this.from=t,this.fromSegments=t.split("."),this.filters.fromMap[t]=this,this.idsSegments=["$filters",t.replace(/\./g,"|")],this.update(),this.model.refList(t,this.path,this.idsSegments.join("."))},Filter.prototype.destroy=function(){delete this.filters.fromMap[this.from],this.model._removeRef(this.idsSegments),this.model._del(this.idsSegments)};var _$refList_59={};function addListener(t,e){t.on(e+"Immediate",function(n,i){var r=i[i.length-1],o=t._refLists.fromMap;for(var s in o){var a=o[s];r.$refList!==a&&a.onMutation(e,n,i)}})}function patchFromEvent(t,e,n,i){var r=i.fromSegments.length,o=e.length,s=n[n.length-1],a=i.model.pass(s,!0);if(o!==r)if(o<r)a._setArrayDiff(i.fromSegments,i.get());else{h=e[r];var c=a._get(i.fromSegments.concat(h)),l=i.toSegmentsByItem(c);if(o>r+1)throw new Error("Mutation on descendant of refList `from` should have been dereferenced: "+e.join("."));if("change"===t)return a._set(l,c),void updateIdForValue(a,i,h,c);if("insert"===t||"remove"===t||"move"===t)throw new Error("Array mutation on child of refList `from`should have been dereferenced: "+e.join("."))}else{if("insert"===t){var h=n[0],u=setNewToValues(a,i,v=n[1]);return void a._insert(i.idsSegments,h,u)}if("remove"===t){var h=n[0],p=n[1].length;u=a._remove(i.idsSegments,h,p);if(i.deleteRemoved)for(var f=0;f<u.length;f++){var d=i.itemById(u[f]);a._del(i.toSegmentsByItem(d))}return}if("move"===t){var m=n[0],_=n[1];p=n[2];return void a._move(i.idsSegments,m,_,p)}var v;if(!(v="change"===t?n[0]:a._get(i.fromSegments)))return void a._set(i.idsSegments,[]);u=setNewToValues(a,i,v);a._set(i.idsSegments,u)}}function setNewToValues(t,e,n){for(var i=[],r=0;r<n.length;r++){var o=n[r],s=e.idByItem(o);void 0===s&&"object"==typeof o&&(s=o.id=t.id());var a=e.toSegmentsByItem(o);if(void 0===s||void 0===a)throw new Error("Unable to add item to refList: "+o);t._get(a)!==o&&t._set(a,o),i.push(s)}return i}function updateIdForValue(t,e,n,i){var r=e.idByItem(i),o=e.idsSegments.concat(n);t._set(o,r)}function patchToEvent(t,e,n,i){var r=i.toSegments.length,o=e.length,s=n[n.length-1],a=i.model.pass(s,!0);if(o===r){if("insert"===t){for(var c=n[1],l=0;l<c.length;l++){var h=c[l];if(g=i.indicesByItem(h))for(var u=0;u<g.length;u++){var p=i.fromSegments.concat(g[u]);a._set(p,h)}}return}if("remove"===t){for(var f=n[0],d=(l=f,f+(c=n[1]).length);l<d;l++){if(g=i.indicesByItem(c[l])){u=0;for(var m=g.length;u<m;u++){p=i.fromSegments.concat(g[u]);a._set(p,void 0)}}}return}if("move"===t)return}if(o<=r)a._setArrayDiff(i.fromSegments,i.get());else if(o>r+1){h=a._get(e.slice(0,r+1));if(!(g=i.indicesByItem(h)))return;var _=e.slice(r+1);for(l=0;l<g.length;l++){var v=g[l],y=i.fromSegments.concat(v,_);y=a._dereference(y,null,i),(n=n.slice())[n.length-1]=a._pass,a.emit(t,y,n)}}else if("change"!==t&&"load"!==t&&"unload"!==t){var g;h=a._get(e.slice(0,r+1));if((g=i.indicesByItem(h))&&("insert"===t||"remove"===t||"move"===t))for(l=0;l<g.length;l++){y=i.fromSegments.concat(g[l]);y=a._dereference(y,null,i),(n=n.slice())[n.length-1]=a._pass,a.emit(t,y,n)}}else{var b;"change"===t?(h=n[0],b=n[1]):"load"===t?(h=n[0],b=void 0):"unload"===t&&(h=void 0,b=n[0]);var w=i.indicesByItem(h),E=i.indicesByItem(b);if(!w&&!E)return;if(E&&!equivalentArrays(E,w))for(var l=0;l<E.length;l++){p=i.fromSegments.concat(E[l]);a._set(p,void 0)}if(w)for(l=0;l<w.length;l++){p=i.fromSegments.concat(w[l]);a._set(p,h)}}}function equivalentArrays(t,e){if(!t||!e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function patchIdsEvent(t,e,n,i){var r=i.idsSegments.length,o=e.length,s=n[n.length-1],a=i.model.pass(s,!0);if(o===r){if("insert"===t){for(var c=n[0],l=n[1],h=[],u=0;u<l.length;u++){var p=i.itemById(l[u]);h.push(p)}return void a._insert(i.fromSegments,c,h)}if("remove"===t){c=n[0];var f=n[1].length;return void a._remove(i.fromSegments,c,f)}if("move"===t){var d=n[0],m=n[1];f=n[2];return void a._move(i.fromSegments,d,m,f)}}if(o<=r)a._setArrayDiff(i.fromSegments,i.get());else{c=e[r];var _=i.idByIndex(c),v=i.itemById(_),y=i.fromSegments.concat(c);a._get(y)!==v&&a._set(y,v)}}function RefList(t,e,n,i,r){this.model=t&&t.pass({$refList:this}),this.from=e,this.to=n,this.ids=i,this.fromSegments=e&&e.split("."),this.toSegments=n&&n.split("."),this.idsSegments=i&&i.split("."),this.options=r,this.deleteRemoved=r&&r.deleteRemoved}function __FromMap_59(){}function RefLists(){this.fromMap=new __FromMap_59}_$Model_45.INITS.push(function(t){var e=t.root;for(var n in e._refLists=new RefLists,_$Model_45.MUTATOR_EVENTS)addListener(e,n)}),_$Model_45.prototype.refList=function(){var t,e,n,i;2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?this.isPath(arguments[2])?(t=arguments[0],e=arguments[1],n=arguments[2]):(e=arguments[0],n=arguments[1],i=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3]);var r,o=this.path(t);if(Array.isArray(e)){r=[];for(var s=0;s<e.length;s++)r.push(this.path(e[s]))}else r=this.path(e);var a=this.path(n),c=new RefList(this.root,o,r,a,i);return this.root._refLists.remove(o),c.model._setArrayDiff(c.fromSegments,c.get()),this.root._refLists.add(c),this.scope(o)},RefList.prototype.get=function(){var t=this.model._get(this.idsSegments);if(!t)return[];for(var e=this.model._get(this.toSegments),n=[],i=0;i<t.length;i++){var r=t[i];n.push(e&&e[r])}return n},RefList.prototype.dereference=function(t,e){var n=t.slice(e+1),i=this.idByIndex(n[0]);return null==i?[]:(n[0]=i,this.toSegments.concat(n))},RefList.prototype.toSegmentsByItem=function(t){var e=this.idByItem(t);if(void 0!==e)return this.toSegments.concat(e)},RefList.prototype.idByItem=function(t){if(t&&t.id)return t.id;var e=this.model._get(this.toSegments);for(var n in e)if(t===e[n])return n},RefList.prototype.indicesByItem=function(t){var e=this.idByItem(t),n=this.model._get(this.idsSegments);if(n){for(var i,r=-1;-1!==(r=n.indexOf(e,r+1));)i?i.push(r):i=[r];return i}},RefList.prototype.itemById=function(t){return this.model._get(this.toSegments.concat(t))},RefList.prototype.idByIndex=function(t){return this.model._get(this.idsSegments.concat(t))},RefList.prototype.onMutation=function(t,e,n){_$util_64.mayImpact(this.toSegments,e)?patchToEvent(t,e,n,this):_$util_64.mayImpact(this.idsSegments,e)?patchIdsEvent(t,e,n,this):_$util_64.mayImpact(this.fromSegments,e)&&patchFromEvent(t,e,n,this)},RefLists.prototype.add=function(t){this.fromMap[t.from]=t},RefLists.prototype.remove=function(t){var e=this.fromMap[t];return delete this.fromMap[t],e},RefLists.prototype.toJSON=function(){var t=[];for(var e in this.fromMap){var n=this.fromMap[e];t.push([n.from,n.to,n.ids,n.options])}return t};var _$ref_58={};function addIndexListeners(t){function e(e,n){var i=t._refs.fromMap;for(var r in i){var o=i[r];if(o.updateIndices&&_$util_64.contains(e,o.toSegments)&&o.toSegments.length>e.length){var s=+o.toSegments[e.length],a=n(s);s!==a&&(t._refs.remove(r),o.toSegments[e.length]=""+a,o.to=o.toSegments.join("."),t._refs.add(o))}}}t.on("insertImmediate",function(t,n){var i=n[0],r=n[1].length;e(t,function(t){return i<=t?t+r:t})}),t.on("removeImmediate",function(t,n){var i=n[0],r=n[1].length;e(t,function(t){return i<=t?t-r:t})}),t.on("moveImmediate",function(t,n){var i=n[0],r=n[1],o=n[2];e(t,function(t){return i<=t&&t<i+o?t+r-i:(i<=t&&(t-=o),r<=t&&(t+=o),t)})})}function refChange(t,e,n,i){var r=n[0];if(void 0===r){var o=i.slice(),s=o.pop(),a=t._get(o);if(!(a&&s in a))return void t._del(e)}t._set(e,r)}function refLoad(t,e,n){var i=n[0];t._set(e,i)}function refUnload(t,e){t._del(e)}function refInsert(t,e,n){var i=n[0],r=n[1];t._insert(e,i,r)}function refRemove(t,e,n){var i=n[0],r=n[1].length;t._remove(e,i,r)}function refMove(t,e,n){var i=n[0],r=n[1],o=n[2];t._move(e,i,r,o)}function __addListener_58(t,e,n){t.on(e+"Immediate",function(i,r){for(var o,s=r[r.length-1],a=t._refs.toMap,c=0,l=i.length;c<l;c++){o=o?o+"."+i[c]:i[c];var h=a[o];if(h){h=h.slice();for(var u=i.slice(c+1),p=0,f=h.length;p<f;p++){var d=h[p],m=d.fromSegments.concat(u);if(t._get(m)===t._get(i))t.emit(e,m,r);else{var _=d.model.pass(s,!0);_._dereference=noopDereference,n(_,m,r,i)}}}}var v=t._refs.parentToMap;if(!(h=v[o]))return;for(var p=0,f=h.length;p<f;p++){var d=h[p],y=t._get(d.toSegments),g=t._get(d.fromSegments);if(g!==y){var _=d.model.pass(s,!0);_._dereference=noopDereference,_._set(d.fromSegments,y)}}})}function noopDereference(t){return t}function Ref(t,e,n,i){this.model=t&&t.pass({$ref:this}),this.from=e,this.to=n,this.fromSegments=e.split("."),this.toSegments=n.split("."),this.parentTos=[];for(var r=1,o=this.toSegments.length;r<o;r++){var s=this.toSegments.slice(0,r).join(".");this.parentTos.push(s)}this.updateIndices=i&&i.updateIndices}function __FromMap_58(){}function ToMap(){}function Refs(){this.fromMap=new __FromMap_58,this.toMap=new ToMap,this.parentToMap=new ToMap}function listMapAdd(t,e,n){t[e]||(t[e]=[]),t[e].push(n)}function listMapRemove(t,e,n){var i=t[e];if(i){var r=i.indexOf(n);-1!==r&&(i.splice(r,1),i.length||delete t[e])}}_$Model_45.INITS.push(function(t){var e=t.root;e._refs=new Refs,addIndexListeners(e),__addListener_58(e,"change",refChange),__addListener_58(e,"load",refLoad),__addListener_58(e,"unload",refUnload),__addListener_58(e,"insert",refInsert),__addListener_58(e,"remove",refRemove),__addListener_58(e,"move",refMove)}),_$Model_45.prototype._canRefTo=function(t){return this.isPath(t)||t&&"function"==typeof t.ref},_$Model_45.prototype.ref=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?this._canRefTo(arguments[1])?(t=arguments[0],e=arguments[1]):(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var i=this.path(t),r=this.path(e);if(!r)return e.ref(i);var o=new Ref(this.root,i,r,n);if(o.fromSegments.length<2)throw new Error("ref must be performed under a collection and document id. Invalid path: "+i);this.root._refs.remove(i),this.root._refLists.remove(i);var s=this.get(e);return o.model._set(o.fromSegments,s),this.root._refs.add(o),this.scope(i)},_$Model_45.prototype.removeRef=function(t){var e=this._splitPath(t),n=e.join(".");this._removeRef(e,n)},_$Model_45.prototype._removeRef=function(t,e){this.root._refs.remove(e),this.root._refLists.remove(e),this._del(t)},_$Model_45.prototype.removeAllRefs=function(t){var e=this._splitPath(t);this._removeAllRefs(e)},_$Model_45.prototype._removeAllRefs=function(t){this._removeMapRefs(t,this.root._refs.fromMap),this._removeMapRefs(t,this.root._refLists.fromMap)},_$Model_45.prototype._removeMapRefs=function(t,e){for(var n in e){var i=e[n].fromSegments;_$util_64.contains(t,i)&&this._removeRef(i,n)}},_$Model_45.prototype.dereference=function(t){var e=this._splitPath(t);return this._dereference(e).join(".")},_$Model_45.prototype._dereference=function(t,e,n){if(0===t.length)return t;var i,r=this.root._refs.fromMap,o=this.root._refLists.fromMap;do{var s="";i=!1;for(var a=0,c=t.length;a<c;a++){var l=r[s=s?s+"."+t[a]:t[a]];if(l){var h=t.slice(a+1);t=l.toSegments.concat(h),i=!0;break}var u=o[s];if(u&&u!==n){if(!(a+2<c||e&&a+1<c))continue;t=u.dereference(t,a),i=!0;break}}}while(i);return 0===t.length?["$null"]:t},Refs.prototype.add=function(t){this.fromMap[t.from]=t,listMapAdd(this.toMap,t.to,t);for(var e=0,n=t.parentTos.length;e<n;e++)listMapAdd(this.parentToMap,t.parentTos[e],t)},Refs.prototype.remove=function(t){var e=this.fromMap[t];if(e){delete this.fromMap[t],listMapRemove(this.toMap,e.to,e);for(var n=0,i=e.parentTos.length;n<i;n++)listMapRemove(this.parentToMap,e.parentTos[n],e);return e}},Refs.prototype.toJSON=function(){var t=[];for(var e in this.fromMap){var n=this.fromMap[e];t.push([n.from,n.to])}return t};var _$Model_55={exports:{}};_$Model_55.exports=_$Model_45,_$util_64.serverRequire(_$Model_55,"./bundle"),_$util_64.serverRequire(_$Model_55,"./connection.server"),_$Model_55=_$Model_55.exports;var _$Racer_63={exports:{}},__EventEmitter_63=_$EventEmitter_23.EventEmitter;function Racer(){__EventEmitter_63.call(this)}_$Racer_63.exports=Racer,_$util_64.mergeInto(Racer.prototype,__EventEmitter_63.prototype),Racer.prototype.Model=_$Model_55,Racer.prototype.util=_$util_64,Racer.prototype.use=_$util_64.use,Racer.prototype.serverUse=_$util_64.serverUse,Racer.prototype.createModel=function(t){var e=new _$Model_55;return t&&(e.createConnection(t),e.unbundle(t)),e},_$util_64.serverRequire(_$Racer_63,"./Racer.server"),_$Racer_63=_$Racer_63.exports;var _$lib_racer=new _$Racer_63,_$bcsocketUncompressed_2={};!function(){var f,aa=aa||{},l=this;function ba(t){t=t.split(".");for(var e,n=l;e=t.shift();){if(null==n[e])return null;n=n[e]}return n}function ca(){}function da(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function m(t){return"array"==da(t)}function ea(t){var e=da(t);return"array"==e||"object"==e&&"number"==typeof t.length}function n(t){return"string"==typeof t}function fa(t){return"function"==da(t)}var ga="closure_uid_"+(1e9*Math.random()>>>0),ha=0;function ia(t,e,n){return t.call.apply(t.bind,arguments)}function ja(t,e,n){if(!t)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function p(t,e,n){return(p=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ia:ja).apply(null,arguments)}var q=Date.now||function(){return+new Date};function s(t,e){function n(){}n.prototype=e.prototype,t.pa=e.prototype,t.prototype=new n,t.Hc=function(t,n,i){var r=Array.prototype.slice.call(arguments,2);return e.prototype[n].apply(t,r)}}function ka(t,e){for(var n=t.split("%s"),i="",r=Array.prototype.slice.call(arguments,1);r.length&&1<n.length;)i+=n.shift()+r.shift();return i+n.join("%s")}function la(t){return ma.test(t)?(-1!=t.indexOf("&")&&(t=t.replace(na,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(oa,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(pa,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(qa,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(ra,"&#39;")),t):t}var na=/&/g,oa=/</g,pa=/>/g,qa=/"/g,ra=/'/g,ma=/[&<>"']/,x,ua,va,wa,ya;function sa(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^q()).toString(36)}function ta(t,e){return t<e?-1:t>e?1:0}function xa(){return l.navigator?l.navigator.userAgent:null}if(wa=va=ua=x=!1,ya=xa()){var za=l.navigator;x=0==ya.lastIndexOf("Opera",0),ua=!x&&(-1!=ya.indexOf("MSIE")||-1!=ya.indexOf("Trident")),va=!x&&-1!=ya.indexOf("WebKit"),wa=!x&&!va&&!ua&&"Gecko"==za.product}var Aa=x,y=ua,Ba=wa,z=va,Da;function Ca(){var t=l.document;return t?t.documentMode:void 0}t:{var Ea="",Fa;if(Aa&&l.opera)var Ga=l.opera.version,Ea="function"==typeof Ga?Ga():Ga;else if(Ba?Fa=/rv\:([^\);]+)(\)|;)/:y?Fa=/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/:z&&(Fa=/WebKit\/(\S+)/),Fa)var Ha=Fa.exec(xa()),Ea=Ha?Ha[1]:"";if(y){var Ia=Ca();if(Ia>parseFloat(Ea)){Da=String(Ia);break t}}Da=Ea}var Ja={};function A(t){var e;if(!(e=Ja[t])){e=0;for(var n=String(Da).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),i=String(t).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),r=Math.max(n.length,i.length),o=0;0==e&&o<r;o++){var s=n[o]||"",a=i[o]||"",c=RegExp("(\\d*)(\\D*)","g"),l=RegExp("(\\d*)(\\D*)","g");do{var h=c.exec(s)||["","",""],u=l.exec(a)||["","",""];if(0==h[0].length&&0==u[0].length)break;e=ta(0==h[1].length?0:parseInt(h[1],10),0==u[1].length?0:parseInt(u[1],10))||ta(0==h[2].length,0==u[2].length)||ta(h[2],u[2])}while(0==e)}e=Ja[t]=0<=e}return e}var La=l.document,Ma=La&&y?Ca()||("CSS1Compat"==La.compatMode?parseInt(Da,10):5):void 0;function Na(t){Error.captureStackTrace?Error.captureStackTrace(this,Na):this.stack=Error().stack||"",t&&(this.message=String(t))}function Oa(t,e){e.unshift(t),Na.call(this,ka.apply(null,e)),e.shift()}function Pa(t,e){throw new Oa("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}s(Na,Error),Na.prototype.name="CustomError",s(Oa,Na),Oa.prototype.name="AssertionError";var Qa=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$");function Ra(t){if(Sa){Sa=!1;var e=l.location;if(e){var n=e.href;if(n&&(n=(n=Ra(n)[3]||null)&&decodeURIComponent(n))&&n!=e.hostname)throw Sa=!0,Error()}}return t.match(Qa)}var Sa=z;function Ta(t){var e,n=[],i=0;for(e in t)n[i++]=t[e];return n}function Ua(t){var e,n=[],i=0;for(e in t)n[i++]=e;return n}var Va="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Wa(t,e){for(var n,i,r=1;r<arguments.length;r++){for(n in i=arguments[r])t[n]=i[n];for(var o=0;o<Va.length;o++)n=Va[o],Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}}var B=Array.prototype,Xa=B.indexOf?function(t,e,n){return B.indexOf.call(t,e,n)}:function(t,e,i){if(i=null==i?0:0>i?Math.max(0,t.length+i):i,n(t))return n(e)&&1==e.length?t.indexOf(e,i):-1;for(;i<t.length;i++)if(i in t&&t[i]===e)return i;return-1},Ya=B.forEach?function(t,e,n){B.forEach.call(t,e,n)}:function(t,e,i){for(var r=t.length,o=n(t)?t.split(""):t,s=0;s<r;s++)s in o&&e.call(i,o[s],s,t)};function Za(t){var e;t:{e=$a;for(var i=t.length,r=n(t)?t.split(""):t,o=0;o<i;o++)if(o in r&&e.call(void 0,r[o],o,t)){e=o;break t}e=-1}return 0>e?null:n(t)?t.charAt(e):t[e]}function ab(t){return B.concat.apply(B,arguments)}function bb(t){var e=t.length;if(0<e){for(var n=Array(e),i=0;i<e;i++)n[i]=t[i];return n}return[]}function cb(t,e){this.O={},this.j=[],this.o=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var i=0;i<n;i+=2)this.set(arguments[i],arguments[i+1])}else if(t){t instanceof cb?(n=t.ca(),i=t.N()):(n=Ua(t),i=Ta(t));for(var r=0;r<n.length;r++)this.set(n[r],i[r])}}function db(t){if(t.o!=t.j.length){for(var e=0,n=0;e<t.j.length;){var i=t.j[e];C(t.O,i)&&(t.j[n++]=i),e++}t.j.length=n}if(t.o!=t.j.length){var r={};for(n=e=0;e<t.j.length;)C(r,i=t.j[e])||(t.j[n++]=i,r[i]=1),e++;t.j.length=n}}function C(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function eb(t){if("function"==typeof t.N)return t.N();if(n(t))return t.split("");if(ea(t)){for(var e=[],i=t.length,r=0;r<i;r++)e.push(t[r]);return e}return Ta(t)}function D(t,e,i){if("function"==typeof t.forEach)t.forEach(e,i);else if(ea(t)||n(t))Ya(t,e,i);else{var r;if("function"==typeof t.ca)r=t.ca();else if("function"!=typeof t.N)if(ea(t)||n(t)){r=[];for(var o=t.length,s=0;s<o;s++)r.push(s)}else r=Ua(t);else r=void 0;s=(o=eb(t)).length;for(var a=0;a<s;a++)e.call(i,o[a],r&&r[a],t)}}function E(t,e){var n;if(t instanceof E)this.D=void 0!==e?e:t.D,fb(this,t.oa),n=t.eb,F(this),this.eb=n,gb(this,t.ja),hb(this,t.Ca),ib(this,t.I),jb(this,t.R.n()),n=t.Na,F(this),this.Na=n;else if(t&&(n=Ra(String(t)))){this.D=!!e,fb(this,n[1]||"",!0);var i=n[2]||"";F(this),this.eb=i?decodeURIComponent(i):"",gb(this,n[3]||"",!0),hb(this,n[4]),ib(this,n[5]||"",!0),jb(this,n[6]||"",!0),n=n[7]||"",F(this),this.Na=n?decodeURIComponent(n):""}else this.D=!!e,this.R=new kb(null,0,this.D)}function fb(t,e,n){F(t),t.oa=n?e?decodeURIComponent(e):"":e,t.oa&&(t.oa=t.oa.replace(/:$/,""))}function gb(t,e,n){F(t),t.ja=n?e?decodeURIComponent(e):"":e}function hb(t,e){if(F(t),e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.Ca=e}else t.Ca=null}function ib(t,e,n){F(t),t.I=n?e?decodeURIComponent(e):"":e}function jb(t,e,n){F(t),e instanceof kb?(t.R=e,t.R.ub(t.D)):(n||(e=lb(e,qb)),t.R=new kb(e,0,t.D))}function G(t,e,n){F(t),t.R.set(e,n)}function rb(t,e,n){F(t),m(n)||(n=[String(n)]),sb(t.R,e,n)}function H(t){return F(t),G(t,"zx",sa()),t}function F(t){if(t.oc)throw Error("Tried to modify a read-only Uri")}function tb(t){return t instanceof E?t.n():new E(t,void 0)}function ub(t,e,n,i){var r=new E(null,void 0);return t&&fb(r,t),e&&gb(r,e),n&&hb(r,n),i&&ib(r,i),r}function lb(t,e){return n(t)?encodeURI(t).replace(e,vb):null}function vb(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}f=cb.prototype,f.N=function(){db(this);for(var t=[],e=0;e<this.j.length;e++)t.push(this.O[this.j[e]]);return t},f.ca=function(){return db(this),this.j.concat()},f.wa=function(t){return C(this.O,t)},f.remove=function(t){return!!C(this.O,t)&&(delete this.O[t],this.o--,this.j.length>2*this.o&&db(this),!0)},f.get=function(t,e){return C(this.O,t)?this.O[t]:e},f.set=function(t,e){C(this.O,t)||(this.o++,this.j.push(t)),this.O[t]=e},f.n=function(){return new cb(this)},f=E.prototype,f.oa="",f.eb="",f.ja="",f.Ca=null,f.I="",f.Na="",f.oc=!1,f.D=!1,f.toString=function(){var t=[],e=this.oa;if(e&&t.push(lb(e,mb),":"),e=this.ja){t.push("//");var n=this.eb;n&&t.push(lb(n,mb),"@"),t.push(encodeURIComponent(String(e))),null!=(e=this.Ca)&&t.push(":",String(e))}return(e=this.I)&&(this.ja&&"/"!=e.charAt(0)&&t.push("/"),t.push(lb(e,"/"==e.charAt(0)?nb:ob))),(e=this.R.toString())&&t.push("?",e),(e=this.Na)&&t.push("#",lb(e,pb)),t.join("")},f.n=function(){return new E(this)},f.ub=function(t){return this.D=t,this.R&&this.R.ub(t),this};var mb=/[#\/\?@]/g,ob=/[\#\?:]/g,nb=/[\#\?]/g,qb=/[\#\?@]/g,pb=/#/g;function kb(t,e,n){this.C=t||null,this.D=!!n}function I(t){if(!t.h&&(t.h=new cb,t.o=0,t.C))for(var e=t.C.split("&"),n=0;n<e.length;n++){var i=e[n].indexOf("="),r=null,o=null;0<=i?(r=e[n].substring(0,i),o=e[n].substring(i+1)):r=e[n],r=J(t,r=decodeURIComponent(r.replace(/\+/g," "))),t.add(r,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}function sb(t,e,n){t.remove(e),0<n.length&&(t.C=null,t.h.set(J(t,e),bb(n)),t.o+=n.length)}function J(t,e){var n=String(e);return t.D&&(n=n.toLowerCase()),n}function wb(a){if(a=String(a),!/^\s*$/.test(a)&&/^[\],:{}\s\u2028\u2029]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r\u2028\u2029\x00-\x08\x0a-\x1f]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,"")))try{return eval("("+a+")")}catch(t){}throw Error("Invalid JSON string: "+a)}function xb(a){return eval("("+a+")")}function yb(t){var e=[];return zb(new Ab,t,e),e.join("")}function Ab(){this.Ya=void 0}function zb(t,e,n){switch(typeof e){case"string":Bb(e,n);break;case"number":n.push(isFinite(e)&&!isNaN(e)?e:"null");break;case"boolean":n.push(e);break;case"undefined":n.push("null");break;case"object":if(null==e){n.push("null");break}if(m(e)){var i=e.length;n.push("[");for(var r="",o=0;o<i;o++)n.push(r),r=e[o],zb(t,t.Ya?t.Ya.call(e,String(o),r):r,n),r=",";n.push("]");break}for(o in n.push("{"),i="",e)Object.prototype.hasOwnProperty.call(e,o)&&("function"!=typeof(r=e[o])&&(n.push(i),Bb(o,n),n.push(":"),zb(t,t.Ya?t.Ya.call(e,o,r):r,n),i=","));n.push("}");break;case"function":break;default:throw Error("Unknown type: "+typeof e)}}f=kb.prototype,f.h=null,f.o=null,f.add=function(t,e){I(this),this.C=null,t=J(this,t);var n=this.h.get(t);return n||this.h.set(t,n=[]),n.push(e),this.o++,this},f.remove=function(t){return I(this),t=J(this,t),!!this.h.wa(t)&&(this.C=null,this.o-=this.h.get(t).length,this.h.remove(t))},f.wa=function(t){return I(this),t=J(this,t),this.h.wa(t)},f.ca=function(){I(this);for(var t=this.h.N(),e=this.h.ca(),n=[],i=0;i<e.length;i++)for(var r=t[i],o=0;o<r.length;o++)n.push(e[i]);return n},f.N=function(t){I(this);var e=[];if(n(t))this.wa(t)&&(e=ab(e,this.h.get(J(this,t))));else{t=this.h.N();for(var i=0;i<t.length;i++)e=ab(e,t[i])}return e},f.set=function(t,e){return I(this),this.C=null,t=J(this,t),this.wa(t)&&(this.o-=this.h.get(t).length),this.h.set(t,[e]),this.o++,this},f.get=function(t,e){var n=t?this.N(t):[];return 0<n.length?String(n[0]):e},f.toString=function(){if(this.C)return this.C;if(!this.h)return"";for(var t=[],e=this.h.ca(),n=0;n<e.length;n++)for(var i=e[n],r=encodeURIComponent(String(i)),o=(i=this.N(i),0);o<i.length;o++){var s=r;""!==i[o]&&(s+="="+encodeURIComponent(String(i[o]))),t.push(s)}return this.C=t.join("&")},f.n=function(){var t=new kb;return t.C=this.C,this.h&&(t.h=this.h.n(),t.o=this.o),t},f.ub=function(t){t&&!this.D&&(I(this),this.C=null,D(this.h,function(t,e){var n=e.toLowerCase();e!=n&&(this.remove(e),sb(this,n,t))},this)),this.D=t};var Cb={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},Db=/\uffff/.test("￿")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g;function Bb(t,e){e.push('"',t.replace(Db,function(t){if(t in Cb)return Cb[t];var e=t.charCodeAt(0),n="\\u";return 16>e?n+="000":256>e?n+="00":4096>e&&(n+="0"),Cb[t]=n+e.toString(16)}),'"')}function Eb(t){return Fb(t||arguments.callee.caller,[])}function Fb(t,e){var n=[];if(0<=Xa(e,t))n.push("[...circular reference...]");else if(t&&50>e.length){n.push(Gb(t)+"(");for(var i=t.arguments,r=0;r<i.length;r++){var o;switch(0<r&&n.push(", "),typeof(o=i[r])){case"object":o=o?"object":"null";break;case"string":break;case"number":o=String(o);break;case"boolean":o=o?"true":"false";break;case"function":o=(o=Gb(o))?o:"[fn]";break;default:o=typeof o}40<o.length&&(o=o.substr(0,40)+"..."),n.push(o)}e.push(t),n.push(")\n");try{n.push(Fb(t.caller,e))}catch(t){n.push("[exception trying to get caller]\n")}}else t?n.push("[...long stack...]"):n.push("[end]");return n.join("")}function Gb(t){if(Hb[t])return Hb[t];if(t=String(t),!Hb[t]){var e=/function ([^\(]+)/.exec(t);Hb[t]=e?e[1]:"[Anonymous]"}return Hb[t]}var Hb={};function Ib(t,e,n,i,r){this.reset(t,e,n,i,r)}Ib.prototype.Fb=null,Ib.prototype.Eb=null;var Jb=0;function L(t){this.rc=t}function Kb(t,e){this.name=t,this.value=e}Ib.prototype.reset=function(t,e,n,i,r){"number"==typeof r||Jb++,i||q(),this.Aa=t,this.qc=e,delete this.Fb,delete this.Eb},Ib.prototype.$b=function(t){this.Aa=t},L.prototype.Sa=null,L.prototype.Aa=null,L.prototype.jb=null,L.prototype.Jb=null,Kb.prototype.toString=function(){return this.name};var Lb=new Kb("SEVERE",1e3),Mb=new Kb("WARNING",900),Nb=new Kb("INFO",800),Ob=new Kb("CONFIG",700),Pb=new Kb("FINE",500);function Qb(t){return t.Aa?t.Aa:t.Sa?Qb(t.Sa):(Pa("Root logger has no level set."),null)}f=L.prototype,f.getParent=function(){return this.Sa},f.$b=function(t){this.Aa=t},f.log=function(t,e,n){if(t.value>=Qb(this).value)for(fa(e)&&(e=e()),e="log:"+(t=this.mc(t,e,n)).qc,l.console&&(l.console.timeStamp?l.console.timeStamp(e):l.console.markTimeline&&l.console.markTimeline(e)),l.msWriteProfilerMark&&l.msWriteProfilerMark(e),e=this;e;){var i=t;if((n=e).Jb)for(var r=0,o=void 0;o=n.Jb[r];r++)o(i);e=e.getParent()}},f.mc=function(t,e,i){var r=new Ib(t,String(e),this.rc);if(i){var o;r.Fb=i;var s=arguments.callee.caller;try{var a,c=ba("window.location.href");if(n(i))a={message:i,name:"Unknown error",lineNumber:"Not available",fileName:c,stack:"Not available"};else{var h,u,p=!1;try{h=i.lineNumber||i.Ic||"Not available"}catch(t){h="Not available",p=!0}try{u=i.fileName||i.filename||i.sourceURL||l.$googDebugFname||c}catch(t){u="Not available",p=!0}a=!p&&i.lineNumber&&i.fileName&&i.stack&&i.message&&i.name?i:{message:i.message||"Not available",name:i.name||"UnknownError",lineNumber:h,fileName:u,stack:i.stack||"Not available"}}o="Message: "+la(a.message)+'\nUrl: <a href="view-source:'+a.fileName+'" target="_new">'+a.fileName+"</a>\nLine: "+a.lineNumber+"\n\nBrowser stack:\n"+la(a.stack+"-> ")+"[end]\n\nJS stack traversal:\n"+la(Eb(s)+"-> ")}catch(t){o="Exception trying to expose exception! You win, we lose. "+t}r.Eb=o}return r},f.J=function(t,e){this.log(Lb,t,e)},f.Z=function(t,e){this.log(Mb,t,e)},f.info=function(t,e){this.log(Nb,t,e)};var Rb={},Sb=null;function Tb(t){var e;if(Sb||(Sb=new L(""),Rb[""]=Sb,Sb.$b(Ob)),!(e=Rb[t])){e=new L(t);var n=t.lastIndexOf("."),i=t.substr(n+1);(n=Tb(t.substr(0,n))).jb||(n.jb={}),n.jb[i]=e,e.Sa=n,Rb[t]=e}return e}function M(t,e){t&&t.log(Pb,e,void 0)}function N(){this.r=Tb("goog.net.BrowserChannel")}function Ub(t,e,n,i){t.info("XMLHTTP TEXT ("+e+"): "+Vb(t,n)+(i?" "+i:""))}function Wb(t,e,n){t.J((n||"Exception")+e)}function Vb(t,e){if(!e||e==Xb)return e;try{var n=xb(e);if(n)for(var i=0;i<n.length;i++)if(m(n[i])){var r=n[i];if(!(2>r.length)){var o=r[1];if(m(o)&&!(1>o.length)){var s=o[0];if("noop"!=s&&"stop"!=s)for(var a=1;a<o.length;a++)o[a]=""}}}return yb(n)}catch(n){return t.debug("Exception parsing expected JS array - probably was not JS"),e}}function Yb(t,e){this.P=e?xb:wb}function O(){0!=Zb&&($b[this[ga]||(this[ga]=++ha)]=this)}N.prototype.debug=function(t){this.info(t)},N.prototype.info=function(t){var e=this.r;e&&e.info(t,void 0)},N.prototype.Z=function(t){var e=this.r;e&&e.Z(t,void 0)},N.prototype.J=function(t){var e=this.r;e&&e.J(t,void 0)},Yb.prototype.parse=function(t){return this.P(t)};var Zb=0,$b={};O.prototype.mb=!1,O.prototype.Ja=function(){if(!this.mb&&(this.mb=!0,this.u(),0!=Zb)){var t=this[ga]||(this[ga]=++ha);delete $b[t]}},O.prototype.u=function(){if(this.Pb)for(;this.Pb.length;)this.Pb.shift()()};var ac="closure_listenable_"+(1e6*Math.random()|0);function bc(t){try{return!(!t||!t[ac])}catch(t){return!1}}var cc=0;function dc(t,e,n,i,r){this.fa=t,this.Ua=null,this.src=e,this.type=n,this.capture=!!i,this.Oa=r,this.key=++cc,this.na=this.Ia=!1}function ec(t){t.na=!0,t.fa=null,t.Ua=null,t.src=null,t.Oa=null}function P(t){this.src=t,this.s={},this.Ga=0}function gc(t,e){var n=e.type;if(!(n in t.s))return!1;var i,r=t.s[n],o=Xa(r,e);return(i=0<=o)&&B.splice.call(r,o,1),i&&(ec(e),0==t.s[n].length&&(delete t.s[n],t.Ga--)),i}function fc(t,e,n,i){for(var r=0;r<t.length;++r){var o=t[r];if(!o.na&&o.fa==e&&o.capture==!!n&&o.Oa==i)return r}return-1}P.prototype.add=function(t,e,n,i,r){var o=this.s[t];o||(o=this.s[t]=[],this.Ga++);var s=fc(o,e,i,r);return-1<s?(t=o[s],n||(t.Ia=!1)):((t=new dc(e,this.src,t,!!i,r)).Ia=n,o.push(t)),t},P.prototype.remove=function(t,e,n,i){if(!(t in this.s))return!1;var r=this.s[t];return-1<(e=fc(r,e,n,i))&&(ec(r[e]),B.splice.call(r,e,1),0==r.length&&(delete this.s[t],this.Ga--),!0)},P.prototype.Xa=function(t){var e,n=0;for(e in this.s)if(!t||e==t){for(var i=this.s[e],r=0;r<i.length;r++)++n,ec(i[r]);delete this.s[e],this.Ga--}return n},P.prototype.ya=function(t,e,n,i){var r=-1;return(t=this.s[t])&&(r=fc(t,e,n,i)),-1<r?t[r]:null};var hc=!y||y&&9<=Ma,ic=y&&!A("9");function Q(t,e){this.type=t,this.currentTarget=this.target=e}function jc(t){return jc[" "](t),t}function kc(t,e){if(Q.call(this,t?t.type:""),this.relatedTarget=this.currentTarget=this.target=null,this.charCode=this.keyCode=this.button=this.screenY=this.screenX=this.clientY=this.clientX=this.offsetY=this.offsetX=0,this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.Db=this.state=null,t){var n=this.type=t.type;this.target=t.target||t.srcElement,this.currentTarget=e;var i=t.relatedTarget;if(i){if(Ba){var r;t:{try{jc(i.nodeName),r=!0;break t}catch(t){}r=!1}r||(i=null)}}else"mouseover"==n?i=t.fromElement:"mouseout"==n&&(i=t.toElement);this.relatedTarget=i,this.offsetX=z||void 0!==t.offsetX?t.offsetX:t.layerX,this.offsetY=z||void 0!==t.offsetY?t.offsetY:t.layerY,this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0,this.button=t.button,this.keyCode=t.keyCode||0,this.charCode=t.charCode||("keypress"==n?t.keyCode:0),this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.state=t.state,this.Db=t,t.defaultPrevented&&this.preventDefault(),delete this.ga}}!z||A("528"),Ba&&A("1.9b")||y&&A("8")||Aa&&A("9.5")||z&&A("528"),Ba&&!A("8")||y&&A("9"),f=Q.prototype,f.u=function(){},f.Ja=function(){},f.ga=!1,f.defaultPrevented=!1,f.Yb=!0,f.preventDefault=function(){this.defaultPrevented=!0,this.Yb=!1},jc[" "]=ca,s(kc,Q),kc.prototype.preventDefault=function(){kc.pa.preventDefault.call(this);var t=this.Db;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,ic)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}},kc.prototype.u=function(){};var lc="closure_lm_"+(1e6*Math.random()|0),mc={},nc=0;function oc(t,e,n,i,r){if(m(e)){for(var o=0;o<e.length;o++)oc(t,e[o],n,i,r);return null}if(n=pc(n),bc(t))t=t.Ra(e,n,i,r);else{if(!e)throw Error("Invalid event type");o=!!i;var s=qc(t);s||(t[lc]=s=new P(t)),(n=s.add(e,n,!1,i,r)).Ua||(i=rc(),n.Ua=i,i.src=t,i.fa=n,t.addEventListener?t.addEventListener(e,i,o):t.attachEvent(e in mc?mc[e]:mc[e]="on"+e,i),nc++),t=n}return t}function rc(){var t=sc,e=hc?function(n){return t.call(e.src,e.fa,n)}:function(n){if(!(n=t.call(e.src,e.fa,n)))return n};return e}function tc(t,e,n,i,r){if(m(e))for(var o=0;o<e.length;o++)tc(t,e[o],n,i,r);else n=pc(n),bc(t)?t.vb(e,n,i,r):t&&(t=qc(t))&&(e=t.ya(e,n,!!i,r))&&uc(e)}function uc(t){if("number"==typeof t||!t||t.na)return!1;var e=t.src;if(bc(e))return gc(e.W,t);var n=t.type,i=t.Ua;return e.removeEventListener?e.removeEventListener(n,i,t.capture):e.detachEvent&&e.detachEvent(n in mc?mc[n]:mc[n]="on"+n,i),nc--,(n=qc(e))?(gc(n,t),0==n.Ga&&(n.src=null,e[lc]=null)):ec(t),!0}function vc(t,e,n,i){var r=1;if((t=qc(t))&&(e=t.s[e]))for(e=bb(e),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.na&&(r&=!1!==wc(o,i))}return Boolean(r)}function wc(t,e){var n=t.fa,i=t.Oa||t.src;return t.Ia&&uc(t),n.call(i,e)}function sc(t,e){if(t.na)return!0;if(!hc){var n=e||ba("window.event"),i=new kc(n,this),r=!0;if(!(0>n.keyCode||null!=n.returnValue)){t:{var o=!1;if(0==n.keyCode)try{n.keyCode=-1;break t}catch(t){o=!0}(o||null==n.returnValue)&&(n.returnValue=!0)}for(n=[],o=i.currentTarget;o;o=o.parentNode)n.push(o);o=t.type;for(var s=n.length-1;!i.ga&&0<=s;s--)i.currentTarget=n[s],r&=vc(n[s],o,!0,i);for(s=0;!i.ga&&s<n.length;s++)i.currentTarget=n[s],r&=vc(n[s],o,!1,i)}return r}return wc(t,new kc(e,this))}function qc(t){return(t=t[lc])instanceof P?t:null}var xc="__closure_events_fn_"+(1e9*Math.random()>>>0);function pc(t){return fa(t)?t:t[xc]||(t[xc]=function(e){return t.handleEvent(e)})}function R(){O.call(this),this.W=new P(this),this.fc=this}function yc(t,e,n,i){if(!(e=t.W.s[String(e)]))return!0;e=bb(e);for(var r=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.na&&s.capture==n){var a=s.fa,c=s.Oa||s.src;s.Ia&&gc(t.W,s),r=!1!==a.call(c,i)&&r}}return r&&0!=i.Yb}function zc(t,e){R.call(this),this.ea=t||1,this.ra=e||l,this.ib=p(this.Gc,this),this.sb=q()}s(R,O),R.prototype[ac]=!0,f=R.prototype,f.tb=null,f.addEventListener=function(t,e,n,i){oc(this,t,e,n,i)},f.removeEventListener=function(t,e,n,i){tc(this,t,e,n,i)},f.dispatchEvent=function(t){var e;if(i=this.tb)for(e=[];i;i=i.tb)e.push(i);var i=this.fc,r=t.type||t;if(n(t))t=new Q(t,i);else if(t instanceof Q)t.target=t.target||i;else{var o=t;Wa(t=new Q(r,i),o)}var s;o=!0;if(e)for(var a=e.length-1;!t.ga&&0<=a;a--)o=yc(s=t.currentTarget=e[a],r,!0,t)&&o;if(t.ga||(o=yc(s=t.currentTarget=i,r,!0,t)&&o,t.ga||(o=yc(s,r,!1,t)&&o)),e)for(a=0;!t.ga&&a<e.length;a++)o=yc(s=t.currentTarget=e[a],r,!1,t)&&o;return o},f.u=function(){R.pa.u.call(this),this.W&&this.W.Xa(void 0),this.tb=null},f.Ra=function(t,e,n,i){return this.W.add(String(t),e,!1,n,i)},f.vb=function(t,e,n,i){return this.W.remove(String(t),e,n,i)},f.ya=function(t,e,n,i){return this.W.ya(String(t),e,n,i)},s(zc,R),f=zc.prototype,f.enabled=!1,f.l=null,f.setInterval=function(t){this.ea=t,this.l&&this.enabled?(this.stop(),this.start()):this.l&&this.stop()},f.Gc=function(){if(this.enabled){var t=q()-this.sb;0<t&&t<.8*this.ea?this.l=this.ra.setTimeout(this.ib,this.ea-t):(this.l&&(this.ra.clearTimeout(this.l),this.l=null),this.dispatchEvent(Ac),this.enabled&&(this.l=this.ra.setTimeout(this.ib,this.ea),this.sb=q()))}},f.start=function(){this.enabled=!0,this.l||(this.l=this.ra.setTimeout(this.ib,this.ea),this.sb=q())},f.stop=function(){this.enabled=!1,this.l&&(this.ra.clearTimeout(this.l),this.l=null)},f.u=function(){zc.pa.u.call(this),this.stop(),delete this.ra};var Ac="tick",Fc;function Bc(t,e,n){if(fa(t))n&&(t=p(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=p(t.handleEvent,t)}return 2147483647<e?-1:l.setTimeout(t,e||0)}function Cc(){}function Dc(t){var e;return(e=t.Ab)||(e={},Ec(t)&&(e[0]=!0,e[1]=!0),e=t.Ab=e),e}function Gc(){}function Hc(t){return(t=Ec(t))?new ActiveXObject(t):new XMLHttpRequest}function Ec(t){if(!t.Kb&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var i=e[n];try{return new ActiveXObject(i),t.Kb=i}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return t.Kb}function Ic(t){R.call(this),this.headers=new cb,this.gb=t||null,this.T=!1,this.fb=this.f=null,this.Mb=this.Qa="",this.ka=0,this.q="",this.da=this.qb=this.Pa=this.nb=!1,this.Fa=0,this.bb=null,this.Xb=Jc,this.cb=this.dc=!1}Cc.prototype.Ab=null,s(Gc,Cc),Fc=new Gc,s(Ic,R);var Jc="";Ic.prototype.r=Tb("goog.net.XhrIo");var Kc=/^https?$/i,Lc=["POST","PUT"];function Oc(t){return y&&A(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}function $a(t){return"content-type"==t.toLowerCase()}function Mc(t,e){t.T=!1,t.f&&(t.da=!0,t.f.abort(),t.da=!1),t.q=e,t.ka=5,Pc(t),Qc(t)}function Pc(t){t.nb||(t.nb=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Rc(t){if(t.T&&void 0!==aa)if(t.fb[1]&&4==T(t)&&2==Sc(t))M(t.r,S(t,"Local request error detected and ignored"));else if(t.Pa&&4==T(t))Bc(t.Qb,0,t);else if(t.dispatchEvent("readystatechange"),4==T(t)){M(t.r,S(t,"Request complete")),t.T=!1;try{var e,n,i=Sc(t);t:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:n=!0;break t;default:n=!1}if(!(e=n)){var r;if(r=0===i){if(!(s=Ra(String(t.Qa))[1]||null)&&self.location)var o=self.location.protocol,s=o.substr(0,o.length-1);r=!Kc.test(s?s.toLowerCase():"")}e=r}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{var a;t.ka=6;try{a=2<T(t)?t.f.statusText:""}catch(e){M(t.r,"Can not get status: "+e.message),a=""}t.q=a+" ["+Sc(t)+"]",Pc(t)}}finally{Qc(t)}}}function Qc(t,e){if(t.f){Nc(t);var n=t.f,i=t.fb[0]?ca:null;t.f=null,t.fb=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=i}catch(e){(n=t.r)&&n.J("Problem encountered resetting onreadystatechange: "+e.message,void 0)}}}function Nc(t){t.f&&t.cb&&(t.f.ontimeout=null),"number"==typeof t.bb&&(l.clearTimeout(t.bb),t.bb=null)}function T(t){return t.f?t.f.readyState:0}function Sc(t){try{return 2<T(t)?t.f.status:-1}catch(e){return(t=t.r)&&t.Z("Can not get status: "+e.message,void 0),-1}}function Tc(t){try{return t.f?t.f.responseText:""}catch(e){return M(t.r,"Can not get responseText: "+e.message),""}}function S(t,e){return e+" ["+t.Mb+" "+t.Qa+" "+Sc(t)+"]"}function Uc(){this.Wb=q()}function Vc(t){O.call(this),this.e=t,this.j={}}f=Ic.prototype,f.send=function(t,e,n,i){if(this.f)throw Error("[goog.net.XhrIo] Object is active with another request="+this.Qa+"; newUri="+t);e=e?e.toUpperCase():"GET",this.Qa=t,this.q="",this.ka=0,this.Mb=e,this.nb=!1,this.T=!0,this.f=this.gb?Hc(this.gb):Hc(Fc),this.fb=this.gb?Dc(this.gb):Dc(Fc),this.f.onreadystatechange=p(this.Qb,this);try{M(this.r,S(this,"Opening Xhr")),this.qb=!0,this.f.open(e,t,!0),this.qb=!1}catch(t){return M(this.r,S(this,"Error opening Xhr: "+t.message)),void Mc(this,t)}t=n||"";var r=this.headers.n();i&&D(i,function(t,e){r.set(e,t)}),i=Za(r.ca()),n=l.FormData&&t instanceof l.FormData,!(0<=Xa(Lc,e))||i||n||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),D(r,function(t,e){this.f.setRequestHeader(e,t)},this),this.Xb&&(this.f.responseType=this.Xb),"withCredentials"in this.f&&(this.f.withCredentials=this.dc);try{Nc(this),0<this.Fa&&(this.cb=Oc(this.f),M(this.r,S(this,"Will abort after "+this.Fa+"ms if incomplete, xhr2 "+this.cb)),this.cb?(this.f.timeout=this.Fa,this.f.ontimeout=p(this.qa,this)):this.bb=Bc(this.qa,this.Fa,this)),M(this.r,S(this,"Sending request")),this.Pa=!0,this.f.send(t),this.Pa=!1}catch(t){M(this.r,S(this,"Send error: "+t.message)),Mc(this,t)}},f.qa=function(){void 0!==aa&&this.f&&(this.q="Timed out after "+this.Fa+"ms, aborting",this.ka=8,M(this.r,S(this,this.q)),this.dispatchEvent("timeout"),this.abort(8))},f.abort=function(t){this.f&&this.T&&(M(this.r,S(this,"Aborting")),this.T=!1,this.da=!0,this.f.abort(),this.da=!1,this.ka=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Qc(this))},f.u=function(){this.f&&(this.T&&(this.T=!1,this.da=!0,this.f.abort(),this.da=!1),Qc(this,!0)),Ic.pa.u.call(this)},f.Qb=function(){this.mb||(this.qb||this.Pa||this.da?Rc(this):this.uc())},f.uc=function(){Rc(this)},f.isActive=function(){return!!this.f},f.Ib=function(){return n(this.q)?this.q:String(this.q)},new Uc,Uc.prototype.set=function(t){this.Wb=t},Uc.prototype.reset=function(){this.set(q())},Uc.prototype.get=function(){return this.Wb},s(Vc,O);var Wc=[];function Xc(t,e,n){O.call(this),this.pc=t,this.ea=e,this.e=n,this.jc=p(this.vc,this)}function Yc(t){t.l=Bc(t.jc,t.ea),t.pc.call(t.e)}function U(t,e,n,i,r){this.b=t,this.a=e,this.Y=n,this.B=i,this.Ea=r||1,this.qa=Zc,this.ob=new Vc(this),this.Ta=new zc,this.Ta.setInterval($c)}f=Vc.prototype,f.Ra=function(t,e,n,i){m(e)||(Wc[0]=e,e=Wc);for(var r=0;r<e.length;r++){var o=oc(t,e[r],n||this.handleEvent,i||!1,this.e||this);if(!o)break;this.j[o.key]=o}return this},f.vb=function(t,e,n,i,r){if(m(e))for(var o=0;o<e.length;o++)this.vb(t,e[o],n,i,r);else n=n||this.handleEvent,r=r||this.e||this,n=pc(n),i=!!i,(e=bc(t)?t.ya(e,n,i,r):t&&(t=qc(t))?t.ya(e,n,i,r):null)&&(uc(e),delete this.j[e.key]);return this},f.Xa=function(){var t,e=this.j,n=uc;for(t in e)n.call(void 0,e[t],t,e);this.j={}},f.u=function(){Vc.pa.u.call(this),this.Xa()},f.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},s(Xc,O),f=Xc.prototype,f.Za=!1,f.Vb=0,f.l=null,f.stop=function(){this.l&&(l.clearTimeout(this.l),this.l=null,this.Za=!1)},f.u=function(){Xc.pa.u.call(this),this.stop()},f.vc=function(){this.l=null,this.Za&&!this.Vb&&(this.Za=!1,Yc(this))},f=U.prototype,f.v=null,f.F=!1,f.ua=null,f.xb=null,f.Da=null,f.sa=null,f.U=null,f.w=null,f.X=null,f.k=null,f.Ha=0,f.K=null,f.ta=null,f.q=null,f.g=-1,f.Zb=!0,f.$=!1,f.ma=0,f.Va=null;var Zc=45e3,$c=250;function ad(t,e){switch(t){case 0:return"Non-200 return code ("+e+")";case 1:return"XMLHTTP failure (no data)";case 2:return"HttpConnection timeout";default:return"Unknown error"}}var bd={},dd={};function ed(){return!y||y&&10<=Ma}function fd(t,e,n){t.sa=1,t.U=H(e.n()),t.X=n,t.Cb=!0,gd(t,null)}function hd(t,e,n,i,r){t.sa=1,t.U=H(e.n()),t.X=null,t.Cb=n,r&&(t.Zb=!1),gd(t,i)}function gd(t,e){var n;if(t.Da=q(),id(t),t.w=t.U.n(),rb(t.w,"t",t.Ea),t.Ha=0,t.k=t.b.lb(t.b.$a()?e:null),0<t.ma&&(t.Va=new Xc(p(t.ec,t,t.k),t.ma)),t.ob.Ra(t.k,"readystatechange",t.Bc),t.v){n=t.v;var i,r={};for(i in n)r[i]=n[i];n=r}else n={};if(t.X?(t.ta="POST",n["Content-Type"]="application/x-www-form-urlencoded",t.k.send(t.w,t.ta,t.X,n)):(t.ta="GET",t.Zb&&!z&&(n.Connection="close"),t.k.send(t.w,t.ta,null,n)),t.b.H(jd),r=t.X)for(n="",r=r.split("&"),i=0;i<r.length;i++){if(1<(s=r[i].split("=")).length){var o=s[0],s=s[1],a=o.split("_");n=2<=a.length&&"type"==a[1]?n+(o+"=")+s+"&":n+(o+"=redacted&")}}else n=null;t.a.info("XMLHTTP REQ ("+t.B+") [attempt "+t.Ea+"]: "+t.ta+"\n"+t.w+"\n"+n)}function nd(t,e,n){for(var i=!0;!t.$&&t.Ha<n.length;){var r=qd(t,n);if(r==dd){4==e&&(t.q=4,W(),i=!1),Ub(t.a,t.B,null,"[Incomplete Response]");break}if(r==bd){t.q=4,W(),Ub(t.a,t.B,n,"[Invalid Chunk]"),i=!1;break}Ub(t.a,t.B,r,null),od(t,r)}4==e&&0==n.length&&(t.q=1,W(),i=!1),t.F=t.F&&i,i||(Ub(t.a,t.B,n,"[Invalid Chunked Response]"),V(t),pd(t))}function qd(t,e){var n=t.Ha,i=e.indexOf("\n",n);if(-1==i)return dd;if(n=Number(e.substring(n,i)),isNaN(n))return bd;if((i+=1)+n>e.length)return dd;var r=e.substr(i,n);return t.Ha=i+n,r}function rd(t,e){t.Da=q(),id(t);var n=e?window.location.hostname:"";t.w=t.U.n(),G(t.w,"DOMAIN",n),G(t.w,"t",t.Ea);try{t.K=new ActiveXObject("htmlfile")}catch(e){return t.a.J("ActiveX blocked"),V(t),t.q=7,W(),void pd(t)}var i="<html><body>";e&&(i+='<script>document.domain="'+n+'"<\/script>'),i+="</body></html>",t.K.open(),t.K.write(i),t.K.close(),t.K.parentWindow.m=p(t.yc,t),t.K.parentWindow.d=p(t.Ub,t,!0),t.K.parentWindow.rpcClose=p(t.Ub,t,!1),n=t.K.createElement("div"),t.K.parentWindow.document.body.appendChild(n),n.innerHTML='<iframe src="'+t.w+'"></iframe>',t.a.info("TRIDENT REQ ("+t.B+") [ attempt "+t.Ea+"]: GET\n"+t.w),t.b.H(jd)}function id(t){t.xb=q()+t.qa,td(t,t.qa)}function td(t,e){if(null!=t.ua)throw Error("WatchDog timer not null");t.ua=Y(p(t.zc,t),e)}function md(t){t.ua&&(l.clearTimeout(t.ua),t.ua=null)}function pd(t){t.b.Lb()||t.$||t.b.la(t)}function V(t){md(t);var e=t.Va;e&&"function"==typeof e.Ja&&e.Ja(),t.Va=null,t.Ta.stop(),t.ob.Xa(),t.k&&(e=t.k,t.k=null,e.abort(),e.Ja()),t.K&&(t.K=null)}function od(t,e){try{t.b.Rb(t,e),t.b.H(sd)}catch(e){Wb(t.a,e,"Error in httprequest callback")}}function ud(t,e,n,i,r){if((new N).debug("TestLoadImageWithRetries: "+r),0==i)n(!1);else{var o=r||0;i--,vd(t,e,function(r){r?n(!0):l.setTimeout(function(){ud(t,e,n,i,o)},o)})}}function vd(t,e,n){function i(t,e){return function(){try{r.debug("TestLoadImage: "+e),o.onload=null,o.onerror=null,o.onabort=null,o.ontimeout=null,l.clearTimeout(s),n(t)}catch(t){Wb(r,t)}}}var r=new N;r.debug("TestLoadImage: loading "+t);var o=new Image,s=null;o.onload=i(!0,"loaded"),o.onerror=i(!1,"error"),o.onabort=i(!1,"abort"),o.ontimeout=i(!1,"timeout"),s=l.setTimeout(function(){o.ontimeout&&o.ontimeout()},e),o.src=t}function wd(t,e){this.b=t,this.a=e,this.P=new Yb(0,!0)}function yd(t){var e=Ad(t.b,t.va,"/mail/images/cleardot.gif");H(e),ud(e.toString(),5e3,p(t.kc,t),3,2e3),t.H(jd)}function zd(t){t.a.debug("TestConnection: starting stage 2");var e=t.b.Dc;if(null!=e)t.a.debug("Buffered"),W(),e?(W(),Bd(t.b,t,!1)):(W(),Bd(t.b,t,!0));else if(t.A=new U(t,t.a,void 0,void 0,void 0),t.A.S(t.v),e=Cd(t.b,t.L,t.I),W(),ed())rb(e,"TYPE","xmlhttp"),hd(t.A,e,!1,t.L,!1);else{rb(e,"TYPE","html");var n=t.A;t=Boolean(t.L),n.sa=3,n.U=H(e.n()),rd(n,t)}}function Ed(t,e,n){this.Bb=t||null,this.c=Fd,this.t=[],this.Q=[],this.a=new N,this.P=new Yb(0,!0),this.Gb=e||null,this.Dc=null!=n?n:null}function Gd(t,e){this.Ob=t,this.map=e}f=U.prototype,f.S=function(t){this.v=t},f.setTimeout=function(t){this.qa=t},f.bc=function(t){this.ma=t},f.Bc=function(t){t=t.target;var e=this.Va;e&&3==T(t)?(this.a.debug("Throttling readystatechange."),e.l||e.Vb?e.Za=!0:Yc(e)):this.ec(t)},f.ec=function(t){try{if(t==this.k)t:{var e=T(this.k),n=this.k.ka,i=Sc(this.k);if(!ed()||z&&!A("420+")){if(4>e)break t}else if(3>e||3==e&&!Aa&&!Tc(this.k))break t;this.$||4!=e||7==n||(8==n||0>=i?this.b.H(kd):this.b.H(ld)),md(this);var r=Sc(this.k);this.g=r;var o=Tc(this.k);o||this.a.debug("No response text for uri "+this.w+" status "+r),this.F=200==r,this.a.info("XMLHTTP RESP ("+this.B+") [ attempt "+this.Ea+"]: "+this.ta+"\n"+this.w+"\n"+e+" "+r),this.F?(4==e&&V(this),this.Cb?(nd(this,e,o),Aa&&this.F&&3==e&&(this.ob.Ra(this.Ta,Ac,this.Ac),this.Ta.start())):(Ub(this.a,this.B,o,null),od(this,o)),this.F&&!this.$&&(4==e?this.b.la(this):(this.F=!1,id(this)))):(400==r&&0<o.indexOf("Unknown SID")?(this.q=3,W(),this.a.Z("XMLHTTP Unknown SID ("+this.B+")")):(this.q=0,W(),this.a.Z("XMLHTTP Bad status "+r+" ("+this.B+")")),V(this),pd(this))}else this.a.Z("Called back with an unexpected xmlhttp")}catch(t){this.a.debug("Failed call to OnXmlHttpReadyStateChanged_"),this.k&&Tc(this.k)?Wb(this.a,t,"ResponseText: "+Tc(this.k)):Wb(this.a,t,"No response text")}},f.Ac=function(){var t=T(this.k),e=Tc(this.k);this.Ha<e.length&&(md(this),nd(this,t,e),this.F&&4!=t&&id(this))},f.yc=function(t){Y(p(this.xc,this,t),0)},f.xc=function(t){if(!this.$){var e=this.a;e.info("TRIDENT TEXT ("+this.B+"): "+Vb(e,t)),md(this),od(this,t),id(this)}},f.Ub=function(t){Y(p(this.wc,this,t),0)},f.wc=function(t){this.$||(this.a.info("TRIDENT TEXT ("+this.B+"): "+t?"success":"failure"),V(this),this.F=t,this.b.la(this),this.b.H(sd))},f.nc=function(){md(this),this.b.la(this)},f.cancel=function(){this.$=!0,V(this)},f.zc=function(){this.ua=null;var t=q();0<=t-this.xb?(this.F&&this.a.J("Received watchdog timeout even though request loaded successfully"),this.a.info("TIMEOUT: "+this.w),2!=this.sa&&this.b.H(kd),V(this),this.q=2,W(),pd(this)):(this.a.Z("WatchDog timer called too early"),td(this,this.xb-t))},f.Ib=function(){return this.q},f=wd.prototype,f.v=null,f.A=null,f.Wa=!1,f.cc=null,f.La=null,f.rb=null,f.I=null,f.c=null,f.g=-1,f.L=null,f.va=null,f.S=function(t){this.v=t},f.ac=function(t){this.P=t},f.kb=function(t){this.I=t,t=xd(this.b,this.I),W(),this.cc=q();var e=this.b.Gb;null!=e?(this.L=this.b.correctHostPrefix(e[0]),(this.va=e[1])?(this.c=1,yd(this)):(this.c=2,zd(this))):(rb(t,"MODE","init"),this.A=new U(this,this.a,void 0,void 0,void 0),this.A.S(this.v),hd(this.A,t,!1,null,!0),this.c=0)},f.kc=function(t){if(t)this.c=2,zd(this);else{W();var e=this.b;e.a.debug("Test Connection Blocked"),e.g=e.V.g,Z(e,9)}t&&this.H(ld)},f.lb=function(t){return this.b.lb(t)},f.abort=function(){this.A&&(this.A.cancel(),this.A=null),this.g=-1},f.Lb=function(){return!1},f.Rb=function(t,e){if(this.g=t.g,0==this.c)if(this.a.debug("TestConnection: Got data for stage 1"),e){try{var n=this.P.parse(e)}catch(t){return Wb(this.a,t),void Dd(this.b,this)}this.L=this.b.correctHostPrefix(n[0]),this.va=n[1]}else this.a.debug("TestConnection: Null responseText"),Dd(this.b,this);else 2==this.c&&(this.Wa?(W(),this.rb=q()):"11111"==e?(W(),this.Wa=!0,this.La=q(),n=this.La-this.cc,(ed()||500>n)&&(this.g=200,this.A.cancel(),this.a.debug("Test connection succeeded; using streaming connection"),W(),Bd(this.b,this,!0))):(W(),this.La=this.rb=q(),this.Wa=!1))},f.la=function(){if(this.g=this.A.g,this.A.F){if(0==this.c)this.a.debug("TestConnection: request complete for initial check"),this.va?(this.c=1,yd(this)):(this.c=2,zd(this));else if(2==this.c){this.a.debug("TestConnection: request complete for stage 2");(ed()?this.Wa:!(200>this.rb-this.La))?(this.a.debug("Test connection succeeded; using streaming connection"),W(),Bd(this.b,this,!0)):(this.a.debug("Test connection failed; not using streaming"),W(),Bd(this.b,this,!1))}}else this.a.debug("TestConnection: request failed, in state "+this.c),0==this.c?W():2==this.c&&W(),Dd(this.b,this)},f.$a=function(){return this.b.$a()},f.isActive=function(){return this.b.isActive()},f.H=function(t){this.b.H(t)},f=Ed.prototype,f.v=null,f.xa=null,f.p=null,f.i=null,f.I=null,f.Ma=null,f.zb=null,f.L=null,f.hc=!0,f.Ba=0,f.sc=0,f.Ka=!1,f.e=null,f.G=null,f.M=null,f.aa=null,f.V=null,f.wb=null,f.gc=!0,f.za=-1,f.Nb=-1,f.g=-1,f.ba=0,f.ha=0,f.ic=5e3,f.Cc=1e4,f.pb=2,f.Hb=2e4,f.ma=0,f.ab=!1,f.ia=8;var Fd=1,Hd=new R;function Id(t){Q.call(this,"statevent",t)}function Jd(t,e){Q.call(this,"timingevent",t),this.size=e}s(Id,Q),s(Jd,Q);var jd=1,ld=2,kd=3,sd=4;function Kd(t){Q.call(this,"serverreachability",t)}s(Kd,Q);var Xb="y2f%",$,Yd;function Md(t){t.V&&(t.V.abort(),t.V=null),t.i&&(t.i.cancel(),t.i=null),t.M&&(l.clearTimeout(t.M),t.M=null),Pd(t),t.p&&(t.p.cancel(),t.p=null),t.G&&(l.clearTimeout(t.G),t.G=null)}function Qd(t){t.p||t.G||(t.G=Y(p(t.Tb,t),0),t.ba=0)}function Sd(t,e){var n,i;e?6<t.ia?(t.t=t.Q.concat(t.t),t.Q.length=0,n=t.Ba-1,i=Rd(t)):(n=e.B,i=e.X):(n=t.Ba++,i=Rd(t));var r=t.Ma.n();G(r,"SID",t.Y),G(r,"RID",n),G(r,"AID",t.za),Nd(t,r),(n=new U(t,t.a,t.Y,n,t.ba+1)).S(t.v),n.setTimeout(Math.round(.5*t.Hb)+Math.round(.5*t.Hb*Math.random())),t.p=n,fd(n,r,i)}function Nd(t,e){if(t.e){var n=t.e.getAdditionalParams(t);n&&D(n,function(t,n){G(e,n,t)})}}function Rd(t){var e,n=Math.min(t.t.length,1e3),i=["count="+n];6<t.ia&&0<n?(e=t.t[0].Ob,i.push("ofs="+e)):e=0;for(var r=0;r<n;r++){var o=t.t[r].Ob,s=t.t[r].map;o=6>=t.ia?r:o-e;try{D(s,function(t,e){i.push("req"+o+"_"+e+"="+encodeURIComponent(t))})}catch(e){i.push("req"+o+"_type="+encodeURIComponent("_badmap")),t.e&&t.e.badMapError(t,s)}}return t.Q=t.Q.concat(t.t.splice(0,n)),i.join("&")}function Td(t){t.i||t.M||(t.yb=1,t.M=Y(p(t.Sb,t),0),t.ha=0)}function Ud(t){return t.i||t.M?(t.a.J("Request already in progress"),!1):!(3<=t.ha)&&(t.a.debug("Going to retry GET"),t.yb++,t.M=Y(p(t.Sb,t),Vd(t,t.ha)),t.ha++,!0)}function Ld(t){if(t.e){var e=t.e.okToMakeRequest(t);if(0!=e)return t.a.debug("Handler returned error code from okToMakeRequest"),Z(t,e),!1}return!0}function Bd(t,e,n){t.a.debug("Test Connection Finished"),t.wb=t.gc&&n,t.g=e.g,t.a.debug("connectChannel_()"),t.lc(Fd,0),t.Ma=xd(t,t.I),Qd(t)}function Dd(t,e){t.a.debug("Test Connection Failed"),t.g=e.g,Z(t,2)}function Pd(t){null!=t.aa&&(l.clearTimeout(t.aa),t.aa=null)}function Vd(t,e){var n=t.ic+Math.floor(Math.random()*t.Cc);return t.isActive()||(t.a.debug("Inactive channel"),n*=2),n*e}function Z(t,e){if(t.a.info("Error code "+e),2==e||9==e){var n=null;t.e&&(n=t.e.getNetworkTestImageUri(t));var i=p(t.Fc,t);n||H(n=new E("//www.google.com/images/cleardot.gif")),vd(n.toString(),1e4,i)}else W();Wd(t,e)}function Wd(t,e){t.a.debug("HttpChannel: error - "+e),t.c=0,t.e&&t.e.channelError(t,e),Od(t),Md(t)}function Od(t){if(t.c=0,t.g=-1,t.e)if(0==t.Q.length&&0==t.t.length)t.e.channelClosed(t);else{t.a.debug("Number of undelivered maps, pending: "+t.Q.length+", outgoing: "+t.t.length);var e=bb(t.Q),n=bb(t.t);t.Q.length=0,t.t.length=0,t.e.channelClosed(t,e,n)}}function xd(t,e){var n=Ad(t,null,e);return t.a.debug("GetForwardChannelUri: "+n),n}function Cd(t,e,n){return e=Ad(t,t.$a()?e:null,n),t.a.debug("GetBackChannelUri: "+e),e}function Ad(t,e,n){if(""!=(r=tb(n)).ja)e&&gb(r,e+"."+r.ja),hb(r,r.Ca);else var i=window.location,r=ub(i.protocol,e?e+"."+i.hostname:i.hostname,i.port,n);return t.xa&&D(t.xa,function(t,e){G(r,e,t)}),G(r,"VER",t.ia),Nd(t,r),r}function Y(t,e){if(!fa(t))throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){t()},e)}function W(){Hd.dispatchEvent(new Id(Hd))}function Xd(){}f=Ed.prototype,f.kb=function(t,e,n,i,r){this.a.debug("connect()"),W(),this.I=e,this.xa=n||{},i&&void 0!==r&&(this.xa.OSID=i,this.xa.OAID=r),this.a.debug("connectTest_()"),Ld(this)&&(this.V=new wd(this,this.a),this.V.S(this.v),this.V.ac(this.P),this.V.kb(t))},f.disconnect=function(){if(this.a.debug("disconnect()"),Md(this),3==this.c){var t=this.Ba++,e=this.Ma.n();G(e,"SID",this.Y),G(e,"RID",t),G(e,"TYPE","terminate"),Nd(this,e),(t=new U(this,this.a,this.Y,t,void 0)).sa=2,t.U=H(e.n()),(e=new Image).src=t.U,e.onload=e.onerror=p(t.nc,t),t.Da=q(),id(t)}Od(this)},f.S=function(t){this.v=t},f.bc=function(t){this.ma=t},f.Lb=function(){return 0==this.c},f.ac=function(t){this.P=t},f.Tb=function(t){if(this.G=null,this.a.debug("startForwardChannel_"),Ld(this))if(this.c==Fd)if(t)this.a.J("Not supposed to retry the open");else{this.a.debug("open_()"),this.Ba=Math.floor(1e5*Math.random()),t=this.Ba++;var e=new U(this,this.a,"",t,void 0);e.S(this.v);var n=Rd(this),i=this.Ma.n();G(i,"RID",t),this.Bb&&G(i,"CVER",this.Bb),Nd(this,i),fd(e,i,n),this.p=e,this.c=2}else 3==this.c&&(t?Sd(this,t):0==this.t.length?this.a.debug("startForwardChannel_ returned: nothing to send"):this.p?this.a.J("startForwardChannel_ returned: connection already in progress"):(Sd(this),this.a.debug("startForwardChannel_ finished, sent request")))},f.Sb=function(){if(this.M=null,Ld(this)){this.a.debug("Creating new HttpRequest"),this.i=new U(this,this.a,this.Y,"rpc",this.yb),this.i.S(this.v),this.i.bc(this.ma);var t=this.zb.n();if(G(t,"RID","rpc"),G(t,"SID",this.Y),G(t,"CI",this.wb?"0":"1"),G(t,"AID",this.za),Nd(this,t),ed())G(t,"TYPE","xmlhttp"),hd(this.i,t,!0,this.L,!1);else{G(t,"TYPE","html");var e=this.i,n=Boolean(this.L);e.sa=3,e.U=H(t.n()),rd(e,n)}this.a.debug("New Request created")}},f.Rb=function(t,e){if(0!=this.c&&(this.i==t||this.p==t))if(this.g=t.g,this.p==t&&3==this.c)if(7<this.ia){var n;try{n=this.P.parse(e)}catch(t){n=null}if(m(n)&&3==n.length)if(0==(i=n)[0])t:if(this.a.debug("Server claims our backchannel is missing."),this.M)this.a.debug("But we are currently starting the request.");else{if(this.i){if(!(this.i.Da+3e3<this.p.Da))break t;Pd(this),this.i.cancel(),this.i=null}else this.a.Z("We do not have a BackChannel established");Ud(this),W()}else this.Nb=i[1],0<(n=this.Nb-this.za)&&(i=i[2],this.a.debug(i+" bytes (in "+n+" arrays) are outstanding on the BackChannel"),37500>i&&this.wb&&0==this.ha&&!this.aa&&(this.aa=Y(p(this.tc,this),6e3)));else this.a.debug("Bad POST response data returned"),Z(this,11)}else e!=Xb&&(this.a.debug("Bad data returned - missing/invald magic cookie"),Z(this,11));else if(this.i==t&&Pd(this),!/^[\s\xa0]*$/.test(e)){n=this.P.parse(e);for(var i=this.e&&this.e.channelHandleMultipleArrays?[]:null,r=0;r<n.length;r++){var o=n[r];this.za=o[0],o=o[1],2==this.c?"c"==o[0]?(this.Y=o[1],this.L=this.correctHostPrefix(o[2]),o=o[3],this.ia=null!=o?o:6,this.c=3,this.e&&this.e.channelOpened(this),this.zb=Cd(this,this.L,this.I),Td(this)):"stop"==o[0]&&Z(this,7):3==this.c&&("stop"==o[0]?(i&&0!=i.length&&(this.e.channelHandleMultipleArrays(this,i),i.length=0),Z(this,7)):"noop"!=o[0]&&(i?i.push(o):this.e&&this.e.channelHandleArray(this,o)),this.ha=0)}i&&0!=i.length&&this.e.channelHandleMultipleArrays(this,i)}},f.correctHostPrefix=function(t){return this.hc?this.e?this.e.correctHostPrefix(t):t:null},f.tc=function(){null!=this.aa&&(this.aa=null,this.i.cancel(),this.i=null,Ud(this),W())},f.la=function(t){var e;if(this.a.debug("Request complete"),this.i==t)Pd(this),this.i=null,e=2;else{if(this.p!=t)return;this.p=null,e=1}if(this.g=t.g,0!=this.c)if(t.F)1==e?(q(),Hd.dispatchEvent(new Jd(Hd,t.X?t.X.length:0)),Qd(this),this.Q.length=0):Td(this);else{var n=t.Ib();if(3==n||7==n||0==n&&0<this.g)this.a.debug("Not retrying due to error type");else{var i;if(this.a.debug("Maybe retrying, last error: "+ad(n,this.g)),(i=1==e)&&(this.p||this.G?(this.a.J("Request already in progress"),i=!1):this.c==Fd||this.ba>=(this.Ka?0:this.pb)?i=!1:(this.a.debug("Going to retry POST"),this.G=Y(p(this.Tb,this,t),Vd(this,this.ba)),this.ba++,i=!0)),i||2==e&&Ud(this))return;this.a.debug("Exceeded max number of retries")}switch(this.a.debug("Error: HTTP request failed"),n){case 1:Z(this,5);break;case 4:Z(this,10);break;case 3:Z(this,6);break;case 7:Z(this,12);break;default:Z(this,2)}}},f.lc=function(t){if(!(0<=Xa(arguments,this.c)))throw Error("Unexpected channel state: "+this.c)},f.Fc=function(t){t?(this.a.info("Successfully pinged google.com"),W()):(this.a.info("Failed to ping google.com"),W(),Wd(this,8))},f.lb=function(t){if(t&&!this.ab)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Ic).dc=this.ab,t},f.isActive=function(){return!!this.e&&this.e.isActive(this)},f.H=function(){Hd.dispatchEvent(new Kd(Hd))},f.$a=function(){return this.ab||!ed()},f=Xd.prototype,f.channelHandleMultipleArrays=null,f.okToMakeRequest=function(){return 0},f.channelOpened=function(){},f.channelHandleArray=function(){},f.channelError=function(){},f.channelClosed=function(){},f.getAdditionalParams=function(){return{}},f.getNetworkTestImageUri=function(){return null},f.isActive=function(){return!0},f.badMapError=function(){},f.correctHostPrefix=function(t){return t},Yd={0:"Ok",4:"User is logging out",6:"Unknown session ID",7:"Stopped by server",8:"General network error",2:"Request failed",9:"Blocked by a network administrator",5:"No data from server",10:"Got bad data from the server",11:"Got a bad response from the server"},$=function(t,e){var n,i,r,o,s,a,c,h,u,p,f,d,_,v;if(!(this instanceof $))return new $(t,e);p=this,t||(t="channel"),t.match(/:\/\//)&&t.replace(/^ws/,"http"),e||(e={}),m(e||"string"==typeof e)&&(e={}),h=e.reconnectTime||3e3,n=e.extraHeaders||null,i=e.extraParams||null,null!==e.affinity&&(i||(i={}),e.affinityParam||(e.affinityParam="a"),this.affinity=e.affinity||sa(),i[e.affinityParam]=this.affinity),(_=function(t){p.readyState=p.readyState=t})(this.CLOSED),d=null,a=null!=(v=e.prev)?v.Ec:void 0,r=function(t,e,n,i,r){try{return"function"==typeof p[t]?p[t](n,i,r):void 0}catch(t){throw"undefined"!=typeof console&&null!==console&&console.error(t.stack),t}},(o=new Xd).channelOpened=function(){return a=d,_($.OPEN),r("onopen")},s=null,o.channelError=function(t,e){var n;return n=Yd[e],s=e,p.readyState!==$.CLOSED&&_($.hb),r("onerror",0,n,e)},u=null,o.channelClosed=function(t,n,i){var o;if(p.readyState!==$.CLOSED)return d=null,t=s?Yd[s]:"Closed",_($.CLOSED),e.reconnect&&7!==s&&0!==s&&(o=6===s?0:h,clearTimeout(u),u=setTimeout(c,o)),r("onclose",0,t,n,i),s=null},o.channelHandleArray=function(t,e){return r("onmessage",0,{type:"message",data:e})},c=function(){if(d)throw Error("Reconnect() called from invalid state");if(_($.CONNECTING),r("onconnecting"),clearTimeout(u),p.Ec=d=new Ed(e.appVersion,null!=a?a.Gb:void 0),e.crossDomainXhr&&(d.ab=!0),d.e=o,n&&d.S(n),s=null,e.failFast){var c=d;c.Ka=!0,c.a.info("setFailFast: true"),(c.p||c.G)&&c.ba>(c.Ka?0:c.pb)&&(c.a.info("Retry count "+c.ba+" > new maxRetries "+(c.Ka?0:c.pb)+". Fail immediately!"),c.p?(c.p.cancel(),c.la(c.p)):(l.clearTimeout(c.G),c.G=null,Z(c,2)))}return d.kb(t+"/test",t+"/bind",i,null!=a?a.Y:void 0,null!=a?a.za:void 0)},this.open=function(){if(p.readyState!==p.CLOSED)throw Error("Already open");return c()},this.close=function(){if(clearTimeout(u),s=0,p.readyState!==$.CLOSED)return _($.hb),d.disconnect()},this.sendMap=f=function(t){var e;if((e=p.readyState)!==$.hb&&e!==$.CLOSED){if(0==(e=d).c)throw Error("Invalid operation: sending map when state is closed");1e3==e.t.length&&e.a.J("Already have 1000 queued maps upon queueing "+yb(t)),e.t.push(new Gd(e.sc++,t)),2!=e.c&&3!=e.c||Qd(e)}},this.send=function(t){return f("string"==typeof t?{_S:t}:{JSON:yb(t)})},c()},$.prototype.canSendWhileConnecting=$.canSendWhileConnecting=!0,$.prototype.canSendJSON=$.canSendJSON=!0,$.prototype.CONNECTING=$.CONNECTING=$.CONNECTING=0,$.prototype.OPEN=$.OPEN=$.OPEN=1,$.prototype.CLOSING=$.CLOSING=$.hb=2,$.prototype.CLOSED=$.CLOSED=$.CLOSED=3,(null!=_$bcsocketUncompressed_2?_$bcsocketUncompressed_2:window).BCSocket=$}();var _$Socket_41=Socket,BCSocket=_$bcsocketUncompressed_2.BCSocket;function Socket(t){this._options=t,this._messageQueue=[],this._connectedOnce=!1,this._attemptNum=0,this._url=getWebSocketURL(t),supportWebSockets()&&!t.browserChannelOnly?this._createWebSocket():this._createBrowserChannel()}function getRandom(t,e){return Math.random()*(e-t)+t}function supportWebSockets(){return"WebSocket"in window&&2===window.WebSocket.CLOSING}function getWebSocketURL(t){var e;window.location&&window.location.port&&(e=":"+window.location.port);var n=t.srvPort,i=t.srvSecurePort,r=t.srvHost||window.location.hostname,o="https:"===(t.srvProtocol||window.location.protocol)?"wss:":"ws:";return"ws:"===o&&n?e=":"+n:"wss:"===o&&i&&(e=":"+i),o+"//"+r+(e||"")+t.base}Socket.prototype._createWebSocket=function(){this._type="websocket",this._socket=new WebSocket(this._url),this.open=this._createWebSocket.bind(this),this._syncState(),this._socket.onmessage=this._ws_onmessage.bind(this),this._socket.onopen=this._ws_onopen.bind(this),this._socket.onclose=this._ws_onclose.bind(this)},Socket.prototype._createBrowserChannel=function(){this._type="browserchannel",this._socket=BCSocket(this._options.base,this._options),this.open=this._createBrowserChannel.bind(this),this._syncState(),this._socket.onmessage=this._bc_onmessage.bind(this),this._socket.onopen=this._bc_onopen.bind(this),this._socket.onclose=this._bc_onclose.bind(this)},Socket.prototype._ws_onmessage=function(t){this._syncState(),t.data=JSON.parse(t.data),this.onmessage&&this.onmessage(t)},Socket.prototype._ws_onopen=function(t){this._attemptNum=0,this._connectedOnce=!0,this._syncState(),this._flushQueue(),this.onopen&&this.onopen(t)},Socket.prototype._ws_onclose=function(t){if(this._syncState(),console.log("WebSocket: connection is broken",t),this.onclose&&this.onclose(t),!this._connectedOnce)return this._createBrowserChannel();var e=this;this._options.reconnect&&!t.wasClean&&setTimeout(function(){e.readyState===e.CLOSED&&e._createWebSocket()},this._getTimeout()),this._attemptNum++},Socket.prototype._getTimeout=function(){var t=this._options.timeout+this._options.timeoutIncrement*this._attemptNum;return getRandom(t/3,t)},Socket.prototype._bc_onmessage=function(t){this._syncState(),this.onmessage&&this.onmessage(t)},Socket.prototype._bc_onopen=function(t){this._syncState(),this.onopen&&this.onopen(t)},Socket.prototype._bc_onclose=function(t){this._syncState(),this.onclose&&this.onclose(t)},Socket.prototype._flushQueue=function(){for(;0!==this._messageQueue.length;){var t=this._messageQueue.shift();this._send(t)}},Socket.prototype._send=function(t){"websocket"===this._type&&"string"!=typeof t&&(t=JSON.stringify(t)),this._socket.send(t)},Socket.prototype.send=function(t){"websocket"===this._type?this._socket.readyState===WebSocket.OPEN&&0===this._messageQueue.length?this._send(t):this._messageQueue.push(t):this._send(t)},Socket.prototype.close=function(){this._socket.close()},Socket.prototype._syncState=function(){this.readyState=this._socket.readyState},Socket.prototype.reconnect=function(){"websocket"===this._type&&this.readyState===this.CLOSED&&this._createWebSocket()},Socket.prototype.canSendWhileConnecting=!0,Socket.prototype.canSendJSON=!0,Socket.prototype.CONNECTING=0,Socket.prototype.OPEN=1,Socket.prototype.CLOSING=2,Socket.prototype.CLOSED=3;var _$browser_40={},CLIENT_OPTIONS=JSON.parse('{"base":"/channel","reconnect":true,"browserChannelOnly":false,"timeout":10000,"timeoutIncrement":10000}');_$lib_racer.Model.prototype._createSocket=function(t){return new _$Socket_41(CLIENT_OPTIONS)};var _$pathBrowserify_29={};(function(t){_$pathBrowserify_29.basename=function(t,e){var n=function(t){"string"!=typeof t&&(t+="");var e,n=0,i=-1,r=!0;for(e=t.length-1;e>=0;--e)if(47===t.charCodeAt(e)){if(!r){n=e+1;break}}else-1===i&&(r=!1,i=e+1);return-1===i?"":t.slice(n,i)}(t);return e&&n.substr(-1*e.length)===e&&(n=n.substr(0,n.length-e.length)),n};"ab".substr(-1)}).call(this,_$browser_30);var _$utils_85={},toString={}.toString;function paramsEqual(t,e){return!Object.keys(t).some(function(n){return t[n]!=e[n]})}function acceptParams(t,e){for(var n=t.split(/ *; */),i={value:n[0],quality:1,params:{},originalIndex:e},r=1;r<n.length;++r){var o=n[r].split(/ *= */);"q"==o[0]?i.quality=parseFloat(o[1]):i.params[o[0]]=o[1]}return i}_$utils_85.pathRegexp=function(t,e,n,i){return"[object RegExp]"==toString.call(t)?t:(Array.isArray(t)&&(t="("+t.join("|")+")"),t=t.concat(i?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g,function(t,n,i,r,o,s,a){return e.push({name:r,optional:!!s}),n=n||"",(s?"":n)+"(?:"+(s?n:"")+(i||"")+(o||(i?"([^/.]+?)":"([^/]+?)"))+")"+(s||"")+(a?"(/*)?":"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),new RegExp("^"+t+"$",n?"":"i"))};var _$Route_84=Route;function Route(t,e,n,i){i=i||{},this.path=e,this.method=t,this.callbacks=n,this.regexp=_$utils_85.pathRegexp(e,this.keys=[],i.sensitive,i.strict)}Route.prototype.match=function(t){var e=this.keys,n=this.params=[],i=this.regexp.exec(t);if(!i)return!1;for(var r=1,o=i.length;r<o;++r){var s=e[r-1],a="string"==typeof i[r]?decodeURIComponent(i[r]):i[r];s?n[s.name]=a:n.push(a)}return!0};var has=Object.prototype.hasOwnProperty,__isArray_36=Array.isArray,hexTable=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),compactQueue=function(t){for(;t.length>1;){var e=t.pop(),n=e.obj[e.prop];if(__isArray_36(n)){for(var i=[],r=0;r<n.length;++r)void 0!==n[r]&&i.push(n[r]);e.obj[e.prop]=i}}},arrayToObject=function(t,e){for(var n=e&&e.plainObjects?Object.create(null):{},i=0;i<t.length;++i)void 0!==t[i]&&(n[i]=t[i]);return n},merge=function t(e,n,i){if(!n)return e;if("object"!=typeof n){if(__isArray_36(e))e.push(n);else{if(!e||"object"!=typeof e)return[e,n];(i&&(i.plainObjects||i.allowPrototypes)||!has.call(Object.prototype,n))&&(e[n]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(n);var r=e;return __isArray_36(e)&&!__isArray_36(n)&&(r=arrayToObject(e,i)),__isArray_36(e)&&__isArray_36(n)?(n.forEach(function(n,r){if(has.call(e,r)){var o=e[r];o&&"object"==typeof o&&n&&"object"==typeof n?e[r]=t(o,n,i):e.push(n)}else e[r]=n}),e):Object.keys(n).reduce(function(e,r){var o=n[r];return has.call(e,r)?e[r]=t(e[r],o,i):e[r]=o,e},r)},assign=function(t,e){return Object.keys(e).reduce(function(t,n){return t[n]=e[n],t},t)},decode=function(t,e,n){var i=t.replace(/\+/g," ");if("iso-8859-1"===n)return i.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(i)}catch(t){return i}},encode=function(t,e,n){if(0===t.length)return t;var i=t;if("symbol"==typeof t?i=Symbol.prototype.toString.call(t):"string"!=typeof t&&(i=String(t)),"iso-8859-1"===n)return escape(i).replace(/%u[0-9a-f]{4}/gi,function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"});for(var r="",o=0;o<i.length;++o){var s=i.charCodeAt(o);45===s||46===s||95===s||126===s||s>=48&&s<=57||s>=65&&s<=90||s>=97&&s<=122?r+=i.charAt(o):s<128?r+=hexTable[s]:s<2048?r+=hexTable[192|s>>6]+hexTable[128|63&s]:s<55296||s>=57344?r+=hexTable[224|s>>12]+hexTable[128|s>>6&63]+hexTable[128|63&s]:(o+=1,s=65536+((1023&s)<<10|1023&i.charCodeAt(o)),r+=hexTable[240|s>>18]+hexTable[128|s>>12&63]+hexTable[128|s>>6&63]+hexTable[128|63&s])}return r},compact=function(t){for(var e=[{obj:{o:t},prop:"o"}],n=[],i=0;i<e.length;++i)for(var r=e[i],o=r.obj[r.prop],s=Object.keys(o),a=0;a<s.length;++a){var c=s[a],l=o[c];"object"==typeof l&&null!==l&&-1===n.indexOf(l)&&(e.push({obj:o,prop:c}),n.push(l))}return compactQueue(e),t},isRegExp=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},isBuffer=function(t){return!(!t||"object"!=typeof t)&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},combine=function(t,e){return[].concat(t,e)},_$utils_36={assign:assign,combine:combine,compact:compact,decode:decode,encode:encode,isBuffer:isBuffer,isRegExp:isRegExp,merge:merge},replace=String.prototype.replace,percentTwenties=/%20/g,Format={RFC1738:"RFC1738",RFC3986:"RFC3986"},_$formats_32=_$utils_36.assign({default:Format.RFC3986,formatters:{RFC1738:function(t){return replace.call(t,percentTwenties,"+")},RFC3986:function(t){return String(t)}}},Format),__has_35=Object.prototype.hasOwnProperty,arrayPrefixGenerators={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},__isArray_35=Array.isArray,push=Array.prototype.push,pushToArray=function(t,e){push.apply(t,__isArray_35(e)?e:[e])},toISO=Date.prototype.toISOString,defaultFormat=_$formats_32.default,defaults={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:_$utils_36.encode,encodeValuesOnly:!1,format:defaultFormat,formatter:_$formats_32.formatters[defaultFormat],indices:!1,serializeDate:function(t){return toISO.call(t)},skipNulls:!1,strictNullHandling:!1},isNonNullishPrimitive=function(t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t||"symbol"==typeof t||"bigint"==typeof t},stringify=function t(e,n,i,r,o,s,a,c,l,h,u,p,f){var d=e;if("function"==typeof a?d=a(n,d):d instanceof Date?d=h(d):"comma"===i&&__isArray_35(d)&&(d=d.join(",")),null===d){if(r)return s&&!p?s(n,defaults.encoder,f,"key"):n;d=""}if(isNonNullishPrimitive(d)||_$utils_36.isBuffer(d))return s?[u(p?n:s(n,defaults.encoder,f,"key"))+"="+u(s(d,defaults.encoder,f,"value"))]:[u(n)+"="+u(String(d))];var m,_=[];if(void 0===d)return _;if(__isArray_35(a))m=a;else{var v=Object.keys(d);m=c?v.sort(c):v}for(var y=0;y<m.length;++y){var g=m[y];o&&null===d[g]||(__isArray_35(d)?pushToArray(_,t(d[g],"function"==typeof i?i(n,g):n,i,r,o,s,a,c,l,h,u,p,f)):pushToArray(_,t(d[g],n+(l?"."+g:"["+g+"]"),i,r,o,s,a,c,l,h,u,p,f)))}return _},normalizeStringifyOptions=function(t){if(!t)return defaults;if(null!==t.encoder&&void 0!==t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||defaults.charset;if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=_$formats_32.default;if(void 0!==t.format){if(!__has_35.call(_$formats_32.formatters,t.format))throw new TypeError("Unknown format option provided.");n=t.format}var i=_$formats_32.formatters[n],r=defaults.filter;return("function"==typeof t.filter||__isArray_35(t.filter))&&(r=t.filter),{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:defaults.addQueryPrefix,allowDots:void 0===t.allowDots?defaults.allowDots:!!t.allowDots,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:defaults.charsetSentinel,delimiter:void 0===t.delimiter?defaults.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:defaults.encode,encoder:"function"==typeof t.encoder?t.encoder:defaults.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:defaults.encodeValuesOnly,filter:r,formatter:i,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:defaults.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:defaults.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:defaults.strictNullHandling}},_$stringify_35=function(t,e){var n,i=t,r=normalizeStringifyOptions(e);"function"==typeof r.filter?i=(0,r.filter)("",i):__isArray_35(r.filter)&&(n=r.filter);var o,s=[];if("object"!=typeof i||null===i)return"";o=e&&e.arrayFormat in arrayPrefixGenerators?e.arrayFormat:e&&"indices"in e?e.indices?"indices":"repeat":"indices";var a=arrayPrefixGenerators[o];n||(n=Object.keys(i)),r.sort&&n.sort(r.sort);for(var c=0;c<n.length;++c){var l=n[c];r.skipNulls&&null===i[l]||pushToArray(s,stringify(i[l],l,a,r.strictNullHandling,r.skipNulls,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.formatter,r.encodeValuesOnly,r.charset))}var h=s.join(r.delimiter),u=!0===r.addQueryPrefix?"?":"";return r.charsetSentinel&&("iso-8859-1"===r.charset?u+="utf8=%26%2310003%3B&":u+="utf8=%E2%9C%93&"),h.length>0?u+h:""},__has_34=Object.prototype.hasOwnProperty,__isArray_34=Array.isArray,__defaults_34={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:_$utils_36.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},interpretNumericEntities=function(t){return t.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},isoSentinel="utf8=%26%2310003%3B",charsetSentinel="utf8=%E2%9C%93",parseValues=function(t,e){var n,i={},r=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,o=e.parameterLimit===1/0?void 0:e.parameterLimit,s=r.split(e.delimiter,o),a=-1,c=e.charset;if(e.charsetSentinel)for(n=0;n<s.length;++n)0===s[n].indexOf("utf8=")&&(s[n]===charsetSentinel?c="utf-8":s[n]===isoSentinel&&(c="iso-8859-1"),a=n,n=s.length);for(n=0;n<s.length;++n)if(n!==a){var l,h,u=s[n],p=u.indexOf("]="),f=-1===p?u.indexOf("="):p+1;-1===f?(l=e.decoder(u,__defaults_34.decoder,c,"key"),h=e.strictNullHandling?null:""):(l=e.decoder(u.slice(0,f),__defaults_34.decoder,c,"key"),h=e.decoder(u.slice(f+1),__defaults_34.decoder,c,"value")),h&&e.interpretNumericEntities&&"iso-8859-1"===c&&(h=interpretNumericEntities(h)),h&&"string"==typeof h&&e.comma&&h.indexOf(",")>-1&&(h=h.split(",")),u.indexOf("[]=")>-1&&(h=__isArray_34(h)?[h]:h),__has_34.call(i,l)?i[l]=_$utils_36.combine(i[l],h):i[l]=h}return i},parseObject=function(t,e,n){for(var i=e,r=t.length-1;r>=0;--r){var o,s=t[r];if("[]"===s&&n.parseArrays)o=[].concat(i);else{o=n.plainObjects?Object.create(null):{};var a="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,c=parseInt(a,10);n.parseArrays||""!==a?!isNaN(c)&&s!==a&&String(c)===a&&c>=0&&n.parseArrays&&c<=n.arrayLimit?(o=[])[c]=i:o[a]=i:o={0:i}}i=o}return i},parseKeys=function(t,e,n){if(t){var i=n.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,r=/(\[[^[\]]*])/g,o=n.depth>0&&/(\[[^[\]]*])/.exec(i),s=o?i.slice(0,o.index):i,a=[];if(s){if(!n.plainObjects&&__has_34.call(Object.prototype,s)&&!n.allowPrototypes)return;a.push(s)}for(var c=0;n.depth>0&&null!==(o=r.exec(i))&&c<n.depth;){if(c+=1,!n.plainObjects&&__has_34.call(Object.prototype,o[1].slice(1,-1))&&!n.allowPrototypes)return;a.push(o[1])}return o&&a.push("["+i.slice(o.index)+"]"),parseObject(a,e,n)}},normalizeParseOptions=function(t){if(!t)return __defaults_34;if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new Error("The charset option must be either utf-8, iso-8859-1, or undefined");var e=void 0===t.charset?__defaults_34.charset:t.charset;return{allowDots:void 0===t.allowDots?__defaults_34.allowDots:!!t.allowDots,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:__defaults_34.allowPrototypes,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:__defaults_34.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:__defaults_34.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:__defaults_34.comma,decoder:"function"==typeof t.decoder?t.decoder:__defaults_34.decoder,delimiter:"string"==typeof t.delimiter||_$utils_36.isRegExp(t.delimiter)?t.delimiter:__defaults_34.delimiter,depth:"number"==typeof t.depth||!1===t.depth?+t.depth:__defaults_34.depth,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:__defaults_34.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:__defaults_34.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:__defaults_34.plainObjects,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:__defaults_34.strictNullHandling}},_$parse_34=function(t,e){var n=normalizeParseOptions(e);if(""===t||null==t)return n.plainObjects?Object.create(null):{};for(var i="string"==typeof t?parseValues(t,n):t,r=n.plainObjects?Object.create(null):{},o=Object.keys(i),s=0;s<o.length;++s){var a=o[s],c=parseKeys(a,i[a],n);r=_$utils_36.merge(r,c,n)}return _$utils_36.compact(r)},_$lib_33={parse:_$parse_34},_$punycode_31={exports:{}};(function(t){!function(e){var n="object"==typeof _$punycode_31.exports&&_$punycode_31.exports&&!_$punycode_31.exports.nodeType&&_$punycode_31.exports,i=_$punycode_31&&!_$punycode_31.nodeType&&_$punycode_31,r="object"==typeof t&&t;r.global!==r&&r.window!==r&&r.self!==r||(e=r);var o,s,a=2147483647,c=36,l=1,h=26,u=38,p=700,f=72,d=128,m="-",_=/^xn--/,v=/[^\x20-\x7E]/,y=/[\x2E\u3002\uFF0E\uFF61]/g,g={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},b=c-l,w=Math.floor,E=String.fromCharCode;function x(t){throw new RangeError(g[t])}function C(t,e){for(var n=t.length,i=[];n--;)i[n]=e(t[n]);return i}function T(t,e){var n=t.split("@"),i="";return n.length>1&&(i=n[0]+"@",t=n[1]),i+C((t=t.replace(y,".")).split("."),e).join(".")}function S(t){for(var e,n,i=[],r=0,o=t.length;r<o;)(e=t.charCodeAt(r++))>=55296&&e<=56319&&r<o?56320==(64512&(n=t.charCodeAt(r++)))?i.push(((1023&e)<<10)+(1023&n)+65536):(i.push(e),r--):i.push(e);return i}function D(t){return C(t,function(t){var e="";return t>65535&&(e+=E((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=E(t)}).join("")}function $(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function R(t,e,n){var i=0;for(t=n?w(t/p):t>>1,t+=w(t/e);t>b*h>>1;i+=c)t=w(t/b);return w(i+(b+1)*t/(t+u))}function O(t){var e,n,i,r,o,s,u,p,_,v,y,g=[],b=t.length,E=0,C=d,T=f;for((n=t.lastIndexOf(m))<0&&(n=0),i=0;i<n;++i)t.charCodeAt(i)>=128&&x("not-basic"),g.push(t.charCodeAt(i));for(r=n>0?n+1:0;r<b;){for(o=E,s=1,u=c;r>=b&&x("invalid-input"),((p=(y=t.charCodeAt(r++))-48<10?y-22:y-65<26?y-65:y-97<26?y-97:c)>=c||p>w((a-E)/s))&&x("overflow"),E+=p*s,!(p<(_=u<=T?l:u>=T+h?h:u-T));u+=c)s>w(a/(v=c-_))&&x("overflow"),s*=v;T=R(E-o,e=g.length+1,0==o),w(E/e)>a-C&&x("overflow"),C+=w(E/e),E%=e,g.splice(E++,0,C)}return D(g)}function A(t){var e,n,i,r,o,s,u,p,_,v,y,g,b,C,T,D=[];for(g=(t=S(t)).length,e=d,n=0,o=f,s=0;s<g;++s)(y=t[s])<128&&D.push(E(y));for(i=r=D.length,r&&D.push(m);i<g;){for(u=a,s=0;s<g;++s)(y=t[s])>=e&&y<u&&(u=y);for(u-e>w((a-n)/(b=i+1))&&x("overflow"),n+=(u-e)*b,e=u,s=0;s<g;++s)if((y=t[s])<e&&++n>a&&x("overflow"),y==e){for(p=n,_=c;!(p<(v=_<=o?l:_>=o+h?h:_-o));_+=c)T=p-v,C=c-v,D.push(E($(v+T%C,0))),p=w(T/C);D.push(E($(p,0))),o=R(n,b,i==r),n=0,++i}++n,++e}return D.join("")}if(o={version:"1.4.1",ucs2:{decode:S,encode:D},decode:O,encode:A,toASCII:function(t){return T(t,function(t){return v.test(t)?"xn--"+A(t):t})},toUnicode:function(t){return T(t,function(t){return _.test(t)?O(t.slice(4).toLowerCase()):t})}},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return o});else if(n&&i)if(_$punycode_31.exports==n)i.exports=o;else for(s in o)o.hasOwnProperty(s)&&(n[s]=o[s]);else e.punycode=o}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),_$punycode_31=_$punycode_31.exports;var _$util_87={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}};function hasOwnProperty(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var _$decode_37=function(t,e,n,i){e=e||"&",n=n||"=";var r={};if("string"!=typeof t||0===t.length)return r;var o=/\+/g;t=t.split(e);var s=1e3;i&&"number"==typeof i.maxKeys&&(s=i.maxKeys);var a=t.length;s>0&&a>s&&(a=s);for(var c=0;c<a;++c){var l,h,u,p,f=t[c].replace(o,"%20"),d=f.indexOf(n);d>=0?(l=f.substr(0,d),h=f.substr(d+1)):(l=f,h=""),u=decodeURIComponent(l),p=decodeURIComponent(h),hasOwnProperty(r,u)?__isArray_37(r[u])?r[u].push(p):r[u]=[r[u],p]:r[u]=p}return r},__isArray_37=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},stringifyPrimitive=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}},_$encode_38=function(t,e,n,i){return e=e||"&",n=n||"=",null===t&&(t=void 0),"object"==typeof t?map(__objectKeys_38(t),function(i){var r=encodeURIComponent(stringifyPrimitive(i))+n;return __isArray_38(t[i])?map(t[i],function(t){return r+encodeURIComponent(stringifyPrimitive(t))}).join(e):r+encodeURIComponent(stringifyPrimitive(t[i]))}).join(e):i?encodeURIComponent(stringifyPrimitive(i))+n+encodeURIComponent(stringifyPrimitive(t)):""},__isArray_38=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function map(t,e){if(t.map)return t.map(e);for(var n=[],i=0;i<t.length;i++)n.push(e(t[i],i));return n}var __objectKeys_38=Object.keys||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e},_$querystringEs3_39={};_$querystringEs3_39.parse=_$decode_37,_$querystringEs3_39.stringify=_$encode_38;var _$url_86={};function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}_$url_86.parse=urlParse,_$url_86.resolve=urlResolve;var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,delims=["<",">",'"',"`"," ","\r","\n","\t"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function urlParse(t,e,n){if(t&&_$util_87.isObject(t)&&t instanceof Url)return t;var i=new Url;return i.parse(t,e,n),i}function urlFormat(t){return _$util_87.isString(t)&&(t=urlParse(t)),t instanceof Url?t.format():Url.prototype.format.call(t)}function urlResolve(t,e){return urlParse(t,!1,!0).resolve(e)}function urlResolveObject(t,e){return t?urlParse(t,!1,!0).resolveObject(e):e}Url.prototype.parse=function(t,e,n){if(!_$util_87.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var i=t.indexOf("?"),r=-1!==i&&i<t.indexOf("#")?"?":"#",o=t.split(r);o[0]=o[0].replace(/\\/g,"/");var s=t=o.join(r);if(s=s.trim(),!n&&1===t.split("#").length){var a=simplePathPattern.exec(s);if(a)return this.path=s,this.href=s,this.pathname=a[1],a[2]?(this.search=a[2],this.query=e?_$querystringEs3_39.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var c=protocolPattern.exec(s);if(c){var l=(c=c[0]).toLowerCase();this.protocol=l,s=s.substr(c.length)}if(n||c||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var h="//"===s.substr(0,2);!h||c&&hostlessProtocol[c]||(s=s.substr(2),this.slashes=!0)}if(!hostlessProtocol[c]&&(h||c&&!slashedProtocol[c])){for(var u,p,f=-1,d=0;d<hostEndingChars.length;d++){-1!==(m=s.indexOf(hostEndingChars[d]))&&(-1===f||m<f)&&(f=m)}-1!==(p=-1===f?s.lastIndexOf("@"):s.lastIndexOf("@",f))&&(u=s.slice(0,p),s=s.slice(p+1),this.auth=decodeURIComponent(u)),f=-1;for(d=0;d<nonHostChars.length;d++){var m;-1!==(m=s.indexOf(nonHostChars[d]))&&(-1===f||m<f)&&(f=m)}-1===f&&(f=s.length),this.host=s.slice(0,f),s=s.slice(f),this.parseHost(),this.hostname=this.hostname||"";var _="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!_)for(var v=this.hostname.split(/\./),y=(d=0,v.length);d<y;d++){var g=v[d];if(g&&!g.match(hostnamePartPattern)){for(var b="",w=0,E=g.length;w<E;w++)g.charCodeAt(w)>127?b+="x":b+=g[w];if(!b.match(hostnamePartPattern)){var x=v.slice(0,d),C=v.slice(d+1),T=g.match(hostnamePartStart);T&&(x.push(T[1]),C.unshift(T[2])),C.length&&(s="/"+C.join(".")+s),this.hostname=x.join(".");break}}}this.hostname.length>hostnameMaxLen?this.hostname="":this.hostname=this.hostname.toLowerCase(),_||(this.hostname=_$punycode_31.toASCII(this.hostname));var S=this.port?":"+this.port:"",D=this.hostname||"";this.host=D+S,this.href+=this.host,_&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!unsafeProtocol[l])for(d=0,y=autoEscape.length;d<y;d++){var $=autoEscape[d];if(-1!==s.indexOf($)){var R=encodeURIComponent($);R===$&&(R=escape($)),s=s.split($).join(R)}}var O=s.indexOf("#");-1!==O&&(this.hash=s.substr(O),s=s.slice(0,O));var A=s.indexOf("?");if(-1!==A?(this.search=s.substr(A),this.query=s.substr(A+1),e&&(this.query=_$querystringEs3_39.parse(this.query)),s=s.slice(0,A)):e&&(this.search="",this.query={}),s&&(this.pathname=s),slashedProtocol[l]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){S=this.pathname||"";var M=this.search||"";this.path=S+M}return this.href=this.format(),this},Url.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",n=this.pathname||"",i=this.hash||"",r=!1,o="";this.host?r=t+this.host:this.hostname&&(r=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&_$util_87.isObject(this.query)&&Object.keys(this.query).length&&(o=_$querystringEs3_39.stringify(this.query));var s=this.search||o&&"?"+o||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||slashedProtocol[e])&&!1!==r?(r="//"+(r||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):r||(r=""),i&&"#"!==i.charAt(0)&&(i="#"+i),s&&"?"!==s.charAt(0)&&(s="?"+s),e+r+(n=n.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(s=s.replace("#","%23"))+i},Url.prototype.resolve=function(t){return this.resolveObject(urlParse(t,!1,!0)).format()},Url.prototype.resolveObject=function(t){if(_$util_87.isString(t)){var e=new Url;e.parse(t,!1,!0),t=e}for(var n=new Url,i=Object.keys(this),r=0;r<i.length;r++){var o=i[r];n[o]=this[o]}if(n.hash=t.hash,""===t.href)return n.href=n.format(),n;if(t.slashes&&!t.protocol){for(var s=Object.keys(t),a=0;a<s.length;a++){var c=s[a];"protocol"!==c&&(n[c]=t[c])}return slashedProtocol[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(t.protocol&&t.protocol!==n.protocol){if(!slashedProtocol[t.protocol]){for(var l=Object.keys(t),h=0;h<l.length;h++){var u=l[h];n[u]=t[u]}return n.href=n.format(),n}if(n.protocol=t.protocol,t.host||hostlessProtocol[t.protocol])n.pathname=t.pathname;else{for(var p=(t.pathname||"").split("/");p.length&&!(t.host=p.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),n.pathname=p.join("/")}if(n.search=t.search,n.query=t.query,n.host=t.host||"",n.auth=t.auth,n.hostname=t.hostname||t.host,n.port=t.port,n.pathname||n.search){var f=n.pathname||"",d=n.search||"";n.path=f+d}return n.slashes=n.slashes||t.slashes,n.href=n.format(),n}var m=n.pathname&&"/"===n.pathname.charAt(0),_=t.host||t.pathname&&"/"===t.pathname.charAt(0),v=_||m||n.host&&t.pathname,y=v,g=n.pathname&&n.pathname.split("/")||[],b=(p=t.pathname&&t.pathname.split("/")||[],n.protocol&&!slashedProtocol[n.protocol]);if(b&&(n.hostname="",n.port=null,n.host&&(""===g[0]?g[0]=n.host:g.unshift(n.host)),n.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===p[0]?p[0]=t.host:p.unshift(t.host)),t.host=null),v=v&&(""===p[0]||""===g[0])),_)n.host=t.host||""===t.host?t.host:n.host,n.hostname=t.hostname||""===t.hostname?t.hostname:n.hostname,n.search=t.search,n.query=t.query,g=p;else if(p.length)g||(g=[]),g.pop(),g=g.concat(p),n.search=t.search,n.query=t.query;else if(!_$util_87.isNullOrUndefined(t.search)){if(b)n.hostname=n.host=g.shift(),(T=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=T.shift(),n.host=n.hostname=T.shift());return n.search=t.search,n.query=t.query,_$util_87.isNull(n.pathname)&&_$util_87.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!g.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var w=g.slice(-1)[0],E=(n.host||t.host||g.length>1)&&("."===w||".."===w)||""===w,x=0,C=g.length;C>=0;C--)"."===(w=g[C])?g.splice(C,1):".."===w?(g.splice(C,1),x++):x&&(g.splice(C,1),x--);if(!v&&!y)for(;x--;x)g.unshift("..");!v||""===g[0]||g[0]&&"/"===g[0].charAt(0)||g.unshift(""),E&&"/"!==g.join("/").substr(-1)&&g.push("");var T,S=""===g[0]||g[0]&&"/"===g[0].charAt(0);b&&(n.hostname=n.host=S?"":g.length?g.shift():"",(T=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=T.shift(),n.host=n.hostname=T.shift()));return(v=v||n.host&&g.length)&&!S&&g.unshift(""),g.length?n.pathname=g.join("/"):(n.pathname=null,n.path=null),_$util_87.isNull(n.pathname)&&_$util_87.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=t.auth||n.auth,n.slashes=n.slashes||t.slashes,n.href=n.format(),n},Url.prototype.parseHost=function(){var t=this.host,e=portPattern.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)};var _$router_83={render:render,isTransitional:isTransitional,mapRoute:mapRoute};function isTransitional(t){return t.hasOwnProperty("from")&&t.hasOwnProperty("to")}function mapRoute(t,e){var n=~(i=e.url.indexOf("?"))?e.url.slice(i):"",i=0;return t.replace(/\/(?:(?:\:([^?\/:*(]+)(?:\([^)]+\))?)|\*)(\?)?/g,function(t,n,r){var o=n?e[n]:e[i++];return r&&null==o?"":"/"+encodeURIComponent(o)})+n}function render(t,e,n){var i=new RenderReq(t.app.page,t.routes,e,n);i.routeTransitional(0,function(){i.page=t.page(),i.routeQueue(0,function(){i.cancel()})})}function RenderReq(t,e,n,i){this.page=t,this.options=n,this.e=i,this.setUrl(n.url.replace(/#.*/,""));var r=_$url_86.parse(this.url).query;this.query=r?_$lib_33.parse(r):{},this.method=n.method,this.body=n.body||{},this.setPrevious(n.previous),this.transitional=e.transitional[this.method],this.queue=e.queue[this.method],this.app=e.app}RenderReq.prototype.cancel=function(){var t=this.options;this.e||t.noNavigate||(t.form?(t.form.setAttribute("data-router-ignore",""),t.form.submit()):window.location.assign(t.url))},RenderReq.prototype.setUrl=function(t){this.url=t,this.path=t.replace(/\?.*/,"")},RenderReq.prototype.setPrevious=function(t){this.previous=t,this.previousPath=t&&t.replace(/\?.*/,"")},RenderReq.prototype.routeTransitional=function(t,e){var n;for(t||(t=0);n=this.transitional[t++];){if(n.to.match(this.path)&&n.from.match(this.previousPath)){var i=this,r=this.routeParams(n.to);return void this.onMatch(n.to,r,function(n){if(n)return i.cancel();i.routeTransitional(t,e)},o)}function o(){}}e()},RenderReq.prototype.routeQueue=function(t,e){var n;for(t||(t=0);n=this.queue[t++];)if(n.match(this.path)){var i=this,r=this.routeParams(n);return void this.onMatch(n,r,function(n){if(n)return i.cancel();i.routeQueue(t,e)})}e()},RenderReq.prototype.onMatch=function(t,e,n,i){if(!this.page)return n();this.e&&(this.e.preventDefault(),this.e=null),this.page.params=e,t.isTransitional?this.app.onRoute(t.callbacks,this.page,n,i):this.app.onRoute(t.callbacks,this.page,n)},RenderReq.prototype.routeParams=function(t){var e=t.params,n=e.slice();for(var i in e)n[i]=e[i];return n.previous=this.previous,n.url=this.url,n.body=this.body,n.query=this.query,n.method=this.method,n};var parseUrl=_$url_86.parse,resolveUrl=_$url_86.resolve,currentPath=window.location.pathname+window.location.search;window.history.replaceState&&window.history.replaceState({$render:!0,$method:"get"},null,window.location.href);var _$History_81=History;function History(t,e){this.app=t,this.routes=e,window.history.pushState?addListeners(this):(this.push=function(t){window.location.assign(t)},this.replace=function(t){window.location.replace(t)})}function routePath(t){var e=parseUrl(t);return e&&e.protocol===window.location.protocol&&e.host===window.location.host&&e.pathname+(e.search||"")}function renderOptions(t,e){if(t&&"submit"===t.type){for(var n,i=t.target,r=i.elements,o=[],s=0,a=r.length;s<a;s++){var c=(n=r[s]).name;if(c){var l=n.value;if(o.push(encodeURIComponent(c)+"="+encodeURIComponent(l)),"_method"===c){var h=l.toLowerCase();"delete"===h&&(h="del")}}}if(o=o.join("&"),"post"===i.method.toLowerCase())var u=h||"post",p=_$lib_33.parse(o);else u="get",e+="?"+o}else u="get";return{method:u,url:e,previous:window.location.pathname+window.location.search,body:p,form:i,link:t&&t._tracksLink}}function addListeners(t){document.addEventListener("click",function(e){var n=e.target;if(!e.metaKey&&1===e.which&&!e.defaultPrevented)for(;n;){var i=n.href;if(i){if(n.hasAttribute&&n.hasAttribute("data-router-ignore"))return;if(n.target&&"_self"!==n.target)return;var r=i.indexOf("#");if(~r&&i.slice(0,r)===window.location.href.replace(/#.*/,""))return;return e._tracksLink=n,void t.push(i,!0,null,e)}n=n.parentNode}},!0),document.addEventListener("submit",function(e){var n=e.target;if(!e.defaultPrevented&&"form"===n.tagName.toLowerCase()&&!("multipart/form-data"===n.enctype||n.hasAttribute&&n.hasAttribute("data-router-ignore"))){var i=n.action||window.location.href;t.push(i,!0,null,e)}},!1),window.addEventListener("popstate",function(e){if(t.app.page){var n=currentPath,i=e.state,r={previous:n,url:currentPath=window.location.pathname+window.location.search};if(i){if(!i.$render)return;return r.method=i.$method,_$router_83.render(t,r)}var o,s,a=window.location.href,c=a.indexOf("#");~c&&currentPath!==n&&(r.method="get",_$router_83.render(t,r),s=a.slice(c+1),(o=document.getElementById(s)||document.getElementsByName(s)[0])&&o.scrollIntoView())}},!0)}History.prototype.push=function(t,e,n,i){this._update("pushState",t,e,n,i)},History.prototype.replace=function(t,e,n,i){this._update("replaceState",t,e,n,i)},History.prototype.refresh=function(){var t=routePath(window.location.href);_$router_83.render(this,{url:t,method:"get"})},History.prototype.back=function(){window.history.back()},History.prototype.forward=function(){window.history.forward()},History.prototype.go=function(t){window.history.go(t)},History.prototype._update=function(t,e,n,i,r){var o=routePath(resolveUrl(window.location.href,e));if(o){null==n&&(n=!0),null==i&&(i={});var s=renderOptions(r,o);i.$render=!0,i.$method=s.method,window.history[t](i,null,s.url),currentPath=window.location.pathname+window.location.search,n&&_$router_83.render(this,s,r)}},History.prototype.page=function(){var t=this.app.createPage(),e=this;return t.redirect=function(t){if("back"===t)return e.back();"home"===t&&(t="\\"),e.replace(t,!0)},t};var _$browser_82={},__router_82=_$browser_82=_$router_83;function setup(t){var e={queue:{},transitional:{},app:t};t.history=new _$History_81(t,e),["get","post","put","del","enter","exit"].forEach(function(n){var i=e.queue[n]=[],r=e.transitional[n]=[];t[n]=function(e,o){if(Array.isArray(e))return e.forEach(function(e){t[n](e,o)}),t;if(__router_82.isTransitional(e)){var s=e.from,a=e.to,c=e.forward||o&&o.forward||o,l=e.back||o&&o.back,h=new _$Route_84(n,s,l),u=new _$Route_84(n,a,c);return h.isTransitional=!0,u.isTransitional=!0,r.push({from:h,to:u}),l&&r.push({from:u,to:h}),t}return i.push(new _$Route_84(n,e,o)),t}})}__router_82.setup=setup;var _$contexts_7={};function __noop_7(){}function ContextMeta(){this.addBinding=__noop_7,this.removeBinding=__noop_7,this.removeNode=__noop_7,this.addItemContext=__noop_7,this.removeItemContext=__noop_7,this.views=null,this.idNamespace="",this.idCount=0,this.pending=[],this.pauseCount=0}function __Context_7(t,e,n,i,r){this.meta=t,this.controller=e,this.parent=n,this.unbound=i,this.expression=r,this.alias=r&&r.meta&&r.meta.as,this.keyAlias=r&&r.meta&&r.meta.keyAs,this.item=null,this.view=null,this.attributes=null,this.hooks=null,this.initHooks=null,this.closure=null,this._id=null}_$contexts_7.ContextMeta=ContextMeta,_$contexts_7.Context=__Context_7,__Context_7.prototype.id=function(){var t=++this.meta.idCount;return this.meta.idNamespace+"_"+t.toString(36)},__Context_7.prototype.addBinding=function(t){if(!t.itemFor){var e=t.template.expression;(e?e.isUnbound(this):this.unbound)||e&&e.meta&&"with"===e.meta.blockType||this.meta.addBinding(t)}},__Context_7.prototype.removeBinding=function(t){this.meta.removeBinding(t)},__Context_7.prototype.removeNode=function(t){this.meta.removeNode(t)},__Context_7.prototype.child=function(t){var e=t.meta&&t.meta.blockType,n="unbound"===e||"bound"!==e&&this.unbound;return new __Context_7(this.meta,this.controller,this,n,t)},__Context_7.prototype.componentChild=function(t){return new __Context_7(this.meta,t,this,this.unbound)},__Context_7.prototype.eachChild=function(t,e){var n=new __Context_7(this.meta,this.controller,this,this.unbound,t);return n.item=e,this.meta.addItemContext(n),n},__Context_7.prototype.viewChild=function(t,e,n,i){var r=new __Context_7(this.meta,this.controller,this,this.unbound);return r.view=t,r.attributes=e,r.hooks=n,r.initHooks=i,r},__Context_7.prototype.closureChild=function(t){var e=new __Context_7(this.meta,this.controller,this,this.unbound);return e.closure=t,e},__Context_7.prototype.forRelative=function(t){for(var e=this;e&&e.expression===t||e.view;)e=e.parent;return e},__Context_7.prototype.forAlias=function(t){for(var e=this;e;){if(e.alias===t||e.keyAlias===t)return e;e=e.parent}},__Context_7.prototype.forAttribute=function(t){for(var e=this;e;){if(e.view){var n=e.attributes;if(!n)return;if(n.hasOwnProperty(t))return e;if(!n.inherit&&!n.extend)return}e=e.parent}},__Context_7.prototype.forViewParent=function(){for(var t=this;t;){if(t.closure)return t.closure.parent;if(t.view)return t.parent;t=t.parent}},__Context_7.prototype.getView=function(){for(var t=this;t;){if(t.view)return t.view;t=t.parent}},__Context_7.prototype.get=function(){var t=this.expression?this.expression.get(this):this.controller.model.data;return null!=this.item?t&&t[this.item]:t},__Context_7.prototype.pause=function(){this.meta.pauseCount++},__Context_7.prototype.unpause=function(){--this.meta.pauseCount||this.flush()},__Context_7.prototype.flush=function(){var t=this.meta.pending,e=t.length;if(e){this.meta.pending=[];for(var n=0;n<e;n++)t[n]()}},__Context_7.prototype.queue=function(t){this.meta.pending.push(t)};var _$operatorFns_9={get:{"!U":function(t){return!t},"-U":function(t){return-t},"+U":function(t){return+t},"~U":function(t){return~t},typeofU:function(t){return typeof t},"||":function(t,e){return t||e},"&&":function(t,e){return t&&e},"|":function(t,e){return t|e},"^":function(t,e){return t^e},"&":function(t,e){return t&e},"==":function(t,e){return t==e},"!=":function(t,e){return t!=e},"===":function(t,e){return t===e},"!==":function(t,e){return t!==e},"<":function(t,e){return t<e},">":function(t,e){return t>e},"<=":function(t,e){return t<=e},">=":function(t,e){return t>=e},instanceof:function(t,e){return t instanceof e},in:function(t,e){return t in e},"<<":function(t,e){return t<<e},">>":function(t,e){return t>>e},">>>":function(t,e){return t>>>e},"+":function(t,e){return t+e},"-":function(t,e){return t-e},"*":function(t,e){return t*e},"/":function(t,e){return t/e},"%":function(t,e){return t%e},"?":function(t,e,n){return t?e:n},",":function(){return arguments[arguments.length-1]}},set:{"!U":function(t){return[!t]},"-U":function(t){return[-t]},"==":function(t,e,n){if(t)return[n]},"===":function(t,e,n){if(t)return[n]},in:function(t,e,n){return n[e]=!0,{1:n}},"+":function(t,e,n){return[t-n]},"-":function(t,e,n){return[t+n]},"*":function(t,e,n){return[t/n]},"/":function(t,e,n){return[t*n]}}},_$saddle_65={},serializeObject=_$serializeObject_66({}),BOOLEAN_PROPERTIES={checked:"checked",disabled:"disabled",readonly:"readOnly",selected:"selected"},INTEGER_PROPERTIES={colspan:"colSpan",maxlength:"maxLength",rowspan:"rowSpan",tabindex:"tabIndex"},STRING_PROPERTIES={cellpadding:"cellPadding",cellspacing:"cellSpacing",class:"className",contenteditable:"contentEditable",enctype:"encoding",for:"htmlFor",frameborder:"frameBorder",id:"id",title:"title",type:"type",usemap:"useMap",value:"value"},UPDATE_PROPERTIES={};mergeInto(BOOLEAN_PROPERTIES,UPDATE_PROPERTIES),mergeInto(INTEGER_PROPERTIES,UPDATE_PROPERTIES),mergeInto(STRING_PROPERTIES,UPDATE_PROPERTIES);var CREATE_PROPERTIES={};mergeInto(UPDATE_PROPERTIES,CREATE_PROPERTIES),CREATE_PROPERTIES.checked="defaultChecked",CREATE_PROPERTIES.value="defaultValue";var VOID_ELEMENTS={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuitem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},NAMESPACE_URIS={svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/2000/xmlns/"};function Template(t,e){this.content=t,this.source=e}function Doctype(t,e,n){this.name=t,this.publicId=e,this.systemId=n}function Text(t){this.data=t,this.escaped=escapeHtml(t)}function DynamicText(t){this.expression=t,this.unbound=!1}function attachText(t,e,n,i,r){if(!e){var o=document.createTextNode(n);return t.appendChild(o),void addNodeBinding(i,r,o)}if(3===e.nodeType){if(e.data===n)return addNodeBinding(i,r,e),e.nextSibling;var s=splitData(e,(n=normalizeLineBreaks(n)).length);if(e.data!==n)throw attachError(t,e);return addNodeBinding(i,r,e),s}if(""===n){o=document.createTextNode("");return t.insertBefore(o,e||null),addNodeBinding(i,r,o),e}throw attachError(t,e)}function Comment(t,e){this.data=t,this.hooks=e}function DynamicComment(t,e){this.expression=t,this.hooks=e}function attachComment(t,e,n,i,r){if(!e||8!==e.nodeType){var o=document.createComment(n);return t.insertBefore(o,e||null),addNodeBinding(i,r,o),e}if(e.data===n)return addNodeBinding(i,r,e),e.nextSibling;throw attachError(t,e)}function addNodeBinding(t,e,n){t.expression&&!t.unbound&&e.addBinding(new NodeBinding(t,e,n)),emitHooks(t.hooks,e,n)}function Html(t){this.data=t}function DynamicHtml(t){this.expression=t,this.ending="/"+t}function createHtmlFragment(t,e){if(t&&1===t.nodeType)return(i=document.createRange()).selectNodeContents(t),i.createContextualFragment(e);var n=document.createElement("div"),i=document.createRange();return n.innerHTML=e,i.selectNodeContents(n),i.extractContents()}function attachHtml(t,e,n){for(var i=0,r=createHtmlFragment(t,n).childNodes.length;i<r;i++){if(!e)throw attachError(t,e);e=e.nextSibling}return e}function Attribute(t,e){this.data=t,this.ns=e}function DynamicAttribute(t,e){this.expression=t,this.ns=e,this.elementNs=null}function getUnescapedValue(t,e){for(var n=t.get(e,!0);n instanceof Template;)n=n.get(e,!0);return n}function Element(t,e,n,i,r,o,s){this.tagName=t,this.attributes=e,this.content=n,this.hooks=i,this.selfClosing=r,this.notClosed=o,this.ns=s,this.endTag=getEndTag(t,r,o),this.startClose=getStartClose(r);var a=t&&t.toLowerCase();this.unescapedContent="script"===a||"style"===a,this.bindContentToValue="textarea"===a}function DynamicElement(t,e,n,i,r,o,s){this.tagName=t,this.attributes=e,this.content=n,this.hooks=i,this.selfClosing=r,this.notClosed=o,this.ns=s,this.startClose=getStartClose(r),this.unescapedContent=!1}function getStartClose(t){return t?" />":">"}function getEndTag(t,e,n){var i=t&&t.toLowerCase();return VOID_ELEMENTS[i]||e||n?"":"</"+t+">"}function getAttributeValue(t,e){var n=UPDATE_PROPERTIES[e];return n?t[n]:t.getAttribute(e)}function emitHooks(t,e,n){t&&e.queue(function(){for(var i=0,r=t.length;i<r;i++)t[i].emit(e,n)})}function Block(t,e){this.expression=t,this.ending="/"+t,this.content=e}function ConditionalBlock(t,e){this.expressions=t,this.beginning=t.join("; "),this.ending="/"+this.beginning,this.contents=e}function EachBlock(t,e,n){this.expression=t,this.ending="/"+t,this.content=e,this.elseContent=n}function indexStartNode(t,e){for(var n=t.start,i=0;n=n.nextSibling;){if(n===t.end)return n;if(n.$bindItemStart&&n.$bindItemStart.itemFor===t.start){if(e===i)return n;i++}}}function updateRange(t,e,n,i,r,o,s){e?(e.start=i,e.end=r,e.condition=s,setNodeBounds(e,i,o)):t.addBinding(new RangeBinding(n,t,i,r,o,s))}function setNodeBounds(t,e,n){setNodeProperty(e,n?"$bindItemStart":"$bindStart",t)}function appendContent(t,e,n){for(var i=0,r=e.length;i<r;i++)e[i].appendTo(t,n)}function attachContent(t,e,n,i){for(var r=0,o=n.length;r<o;r++){for(;e&&e.hasAttribute&&e.hasAttribute("data-no-attach");)e=e.nextSibling;e=n[r].attachTo(t,e,i)}return e}function contentHtml(t,e,n){for(var i="",r=0,o=t.length;r<o;r++)i+=t[r].get(e,n);return i}function replaceRange(t,e,n,i,r,o){var s=e.parentNode;if(e.$bindItemStart&&i.firstChild&&(setNodeProperty(i.firstChild,"$bindItemStart",e.$bindItemStart),e.$bindItemStart.start=i.firstChild),e===n)return s.replaceChild(i,e),void emitRemoved(t,e,r);for(var a,c=o?e.nextSibling:e;c;){if(a=c.nextSibling,emitRemoved(t,c,r),o&&c===n){a=n;break}if(s.removeChild(c),c===n)break;c=a}s.insertBefore(i,a||null)}function emitRemoved(t,e,n){t.removeNode(e),emitRemovedBinding(t,n,e,"$bindNode"),emitRemovedBinding(t,n,e,"$bindStart"),emitRemovedBinding(t,n,e,"$bindItemStart");var i=e.$bindAttributes;if(i)for(var r in e.$bindAttributes=null,i)t.removeBinding(i[r]);for(e=e.firstChild;e;e=e.nextSibling)emitRemoved(t,e,n)}function emitRemovedBinding(t,e,n,i){var r=n[i];r&&(n[i]=null,r!==e&&t.removeBinding(r))}function attachError(t,e){return"undefined"!=typeof console&&console.error("Attach failed for",e,"within",t),new Error("Attaching bindings failed, because HTML structure does not match client rendering.")}function Binding(){this.meta=null}function NodeBinding(t,e,n){this.template=t,this.context=e,this.node=n,this.meta=null,setNodeProperty(n,"$bindNode",this)}function AttributeBindingsMap(){}function AttributeBinding(t,e,n,i){this.template=t,this.context=e,this.element=n,this.name=i,this.meta=null,(n.$bindAttributes||(n.$bindAttributes=new AttributeBindingsMap))[i]=this}function RangeBinding(t,e,n,i,r,o){this.template=t,this.context=e,this.start=n,this.end=i,this.itemFor=r,this.condition=o,this.meta=null,setNodeBounds(this,n,r)}function __noop_65(){}function mergeInto(t,e){for(var n in t)e[n]=t[n]}function escapeHtml(t){return(t+="").replace(/[&<]/g,function(t){return"&"===t?"&amp;":"&lt;"})}function escapeAttribute(t){return(t+="").replace(/[&"]/g,function(t){return"&"===t?"&amp;":"&quot;"})}function equalConditions(t,e){return t===e||t instanceof Template&&t.equals(e)}function splitData(t,e){var n=t.cloneNode(!1);return n.deleteData(0,e),t.deleteData(e,t.length-e),t.parentNode.insertBefore(n,t.nextSibling||null),n}function setNodeProperty(t,e,n){return t[e]=n}function normalizeLineBreaks(t){return t}_$saddle_65.CREATE_PROPERTIES=CREATE_PROPERTIES,_$saddle_65.BOOLEAN_PROPERTIES=BOOLEAN_PROPERTIES,_$saddle_65.INTEGER_PROPERTIES=INTEGER_PROPERTIES,_$saddle_65.STRING_PROPERTIES=STRING_PROPERTIES,_$saddle_65.UPDATE_PROPERTIES=UPDATE_PROPERTIES,_$saddle_65.VOID_ELEMENTS=VOID_ELEMENTS,_$saddle_65.NAMESPACE_URIS=NAMESPACE_URIS,_$saddle_65.Template=Template,_$saddle_65.Doctype=Doctype,_$saddle_65.Text=Text,_$saddle_65.DynamicText=DynamicText,_$saddle_65.Comment=Comment,_$saddle_65.DynamicComment=DynamicComment,_$saddle_65.Html=Html,_$saddle_65.DynamicHtml=DynamicHtml,_$saddle_65.Element=Element,_$saddle_65.DynamicElement=DynamicElement,_$saddle_65.Block=Block,_$saddle_65.ConditionalBlock=ConditionalBlock,_$saddle_65.EachBlock=EachBlock,_$saddle_65.Attribute=Attribute,_$saddle_65.DynamicAttribute=DynamicAttribute,_$saddle_65.Binding=Binding,_$saddle_65.NodeBinding=NodeBinding,_$saddle_65.AttributeBinding=AttributeBinding,_$saddle_65.RangeBinding=RangeBinding,Template.prototype.toString=function(){return this.source},Template.prototype.get=function(t,e){return contentHtml(this.content,t,e)},Template.prototype.getFragment=function(t,e){var n=document.createDocumentFragment();return this.appendTo(n,t,e),n},Template.prototype.appendTo=function(t,e){e.pause(),appendContent(t,this.content,e),e.unpause()},Template.prototype.attachTo=function(t,e,n){n.pause();e=attachContent(t,e,this.content,n);return n.unpause(),e},Template.prototype.update=function(){},Template.prototype.stringify=function(t){return null==t?"":t+""},Template.prototype.equals=function(t){return this===t},Template.prototype.module="templates",Template.prototype.type="Template",Template.prototype.serialize=function(){return serializeObject.instance(this,this.content,this.source)},Doctype.prototype=Object.create(Template.prototype),Doctype.prototype.constructor=Doctype,Doctype.prototype.get=function(){var t=this.publicId?' PUBLIC "'+this.publicId+'"':"",e=this.systemId?this.publicId?' "'+this.systemId+'"':' SYSTEM "'+this.systemId+'"':"";return"<!DOCTYPE "+this.name+t+e+">"},Doctype.prototype.appendTo=function(){},Doctype.prototype.attachTo=function(t,e){if(!e||10!==e.nodeType)throw attachError(t,e);return e.nextSibling},Doctype.prototype.type="Doctype",Doctype.prototype.serialize=function(){return serializeObject.instance(this,this.name,this.publicId,this.systemId)},Text.prototype=Object.create(Template.prototype),Text.prototype.constructor=Text,Text.prototype.get=function(t,e){return e?this.data:this.escaped},Text.prototype.appendTo=function(t){var e=document.createTextNode(this.data);t.appendChild(e)},Text.prototype.attachTo=function(t,e){return attachText(t,e,this.data,this)},Text.prototype.type="Text",Text.prototype.serialize=function(){return serializeObject.instance(this,this.data)},DynamicText.prototype=Object.create(Template.prototype),DynamicText.prototype.constructor=DynamicText,DynamicText.prototype.get=function(t,e){var n=this.expression.get(t);if(n instanceof Template){do{n=n.get(t,e)}while(n instanceof Template);return n}var i=this.stringify(n);return e?i:escapeHtml(i)},DynamicText.prototype.appendTo=function(t,e,n){var i=this.expression.get(e);if(i instanceof Template){var r=document.createComment(this.expression),o=document.createComment("/"+this.expression),s=this.getCondition(e);return t.appendChild(r),i.appendTo(t,e),t.appendChild(o),void updateRange(e,n,this,r,o,null,s)}var a=this.stringify(i),c=document.createTextNode(a);t.appendChild(c),addNodeBinding(this,e,c)},DynamicText.prototype.attachTo=function(t,e,n){var i=this.expression.get(n);if(i instanceof Template){var r=document.createComment(this.expression),o=document.createComment("/"+this.expression),s=this.getCondition(n);return t.insertBefore(r,e||null),e=i.attachTo(t,e,n),t.insertBefore(o,e||null),updateRange(n,null,this,r,o,null,s),e}return attachText(t,e,this.stringify(i),this,n)},DynamicText.prototype.update=function(t,e){if(e instanceof RangeBinding)this._blockUpdate(t,e);else{var n=this.expression.get(t);if(n instanceof Template){var i=e.node;if(!i.parentNode)return;replaceRange(t,i,i,this.getFragment(t),e)}else e.node.data=this.stringify(n)}},DynamicText.prototype.getCondition=function(t){return this.expression.get(t)},DynamicText.prototype.type="DynamicText",DynamicText.prototype.serialize=function(){return serializeObject.instance(this,this.expression)},Comment.prototype=Object.create(Template.prototype),Comment.prototype.constructor=Comment,Comment.prototype.get=function(){return"\x3c!--"+this.data+"--\x3e"},Comment.prototype.appendTo=function(t,e){var n=document.createComment(this.data);t.appendChild(n),emitHooks(this.hooks,e,n)},Comment.prototype.attachTo=function(t,e,n){return attachComment(t,e,this.data,this,n)},Comment.prototype.type="Comment",Comment.prototype.serialize=function(){return serializeObject.instance(this,this.data,this.hooks)},DynamicComment.prototype=Object.create(Template.prototype),DynamicComment.prototype.constructor=DynamicComment,DynamicComment.prototype.get=function(t){var e=getUnescapedValue(this.expression,t);return"\x3c!--"+this.stringify(e)+"--\x3e"},DynamicComment.prototype.appendTo=function(t,e){var n=getUnescapedValue(this.expression,e),i=this.stringify(n),r=document.createComment(i);t.appendChild(r),addNodeBinding(this,e,r)},DynamicComment.prototype.attachTo=function(t,e,n){var i=getUnescapedValue(this.expression,n);return attachComment(t,e,this.stringify(i),this,n)},DynamicComment.prototype.update=function(t,e){var n=getUnescapedValue(this.expression,t);e.node.data=this.stringify(n)},DynamicComment.prototype.type="DynamicComment",DynamicComment.prototype.serialize=function(){return serializeObject.instance(this,this.expression,this.hooks)},Html.prototype=Object.create(Template.prototype),Html.prototype.constructor=Html,Html.prototype.get=function(){return this.data},Html.prototype.appendTo=function(t){var e=createHtmlFragment(t,this.data);t.appendChild(e)},Html.prototype.attachTo=function(t,e){return attachHtml(t,e,this.data)},Html.prototype.type="Html",Html.prototype.serialize=function(){return serializeObject.instance(this,this.data)},DynamicHtml.prototype=Object.create(Template.prototype),DynamicHtml.prototype.constructor=DynamicHtml,DynamicHtml.prototype.get=function(t){var e=getUnescapedValue(this.expression,t);return this.stringify(e)},DynamicHtml.prototype.appendTo=function(t,e,n){var i=document.createComment(this.expression),r=document.createComment(this.ending),o=getUnescapedValue(this.expression,e),s=createHtmlFragment(t,this.stringify(o));t.appendChild(i),t.appendChild(s),t.appendChild(r),updateRange(e,n,this,i,r)},DynamicHtml.prototype.attachTo=function(t,e,n){var i=document.createComment(this.expression),r=document.createComment(this.ending),o=getUnescapedValue(this.expression,n),s=this.stringify(o);return t.insertBefore(i,e||null),e=attachHtml(t,e,s),t.insertBefore(r,e||null),updateRange(n,null,this,i,r),e},DynamicHtml.prototype.update=function(t,e){var n=e.start.parentNode;if(n){var i=e.start,r=e.end,o=getUnescapedValue(this.expression,t);replaceRange(t,i,r,createHtmlFragment(n,this.stringify(o)),e,!0)}},DynamicHtml.prototype.type="DynamicHtml",DynamicHtml.prototype.serialize=function(){return serializeObject.instance(this,this.expression)},Attribute.prototype=Object.create(Template.prototype),Attribute.prototype.constructor=Attribute,Attribute.prototype.get=Attribute.prototype.getBound=function(t){return this.data},Attribute.prototype.type="Attribute",Attribute.prototype.serialize=function(){return serializeObject.instance(this,this.data,this.ns)},DynamicAttribute.prototype=Object.create(Attribute.prototype),DynamicAttribute.prototype.constructor=DynamicAttribute,DynamicAttribute.prototype.get=function(t){return getUnescapedValue(this.expression,t)},DynamicAttribute.prototype.getBound=function(t,e,n,i){return this.elementNs=i,t.addBinding(new AttributeBinding(this,t,e,n)),getUnescapedValue(this.expression,t)},DynamicAttribute.prototype.update=function(t,e){var n=getUnescapedValue(this.expression,t),i=e.element,r=!this.elementNs&&UPDATE_PROPERTIES[e.name];if(r){var o=STRING_PROPERTIES[e.name]?this.stringify(n):n;if(i[r]===o)return;i[r]=o}else!1!==n&&null!=n?(!0===n&&(n=e.name),this.ns?i.setAttributeNS(this.ns,e.name,n):i.setAttribute(e.name,n)):this.ns?i.removeAttributeNS(this.ns,e.name):i.removeAttribute(e.name)},DynamicAttribute.prototype.type="DynamicAttribute",DynamicAttribute.prototype.serialize=function(){return serializeObject.instance(this,this.expression,this.ns)},Element.prototype=Object.create(Template.prototype),Element.prototype.constructor=Element,Element.prototype.getTagName=function(){return this.tagName},Element.prototype.getEndTag=function(){return this.endTag},Element.prototype.get=function(t){var e=this.getTagName(t),n=this.getEndTag(e),i=[e];for(var r in this.attributes){var o=this.attributes[r].get(t);!0===o?i.push(r):!1!==o&&null!=o&&i.push(r+'="'+escapeAttribute(o)+'"')}var s="<"+i.join(" ")+this.startClose;return this.content?s+contentHtml(this.content,t,this.unescapedContent)+n:s+n},Element.prototype.appendTo=function(t,e){var n=this.getTagName(e),i=this.ns?document.createElementNS(this.ns,n):document.createElement(n);for(var r in this.attributes){var o=this.attributes[r],s=o.getBound(e,i,r,this.ns);if(!1!==s&&null!=s){var a=!this.ns&&CREATE_PROPERTIES[r];a?i[a]=s:(!0===s&&(s=r),o.ns?i.setAttributeNS(o.ns,r,s):i.setAttribute(r,s))}}this.content&&(this._bindContent(e,i),appendContent(i,this.content,e)),t.appendChild(i),emitHooks(this.hooks,e,i)},Element.prototype.attachTo=function(t,e,n){var i=this.getTagName(n);if(!e||1!==e.nodeType||e.tagName.toLowerCase()!==i.toLowerCase())throw attachError(t,e);for(var r in this.attributes)this.attributes[r].getBound(n,e,r,this.ns);return this.content&&(this._bindContent(n,e),attachContent(e,e.firstChild,this.content,n)),emitHooks(this.hooks,n,e),e.nextSibling},Element.prototype._bindContent=function(t,e){var n=this.bindContentToValue&&1===this.content.length&&this.content[0];if(n instanceof DynamicText){n.unbound=!0;var i=new DynamicAttribute(n.expression);t.addBinding(new AttributeBinding(i,t,e,"value"))}},Element.prototype.type="Element",Element.prototype.serialize=function(){return serializeObject.instance(this,this.tagName,this.attributes,this.content,this.hooks,this.selfClosing,this.notClosed,this.ns)},DynamicElement.prototype=Object.create(Element.prototype),DynamicElement.prototype.constructor=DynamicElement,DynamicElement.prototype.getTagName=function(t){return getUnescapedValue(this.tagName,t)},DynamicElement.prototype.getEndTag=function(t){return getEndTag(t,this.selfClosing,this.notClosed)},DynamicElement.prototype.type="DynamicElement",Block.prototype=Object.create(Template.prototype),Block.prototype.constructor=Block,Block.prototype.get=function(t,e){var n=t.child(this.expression);return contentHtml(this.content,n,e)},Block.prototype.appendTo=function(t,e,n){var i=e.child(this.expression),r=document.createComment(this.expression),o=document.createComment(this.ending),s=this.getCondition(e);t.appendChild(r),appendContent(t,this.content,i),t.appendChild(o),updateRange(e,n,this,r,o,null,s)},Block.prototype.attachTo=function(t,e,n){var i=n.child(this.expression),r=document.createComment(this.expression),o=document.createComment(this.ending),s=this.getCondition(n);return t.insertBefore(r,e||null),e=attachContent(t,e,this.content,i),t.insertBefore(o,e||null),updateRange(n,null,this,r,o,null,s),e},Block.prototype.type="Block",Block.prototype.serialize=function(){return serializeObject.instance(this,this.expression,this.content)},Block.prototype.update=function(t,e){if(e.start.parentNode){var n=this.getCondition(t);if(!equalConditions(n,e.condition))e.condition=n,replaceRange(t,e.start,e.end,this.getFragment(t,e),e)}},Block.prototype.getCondition=function(t){var e=this.expression.get(t);return"object"==typeof e?NaN:e},DynamicText.prototype._blockUpdate=Block.prototype.update,ConditionalBlock.prototype=Object.create(Block.prototype),ConditionalBlock.prototype.constructor=ConditionalBlock,ConditionalBlock.prototype.get=function(t,e){var n=this.getCondition(t);if(null==n)return"";var i=this.expressions[n],r=t.child(i);return contentHtml(this.contents[n],r,e)},ConditionalBlock.prototype.appendTo=function(t,e,n){var i=document.createComment(this.beginning),r=document.createComment(this.ending);t.appendChild(i);var o=this.getCondition(e);if(null!=o){var s=this.expressions[o],a=e.child(s);appendContent(t,this.contents[o],a)}t.appendChild(r),updateRange(e,n,this,i,r,null,o)},ConditionalBlock.prototype.attachTo=function(t,e,n){var i=document.createComment(this.beginning),r=document.createComment(this.ending);t.insertBefore(i,e||null);var o=this.getCondition(n);if(null!=o){var s=this.expressions[o],a=n.child(s);e=attachContent(t,e,this.contents[o],a)}return t.insertBefore(r,e||null),updateRange(n,null,this,i,r,null,o),e},ConditionalBlock.prototype.type="ConditionalBlock",ConditionalBlock.prototype.serialize=function(){return serializeObject.instance(this,this.expressions,this.contents)},ConditionalBlock.prototype.update=function(t,e){if(e.start.parentNode){var n=this.getCondition(t);if(!equalConditions(n,e.condition))e.condition=n,replaceRange(t,e.start,e.end,this.getFragment(t,e),e)}},ConditionalBlock.prototype.getCondition=function(t){for(var e=0,n=this.expressions.length;e<n;e++)if(this.expressions[e].truthy(t))return e},EachBlock.prototype=Object.create(Block.prototype),EachBlock.prototype.constructor=EachBlock,EachBlock.prototype.get=function(t,e){var n=this.expression.get(t);if(n&&n.length){for(var i="",r=0,o=n.length;r<o;r++){var s=t.eachChild(this.expression,r);i+=contentHtml(this.content,s,e)}return i}return this.elseContent?contentHtml(this.elseContent,t,e):""},EachBlock.prototype.appendTo=function(t,e,n){var i=this.expression.get(e),r=document.createComment(this.expression),o=document.createComment(this.ending);if(t.appendChild(r),i&&i.length)for(var s=0,a=i.length;s<a;s++){var c=e.eachChild(this.expression,s);this.appendItemTo(t,c,r)}else this.elseContent&&appendContent(t,this.elseContent,e);t.appendChild(o),updateRange(e,n,this,r,o)},EachBlock.prototype.appendItemTo=function(t,e,n,i){var r,o,s=t.lastChild;appendContent(t,this.content,e),s===t.lastChild?(r=o=document.createComment("empty"),t.appendChild(r)):(r=s&&s.nextSibling||t.firstChild,o=t.lastChild),updateRange(e,i,this,r,o,n)},EachBlock.prototype.attachTo=function(t,e,n){var i=this.expression.get(n),r=document.createComment(this.expression),o=document.createComment(this.ending);if(t.insertBefore(r,e||null),i&&i.length)for(var s=0,a=i.length;s<a;s++){var c=n.eachChild(this.expression,s);e=this.attachItemTo(t,e,c,r)}else this.elseContent&&(e=attachContent(t,e,this.elseContent,n));return t.insertBefore(o,e||null),updateRange(n,null,this,r,o),e},EachBlock.prototype.attachItemTo=function(t,e,n,i){var r,o,s=e&&e.previousSibling,a=attachContent(t,e,this.content,n);return a===e?(r=o=document.createComment("empty"),t.insertBefore(r,e||null)):(r=s&&s.nextSibling||t.firstChild,o=a&&a.previousSibling||t.lastChild),updateRange(n,null,this,r,o,i),a},EachBlock.prototype.update=function(t,e){if(e.start.parentNode){var n=e.start,i=e.end;if(e.itemFor){var r=document.createDocumentFragment();this.appendItemTo(r,t,e.itemFor,e)}else r=this.getFragment(t,e);replaceRange(t,n,i,r,e)}},EachBlock.prototype.insert=function(t,e,n,i){var r=e.start.parentNode;if(r){if(0===n&&this.expression.get(t).length===i)return this.update(t,e);for(var o=indexStartNode(e,n),s=document.createDocumentFragment(),a=n,c=n+i;a<c;a++){var l=t.eachChild(this.expression,a);this.appendItemTo(s,l,e.start)}r.insertBefore(s,o||null)}},EachBlock.prototype.remove=function(t,e,n,i){var r=e.start.parentNode;if(r){if(0===n&&0===this.expression.get(t).length)return this.update(t,e);for(var o=indexStartNode(e,n),s=0;o;){if(o===e.end)return;if(o.$bindItemStart&&o.$bindItemStart.itemFor===e.start&&i===s++)return;var a=o.nextSibling;r.removeChild(o),emitRemoved(t,o,e),o=a}}},EachBlock.prototype.move=function(t,e,n,i,r){var o=e.start.parentNode;if(o){for(var s=indexStartNode(e,n),a=document.createDocumentFragment(),c=0;s&&s!==e.end&&(!s.$bindItemStart||s.$bindItemStart.itemFor!==e.start||r!==c++);){var l=s.nextSibling;a.appendChild(s),s=l}s=indexStartNode(e,i),o.insertBefore(a,s||null)}},EachBlock.prototype.type="EachBlock",EachBlock.prototype.serialize=function(){return serializeObject.instance(this,this.expression,this.content,this.elseContent)},Binding.prototype.type="Binding",Binding.prototype.update=function(){this.context.pause(),this.template.update(this.context,this),this.context.unpause()},Binding.prototype.insert=function(){this.update()},Binding.prototype.remove=function(){this.update()},Binding.prototype.move=function(){this.update()},NodeBinding.prototype=Object.create(Binding.prototype),NodeBinding.prototype.constructor=NodeBinding,NodeBinding.prototype.type="NodeBinding",AttributeBinding.prototype=Object.create(Binding.prototype),AttributeBinding.prototype.constructor=AttributeBinding,AttributeBinding.prototype.type="AttributeBinding",RangeBinding.prototype=Object.create(Binding.prototype),RangeBinding.prototype.constructor=RangeBinding,RangeBinding.prototype.type="RangeBinding",RangeBinding.prototype.insert=function(t,e){this.context.pause(),this.template.insert?this.template.insert(this.context,this,t,e):this.template.update(this.context,this),this.context.unpause()},RangeBinding.prototype.remove=function(t,e){this.context.pause(),this.template.remove?this.template.remove(this.context,this,t,e):this.template.update(this.context,this),this.context.unpause()},RangeBinding.prototype.move=function(t,e,n){this.context.pause(),this.template.move?this.template.move(this.context,this,t,e,n):this.template.update(this.context,this),this.context.unpause()},Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),function(){if("undefined"!=typeof document){var t=document.createElement("div");t.innerHTML="\r\n<br>\n";var e=t.firstChild.data.length,n=t.lastChild.data.length;1===e&&1===n?normalizeLineBreaks=function(t){return t.replace(/\r\n/g,"\n")}:2===e&&2===n&&(normalizeLineBreaks=function(t){return t.replace(/(^|[^\r])(\n+)/g,function(t,e,n){for(var i=n.length;i--;)e+="\r\n";return e})});var i=document.createElement("input");i.defaultValue="x","x"!==i.value&&(CREATE_PROPERTIES.value="value");try{document.createTextNode("").$try=0}catch(t){setNodeProperty=function(t,e,n){if(3===t.nodeType){var i=t.previousSibling;return i&&i.$bindProxy===t||((i=document.createComment("proxy")).$bindProxy=t,t.parentNode.insertBefore(i,t||null)),i[e]=n}return t[e]=n}}}}();var _$util_12={concat:function(t,e){return t?e?t.concat(e):t:e},hasKeys:function(t){if(!t)return!1;for(var e in t)return!0;return!1},traverseAndCreate:function(t,e){var n=e.length;if(!n)return t;for(var i=0;i<n;i++){var r=e[i];t=t[r]||(t[r]={})}return t}},_$expressions_8={};(function(t){var e=_$serializeObject_66({}),n=_$templates_11({}),i=n.Template,r=_$util_12.concat;function o(t,e){if(!t)return e;for(var n=0,i=t.length;n<i;n++){if(null==e)return e;e=e[t[n]]}return e}function s(t){return Array.isArray(t)?t.length>0:!!t}function a(t){for(var e=[],n=0;n<t.length;n++){var i=t[n];e[n]="object"==typeof i?i.item:i}return e}function c(t,e){return"object"!=typeof t?t:t instanceof i?l(t,e):Array.isArray(t)?function(t,e){for(var n=0;n<t.length;n++)if(h(t[n]))return u(t,e);return t}(t,e):function(t,e){return h(t)?function(t,e){var n={};for(var i in t)n[i]=c(t[i],e);return n}(t,e):t}(t,e)}function l(t,e){for(var n=1e3;t instanceof i;){if(--n<0)throw new Error("Maximum template render passes exceeded");t=t.get(e,!0)}return t}function h(t){if(!t)return!1;if(t.constructor!==Object)return!1;for(var e in t)if(t[e]instanceof i)return!0;return!1}function u(t,e){for(var n=new Array(t.length),i=0;i<t.length;i++)n[i]=c(t[i],e);return n}function p(t,e,n,i,r,o,s,a){this.source=t,this.blockType=e,this.isEnd=n,this.as=i,this.keyAs=r,this.unescaped=o,this.bindType=s,this.valueType=a}function f(t){this.meta=t}function d(t,e){this.value=t,this.meta=e}function m(t,e){this.segments=t,this.meta=e}function _(t,e){this.segments=t,this.meta=e}function v(t,e,n){this.alias=t,this.segments=e,this.meta=n}function y(t,e,n){this.attribute=t,this.segments=e,this.meta=n}function g(t,e,n,i){this.before=t,this.inside=e,this.afterSegments=n,this.meta=i}function b(t,e){if(!(t instanceof i))throw new Error("DeferRenderExpression requires a Template argument");this.template=t,this.meta=e}function w(t,e,n){this.items=t,this.afterSegments=e,this.meta=n}function E(t,e,n){this.properties=t,this.afterSegments=e,this.meta=n}function x(t,e,n,i){this.segments=t,this.args=e,this.afterSegments=n,this.meta=i;var r=t&&t.slice();this.lastSegment=r&&r.pop(),this.parentSegments=r&&r.length?r:null}function C(t,e,n,i){x.call(this,t,e,n,i)}function T(t,e,n,i){this.name=t,this.args=e,this.afterSegments=n,this.meta=i,this.getFn=_$operatorFns_9.get[t],this.setFn=_$operatorFns_9.set[t]}function S(t,e,n){this.args=t,this.afterSegments=e,this.meta=n}function D(t,e){this.expression=t,this.meta=e}function $(t,e){this.expression=t,this.meta=e}function R(t,e,n){if(t instanceof f||t instanceof i)return t.dependencies(e,n)}function O(t,e,n){var i=e.resolve(n);return i?t?(t.push(i),t):[i]:t}function A(t,e,n){if(!e.segments.length)return t;var i=e.resolve(n);return i?t?(t.pop(),t.push(i),t):[i]:t}_$expressions_8.lookup=o,_$expressions_8.templateTruthy=s,_$expressions_8.pathSegments=a,_$expressions_8.renderValue=c,_$expressions_8.renderTemplate=l,_$expressions_8.ExpressionMeta=p,_$expressions_8.Expression=f,_$expressions_8.LiteralExpression=d,_$expressions_8.PathExpression=m,_$expressions_8.RelativePathExpression=_,_$expressions_8.AliasPathExpression=v,_$expressions_8.AttributePathExpression=y,_$expressions_8.BracketsExpression=g,_$expressions_8.DeferRenderExpression=b,_$expressions_8.ArrayExpression=w,_$expressions_8.ObjectExpression=E,_$expressions_8.FnExpression=x,_$expressions_8.OperatorExpression=T,_$expressions_8.NewExpression=C,_$expressions_8.SequenceExpression=S,_$expressions_8.ViewParentExpression=D,_$expressions_8.ScopedModelExpression=$,p.prototype.module="expressions",p.prototype.type="ExpressionMeta",p.prototype.serialize=function(){return e.instance(this,this.source,this.blockType,this.isEnd,this.as,this.keyAs,this.unescaped,this.bindType,this.valueType)},f.prototype.module="expressions",f.prototype.type="Expression",f.prototype.serialize=function(){return e.instance(this,this.meta)},f.prototype.toString=function(){return this.meta&&this.meta.source},f.prototype.truthy=function(t){var e=this.meta.blockType;if("else"===e)return!0;var n=s(this.get(t,!0));return"unless"===e?!n:n},f.prototype.get=function(){},f.prototype.resolve=function(){},f.prototype.dependencies=function(){},f.prototype.pathSegments=function(t){var e=this.resolve(t);return e&&a(e)},f.prototype.set=function(t,e){var n=this.pathSegments(t);if(!n)throw new Error("Expression does not support setting");t.controller.model._set(n,e)},f.prototype._resolvePatch=function(t,e){return t&&t.expression===this&&null!=t.item?e.concat(t):e},f.prototype.isUnbound=function(t){var e=this.meta&&this.meta.bindType;return"unbound"===e||"bound"!==e&&t.unbound},f.prototype._lookupAndContextifyValue=function(t,e){return this.segments&&this.segments.length&&(t=l(t,e),t=o(this.segments,t)),t instanceof i&&!(t instanceof n.ContextClosure)&&(t=new n.ContextClosure(t,e)),t},d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.prototype.type="LiteralExpression",d.prototype.serialize=function(){return e.instance(this,this.value,this.meta)},d.prototype.get=function(){return this.value},m.prototype=Object.create(f.prototype),m.prototype.constructor=m,m.prototype.type="PathExpression",m.prototype.serialize=function(){return e.instance(this,this.segments,this.meta)},m.prototype.get=function(t){if(t.controller)return o(this.segments,t.controller.model.data)},m.prototype.resolve=function(t){if(t.controller){var e=r(t.controller._scope,this.segments);return this._resolvePatch(t,e)}},m.prototype.dependencies=function(t,e){if(t.controller)return O(R(o(this.segments,t.controller.model.data),t,e),this,t)},_.prototype=Object.create(f.prototype),_.prototype.constructor=_,_.prototype.type="RelativePathExpression",_.prototype.serialize=function(){return e.instance(this,this.segments,this.meta)},_.prototype.get=function(t){var e=t.forRelative(this),n=e.get();return this._lookupAndContextifyValue(n,e)},_.prototype.resolve=function(t){var e=t.forRelative(this),n=e.expression?e.expression.resolve(e):[];if(n){var i=n.concat(this.segments);return this._resolvePatch(t,i)}},_.prototype.dependencies=function(t,e){var n=t.forRelative(this);return A(n.expression&&n.expression.dependencies(n,e),this,t)},v.prototype=Object.create(f.prototype),v.prototype.constructor=v,v.prototype.type="AliasPathExpression",v.prototype.serialize=function(){return e.instance(this,this.alias,this.segments,this.meta)},v.prototype.get=function(t){var e=t.forAlias(this.alias);if(e){if(e.keyAlias===this.alias)return e.item;var n=e.get();return this._lookupAndContextifyValue(n,e)}},v.prototype.resolve=function(t){var e=t.forAlias(this.alias);if(e&&e.keyAlias!==this.alias){var n=e.expression.resolve(e);if(n){var i=n.concat(this.segments);return this._resolvePatch(t,i)}}},v.prototype.dependencies=function(t,e){var n=t.forAlias(this.alias);if(n){if(n.keyAlias===this.alias){var i=n.expression.resolve(n.parent);if(!i)return;return[i]}return A(n.expression.dependencies(n,e),this,t)}},y.prototype=Object.create(f.prototype),y.prototype.constructor=y,y.prototype.type="AttributePathExpression",y.prototype.serialize=function(){return e.instance(this,this.attribute,this.segments,this.meta)},y.prototype.get=function(t){var e=t.forAttribute(this.attribute);if(e){var n=e.attributes[this.attribute];return n instanceof f&&(n=n.get(e)),this._lookupAndContextifyValue(n,e)}},y.prototype.resolve=function(t){var e=t.forAttribute(this.attribute);if(e){var n,r=e.attributes[this.attribute];if((r instanceof f||r instanceof i)&&(n=r.resolve(e)),n){var o=n.concat(this.segments);return this._resolvePatch(t,o)}}},y.prototype.dependencies=function(t,e){var n=t.forAttribute(this.attribute);if(n)return A(R(n.attributes[this.attribute],n,e),this,t)},g.prototype=Object.create(f.prototype),g.prototype.constructor=g,g.prototype.type="BracketsExpression",g.prototype.serialize=function(){return e.instance(this,this.before,this.inside,this.afterSegments,this.meta)},g.prototype.get=function(t){var e=this.inside.get(t);if(null!=e){var n=this.before.get(t);if(n){var i=n[e];return this.afterSegments?o(this.afterSegments,i):i}}},g.prototype.resolve=function(t){var e=this.inside.get(t);if(null!=e){var n=this.before.resolve(t);if(n){var i=this.afterSegments?n.concat(e,this.afterSegments):n.concat(e);return this._resolvePatch(t,i)}}},g.prototype.dependencies=function(t,e){var n=this.before.dependencies(t,e);n&&n.pop();var i=this.inside.dependencies(t,e);return O(r(n,i),this,t)},b.prototype=Object.create(f.prototype),b.prototype.constructor=b,b.prototype.type="DeferRenderExpression",b.prototype.serialize=function(){return e.instance(this,this.template,this.meta)},b.prototype.get=function(t){return new n.ContextClosure(this.template,t)},w.prototype=Object.create(f.prototype),w.prototype.constructor=w,w.prototype.type="ArrayExpression",w.prototype.serialize=function(){return e.instance(this,this.items,this.afterSegments,this.meta)},w.prototype.get=function(t){for(var e=new Array(this.items.length),n=0;n<this.items.length;n++){var i=this.items[n].get(t);e[n]=i}return this.afterSegments?o(this.afterSegments,e):e},w.prototype.dependencies=function(t,e){if(this.items){for(var n,i=0;i<this.items.length;i++){var o=this.items[i].dependencies(t,e);n=r(n,o)}return n}},E.prototype=Object.create(f.prototype),E.prototype.constructor=E,E.prototype.type="ObjectExpression",E.prototype.serialize=function(){return e.instance(this,this.properties,this.afterSegments,this.meta)},E.prototype.get=function(t){var e={};for(var n in this.properties){var i=this.properties[n].get(t);e[n]=i}return this.afterSegments?o(this.afterSegments,e):e},E.prototype.dependencies=function(t,e){if(this.properties){var n;for(var i in this.properties){var o=this.properties[i].dependencies(t,e);n=r(n,o)}return n}},x.prototype=Object.create(f.prototype),x.prototype.constructor=x,x.prototype.type="FnExpression",x.prototype.serialize=function(){return e.instance(this,this.segments,this.args,this.afterSegments,this.meta)},x.prototype.get=function(t){var e=this.apply(t);return this.afterSegments?o(this.afterSegments,e):e},x.prototype.apply=function(t,e){if(t.controller){var n=this._lookupParent(t),i=n[this.lastSegment],r=i.get||i;return this._applyFn(r,t,e,n)}},x.prototype._lookupParent=function(e){var n=e.controller,i=this.parentSegments,r=i?o(i,n):n;if(r&&r[this.lastSegment])return r;var s=n.page;if(n!==s&&(r=i?o(i,s):s)&&r[this.lastSegment])return r;if((r=i?o(i,t):t)&&r[this.lastSegment])return r;throw new Error("Function not found for: "+this.segments.join("."))},x.prototype._getInputs=function(t){for(var e=[],n=0,i=this.args.length;n<i;n++){var r=this.args[n].get(t);e.push(c(r,t))}return e},x.prototype._applyFn=function(t,e,n,i){if(!this.args)return n?t.apply(i,n):t.call(i);var r=this._getInputs(e);if(n)for(var o=0,s=n.length;o<s;o++)r.push(n[o]);return t.apply(i,r)},x.prototype.dependencies=function(t,e){var n=[];if(!this.args)return n;for(var i=0,r=this.args.length;i<r;i++){var o=this.args[i].dependencies(t,e);if(o&&!(o.length<1)){for(var s=o.length-1,a=0;a<s;a++)n.push(o[a]);var c=o[s];"*"!==c[c.length-1]&&(c=c.concat("*")),n.push(c)}}return n},x.prototype.set=function(t,e){for(var n,i,r=t.controller;r&&!(n=(i=this.parentSegments?o(this.parentSegments,r):r)&&i[this.lastSegment]);)r=r.parent;var s=n&&n.set;if(!s)throw new Error("No setter function for: "+this.segments.join("."));var a=this._getInputs(t);a.unshift(e);var c=s.apply(i,a);for(var l in c)this.args[l].set(t,c[l])},C.prototype=Object.create(x.prototype),C.prototype.constructor=C,C.prototype.type="NewExpression",C.prototype._applyFn=function(t,e){if(!this.args)return new t;var n=this._getInputs(e);return n.unshift(null),new(t.bind.apply(t,n))},T.prototype=Object.create(x.prototype),T.prototype.constructor=T,T.prototype.type="OperatorExpression",T.prototype.serialize=function(){return e.instance(this,this.name,this.args,this.afterSegments,this.meta)},T.prototype.apply=function(t){var e=this._getInputs(t);return this.getFn.apply(null,e)},T.prototype.set=function(t,e){var n=this._getInputs(t);n.unshift(e);var i=this.setFn.apply(null,n);for(var r in i)this.args[r].set(t,i[r])},S.prototype=Object.create(T.prototype),S.prototype.constructor=S,S.prototype.type="SequenceExpression",S.prototype.serialize=function(){return e.instance(this,this.args,this.afterSegments,this.meta)},S.prototype.name=",",S.prototype.getFn=_$operatorFns_9.get[","],S.prototype.resolve=function(t){return this.args[this.args.length-1].resolve(t)},S.prototype.dependencies=function(t,e){for(var n=[],i=0,r=this.args.length;i<r;i++)for(var o=this.args[i].dependencies(t,e),s=0,a=o.length;s<a;s++)n.push(o[s]);return n},D.prototype=Object.create(f.prototype),D.prototype.constructor=D,D.prototype.type="ViewParentExpression",D.prototype.serialize=function(){return e.instance(this,this.expression,this.meta)},D.prototype.get=function(t){var e=t.forViewParent();return this.expression.get(e)},D.prototype.resolve=function(t){var e=t.forViewParent();return this.expression.resolve(e)},D.prototype.dependencies=function(t,e){var n=t.forViewParent();return this.expression.dependencies(n,e)},D.prototype.pathSegments=function(t){var e=t.forViewParent();return this.expression.pathSegments(e)},D.prototype.set=function(t,e){var n=t.forViewParent();return this.expression.set(n,e)},$.prototype=Object.create(f.prototype),$.prototype.constructor=$,$.prototype.type="ScopedModelExpression",$.prototype.serialize=function(){return e.instance(this,this.expression,this.meta)},$.prototype.get=function(t){var e=this.pathSegments(t);if(e)return t.controller.model.scope(e.join("."))},$.prototype.resolve=function(t){return this.expression.resolve(t)},$.prototype.dependencies=function(t,e){return this.expression.dependencies(t,e)},$.prototype.pathSegments=function(t){return this.expression.pathSegments(t)},$.prototype.set=function(t,e){return this.expression.set(t,e)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var _$derbyTemplates_6={};_$derbyTemplates_6.contexts=_$contexts_7,_$derbyTemplates_6.expressions=_$expressions_8,_$derbyTemplates_6.operatorFns=_$operatorFns_9,_$derbyTemplates_6.options=_$options_10({}),_$derbyTemplates_6.templates=_$templates_11({});var _$Dom_16=Dom;function Dom(t){this.controller=t,this._listeners=null}function DomListener(t,e,n,i){this.type=t,this.target=e,this.listener=n,this.useCapture=!!i}function DestroyListener(t,e){DomListener.call(this,"destroy",t,e)}Dom.prototype._initListeners=function(){var t=this;return this.controller.on("destroy",function(){var e=t._listeners;if(e){for(var n=e.length;n--;)e[n].remove();t._listeners=null}}),this._listeners=[]},Dom.prototype._listenerIndex=function(t){var e=this._listeners;if(!e)return-1;for(var n=e.length;n--;)if(e[n].equals(t))return n;return-1},Dom.prototype.addListener=function(t,e,n,i){"function"==typeof e&&(i=n,n=e,e=document);var r="destroy"===t?new DestroyListener(e,n):new DomListener(t,e,n,i);-1===this._listenerIndex(r)&&(this._listeners||this._initListeners()).push(r);r.add()},Dom.prototype.on=Dom.prototype.addListener,Dom.prototype.once=function(t,e,n,i){"function"==typeof e&&(i=n,n=e,e=document),this.addListener(t,e,function o(){r.removeListener(t,e,o,i);return n.apply(this,arguments)},i);var r=this},Dom.prototype.removeListener=function(t,e,n,i){"function"==typeof e&&(i=n,n=e,e=document);var r=new DomListener(t,e,n,i);r.remove();var o=this._listenerIndex(r);o>-1&&this._listeners.splice(o,1)},DomListener.prototype.equals=function(t){return this.listener===t.listener&&this.target===t.target&&this.type===t.type&&this.useCapture===t.useCapture},DomListener.prototype.add=function(){this.target.addEventListener(this.type,this.listener,this.useCapture)},DomListener.prototype.remove=function(){this.target.removeEventListener(this.type,this.listener,this.useCapture)},DestroyListener.prototype=new DomListener,DestroyListener.prototype.add=function(){var t=this.target.$destroyListeners||(this.target.$destroyListeners=[]);-1===t.indexOf(this.listener)&&t.push(this.listener)},DestroyListener.prototype.remove=function(){var t=this.target.$destroyListeners;if(t){var e=t.indexOf(this.listener);-1!==e&&t.splice(e,1)}};var __EventEmitter_14=_$EventEmitter_23.EventEmitter,_$Controller_14=Controller;function Controller(t,e,n){__EventEmitter_14.call(this),this.dom=new _$Dom_16(this),this.app=t,this.page=e,this.model=n,n.data.$controller=this}_$util_64.mergeInto(Controller.prototype,__EventEmitter_14.prototype),Controller.prototype.emitCancellable=function(){var t=!1;var e=Array.prototype.slice.call(arguments);return e.push(function(){t=!0}),this.emit.apply(this,e),t},Controller.prototype.emitDelayable=function(){var t=Array.prototype.slice.call(arguments),e=t.pop(),n=!1;return t.push(function(){return n=!0,e}),this.emit.apply(this,t),n||e(),n};var _$components_19={},__templates_19=_$derbyTemplates_6.templates,expressions=_$derbyTemplates_6.expressions,slice=[].slice;function Component(t,e){var n=t.controller,i=t.id(),r=["$components",i],o=n.model.root.eventContext(i);o._at=r.join("."),e.id=i,o._set(r,e),o.data=e,_$Controller_14.call(this,n.app,n.page,o),this.parent=n,this.context=t.componentChild(this),this.id=i,this._scope=r,this.page._components[i]=this,this.isDestroyed=!1}function ComponentAttribute(t,e,n){this.expression=t,this.model=e,this.key=n}function ComponentAttributeBinding(t,e,n,i){this.template=new ComponentAttribute(t,e,n),this.context=i,this.condition=t.get(i)}function setModelAttributes(t,e){var n=t.parent.attributes;if(n)for(var i in n){setModelAttribute(t,e,i,n[i])}}function setModelAttribute(t,e,n,i){if(i instanceof expressions.Expression){var r=i.pathSegments(t);if(r)e.root.ref(e._at+"."+n,r.join("."),{updateIndices:!0});else{var o=new ComponentAttributeBinding(i,e,n,t);t.addBinding(o),e.set(n,o.condition)}}else if(i instanceof __templates_19.Template){var s=new __templates_19.ContextClosure(i,t);e.set(n,s)}else e.set(n,i)}function createFactory(t){return t.singleton||t.prototype.singleton?new SingletonComponentFactory(t):new ComponentFactory(t)}function emitInitHooks(t,e){if(t.initHooks)for(var n=0,i=t.initHooks.length;n<i;n++)t.initHooks[n].emit(t,e)}function ComponentModelData(){this.id=null,this.$controller=null}function ComponentFactory(t){this.constructor=t}function __noop_19(){}function SingletonComponentFactory(t){this.constructor=t,this.component=null,t.prototype.destroy=__noop_19}function isBasePrototype(t){return t===Object.prototype||t===Function.prototype||null===t}function getRootPrototype(t){for(;;){var e=Object.getPrototypeOf(t);if(isBasePrototype(e))return t;t=e}}_$components_19.Component=Component,_$components_19.ComponentAttributeBinding=ComponentAttributeBinding,_$components_19.createFactory=createFactory,_$components_19.extendComponent=extendComponent,_$util_64.mergeInto(Component.prototype,_$Controller_14.prototype),Component.prototype.destroy=function(){this.emit("destroy"),this.model.removeContextListeners(),this.model.destroy(),delete this.page._components[this.id];var t=this.page._eventModel.object.$components;t&&delete t.object[this.id],this.isDestroyed=!0},Component.prototype.bind=function(t){var e=this;return this.on("destroy",function(){e=null,t=null}),function(){if(t)return t.apply(e,arguments)}},Component.prototype.throttle=function(t,e){var n=this;if(this.on("destroy",function(){n=null,t=null}),null==e||"number"==typeof e){var i,r=e||0,o=function(){var e=s;s=null,i=+new Date,t&&e&&t.apply(n,e)};return function(){var t=!s;if(s=slice.call(arguments),t){var e=+new Date,n=Math.max(i+r-e,0);setTimeout(o,n)}}}if("function"==typeof e){var s;o=function(){var e=s;s=null,t&&e&&t.apply(n,e)};return function(){var t=!s;s=slice.call(arguments),t&&e(o)}}throw new Error("Second argument must be a delay function or number")},Component.prototype.debounce=function(t,e){if("number"!=typeof(e=e||0))throw new Error("Second argument must be a number");var n,i,r=this;this.on("destroy",function(){r=null,t=null});var o=function(){var e=n;n=null,i=null,t&&e&&t.apply(r,e)};return function(){n=slice.call(arguments),i&&clearTimeout(i),i=setTimeout(o,e)}},Component.prototype.debounceAsync=function(t,e){var n=1!==t.length;if("number"!=typeof(e=e||0))throw new Error("Second argument must be a number");var i=this;this.on("destroy",function(){i=null,t=null});var r,o,s=!1;function a(){var e=r;r=null,o=null,t&&e?(s=!0,e.push(a),t.apply(i,e)):s=!1}return function(){r=n?slice.call(arguments):[],o&&clearTimeout(o),s||(o=setTimeout(a,e))}},Component.prototype.get=function(t,e){return this.getView(t).get(this.context,e)},Component.prototype.getFragment=function(t){return this.getView(t).getFragment(this.context)},Component.prototype.getView=function(t){var e=this.context.getView();return t?this.app.views.find(t,e.namespace):e},Component.prototype.getAttribute=function(t){var e=this.context.forAttribute(t);if(e){var n=e.attributes[t];return n instanceof expressions.Expression&&(n=n.get(e)),expressions.renderValue(n,this.context)}},Component.prototype.setAttribute=function(t,e){this.context.parent.attributes[t]=e},Component.prototype.setNullAttribute=function(t,e){var n=this.context.parent.attributes;null==n[t]&&(n[t]=e)},ComponentAttribute.prototype.update=function(t,e){var n=this.expression.get(t);e.condition=n,this.model.setDiff(this.key,n)},ComponentAttributeBinding.prototype=Object.create(__templates_19.Binding.prototype),ComponentAttributeBinding.prototype.constructor=ComponentAttributeBinding,ComponentFactory.prototype.init=function(t){var e=new(this.constructor.DataConstructor||ComponentModelData),n=new this.constructor(t,e);return n.context||Component.call(n,t,e),setModelAttributes(n.context,n.model),emitInitHooks(t,n),n.emit("init",n),n.init&&n.init(n.model),n.context},ComponentFactory.prototype.create=function(t){var e=t.controller;e.emit("create",e),e.create&&e.create(e.model,e.dom)},SingletonComponentFactory.prototype.isSingleton=!0,SingletonComponentFactory.prototype.init=function(t){return this.component||(this.component=new this.constructor),t.componentChild(this.component)},SingletonComponentFactory.prototype.create=__noop_19;var _extendComponent=Object.setPrototypeOf&&Object.getPrototypeOf?function(t){var e=getRootPrototype(t.prototype);e!==Component.prototype&&Object.setPrototypeOf(e,Component.prototype)}:function(t){var e=t.prototype;t.prototype=Object.create(Component.prototype),t.prototype.constructor=t,_$util_64.mergeInto(t.prototype,e)};function extendComponent(t){t.prototype instanceof Component||_extendComponent(t)}var __expressions_21=_$derbyTemplates_6.expressions,_$EventModel_21=EventModel,nextId=1;function ModelRef(t,e,n,i){this.id=nextId++,this.model=t,this.segments=n,this.item=e,this.outside=i,this.result=i.child(e).refChild(this)}function RefOutMap(){}function RefChildrenMap(){}function BindingsMap(){}function ItemContextsMap(){}function EventModelsMap(){}function EventModel(){this.id=nextId++,this.object=null,this.array=null,this.arrayByReference=null,this.refOut=null,this.refChildren=null,this.bindings=null,this.itemContexts=null}function __hasKeys_21(t){for(var e in t)return!0;return!1}function childSetWildcard(t){t._set()}ModelRef.prototype.update=function(){var t=__expressions_21.pathSegments(this.segments),e=__expressions_21.lookup(t,this.model.data);if(this.item!==e){delete this.outside.child(this.item).refChildren[this.id],this.item=e;var n=this.outside.child(this.item);n.refChildren||(n.refChildren=new RefChildrenMap),n.refChildren[this.id]=this.result,this.result.update()}},EventModel.prototype.refChild=function(t){this.refChildren||(this.refChildren=new RefChildrenMap);var e=t.id;return this.refChildren[e]||(this.refChildren[e]=new EventModel),this.refChildren[e]},EventModel.prototype.arrayLookup=function(t,e,n){var i=__expressions_21.pathSegments(n),r=__expressions_21.lookup(i,t.data),o=this.at(n),s=this.at(e);o.refOut||(o.refOut=new RefOutMap);var a=o.refOut[s.id];return null==a&&(a=new ModelRef(t,r,n,s),o.refOut[s.id]=a),a},EventModel.prototype.child=function(t){var e;if("string"==typeof t)this.object||(this.object={}),e=this.object;else if("number"==typeof t)this.array||(this.array=[]),e=this.array;else{if(t instanceof ModelRef)return t.result;this.arrayByReference||(this.arrayByReference=[]),e=this.arrayByReference,t=t.item}return e[t]||(e[t]=new EventModel)},EventModel.prototype.at=function(t){if(null==t)return this;for(var e=this,n=0;n<t.length;n++)e=e.child(t[n]);return e},EventModel.prototype.isEmpty=function(){if(__hasKeys_21(this.dependancies))return!1;if(__hasKeys_21(this.itemContexts))return!1;if(this.object){if(__hasKeys_21(this.object))return!1;this.object=null}if(this.arrayByReference){for(var t=0;t<this.arrayByReference.length;t++)if(null!=this.arrayByReference[t])return!1;this.arrayByReference=null}if(this.array){for(t=0;t<this.array.length;t++)if(null!=this.array[t])return!1;this.array=null}return!0},EventModel.prototype._addItemContext=function(t){t._id||(t._id=nextId++),this.itemContexts||(this.itemContexts=new ItemContextsMap),this.itemContexts[t._id]=t},EventModel.prototype._removeItemContext=function(t){this.itemContexts&&delete this.itemContexts[t._id]},EventModel.prototype._addBinding=function(t){var e=this.bindings||(this.bindings=new BindingsMap);t.eventModels||(t.eventModels=new EventModelsMap),e[t.id]=t,t.eventModels[this.id]=this},EventModel.prototype.addBinding=function(t,e){this.at(t)._addBinding(e)},EventModel.prototype.addItemContext=function(t,e){this.at(t)._addItemContext(e)},EventModel.prototype.removeBinding=function(t){if(t.eventModels){for(var e in t.eventModels){var n=t.eventModels[e];n.bindings&&delete n.bindings[t.id]}t.eventModels=null}},EventModel.prototype._each=function(t,e,n){if(this.refChildren)for(var i in this.refChildren){var r=this.refChildren[i];r&&r._each(t,e,n)}if(t.length!==e){var o,s=t[e];"string"==typeof s?(o=this.object&&this.object[s])&&o._each(t,e+1,n):((o=this.array&&this.array[s])&&o._each(t,e+1,n),(o=this.arrayByReference&&this.arrayByReference[s])&&o._each(t,e+1,n))}else n(this)},EventModel.prototype.localUpdate=function(t,e){if(this.bindings)for(var n in this.bindings){var i=this.bindings[n];i&&i.update(t,e)}if(this.refOut)for(var n in this.refOut){var r=this.refOut[n];r&&r.update()}},EventModel.prototype.update=function(t,e){if(this.localUpdate(t,e),this.object)for(var n in this.object){(r=this.object[n])&&r.update()}if(this.array)for(var i=0;i<this.array.length;i++){(r=this.array[i])&&r.update()}if(this.arrayByReference)for(i=0;i<this.arrayByReference.length;i++){var r;(r=this.arrayByReference[i])&&r.update()}},EventModel.prototype._updateChildItemContexts=function(t,e){if(this.arrayByReference){null==t&&(t=0),null==e&&(e=this.arrayByReference.length);for(var n=t;n<e;n++){var i=this.arrayByReference[n]&&this.arrayByReference[n].itemContexts;if(i)for(var r in i)i[r].item=n}}},EventModel.prototype._updateArray=function(t,e){if(this.array){null==t&&(t=0),null==e&&(e=this.array.length);for(var n=t;n<e;n++){var i=this.array[n];i&&i.update()}}},EventModel.prototype._updateObject=function(){if(this.object)for(var t in this.object){var e=this.object[t];e&&e.update()}},EventModel.prototype._set=function(t,e){this.update(t,e)},EventModel.prototype._insert=function(t,e){if(this._updateArray(t),this.arrayByReference&&this.arrayByReference.length>t){for(var n=0;n<e;n++)this.arrayByReference.splice(t,0,null);this._updateChildItemContexts(t+e)}if(this.bindings)for(var i in this.bindings){var r=this.bindings[i];r&&r.insert(t,e)}this._updateObject()},EventModel.prototype._remove=function(t,e){if(this._updateArray(t),this.arrayByReference&&(this.arrayByReference.splice(t,e),this._updateChildItemContexts(t)),this.bindings)for(var n in this.bindings){var i=this.bindings[n];i&&i.remove(t,e)}this._updateObject()},EventModel.prototype._move=function(t,e,n){var i,r;t<e?(i=t,r=e+n):(i=e,r=t+n),this._updateArray(i,r);var o=this.arrayByReference;if(o&&o.length>i){var s=o.splice(t,n);o.splice.apply(o,[e,0].concat(s)),this._updateChildItemContexts(i,r)}if(this.bindings)for(var a in this.bindings){var c=this.bindings[a];c&&c.move(t,e,n)}this._updateObject()},EventModel.prototype.mutate=function(t,e){this._each(t,0,e);for(var n=0,i=t.length;n++<i;){var r=t.slice(0,n);r.push("*"),this._each(r,0,childSetWildcard)}},EventModel.prototype.set=function(t,e,n){this.mutate(t,function(t){t._set(e,n)})},EventModel.prototype.insert=function(t,e,n){this.mutate(t,function(t){t._insert(e,n)})},EventModel.prototype.remove=function(t,e,n){this.mutate(t,function(t){t._remove(e,n)})},EventModel.prototype.move=function(t,e,n,i){this.mutate(t,function(t){t._move(e,n,i)})};var _$textDiff_22={};function onStringInsert(t,e,n,i){e||(e=""),replaceText(t,e.slice(0,n)+i+e.slice(n),function(t){return n<t?t+i.length:t})}function onStringRemove(t,e,n,i){e||(e=""),replaceText(t,e.slice(0,n)+e.slice(n+i),function(t){return n<t?t-Math.min(i,t-n):t})}function replaceText(t,e,n){var i=n(t.selectionStart),r=n(t.selectionEnd),o=t.scrollTop;t.value=e,t.scrollTop!==o&&(t.scrollTop=o),document.activeElement===t&&(t.selectionStart=i,t.selectionEnd=r)}function onTextInput(t,e,n){var i=t._get(e)||"";if(i!==n){for(var r=0;i.charAt(r)===n.charAt(r);)r++;for(var o=0;i.charAt(i.length-1-o)===n.charAt(n.length-1-o)&&o+r<i.length&&o+r<n.length;)o++;if(i.length!==r+o){var s=i.length-r-o;t._stringRemove(e,r,s)}if(n.length!==r+o){var a=n.slice(r,n.length-o);t._stringInsert(e,r,a)}}}_$textDiff_22.onStringInsert=onStringInsert,_$textDiff_22.onStringRemove=onStringRemove,_$textDiff_22.onTextInput=onTextInput;var contexts=_$derbyTemplates_6.contexts,__expressions_17=_$derbyTemplates_6.expressions,__templates_17=_$derbyTemplates_6.templates,__DependencyOptions_17=_$derbyTemplates_6.options.DependencyOptions,documentListeners=_$documentListeners_20({}),_$Page_17=Page;function Page(t,e){_$Controller_14.call(this,t,this,e),this.params=null,this.init&&this.init(e),this.context=this._createContext(),this._eventModel=null,this._removeModelListeners=null,this._components={},this._addListeners()}function useLegacyListeners(t){var e=!0,n=t.on("changeImmediate",function(i,r){t.removeListener("changeImmediate",n),e=Array.isArray(r)});return t.set("$derby.testEvent",!0),e}function addDependencies(t,e,n){new BindingWrapper(t,e,n).updateDependencies()}_$util_64.mergeInto(Page.prototype,_$Controller_14.prototype),Page.prototype.$bodyClass=function(t){if(t){for(var e=[],n=t.split(":"),i=0,r=n.length;i<r;i++){var o=n.slice(0,i+1).join("-");e.push(o)}return e.join(" ")}},Page.prototype.$preventDefault=function(t){t.preventDefault()},Page.prototype.$stopPropagation=function(t){t.stopPropagation()},Page.prototype._setRenderParams=function(t){this.model.set("$render.ns",t),this.model.set("$render.params",this.params),this.model.set("$render.url",this.params&&this.params.url),this.model.set("$render.query",this.params&&this.params.query)},Page.prototype._setRenderPrefix=function(t){var e=t?t+":":"";this.model.set("$render.prefix",e)},Page.prototype.get=function(t,e,n){return this._setRenderPrefix(e),this.getView(t,e).get(this.context,n)},Page.prototype.getFragment=function(t,e){return this._setRenderPrefix(e),this.getView(t,e).getFragment(this.context)},Page.prototype.getView=function(t,e){return this.app.views.find(t,e)},Page.prototype.render=function(t){this.app.emit("render",this),this.context.pause(),this._setRenderParams(t);var e=this.getFragment("TitleElement",t),n=this.getFragment("BodyElement",t),i=document.getElementsByTagName("title")[0];i.parentNode.replaceChild(e,i),document.body.parentNode.replaceChild(n,document.body),this.context.unpause(),this.create&&this.create(this.model,this.dom),this.app.emit("routeDone",this,"render")},Page.prototype.attach=function(){this.context.pause();var t=this.model.get("$render.ns"),e=this.getView("TitleElement",t),n=this.getView("BodyElement",t),i=document.getElementsByTagName("title")[0];e.attachTo(i.parentNode,i,this.context),n.attachTo(document.body.parentNode,document.body,this.context),this.context.unpause(),this.create&&this.create(this.model,this.dom)},Page.prototype._createContext=function(){var t=new contexts.ContextMeta;t.views=this.app&&this.app.views;var e=new contexts.Context(t,this);return e.expression=new __expressions_17.PathExpression([]),e.alias="#root",e},Page.prototype._addListeners=function(){var t=this._eventModel=new _$EventModel_21;this._addModelListeners(t),this._addContextListeners(t)},Page.prototype.destroy=function(){for(var t in this.emit("destroy"),this._removeModelListeners(),this._components){this._components[t].destroy()}var e=this.model.silent();e.destroy("_page"),e.destroy("$components"),e.unloadAll&&e.unloadAll()},Page.prototype._addModelListeners=function(t){var e=this.model;if(e){if(useLegacyListeners(e))return this._addModelListenersLegacy(t);var n=e.on("changeImmediate",function(e,n){e=_$util_64.castSegments(e.slice()),t.set(e,n.previous,n.pass)}),i=e.on("loadImmediate",function(e){e=_$util_64.castSegments(e.slice()),t.set(e)}),r=e.on("unloadImmediate",function(e,n){e=_$util_64.castSegments(e.slice()),t.set(e,n.previous)}),o=e.on("insertImmediate",function(e,n){e=_$util_64.castSegments(e.slice()),t.insert(e,n.index,n.values.length)}),s=e.on("removeImmediate",function(e,n){e=_$util_64.castSegments(e.slice()),t.remove(e,n.index,n.values.length)}),a=e.on("moveImmediate",function(e,n){e=_$util_64.castSegments(e.slice()),t.move(e,n.from,n.to,n.howMany)});this._removeModelListeners=function(){e.removeListener("changeImmediate",n),e.removeListener("loadImmediate",i),e.removeListener("unloadImmediate",r),e.removeListener("insertImmediate",o),e.removeListener("removeImmediate",s),e.removeListener("moveImmediate",a)}}},Page.prototype._addModelListenersLegacy=function(t){var e=this.model;if(e){var n=e.on("changeImmediate",function(e,n){var i=n[1],r=n[2];e=_$util_64.castSegments(e.slice()),t.set(e,i,r)}),i=e.on("loadImmediate",function(e){e=_$util_64.castSegments(e.slice()),t.set(e)}),r=e.on("unloadImmediate",function(e){e=_$util_64.castSegments(e.slice()),t.set(e)}),o=e.on("insertImmediate",function(e,n){var i=n[0],r=n[1];e=_$util_64.castSegments(e.slice()),t.insert(e,i,r.length)}),s=e.on("removeImmediate",function(e,n){var i=n[0],r=n[1];e=_$util_64.castSegments(e.slice()),t.remove(e,i,r.length)}),a=e.on("moveImmediate",function(e,n){var i=n[0],r=n[1],o=n[2];e=_$util_64.castSegments(e.slice()),t.move(e,i,r,o)});this._removeModelListeners=function(){e.removeListener("changeImmediate",n),e.removeListener("loadImmediate",i),e.removeListener("unloadImmediate",r),e.removeListener("insertImmediate",o),e.removeListener("removeImmediate",s),e.removeListener("moveImmediate",a)}}},Page.prototype._addContextListeners=function(t){this.context.meta.addBinding=function(e){patchTextBinding(e);var n=e.template.expressions;if(n)for(var i=0,r=n.length;i<r;i++)addDependencies(t,n[i],e);else{var o=e.template.expression;addDependencies(t,o,e)}},this.context.meta.removeBinding=function(e){var n=e.meta;if(!n)return;for(var i=n.length;i--;)t.removeBinding(n[i])},this.context.meta.removeNode=function(t){var e=t.$component;e&&e.destroy();var n=t.$destroyListeners;if(n)for(var i=0;i<n.length;i++)n[i]()},this.context.meta.addItemContext=function(e){var n=e.expression.resolve(e);t.addItemContext(n,e)},this.context.meta.removeItemContext=function(t){}};var __nextId_17=1;function BindingWrapper(t,e,n){this.eventModel=t,this.expression=e,this.binding=n,this.id=__nextId_17++,this.eventModels=null,this.dependencies=null,this.ignoreTemplateDependency=n instanceof _$components_19.ComponentAttributeBinding||n.template instanceof __templates_17.DynamicText&&n instanceof __templates_17.RangeBinding,n.meta?n.meta.push(this):n.meta=[this]}function equalDependencies(t,e){var n=t?t.length:-1;if(n!==(e?e.length:-1))return!1;for(var i=0;i<n;i++){var r=t[i],o=e[i],s=r?r.length:-1,a=o?o.length:-1;if(s!==a)return!1;for(var c=0;c<a;c++)if(r[c]!==o[c])return!1}return!0}function patchTextBinding(t){t instanceof __templates_17.AttributeBinding&&"value"===t.name&&("INPUT"===t.element.tagName||"TEXTAREA"===t.element.tagName)&&documentListeners.inputSupportsSelection(t.element)&&t.template.expression.resolve(t.context)&&(t.update=textInputUpdate)}function textInputUpdate(t,e){textUpdate(this,this.element,t,e)}function textUpdate(t,e,n,i){if(i){if(i.$event&&i.$event.target===e)return;if(i.$stringInsert)return _$textDiff_22.onStringInsert(e,n,i.$stringInsert.index,i.$stringInsert.text);if(i.$stringRemove)return _$textDiff_22.onStringRemove(e,n,i.$stringRemove.index,i.$stringRemove.howMany)}t.template.update(t.context,t)}BindingWrapper.prototype.updateDependencies=function(){var t;this.ignoreTemplateDependency&&this.binding.condition instanceof __templates_17.Template&&(t=new __DependencyOptions_17).setIgnoreTemplate(this.binding.condition);var e=this.expression.dependencies(this.binding.context,t);if(this.dependencies){if(equalDependencies(this.dependencies,e))return;this.eventModel.removeBinding(this)}if(e){this.dependencies=e;for(var n=0,i=e.length;n<i;n++){var r=e[n];r&&this.eventModel.addBinding(r,this)}}},BindingWrapper.prototype.update=function(t,e){this.binding.update(t,e),this.updateDependencies()},BindingWrapper.prototype.insert=function(t,e){this.binding.insert(t,e),this.updateDependencies()},BindingWrapper.prototype.remove=function(t,e){this.binding.remove(t,e),this.updateDependencies()},BindingWrapper.prototype.move=function(t,e,n){this.binding.move(t,e,n),this.updateDependencies()};var _$_views_18=function(t,e){var n=t.expressions,i=t.templates;e.deserialize([[function(){return this.template=new i.Template([new i.Element("title",void 0,[new i.Block(new i.Template([new i.DynamicText(new n.PathExpression(["$render","prefix"],new n.ExpressionMeta("$render.prefix"))),new i.Text("Title")],"{{$render.prefix}}Title"),[new i.DynamicViewInstance(new i.Template([new i.DynamicText(new n.PathExpression(["$render","prefix"],new n.ExpressionMeta("$render.prefix"))),new i.Text("Title")],"{{$render.prefix}}Title"),{})])],void 0,!1)])},"TitleElement"],[function(){return this.template=new i.Template([new i.Element("body",{class:new i.DynamicAttribute(new n.FnExpression(["$bodyClass"],[new n.PathExpression(["$render","ns"])],void 0,new n.ExpressionMeta("$bodyClass($render.ns)")))},[new i.Block(new i.Template([new i.DynamicText(new n.PathExpression(["$render","prefix"],new n.ExpressionMeta("$render.prefix"))),new i.Text("Body")],"{{$render.prefix}}Body"),[new i.DynamicViewInstance(new i.Template([new i.DynamicText(new n.PathExpression(["$render","prefix"],new n.ExpressionMeta("$render.prefix"))),new i.Text("Body")],"{{$render.prefix}}Body"),{})])],void 0,!1,!0)])},"BodyElement"],[function(){return this.template=new i.Template([new i.Text("Derby demo: "),new i.DynamicText(new n.FnExpression(["pageTitle"],[new n.PathExpression(["$render","ns"])],void 0,new n.ExpressionMeta("pageTitle($render.ns)")))])},"Title"],[function(){return this.template=new i.Template([new i.ViewInstance("d-connection-alert",{}),new i.ViewInstance("d-before-unload",{}),new i.Element("nav",void 0,[new i.EachBlock(new n.FnExpression(["navItems"],[new n.PathExpression(["$render","ns"])],void 0,new n.ExpressionMeta("each navItems($render.ns) as #item","each",void 0,"#item")),[new i.ConditionalBlock([new n.AliasPathExpression("#item",["isCurrent"],new n.ExpressionMeta("if #item.isCurrent","if")),new n.Expression(new n.ExpressionMeta("else","else"))],[[new i.Element("b",void 0,[new i.DynamicText(new n.AliasPathExpression("#item",["title"],new n.ExpressionMeta("#item.title")))],void 0,!1)],[new i.Element("a",{href:new i.DynamicAttribute(new n.AliasPathExpression("#item",["href"],new n.ExpressionMeta("#item.href")))},[new i.DynamicText(new n.AliasPathExpression("#item",["title"],new n.ExpressionMeta("#item.title")))],void 0,!1)]]),new i.ConditionalBlock([new n.AliasPathExpression("#item",["isLast"],new n.ExpressionMeta("unless #item.isLast","unless"))],[[new i.Text(" | ")]])]),new i.Element("hr",void 0,null,void 0,!1)],void 0,!1),new i.Block(new n.PathExpression(["$render","ns"],new n.ExpressionMeta("$render.ns")),[new i.DynamicViewInstance(new n.PathExpression(["$render","ns"],new n.ExpressionMeta("$render.ns")),{})])])},"Body"],[function(){return this.template=new i.Template([])},"Tail"],[function(){return this.template=new i.Template([new i.ViewInstance("bench:circles",{})])},"bench:index"],[function(){return this.template=new i.Template([new i.Marker("bench:circles"),new i.Element("div",void 0,[new i.Element("p",void 0,[new i.ConditionalBlock([new n.PathExpression(["mode"],new n.ExpressionMeta("if mode","if")),new n.Expression(new n.ExpressionMeta("else","else"))],[[new i.Text("Mode: "),new i.Element("b",void 0,[new i.DynamicText(new n.PathExpression(["mode"],new n.ExpressionMeta("mode")))],void 0,!1),new i.Text("   FPS: "),new i.Element("b",void 0,[new i.DynamicText(new n.PathExpression(["fps"],new n.ExpressionMeta("fps")))],void 0,!1)],[new i.Text("Select a mode to run:")]])],void 0,!1),new i.Element("p",void 0,[new i.EachBlock(new n.PathExpression(["modes"],new n.ExpressionMeta("each modes","each")),[new i.Element("button",void 0,[new i.DynamicText(new n.RelativePathExpression([],new n.ExpressionMeta("this")))],[new i.ElementOn("click",new n.FnExpression(["start"],[new n.RelativePathExpression([])]))],!1)]),new i.Element("button",void 0,[new i.Text("Stop")],[new i.ElementOn("click",new n.FnExpression(["stop"],[]))],!1)],void 0,!1)],void 0,!1),new i.EachBlock(new n.PathExpression(["boxes"],new n.ExpressionMeta("each boxes","each")),[new i.Element("div",{class:new i.Attribute("box-view")},[new i.Element("div",{class:new i.Attribute("box"),style:new i.DynamicAttribute(new i.Template([new i.Text("\ntop: "),new i.DynamicText(new n.RelativePathExpression(["top"],new n.ExpressionMeta("this.top"))),new i.Text("px;\nleft: "),new i.DynamicText(new n.RelativePathExpression(["left"],new n.ExpressionMeta("this.left"))),new i.Text("px;\nbackground: rgb(0, 0, "),new i.DynamicText(new n.RelativePathExpression(["color"],new n.ExpressionMeta("this.color"))),new i.Text(");")],"\ntop: {{this.top}}px;\nleft: {{this.left}}px;\nbackground: rgb(0, 0, {{this.color}});"))},[new i.DynamicText(new n.RelativePathExpression(["content"],new n.ExpressionMeta("this.content")))],void 0,!1)],void 0,!1)])])},"bench:circles"],[function(){return this.template=new i.Template([new i.ViewInstance("home:colored-title",{content:new i.ViewParent(new i.Template([new i.Element("p",void 0,[new i.Text("This is a collection of random demos. Check 'em out!")],void 0,!1),new i.Element("br",void 0,null,void 0,!1)]))}),new i.Element("br",void 0,null,void 0,!1),new i.Element("br",void 0,null,void 0,!1),new i.ViewInstance("home:svg-ellipse",{data:new n.ViewParentExpression(new n.PathExpression(["sink","home","ellipse"],new n.ExpressionMeta("sink.home.ellipse")))}),new i.Element("br",void 0,null,void 0,!1),new i.Element("br",void 0,null,void 0,!1),new i.Element("p",void 0,[new i.Element("a",{href:new i.Attribute("#jump")},[new i.Text("Test jump link")],void 0,!1)],void 0,!1),new i.Element("br",void 0,null,void 0,!1),new i.Element("p",void 0,[new i.Element("a",{href:new i.Attribute("/live-css/popout")},[new i.Text("Test Live CSS popped out")],void 0,!1)],void 0,!1),new i.Element("p",{style:new i.Attribute("margin: 400px 0 1000px")},[new i.Element("span",{id:new i.Attribute("jump")},[new i.Text("Jumped!")],void 0,!1),new i.Text(" - "),new i.Element("a",{href:new i.Attribute("#")},[new i.Text("Back to top")],void 0,!1),new i.Text(" - "),new i.Element("a",{href:new i.Attribute("/live-css")},[new i.Text("Go to Live CSS")],void 0,!1)],void 0,!1)])},"home:index"],[function(){return this.template=new i.Template([new i.Marker("home:colored-title"),new i.Element("h1",{style:new i.DynamicAttribute(new i.Template([new i.Text("color: "),new i.DynamicText(new n.FnExpression(["unspace"],[new n.PathExpression(["titleColor"])],void 0,new n.ExpressionMeta("unspace(titleColor)")))],"color: {{unspace(titleColor)}}"))},[new i.Text("Welcome in "),new i.DynamicText(new n.PathExpression(["titleColor"],new n.ExpressionMeta("titleColor"))),new i.Text("!")],void 0,!1),new i.DynamicText(new n.AttributePathExpression("content",[],new n.ExpressionMeta("@content"))),new i.Element("p",void 0,[new i.Element("label",void 0,[new i.Text("Title color: "),new i.Element("select",{id:new i.Attribute("title-select")},[new i.EachBlock(new n.PathExpression(["colors"],new n.ExpressionMeta("each colors","each")),[new i.Element("option",{selected:new i.DynamicAttribute(new n.OperatorExpression("===",[new n.PathExpression(["titleColor"]),new n.RelativePathExpression(["name"])],void 0,new n.ExpressionMeta("titleColor === this.name")))},[new i.DynamicText(new n.FnExpression(["capitalize"],[new n.RelativePathExpression(["name"])],void 0,new n.ExpressionMeta("capitalize(this.name)")))],void 0,!1)])],void 0,!1)],void 0,!1),new i.Text(" "),new i.Element("input",{id:new i.Attribute("title-input"),value:new i.DynamicAttribute(new n.FnExpression(["titleInputValue"],[new n.PathExpression(["titleColor"])],void 0,new n.ExpressionMeta("titleInputValue(titleColor)")))},null,void 0,!1)],void 0,!1),new i.Element("h3",void 0,[new i.Text("Colors:")],void 0,!1),new i.Element("div",void 0,[new i.EachBlock(new n.PathExpression(["colors"],new n.ExpressionMeta("each colors","each")),[new i.Element("p",void 0,[new i.Element("input",{type:new i.Attribute("radio"),is:new i.Attribute("title-radio"),checked:new i.DynamicAttribute(new n.OperatorExpression("===",[new n.PathExpression(["titleColor"]),new n.RelativePathExpression(["name"])],void 0,new n.ExpressionMeta("titleColor === this.name")))},null,void 0,!1),new i.Text(" "),new i.Element("input",{class:new i.Attribute("color-input"),value:new i.DynamicAttribute(new n.FnExpression(["colorInputValue"],[new n.RelativePathExpression(["name"]),new n.PathExpression(["titleColor"])],void 0,new n.ExpressionMeta("colorInputValue(this.name, titleColor)")))},null,void 0,!1),new i.Text(" "),new i.Element("button",void 0,[new i.Text("Select")],[new i.ElementOn("click",new n.FnExpression(["model","set"],[new n.LiteralExpression("titleColor"),new n.RelativePathExpression(["name"])]))],!1)],void 0,!1)])],void 0,!1)])},"home:colored-title"],[function(){return this.template=new i.Template([new i.Element("svg",{width:new i.Attribute("200"),height:new i.Attribute("200")},[new i.Element("ellipse",{cx:new i.DynamicAttribute(new n.AttributePathExpression("data",["cx"],new n.ExpressionMeta("@data.cx"))),cy:new i.DynamicAttribute(new n.AttributePathExpression("data",["cy"],new n.ExpressionMeta("@data.cy"))),rx:new i.DynamicAttribute(new n.AttributePathExpression("data",["rx"],new n.ExpressionMeta("@data.rx"))),ry:new i.DynamicAttribute(new n.AttributePathExpression("data",["ry"],new n.ExpressionMeta("@data.ry"))),fill:new i.DynamicAttribute(new n.AttributePathExpression("data",["fill"],new n.ExpressionMeta("@data.fill")))},null,void 0,!0,null,"http://www.w3.org/2000/svg")],void 0,!1,null,"http://www.w3.org/2000/svg"),new i.Element("p",void 0,[new i.Text("CX: "),new i.Element("input",{type:new i.Attribute("number"),value:new i.DynamicAttribute(new n.AttributePathExpression("data",["cx"],new n.ExpressionMeta("@data.cx")))},null,void 0,!1)],void 0,!1),new i.Element("p",void 0,[new i.Text("CY: "),new i.Element("input",{type:new i.Attribute("number"),value:new i.DynamicAttribute(new n.AttributePathExpression("data",["cy"],new n.ExpressionMeta("@data.cy")))},null,void 0,!1)],void 0,!1),new i.Element("p",void 0,[new i.Text("RX: "),new i.Element("input",{type:new i.Attribute("range"),value:new i.DynamicAttribute(new n.AttributePathExpression("data",["rx"],new n.ExpressionMeta("@data.rx")))},null,void 0,!1)],void 0,!1),new i.Element("p",void 0,[new i.Text("RY: "),new i.Element("input",{type:new i.Attribute("range"),value:new i.DynamicAttribute(new n.AttributePathExpression("data",["ry"],new n.ExpressionMeta("@data.ry")))},null,void 0,!1)],void 0,!1),new i.Element("p",void 0,[new i.Text("Fill: "),new i.Element("input",{value:new i.DynamicAttribute(new n.AttributePathExpression("data",["fill"],new n.ExpressionMeta("@data.fill")))},null,void 0,!1)],void 0,!1)])},"home:svg-ellipse"],[function(){return this.template=new i.Template([new i.Marker("leaderboard:index"),new i.Element("form",void 0,[new i.Element("input",{value:new i.DynamicAttribute(new n.PathExpression(["newPlayer"],new n.ExpressionMeta("newPlayer")))},null,void 0,!1),new i.Text(" "),new i.Element("button",{type:new i.Attribute("submit")},[new i.Text("Add player")],void 0,!1),new i.Text(" "),new i.Element("button",{disabled:new i.DynamicAttribute(new n.OperatorExpression("!U",[new n.PathExpression(["selected"])],void 0,new n.ExpressionMeta("!selected")))},[new i.Text("Remove "),new i.DynamicText(new n.OperatorExpression("||",[new n.PathExpression(["selected","name"]),new n.LiteralExpression("selected")],void 0,new n.ExpressionMeta("selected.name || 'selected'")))],[new i.ElementOn("click",new n.FnExpression(["remove"],[]))],!1)],[new i.ElementOn("submit",new n.FnExpression(["add"],[])),new i.ElementOn("submit",new n.FnExpression(["$preventDefault"],[new n.PathExpression(["$event"])]))],!1),new i.Element("div",{class:new i.Attribute("board")},[new i.Element("div",{class:new i.Attribute("selected-player")},[new i.ConditionalBlock([new n.PathExpression(["selected"],new n.ExpressionMeta("if selected","if")),new n.Expression(new n.ExpressionMeta("else","else"))],[[new i.Element("p",{class:new i.Attribute("vote")},[new i.Element("button",void 0,[new i.Text("+ 5")],[new i.ElementOn("click",new n.FnExpression(["increment"],[new n.LiteralExpression(5)]))],!1),new i.Element("button",void 0,[new i.Text("- 5")],[new i.ElementOn("click",new n.FnExpression(["increment"],[new n.LiteralExpression(-5)]))],!1)],void 0,!1),new i.DynamicText(new n.RelativePathExpression(["name"],new n.ExpressionMeta("this.name")))],[new i.Text("Click a player to select")]])],void 0,!1),new i.Element("ol",void 0,[new i.EachBlock(new n.PathExpression(["list"],new n.ExpressionMeta("each list as #player","each",void 0,"#player")),[new i.Element("li",{class:new i.DynamicAttribute(new i.ConditionalBlock([new n.OperatorExpression("===",[new n.AliasPathExpression("#player",[]),new n.PathExpression(["selected"])],void 0,new n.ExpressionMeta("if #player === selected","if"))],[[new i.Text("selected")]]))},[new i.Element("p",{class:new i.Attribute("score")},[new i.DynamicText(new n.AliasPathExpression("#player",["score"],new n.ExpressionMeta("#player.score")))],void 0,!1),new i.DynamicText(new n.AliasPathExpression("#player",["name"],new n.ExpressionMeta("#player.name")))],[new i.ElementOn("click",new n.FnExpression(["select"],[new n.AliasPathExpression("#player",[])]))],!1)])],void 0,!1)],[new i.AsProperty(["board"])],!1)])},"leaderboard:index"],[function(){return this.template=new i.Template([new i.Marker("live-css:index"),new i.Element("select",{multiple:new i.Attribute(!0)},[new i.Element("optgroup",{label:new i.Attribute("CSS properties")},[new i.EachBlock(new n.PathExpression(["styles"],new n.ExpressionMeta("each styles","each")),[new i.Element("option",{selected:new i.DynamicAttribute(new n.RelativePathExpression(["active"],new n.ExpressionMeta("this.active")))},[new i.DynamicText(new n.RelativePathExpression(["prop"],new n.ExpressionMeta("this.prop")))],void 0,!1)])],void 0,!1)],void 0,!1),new i.Element("div",void 0,[new i.EachBlock(new n.PathExpression(["styles"],new n.ExpressionMeta("each styles as #style, #i","each",void 0,"#style","#i")),[new i.Element("p",void 0,[new i.Element("input",{type:new i.Attribute("checkbox"),checked:new i.DynamicAttribute(new n.AliasPathExpression("#style",["active"],new n.ExpressionMeta("#style.active")))},null,void 0,!1),new i.Text(" "),new i.Element("input",{value:new i.DynamicAttribute(new n.AliasPathExpression("#style",["prop"],new n.ExpressionMeta("#style.prop"))),disabled:new i.DynamicAttribute(new n.OperatorExpression("!U",[new n.AliasPathExpression("#style",["active"])],void 0,new n.ExpressionMeta("!#style.active")))},null,void 0,!1),new i.Text(" "),new i.Element("input",{value:new i.DynamicAttribute(new n.AliasPathExpression("#style",["value"],new n.ExpressionMeta("#style.value"))),disabled:new i.DynamicAttribute(new n.OperatorExpression("!U",[new n.AliasPathExpression("#style",["active"])],void 0,new n.ExpressionMeta("!#style.active")))},null,void 0,!1),new i.Text(" "),new i.Element("a",{href:new i.Attribute("#")},[new i.Text("Delete")],[new i.ElementOn("click",new n.FnExpression(["deleteStyle"],[new n.AliasPathExpression("#i",[])])),new i.ElementOn("click",new n.FnExpression(["$preventDefault"],[new n.PathExpression(["$event"])]))],!1)],void 0,!1)])],void 0,!1),new i.Element("button",void 0,[new i.Text("Add")],[new i.ElementOn("click",new n.FnExpression(["addStyle"],[]))],!1),new i.Element("h3",void 0,[new i.Text("Currently applied:")],void 0,!1),new i.Element("pre",void 0,[new i.Element("code",void 0,[new i.ConditionalBlock([new n.FnExpression(["hasActiveStyles"],[new n.PathExpression(["styles"])],void 0,new n.ExpressionMeta("if hasActiveStyles(styles)","if")),new n.Expression(new n.ExpressionMeta("else","else"))],[[new i.Element("p",void 0,[new i.Text("{")],void 0,!1),new i.Element("ul",{class:new i.Attribute("css")},[new i.EachBlock(new n.PathExpression(["styles"],new n.ExpressionMeta("each styles as #style","each",void 0,"#style")),[new i.Element("li",void 0,[new i.ViewInstance("live-css:css-property",{})],void 0,!1)])],void 0,!1),new i.Element("p",void 0,[new i.Text("}")],void 0,!1)],[new i.Text("(None)")]])],void 0,!1)],void 0,!1),new i.Element("div",void 0,[new i.ConditionalBlock([new n.PathExpression(["poppedOut"],new n.ExpressionMeta("unless poppedOut","unless"))],[[new i.Element("h3",{style:new i.Attribute("display:inline-block")},[new i.Text("Output:")],void 0,!1),new i.Text("   "),new i.Element("a",{href:new i.Attribute("/live-css/popout")},[new i.Text("Pop out")],void 0,!1)]])],void 0,!1),new i.Element("div",{id:new i.Attribute("css-output"),class:new i.DynamicAttribute(new i.ConditionalBlock([new n.PathExpression(["poppedOut"],new n.ExpressionMeta("if poppedOut","if"))],[[new i.Text("popped-out")]]))},[new i.Element("p",{class:new i.Attribute("popup-title")},[new i.Element("a",{href:new i.Attribute("/live-css")},[new i.Text("Close")],void 0,!1)],void 0,!1),new i.Element("div",{class:new i.Attribute("popup-content")},[new i.Element("textarea",{rows:new i.Attribute("20"),cols:new i.Attribute("80"),style:new i.DynamicAttribute(new i.EachBlock(new n.PathExpression(["styles"],new n.ExpressionMeta("each styles as #style","each",void 0,"#style")),[new i.ViewInstance("css-property")]))},[new i.DynamicText(new n.PathExpression(["outputText"],new n.ExpressionMeta("outputText")))],void 0,!1)],void 0,!1)],void 0,!1)])},"live-css:index"],[function(){return this.template=new i.Template([new i.ConditionalBlock([new n.AliasPathExpression("#style",["active"],new n.ExpressionMeta("if #style.active","if"))],[[new i.DynamicText(new n.AliasPathExpression("#style",["prop"],new n.ExpressionMeta("#style.prop"))),new i.Text(": "),new i.DynamicText(new n.AliasPathExpression("#style",["value"],new n.ExpressionMeta("#style.value"))),new i.Text(";")]])])},"live-css:css-property"],[function(){return this.template=new i.Template([new i.Element("form",{action:new i.Attribute("submit"),method:new i.Attribute("post")},[new i.Element("input",{type:new i.Attribute("hidden"),is:new i.Attribute("_method"),value:new i.Attribute("put")},null,void 0,!1),new i.Element("p",void 0,[new i.Element("label",void 0,[new i.Text("Name: "),new i.Element("input",{type:new i.Attribute("text"),is:new i.Attribute("user[name]")},null,void 0,!1)],void 0,!1)],void 0,!1),new i.Element("p",void 0,[new i.Element("label",void 0,[new i.Text("Email: "),new i.Element("input",{type:new i.Attribute("text"),is:new i.Attribute("user[email]")},null,void 0,!1)],void 0,!1)],void 0,!1),new i.Element("p",void 0,[new i.Element("input",{type:new i.Attribute("submit")},null,void 0,!1)],void 0,!1)],void 0,!1),new i.Element("h3",void 0,[new i.Text("Arguments:")],void 0,!1),new i.Element("pre",void 0,[new i.Element("code",void 0,[new i.DynamicText(new n.PathExpression(["_page","args"],new n.ExpressionMeta("_page.args")))],void 0,!1)],void 0,!1)])},"submit:index"],[function(){return this.template=new i.Template([new i.Marker("table:index"),new i.Element("button",void 0,[new i.Text("Add row")],[new i.ElementOn("click",new n.FnExpression(["addRow"],[]))],!1),new i.Text(" "),new i.Element("button",void 0,[new i.Text("Add column")],[new i.ElementOn("click",new n.FnExpression(["addCol"],[]))],!1),new i.Element("hr",void 0,null,void 0,!1),new i.ViewInstance("sortable-table",{},[new i.AsProperty(["sortable"])],[new i.ComponentOn("rowMove",new n.FnExpression(["onRowMove"],[])),new i.ComponentOn("colMove",new n.FnExpression(["onColMove"],[]))]),new i.Element("table",void 0,[new i.Element("tbody",void 0,[new i.Element("tr",void 0,[new i.Element("td",void 0,[],void 0,!1),new i.EachBlock(new n.PathExpression(["table",0,"cells"],new n.ExpressionMeta("each table[0].cells as #cell, #i","each",void 0,"#cell","#i")),[new i.Element("th",{class:new i.Attribute("col")},[new i.DynamicText(new n.FnExpression(["colName"],[new n.AliasPathExpression("#i",[])],void 0,new n.ExpressionMeta("colName(#i)")))],[new i.ElementOn("mousedown",new n.FnExpression(["sortable","onColDown"],[new n.PathExpression(["$event"])]))],!1)]),new i.Element("td",void 0,[],void 0,!1)],void 0,!1),new i.EachBlock(new n.PathExpression(["table"],new n.ExpressionMeta("each table as #row, #i","each",void 0,"#row","#i")),[new i.Element("tr",{class:new i.Attribute("row")},[new i.Element("th",void 0,[new i.DynamicText(new n.OperatorExpression("+",[new n.AliasPathExpression("#i",[]),new n.LiteralExpression(1)],void 0,new n.ExpressionMeta("#i + 1")))],[new i.ElementOn("mousedown",new n.FnExpression(["sortable","onRowDown"],[new n.PathExpression(["$event"])]))],!1),new i.EachBlock(new n.AliasPathExpression("#row",["cells"],new n.ExpressionMeta("each #row.cells","each")),[new i.Element("td",void 0,[new i.Element("input",{value:new i.DynamicAttribute(new n.RelativePathExpression(["text"],new n.ExpressionMeta("this.text")))},null,void 0,!1)],void 0,!1)]),new i.Element("td",void 0,[new i.Element("button",void 0,[new i.Text("Delete")],[new i.ElementOn("click",new n.FnExpression(["deleteRow"],[new n.AliasPathExpression("#i",[])]))],!1)],void 0,!1)],void 0,!1)]),new i.Element("tr",{class:new i.Attribute("foot")},[new i.Element("td",void 0,[],void 0,!1),new i.EachBlock(new n.PathExpression(["table",0,"cells"],new n.ExpressionMeta("each table[0].cells as #cell, #i","each",void 0,"#cell","#i")),[new i.Element("td",void 0,[new i.Element("button",void 0,[new i.Text("Delete")],[new i.ElementOn("click",new n.FnExpression(["deleteCol"],[new n.AliasPathExpression("#i",[])]))],!1)],void 0,!1)]),new i.Element("td",void 0,[],void 0,!1)],void 0,!1)],void 0,!1)],void 0,!1)])},"table:index"],[function(){return this.template=new i.Template([new i.Marker("d-connection-alert:index"),new i.ConditionalBlock([new n.OperatorExpression("!==",[new n.AliasPathExpression("#root",["$connection","state"]),new n.LiteralExpression("connected")],void 0,new n.ExpressionMeta("if #root.$connection.state !== 'connected'","if"))],[[new i.Element("div",{class:new i.Attribute("connection")},[new i.Element("p",{class:new i.Attribute("alert alert-warning")},[new i.ConditionalBlock([new n.OperatorExpression("===",[new n.AliasPathExpression("#root",["$connection","state"]),new n.LiteralExpression("stopped")],void 0,new n.ExpressionMeta("if #root.$connection.state === 'stopped'","if")),new n.Expression(new n.ExpressionMeta("else","else"))],[[new i.Text("Unable to reconnect – "),new i.Element("a",{href:new i.Attribute("#")},[new i.Text("Reload")],[new i.ElementOn("click",new n.FnExpression(["reload"],[])),new i.ElementOn("click",new n.FnExpression(["$preventDefault"],[new n.PathExpression(["$event"])]))],!1)],[new i.DynamicText(new n.FnExpression(["sentenceCase"],[new n.AliasPathExpression("#root",["$connection","state"])],void 0,new n.ExpressionMeta("sentenceCase(#root.$connection.state)"))),new i.ConditionalBlock([new n.PathExpression(["hideReconnect"],new n.ExpressionMeta("unless hideReconnect","unless"))],[[new i.Text(" – "),new i.Element("a",{href:new i.Attribute("#")},[new i.Text("Reconnect")],[new i.ElementOn("click",new n.FnExpression(["reconnect"],[])),new i.ElementOn("click",new n.FnExpression(["$preventDefault"],[new n.PathExpression(["$event"])]))],!1)]])]])],void 0,!1)],void 0,!1)]])])},"d-connection-alert:index"],[function(){return this.template=new i.Template([new i.Marker("d-before-unload")])},"d-before-unload"],[function(){return this.template=new i.Template([new i.Marker("sortable-table")])},"sortable-table"]])},__EventEmitter_13=_$EventEmitter_23.EventEmitter,__templates_13=_$derbyTemplates_6.templates,_$App_13=App;function App(t,e,n,i){__EventEmitter_13.call(this),this.derby=t,this.name=e,this.filename=n,this.scriptHash="f2f09b937ba45cd68a5a49f145ff617f",this.bundledAt=1580856696506,this.Page=createAppPage(t),this.proto=this.Page.prototype,this.views=new __templates_13.Views,this.tracksRoutes=_$browser_82.setup(this),this.model=null,this.page=null,this._pendingComponentMap={},this._init(i)}function createAppPage(t){var e=t&&t.Page||_$Page_17;function n(){e.apply(this,arguments)}return n.prototype=Object.create(e.prototype),n}_$util_64.mergeInto(App.prototype,__EventEmitter_13.prototype),App.prototype._init=function(){this._waitForAttach=!0,this._cancelAttach=!1,this.model=new this.derby.Model,_$_views_18(_$derbyTemplates_6,this.views),this._contentReady()},App.prototype._finishInit=function(){var t=this._getScript(),e=JSON.parse(t.nextSibling.innerHTML);this.model.createConnection(e),this.emit("model",this.model),_$util_64.isProduction="production"===e.nodeEnv,_$util_64.isProduction||this._autoRefresh(),this.model.unbundle(e);var n=this.createPage();if(n.params=this.model.get("$render.params"),this.emit("ready",n),this._waitForAttach=!1,this._cancelAttach)this.history.refresh();else{if(_$util_64.isProduction)try{n.attach()}catch(t){this.history.refresh(),console.warn("attachment error",t.stack)}else n.attach();this.emit("load",n)}},App.prototype._contentReady=function(){var t=!1,e=this;function n(){document.addEventListener?document.removeEventListener("DOMContentLoaded",n,!1):document.detachEvent("onreadystatechange",n),i()}function i(){if(!t){if(!document.body)return setTimeout(i,0);t=!0,setTimeout(function(){e._finishInit()},0)}}if("loading"!==document.readyState)return i();if(document.addEventListener)document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1);else if(document.attachEvent){var r;document.attachEvent("onreadystatechange",n),window.attachEvent("onload",n);try{r=null==window.frameElement}catch(t){}document.documentElement.doScroll&&r&&function e(){if(!t){try{document.documentElement.doScroll("left")}catch(t){return void setTimeout(e,0)}i()}}()}},App.prototype._getScript=function(){return document.querySelector("script[data-derby-app]")},App.prototype.use=_$util_64.use,App.prototype.serverUse=_$util_64.serverUse,App.prototype.loadViews=function(){},App.prototype.loadStyles=function(){},App.prototype.addViews=function(){throw new Error("Parsing not available. Registering a view from source should not be used in application code. Instead, specify a filename with view.file.")},App.prototype.component=function(t,e,n){if("function"==typeof t&&(e=t,t=null),"function"!=typeof e)throw new Error("Missing component constructor argument");var i,r,o,s,a=e.view;a&&"object"==typeof a?(i=a.is,r=a.file,o=a.source,s=a.dependencies):(i=e.is||e.prototype.name,r=e.view||e.prototype.view);var c=t||i||r&&_$pathBrowserify_29.basename(r,".html");if(!c)throw new Error("No view specified for component");if(r&&o)throw new Error("Component may not specify both a view file and source");var l=c.replace(/:index$/,""),h=this.views.nameMap[l];if((h&&h.componentFactory?h.componentFactory.constructor:this._pendingComponentMap[l])!==e){if(n&&h&&!h.fromSerialized)throw new Error('Dependencies cannot override existing views. Already registered "'+c+'"');if(this._pendingComponentMap[l]=e,s)for(var u=0;u<s.length;u++){var p=s[u];Array.isArray(p)?this.component(p[0],p[1],!0):this.component(null,p,!0)}var f;if(r?(this.loadViews(r,c),f=this.views.find(c)):o?(this.addViews(o,c),f=this.views.find(c)):f=t?this.views.find(c):this.views.register(c,""),!f){var d=this.views.findErrorMessage(c);throw new Error(d)}return _$components_19.extendComponent(e),f.componentFactory=_$components_19.createFactory(e),delete this._pendingComponentMap[l],this}},App.prototype.createPage=function(){this.page&&(this.emit("destroyPage",this.page),this.page.destroy());var t=new this.Page(this,this.model);return this.page=t,t},App.prototype.onRoute=function(t,e,n,i){if(this._waitForAttach)this._cancelAttach=!0;else if(this.emit("route",e),e.model.set("$render.params",e.params),e.model.set("$render.url",e.params.url),e.model.set("$render.query",e.params.query),i){var r=this;t.call(e,e,e.model,e.params,n,function(){r.emit("routeDone",e,"transition"),i()})}else t.call(e,e,e.model,e.params,n)},App.prototype._autoRefresh=function(){var t=this,e=this.model.connection;e.on("connected",function(){e.send({derby:"app",name:t.name,hash:t.scriptHash})}),e.on("receive",function(e){if(e.data.derby){var n=e.data;e.data=null,t._handleMessage(n.derby,n)}})},App.prototype._handleMessage=function(t,e){if("refreshViews"===t){new Function("return "+e.views)()(_$derbyTemplates_6,this.views);var n=this.model.get("$render.ns");this.page.render(n)}else if("refreshStyles"===t){var i=document.querySelector('style[data-filename="'+e.filename+'"]');i&&(i.innerHTML=e.css)}else"reload"===t&&this.model.whenNothingPending(function(){window.location=window.location})};var _$Derby_15=Derby;function Derby(){}Derby.prototype=Object.create(_$lib_racer),Derby.prototype.constructor=Derby,Derby.prototype.App=_$App_13,Derby.prototype.Page=_$Page_17,Derby.prototype.Component=_$components_19.Component,Derby.prototype.createApp=function(t,e,n){return new this.App(this,t,e,n)},_$lib_racer.util.isServer||_$documentListeners_20({}).add(document);var _$derby_derby={exports:{}},serverRequire=_$lib_racer.util.serverRequire,__Derby_derby=serverRequire(_$derby_derby,"./lib/DerbyForServer")||_$Derby_15;_$derby_derby.exports=new __Derby_derby,_$derby_derby=_$derby_derby.exports;var _$derbyDebug_5=function(t){t.on("ready",function(e){window.MODEL=e.model,window.APP=t,t.findComponent=findComponent,t.componentCommand=componentCommand,t.derby.Model.prototype.logEvents=logEvents})};function findComponent(t,e){null==e&&(e=0);for(var n,i=document.createTreeWalker(document,128,null,!1);n=i.nextNode();)if(n.data===t){if(0===e)return n.$component;e--}}function componentCommand(t){for(var e,n=0,i=document.createTreeWalker(document,128,null,!1);e=i.nextNode();){if(e===t)return"(component = APP.findComponent('"+e.data+"',"+n+"))";e.data===t.data&&n++}}function logEvents(t){null==t&&(t=""),this.on("all",t+"**",console.log.bind(console))}var _$ConnectionAlert_4={};(function(t){function e(){}_$ConnectionAlert_4=e,e.prototype.view=t,e.prototype.reconnect=function(){var t=this.model;t.set("hideReconnect",!0),setTimeout(function(){t.set("hideReconnect",!1)},1e3),t.reconnect()},e.prototype.reload=function(){window.location.reload()},e.prototype.sentenceCase=function(t){return t&&t.charAt(0).toUpperCase()+t.slice(1)}}).call(this,"/node_modules/d-connection-alert");var _$BeforeUnload_3=BeforeUnload,SortableTable,breakLeft,breakTop,cloneCol,cloneRow,finishCol,finishRow,setLeft,setTop,targetIndex;function BeforeUnload(){}function listenerFn(t){return function(e){if(t.hasWritePending()){var n=t.get("message")||"You have unsaved changes. Do you want to leave this page and discard your changes?";return e.returnValue=n,n}}}BeforeUnload.prototype.name="d-before-unload",BeforeUnload.prototype.create=function(t,e){e.on("beforeunload",window,listenerFn(t))};var _$sortableTable_90=SortableTable=function(){function t(){}return t.view={is:"sortable-table"},t.prototype.create=function(){var t;return this.dragging=null,this.dom.addListener("mousemove",document,(t=this,function(e){return t.onMove(e)})),this.dom.addListener("mouseup",document,function(t){return function(){return t.endDragging()}}(this)),this.dom.addListener("blur",window,function(t){return function(){return t.endDragging(!0)}}(this))},t.prototype.onRowDown=function(t){return this.dragStart(t,cloneRow,setTop,breakTop,".row",finishRow,t.target.parentNode)},t.prototype.onColDown=function(t){return this.dragStart(t,cloneCol,setLeft,breakLeft,".col",finishCol,t.target)},t.prototype.onMove=function(t){var e,n,i,r,o,s,a,c;if(this.dragging){for(s=(c=this.dragging).parent,r=c.last,e=c.breakFn,o=this.dragging.setFn(t),i=0,n=s.querySelectorAll(this.dragging.selector);o>e(i<r?n[i]:n[i+1]);)i++;return i!==r&&((a=n[i<r?i:i+1])||(a=n[n.length-1].nextSibling),s.insertBefore(this.dragging.clone,a)),this.dragging.last=i}},t.prototype.endDragging=function(t){if(this.dragging)return this.dragging.finish(t),document.body.removeChild(this.dragging.container),this.dragging=null},t.prototype.dragStart=function(t,e,n,i,r,o,s){var a,c,l,h,u,p,f,d;if(0===t.button)return"function"==typeof t.preventDefault&&t.preventDefault(),(c=document.createElement("table")).style.position="absolute",f=s.parentNode,d=s.getBoundingClientRect(),h=targetIndex(f.querySelector(r)),a=e(c,s,d,f,h,l=targetIndex(s)-h),u=d.left-t.clientX,p=d.top-t.clientY,this.dragging={component:this,el:s,parent:f,clone:a,nodeOffset:h,index:l,last:l,setFn:n,breakFn:i,selector:r,offsetLeft:u,offsetTop:p,finish:o,container:c},setLeft.call(this.dragging,t),setTop.call(this.dragging,t),document.body.appendChild(c)},t}();return targetIndex=function(t){var e,n,i,r;for(e=n=0,i=(r=t.parentNode.childNodes).length;n<i;e=++n)if(r[e]===t)return e},setLeft=function(t){var e;return e=t.clientX,this.container.style.left=e+window.pageXOffset+this.offsetLeft+"px",e},setTop=function(t){var e;return e=t.clientY,this.container.style.top=e+window.pageYOffset+this.offsetTop+"px",e},breakLeft=function(t){var e;if(t)return(e=t.getBoundingClientRect()).width/2+e.left},breakTop=function(t){var e;if(t)return(e=t.getBoundingClientRect()).height/2+e.top},cloneRow=function(t,e,n,i){var r,o,s,a,c;for(c="<tr>",o=0,s=(a=e.children).length;o<s;o++)c+="<td style=width:"+a[o].offsetWidth+"px;height:0;padding:0>";return(r=e.cloneNode(!1)).removeAttribute("id"),r.style.height=n.height+"px",t.innerHTML=r.innerHTML=c,i.insertBefore(r,e),t.firstChild.appendChild(e),r},cloneCol=function(t,e,n,i,r,o){var s,a,c,l,h,u,p,f,d,m,_;for(_="",l=0,u=(m=i.parentNode.children).length;l<u;l++)_+="<tr class="+(d=m[l]).className+" style=height:"+d.offsetHeight+"px;width:0;padding:0>";for(t.innerHTML=_,(s=e.cloneNode(!1)).removeAttribute("id"),s.setAttribute("rowspan",m.length),s.style.padding=0,s.style.width=n.width+"px",f=o+r,i.insertBefore(s,i.childNodes[f+1]),a=t.firstChild.children,c=h=0,p=m.length;h<p;c=++h)d=m[c],a[c].appendChild(d.childNodes[f]);return s},finishRow=function(t){if(this.parent.removeChild(this.clone),this.parent.insertBefore(this.el,this.parent.childNodes[this.index+this.nodeOffset]),!t)return this.component.emit("rowMove",this.index,this.last)},finishCol=function(t){var e,n,i,r,o,s,a;for(this.parent.removeChild(this.clone),a=this.parent.parentNode.children,e=this.container.firstChild.children,o=this.index+this.nodeOffset,n=i=0,r=a.length;i<r;n=++i)(s=a[n]).insertBefore(e[n].firstChild,s.childNodes[o]);if(!t)return this.component.emit("colMove",this.index,this.last)},_$index_93(),exposedRequire.m.racer=_$lib_racer,exposedRequire.m.derby=_$derby_derby,exposedRequire}("function"==typeof require?require:void 0);
//# sourceMappingURL=/derby/sink-f2f09b937ba45cd68a5a49f145ff617f.map.json